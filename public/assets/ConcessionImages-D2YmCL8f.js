import{Y as f,e as T,a6 as A,u as P,a8 as N,j as e,C as o,c as h,a as u,b as g,az as S,y as F,I,B as x,bg as b,f as G,S as L,bb as K,d as D,aI as y,L as k,A as q}from"./index-Dzu3mJf5.js";const Q=({concessionId:i})=>{const[a,n]=f.useState(null),[p,d]=f.useState(""),[m,c]=f.useState(!1),{toast:r}=T(),j=A(),{data:v=[],isLoading:$}=P({queryKey:[`/api/active-concessions/${i}/images`],queryFn:async()=>{const s=await fetch(`/api/active-concessions/${i}/images`);if(!s.ok)throw new Error("Error al cargar imágenes");return s.json()}}),z=N({mutationFn:async({file:s,caption:t})=>{c(!0);const l=new FormData;l.append("image",s),l.append("caption",t);const C=await fetch(`/api/active-concessions/${i}/images`,{method:"POST",body:l});if(!C.ok)throw new Error("Error al subir imagen");return C.json()},onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/active-concessions/${i}/images`]}),n(null),d(""),c(!1),r({title:"Imagen subida",description:"La imagen se ha subido correctamente"})},onError:s=>{c(!1),r({title:"Error al subir imagen",description:s instanceof Error?s.message:"Error desconocido",variant:"destructive"})}}),w=N({mutationFn:async s=>{if(!(await fetch(`/api/concession-images/${s}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar imagen")},onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/active-concessions/${i}/images`]}),r({title:"Imagen eliminada",description:"La imagen se ha eliminado correctamente"})},onError:s=>{r({title:"Error al eliminar imagen",description:s instanceof Error?s.message:"Error desconocido",variant:"destructive"})}}),E=N({mutationFn:async s=>{if(!(await fetch(`/api/concession-images/${s}/set-primary`,{method:"POST"})).ok)throw new Error("Error al establecer imagen principal")},onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/active-concessions/${i}/images`]}),r({title:"Imagen principal actualizada",description:"La imagen principal se ha actualizado correctamente"})},onError:s=>{r({title:"Error al actualizar imagen principal",description:s instanceof Error?s.message:"Error desconocido",variant:"destructive"})}}),M=s=>{var l;const t=(l=s.target.files)==null?void 0:l[0];if(t){if(t.size>5*1024*1024){r({title:"Archivo muy grande",description:"El archivo debe ser menor a 5MB",variant:"destructive"});return}n(t)}},B=()=>{a&&z.mutate({file:a,caption:p})};return $?e.jsx(o,{children:e.jsx(h,{className:"flex justify-center items-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Subir Nueva Imagen"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(F,{htmlFor:"imageFile",children:"Seleccionar imagen (máx. 5MB)"}),e.jsx(I,{id:"imageFile",type:"file",accept:"image/*",onChange:M,className:"mt-1"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Archivo seleccionado: ",a.name," (",Math.round(a.size/1024)," KB)"]}),e.jsxs("div",{children:[e.jsx(F,{htmlFor:"caption",children:"Descripción (opcional)"}),e.jsx(I,{id:"caption",value:p,onChange:s=>d(s.target.value),placeholder:"Descripción de la imagen...",className:"mt-1"})]}),e.jsx(x,{onClick:B,disabled:m,className:"w-full",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Subir Imagen"]})})]})]})]}),e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"Galería de Imágenes (",v.length,")"]})}),e.jsx(h,{children:v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"No hay imágenes subidas"}),e.jsx("p",{className:"text-sm",children:"Sube la primera imagen para comenzar"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(s=>e.jsxs("div",{className:"relative border rounded-lg hover:shadow-lg transition-shadow bg-white",children:[e.jsx("div",{className:"p-4",children:e.jsx("img",{src:s.image_url,alt:s.caption||"Imagen de concesión",className:"w-full h-auto rounded"})}),s.is_primary&&e.jsxs(G,{className:"absolute top-2 left-2 bg-yellow-500 hover:bg-yellow-600",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Principal"]}),e.jsxs("div",{className:"p-3",children:[s.caption&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.caption}),e.jsxs("div",{className:"flex gap-2",children:[!s.is_primary&&e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>E.mutate(s.id),disabled:E.isPending,children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Hacer principal"]}),e.jsxs(x,{size:"sm",variant:"destructive",onClick:()=>w.mutate(s.id),disabled:w.isPending,children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Eliminar"]})]})]})]},s.id))})})]})]})},H=()=>{var d,m;const{id:i}=D(),a=parseInt(i||"0"),{data:n,isLoading:p}=P({queryKey:[`/api/active-concessions/${a}`],queryFn:async()=>{const c=await fetch(`/api/active-concessions/${a}`);if(!c.ok)throw new Error("Error al cargar concesión");return c.json()},enabled:!!a});return p?e.jsx(y,{title:"Gestión de Imágenes - Concesión",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})}):n?e.jsx(y,{title:"Gestión de Imágenes - Concesión",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(o,{children:e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx(g,{className:"text-2xl",children:"Gestión de Imágenes"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[((d=n.data)==null?void 0:d.name)||n.name," - ",((m=n.data)==null?void 0:m.description)||n.description]})]})]}),e.jsx(k,{href:"/admin/concessions/active",children:e.jsxs(x,{variant:"outline",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Volver al listado"]})})]})})}),e.jsx(Q,{concessionId:a}),e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(g,{children:"Información Importante"})}),e.jsxs(h,{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{children:"Las imágenes subidas aquí aparecerán automáticamente en las landing pages de parques y en las páginas públicas de concesiones."})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{children:"La primera imagen subida se establecerá automáticamente como imagen principal."})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{children:'Puedes cambiar la imagen principal en cualquier momento haciendo clic en "Hacer principal".'})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{children:"Formatos soportados: JPG, PNG, WebP. Tamaño máximo: 5MB por imagen."})]})]})]})]})}):e.jsx(y,{title:"Concesión no encontrada",children:e.jsx(o,{children:e.jsxs(h,{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"La concesión solicitada no existe"}),e.jsx(k,{href:"/admin/concessions/active",children:e.jsxs(x,{children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Volver a Concesiones Activas"]})})]})})})};export{H as default};
