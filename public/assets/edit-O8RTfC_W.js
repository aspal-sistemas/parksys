import{am as W,e as Z,a6 as _,Y as h,u as D,a8 as ee,j as e,aI as y,B as o,A as ae,C as f,a as j,b as N,m as R,c as g,a0 as se,a1 as ie,a2 as re,I as c,az as le,a4 as te,z,H as M,J as Y,K as T,N as n,f as ce,as as U,M as ne,O as b,bz as oe}from"./index-Dzu3mJf5.js";import{F as L}from"./file-symlink-DROl84aY.js";function pe(){var q,E,k;const[V,d]=W(),{toast:m}=Z(),C=_(),F=V.split("/"),p=F[F.length-1],[B,I]=h.useState(null),[u,w]=h.useState(""),[i,P]=h.useState({firstName:"",lastName:"",email:"",phone:"",specialties:[],experienceYears:1,bio:"",preferredParkId:void 0,qualifications:"",availability:"",hourlyRate:0,experience:"",profileImageFile:null,curriculumFile:null}),{data:t,isLoading:K,isError:O}=D({queryKey:[`/api/instructors/${p}`],enabled:!!p}),{data:G=[]}=D({queryKey:["/api/parks"]});h.useEffect(()=>{if(t&&typeof t=="object"){const a=t;let s=[];if(a.specialties){if(Array.isArray(a.specialties))s=a.specialties;else if(typeof a.specialties=="string")try{if(a.specialties.startsWith("[")||a.specialties.startsWith("{")){const r=JSON.parse(a.specialties);s=Array.isArray(r)?r:[r]}else a.specialties.includes(",")?s=a.specialties.split(",").map(r=>r.trim()):s=[a.specialties.trim()]}catch{s=[a.specialties]}}P({firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",phone:a.phone||"",specialties:s,experienceYears:a.experienceYears||1,bio:a.bio||"",preferredParkId:a.preferredParkId||void 0,qualifications:a.qualifications||"",availability:a.availability||"",hourlyRate:a.hourlyRate||0,experience:a.experience||"",profileImageFile:null,curriculumFile:null}),a.profileImageUrl&&I(a.profileImageUrl)}},[t]);const v=ee({mutationFn:async a=>{const s=new FormData;s.append("firstName",a.firstName),s.append("lastName",a.lastName),s.append("email",a.email),s.append("phone",a.phone||""),s.append("specialties",JSON.stringify(a.specialties)),s.append("experienceYears",a.experienceYears.toString()),s.append("bio",a.bio||""),s.append("qualifications",a.qualifications||""),s.append("availability",a.availability||""),s.append("hourlyRate",(a.hourlyRate||0).toString()),s.append("experience",a.experience||""),a.preferredParkId&&s.append("preferredParkId",a.preferredParkId.toString()),a.profileImageFile&&s.append("profileImage",a.profileImageFile),a.curriculumFile&&s.append("curriculum",a.curriculumFile);const r=await fetch(`/api/instructors/${p}`,{method:"PUT",body:s});if(!r.ok){const x=await r.json();throw new Error(x.message||"Error al actualizar instructor")}return await r.json()},onSuccess:()=>{m({title:"Instructor actualizado",description:"Los datos del instructor han sido actualizados exitosamente."}),C.invalidateQueries({queryKey:["/api/instructors"]}),C.invalidateQueries({queryKey:[`/api/instructors/${p}`]}),d("/admin/instructors")},onError:a=>{m({title:"Error al actualizar",description:a.message,variant:"destructive"})}}),l=(a,s)=>{P(r=>({...r,[a]:s}))},J=a=>{var r;const s=(r=a.target.files)==null?void 0:r[0];if(s){const x=new FileReader;x.onload=$=>{var A;return I((A=$.target)==null?void 0:A.result)},x.readAsDataURL(s),l("profileImageFile",s)}},Q=a=>{var r;const s=(r=a.target.files)==null?void 0:r[0];s&&l("curriculumFile",s)},S=()=>{if(u.trim()&&!i.specialties.includes(u.trim())){const a=[...i.specialties,u.trim()];l("specialties",a),w("")}},H=a=>{const s=i.specialties.filter(r=>r!==a);l("specialties",s)},X=a=>{if(a.preventDefault(),!i.firstName||!i.lastName||!i.email){m({title:"Campos requeridos",description:"Por favor completa los campos de nombre, apellido y email.",variant:"destructive"});return}if(i.specialties.length===0){m({title:"Especialidades requeridas",description:"Por favor agrega al menos una especialidad.",variant:"destructive"});return}v.mutate(i)};return K?e.jsx(y,{title:"Cargando...",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#00a587] mx-auto mb-4"}),e.jsx("p",{children:"Cargando datos del instructor..."})]})})}):O?e.jsx(y,{title:"Error",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:"Error al cargar los datos del instructor"}),e.jsx(o,{onClick:()=>d("/admin/instructors"),children:"Volver a la lista"})]})})}):e.jsx(y,{title:"Editar Instructor",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs(o,{variant:"ghost",onClick:()=>d("/admin/instructors"),className:"mr-4",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Editar Instructor"}),e.jsxs("p",{className:"text-muted-foreground",children:["Actualiza la información del instructor ",t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]})]})]})}),e.jsxs("form",{onSubmit:X,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(f,{children:[e.jsx(j,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(R,{className:"mr-2 h-5 w-5"}),"Foto de Perfil"]})}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs(se,{className:"h-32 w-32",children:[e.jsx(ie,{src:B||void 0}),e.jsxs(re,{className:"text-2xl",children:[(q=i.firstName)==null?void 0:q[0],(E=i.lastName)==null?void 0:E[0]]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{type:"file",accept:"image/*",onChange:J,className:"hidden",id:"profile-image"}),e.jsx("label",{htmlFor:"profile-image",children:e.jsx(o,{type:"button",variant:"outline",size:"sm",asChild:!0,children:e.jsxs("span",{className:"cursor-pointer",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Cambiar foto"]})})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Formatos: JPG, PNG. Máx: 5MB"})]})})]})}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(f,{children:[e.jsx(j,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(R,{className:"mr-2 h-5 w-5"}),"Información Personal"]})}),e.jsxs(g,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"firstName",className:"text-sm font-medium",children:"Nombre *"}),e.jsx(c,{id:"firstName",placeholder:"Nombre del instructor",value:i.firstName,onChange:a=>l("firstName",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"lastName",className:"text-sm font-medium",children:"Apellido *"}),e.jsx(c,{id:"lastName",placeholder:"Apellido del instructor",value:i.lastName,onChange:a=>l("lastName",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email *"}),e.jsx(c,{id:"email",type:"email",placeholder:"email@ejemplo.com",value:i.email,onChange:a=>l("email",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium",children:"Teléfono"}),e.jsx(c,{id:"phone",placeholder:"(33) 1234-5678",value:i.phone,onChange:a=>l("phone",a.target.value)})]})]})]}),e.jsxs(f,{children:[e.jsx(j,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(te,{className:"mr-2 h-5 w-5"}),"Información Profesional"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"experienceYears",className:"text-sm font-medium",children:"Años de Experiencia"}),e.jsx(c,{id:"experienceYears",type:"number",min:"0",max:"50",value:i.experienceYears,onChange:a=>l("experienceYears",parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"hourlyRate",className:"text-sm font-medium",children:"Tarifa por Hora (MXN)"}),e.jsx(c,{id:"hourlyRate",type:"number",min:"0",placeholder:"0",value:i.hourlyRate,onChange:a=>l("hourlyRate",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"availability",className:"text-sm font-medium",children:"Disponibilidad"}),e.jsxs(z,{value:i.availability,onValueChange:a=>l("availability",a),children:[e.jsx(M,{children:e.jsx(Y,{placeholder:"Selecciona disponibilidad"})}),e.jsxs(T,{children:[e.jsx(n,{value:"full-time",children:"Tiempo completo"}),e.jsx(n,{value:"part-time",children:"Medio tiempo"}),e.jsx(n,{value:"weekends",children:"Fines de semana"}),e.jsx(n,{value:"evenings",children:"Tardes"}),e.jsx(n,{value:"mornings",children:"Mañanas"}),e.jsx(n,{value:"flexible",children:"Flexible"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Especialidades *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{placeholder:"Ej: Yoga, Danza, Deportes acuáticos",value:u,onChange:a=>w(a.target.value),onKeyPress:a=>a.key==="Enter"&&(a.preventDefault(),S())}),e.jsx(o,{type:"button",onClick:S,variant:"outline",children:"Agregar"})]}),i.specialties.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:i.specialties.map((a,s)=>e.jsxs(ce,{variant:"secondary",className:"bg-[#00a587]/10 text-[#00a587]",children:[a,e.jsx("button",{type:"button",onClick:()=>H(a),className:"ml-2 hover:text-red-600",children:e.jsx(U,{className:"h-3 w-3"})})]},s))})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Agrega las especialidades una por una"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"curriculumFile",className:"text-sm font-medium",children:"Curriculum Vitae"}),e.jsx("div",{className:"border border-gray-300 rounded-md p-4 bg-gray-50",children:i.curriculumFile?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 truncate max-w-[200px]",children:i.curriculumFile.name})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700",onClick:()=>l("curriculumFile",null),children:e.jsx(U,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("label",{htmlFor:"curriculumUpload",className:"cursor-pointer inline-flex items-center gap-2 py-2 px-4 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(L,{className:"h-4 w-4"}),"Subir CV",e.jsx("input",{id:"curriculumUpload",type:"file",accept:".pdf,.doc,.docx",className:"hidden",onChange:Q})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formatos: PDF, DOC, DOCX. Máx: 5MB"})]})})]})]})]}),e.jsxs(f,{children:[e.jsx(j,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(ne,{className:"mr-2 h-5 w-5"}),"Información Adicional"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"preferredParkId",className:"text-sm font-medium",children:"Parque Preferido (Opcional)"}),e.jsxs(z,{value:(k=i.preferredParkId)==null?void 0:k.toString(),onValueChange:a=>l("preferredParkId",parseInt(a)),children:[e.jsx(M,{children:e.jsx(Y,{placeholder:"Selecciona un parque"})}),e.jsx(T,{children:G.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"El parque donde el instructor prefiere dar sus actividades"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"qualifications",className:"text-sm font-medium",children:"Certificaciones y Cualificaciones"}),e.jsx(b,{id:"qualifications",placeholder:"Describe las certificaciones, títulos o cualificaciones del instructor...",value:i.qualifications,onChange:a=>l("qualifications",a.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"experience",className:"text-sm font-medium",children:"Experiencia Profesional"}),e.jsx(b,{id:"experience",placeholder:"Describe la experiencia profesional, logros y áreas de especialización...",value:i.experience,onChange:a=>l("experience",a.target.value),rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"bio",className:"text-sm font-medium",children:"Biografía"}),e.jsx(b,{id:"bio",placeholder:"Describe la filosofía y enfoque del instructor...",value:i.bio,onChange:a=>l("bio",a.target.value),rows:3}),e.jsx("p",{className:"text-xs text-gray-500",children:"Esta información será visible en el perfil público del instructor"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>d("/admin/instructors"),children:"Cancelar"}),e.jsxs(o,{type:"submit",disabled:v.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),v.isPending?"Guardando...":"Guardar Cambios"]})]})]})]})})}export{pe as default};
