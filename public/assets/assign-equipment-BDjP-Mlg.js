import{a2 as i,u as q,j as e,aX as ae,B as S,A as se,f as F,g as M,h as z,ab as B,i as L,N as t,Q as x,V as h,W as j,Y as g,dr as b,_ as r,a1 as V,$ as ie,ao as te,bG as re,cb as u,r as K,ca as ne}from"./index-D5qLf1ib.js";import{D as Y}from"./date-picker-BGQBE3iK.js";const oe=()=>{const[c,Q]=i.useState(""),[o,R]=i.useState(""),[d,G]=i.useState(null),[N,J]=i.useState(null),[C,O]=i.useState(""),[p,$]=i.useState(""),[E,H]=i.useState(""),[I,U]=i.useState(!1),[w,k]=i.useState(!1),{data:f=[]}=q({queryKey:["/api/assets"],retry:!1}),{data:v=[]}=q({queryKey:["/api/instructors"],retry:!1}),{data:y=[]}=q({queryKey:["/api/activities"],retry:!1}),W=[{id:1,name:"Equipo de Yoga (10 colchonetas)",condition:"good",categoryName:"Equipamiento Deportivo",parkName:"Parque Central"},{id:2,name:"Set de Balones de Fútbol (5)",condition:"good",categoryName:"Equipamiento Deportivo",parkName:"Parque Central"},{id:3,name:"Kit de Tenis (4 raquetas, 10 pelotas)",condition:"fair",categoryName:"Equipamiento Deportivo",parkName:"Parque Metropolitano"},{id:4,name:"Sistema de Sonido Portátil",condition:"good",categoryName:"Equipamiento Electrónico",parkName:"Parque Agua Azul"}],X=[{id:1,fullName:"Carlos Ramírez",specialties:"Yoga, Meditación"},{id:2,fullName:"Laura Sánchez",specialties:"Fútbol, Atletismo"},{id:3,fullName:"Miguel Torres",specialties:"Tenis, Badminton"},{id:4,fullName:"Ana López",specialties:"Baile, Aerobics"}],_=[{id:1,title:"Clase de Yoga para Principiantes",parkId:1,parkName:"Parque Central"},{id:2,title:"Entrenamiento de Fútbol Juvenil",parkId:1,parkName:"Parque Central"},{id:3,title:"Torneo de Tenis Infantil",parkId:2,parkName:"Parque Metropolitano"},{id:4,title:"Clase de Baile Urbano",parkId:3,parkName:"Parque Agua Azul"}],A=Array.isArray(f)&&f.length>0?f.filter(a=>{var l,m;return((l=a.categoryName)==null?void 0:l.toLowerCase().includes("deport"))||((m=a.categoryName)==null?void 0:m.toLowerCase().includes("equip"))}):W,D=Array.isArray(v)&&v.length>0?v:X,P=Array.isArray(y)&&y.length>0?y:_,s=A.find(a=>a.id.toString()===c),n=D.find(a=>a.id.toString()===o);P.find(a=>a.id.toString()===p);const T=!1,Z=async a=>{if(a.preventDefault(),!c){u({title:"Error",description:"Debes seleccionar un equipamiento para asignar",variant:"destructive"});return}if(!o){u({title:"Error",description:"Debes seleccionar un instructor",variant:"destructive"});return}if(!d){u({title:"Error",description:"Debes seleccionar una fecha de inicio",variant:"destructive"});return}k(!0);try{const l={assetId:parseInt(c),instructorId:parseInt(o),startDate:d?K(d,"yyyy-MM-dd"):null,endDate:N?K(N,"yyyy-MM-dd"):null,purpose:C,activityId:p?parseInt(p):null,notes:E,requiresTraining:I,status:"active"},m=await fetch("/api/asset-assignments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(l)});if(!m.ok){const ee=await m.json();throw new Error(ee.message||"Error al asignar equipamiento")}ne.invalidateQueries({queryKey:["/api/assets"]}),u({title:"Equipamiento asignado",description:"El equipamiento ha sido asignado correctamente al instructor."}),window.location.href="/admin/assets"}catch(l){console.error("Error al asignar equipamiento:",l),u({title:"Error",description:"No se pudo asignar el equipamiento. Por favor, intenta de nuevo.",variant:"destructive"})}finally{k(!1)}};return e.jsx(ae,{children:e.jsxs("div",{className:"container py-6",children:[e.jsx("div",{className:"mb-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(S,{variant:"outline",onClick:()=>window.location.href="/admin/assets",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Volver a Activos"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Asignar Equipamiento a Instructor"}),e.jsx("p",{className:"text-muted-foreground",children:"Asigna equipamiento deportivo a instructores para actividades programadas"})]})]})}),e.jsxs("form",{onSubmit:Z,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(F,{children:[e.jsxs(M,{children:[e.jsx(z,{className:"text-lg",children:"Información del Equipamiento"}),e.jsx(B,{children:"Selecciona el equipamiento deportivo que deseas asignar"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"asset",children:"Equipamiento*"}),e.jsxs(x,{value:c,onValueChange:Q,required:!0,children:[e.jsx(h,{id:"asset",children:e.jsx(j,{placeholder:"Selecciona un equipamiento"})}),e.jsx(g,{children:e.jsx(b,{children:A.map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.name," (",a.parkName||"Sin parque asignado",")"]},a.id))})})]})]}),c&&e.jsxs("div",{className:"border rounded-md p-4 bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Información del equipamiento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nombre:"}),e.jsx("span",{className:"text-sm font-medium",children:s==null?void 0:s.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Condición:"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:s==null?void 0:s.condition})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Parque:"}),e.jsx("span",{className:"text-sm font-medium",children:(s==null?void 0:s.parkName)||"No asignado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Categoría:"}),e.jsx("span",{className:"text-sm font-medium",children:s==null?void 0:s.categoryName})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"purpose",children:"Propósito de uso*"}),e.jsxs(x,{value:C,onValueChange:O,required:!0,children:[e.jsx(h,{id:"purpose",children:e.jsx(j,{placeholder:"Selecciona el propósito"})}),e.jsxs(g,{children:[e.jsx(r,{value:"class",children:"Clase regular"}),e.jsx(r,{value:"event",children:"Evento especial"}),e.jsx(r,{value:"tournament",children:"Torneo"}),e.jsx(r,{value:"workshop",children:"Taller"}),e.jsx(r,{value:"training",children:"Entrenamiento"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"activity",children:"Actividad relacionada (opcional)"}),e.jsxs(x,{value:p,onValueChange:$,children:[e.jsx(h,{id:"activity",children:e.jsx(j,{placeholder:"Selecciona una actividad"})}),e.jsx(g,{children:e.jsx(b,{children:P.map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.title," (",a.parkName||"Sin parque asignado",")"]},a.id))})})]})]})]})]}),e.jsxs(F,{children:[e.jsxs(M,{children:[e.jsx(z,{className:"text-lg",children:"Información del Instructor"}),e.jsx(B,{children:"Selecciona el instructor y el periodo de asignación"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"instructor",children:"Instructor*"}),e.jsxs(x,{value:o,onValueChange:R,required:!0,children:[e.jsx(h,{id:"instructor",children:e.jsx(j,{placeholder:"Selecciona un instructor"})}),e.jsx(g,{children:e.jsx(b,{children:D.map(a=>e.jsx(r,{value:a.id.toString(),children:a.fullName},a.id))})})]})]}),o&&e.jsxs("div",{className:"border rounded-md p-4 bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Información del instructor"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nombre:"}),e.jsx("span",{className:"text-sm font-medium",children:n==null?void 0:n.fullName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Especialidades:"}),e.jsx("span",{className:"text-sm font-medium",children:n==null?void 0:n.specialties})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"startDate",children:"Fecha de inicio*"}),e.jsx(Y,{selected:d,onSelect:G,locale:V,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"endDate",children:"Fecha de devolución"}),e.jsx(Y,{selected:N,onSelect:J,locale:V,className:"w-full",minDate:d||void 0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"notes",children:"Notas adicionales"}),e.jsx(ie,{id:"notes",placeholder:"Instrucciones especiales o detalles adicionales",value:E,onChange:a=>H(a.target.value),rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(te,{id:"requiresTraining",checked:I,onCheckedChange:a=>U(a)}),e.jsx(t,{htmlFor:"requiresTraining",className:"text-sm font-normal",children:"El instructor requiere capacitación para usar este equipamiento"})]}),T]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(S,{variant:"outline",type:"button",className:"mr-2",onClick:()=>window.location.href="/admin/assets",children:"Cancelar"}),e.jsxs(S,{type:"submit",disabled:w||T,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),w?"Asignando...":"Asignar Equipamiento"]})]})]})]})})};export{oe as default};
