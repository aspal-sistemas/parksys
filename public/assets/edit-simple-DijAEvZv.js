import{a2 as q,j as e,k as B,l as O,u as Y,af as Q,R as G,ag as H,aX as J,L as F,B as T,A as K,ai as X,b1 as _,b2 as W,b3 as S,ax as M,M as I,a as A,b4 as w,f as C,g as E,h as k,ab as P,i as U,aj as l,ak as o,al as t,am as c,O as u,an as d,Q as D,V as R,W as V,Y as L,_ as j,$ as Z,bG as ee,ad as s,ap as ae,ca as $}from"./index-D5qLf1ib.js";import{l as z,M as se,T as re,a as ne}from"./leaflet-CDEiJxZW.js";import{u as ie,a as le}from"./hooks-ByDnCwIh.js";delete z.Icon.Default.prototype._getIconUrl;z.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});function oe({onLocationSelect:i}){return ie({click:x=>{const{lat:n,lng:m}=x.latlng;i({lat:n,lng:m})}}),null}function te({latitude:i,longitude:x}){const n=le();return q.useEffect(()=>{if(i&&x){const m=parseFloat(i),r=parseFloat(x);!isNaN(m)&&!isNaN(r)&&m!==0&&r!==0&&n.setView([m,r],15)}},[n,i,x]),null}function ce({latitude:i,longitude:x,defaultCenter:n,selectedLocation:m,onLocationSelect:r,className:b}){const[v,a]=q.useState(null);return q.useEffect(()=>{if(n&&!isNaN(n.lat)&&!isNaN(n.lng))a([n.lat,n.lng]);else if(i&&x){const h=parseFloat(i),g=parseFloat(x);!isNaN(h)&&!isNaN(g)?a([h,g]):a([19.4326,-99.1332])}else a([19.4326,-99.1332])},[i,x,n]),v?e.jsxs("div",{className:`relative ${b}`,children:[e.jsx("div",{className:"mb-2 text-sm text-gray-600",children:"Haz clic en el mapa para seleccionar la ubicación del parque"}),e.jsx("div",{style:{height:"400px",width:"100%"},className:"rounded-lg overflow-hidden border",children:e.jsxs(se,{center:v,zoom:15,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,children:[e.jsx(re,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.jsx(oe,{onLocationSelect:r}),e.jsx(te,{latitude:i,longitude:x}),m&&!isNaN(m.lat)&&!isNaN(m.lng)&&e.jsx(ne,{position:[m.lat,m.lng]})]})}),m&&e.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Coordenadas seleccionadas: ",m.lat.toFixed(6),", ",m.lng.toFixed(6)]})]}):e.jsx("div",{className:"h-64 bg-gray-200 rounded-lg flex items-center justify-center",children:"Cargando mapa..."})}const de=s.object({name:s.string().min(1,"El nombre es requerido"),municipalityName:s.string().optional(),description:s.string().optional(),address:s.string().optional(),postalCode:s.string().optional(),contactPhone:s.string().optional(),contactEmail:s.string().optional(),parkType:s.string().optional(),latitude:s.string().optional(),longitude:s.string().optional(),area:s.string().optional(),greenArea:s.string().optional(),foundationYear:s.number().optional(),administrator:s.string().optional(),conservationStatus:s.string().optional(),regulationUrl:s.string().optional(),videoUrl:s.string().optional(),schedule:s.object({monday:s.object({enabled:s.boolean(),openTime:s.string(),closeTime:s.string()}),tuesday:s.object({enabled:s.boolean(),openTime:s.string(),closeTime:s.string()}),wednesday:s.object({enabled:s.boolean(),openTime:s.string(),closeTime:s.string()}),thursday:s.object({enabled:s.boolean(),openTime:s.string(),closeTime:s.string()}),friday:s.object({enabled:s.boolean(),openTime:s.string(),closeTime:s.string()}),saturday:s.object({enabled:s.boolean(),openTime:s.string(),closeTime:s.string()}),sunday:s.object({enabled:s.boolean(),openTime:s.string(),closeTime:s.string()})}).optional()});function he(){const{id:i}=B(),{toast:x}=O(),{data:n,isLoading:m}=Y({queryKey:[`/api/parks/${i}`],enabled:!!i}),r=Q({resolver:ae(de),defaultValues:{name:"",municipalityName:"",description:"",address:"",postalCode:"",contactPhone:"",contactEmail:"",parkType:"",latitude:"",longitude:"",area:"",greenArea:"",foundationYear:void 0,administrator:"",conservationStatus:"",regulationUrl:"",videoUrl:"",schedule:{monday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},tuesday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},wednesday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},thursday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},friday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},saturday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},sunday:{enabled:!0,openTime:"06:00",closeTime:"22:00"}}}});G.useEffect(()=>{var a,h,g,f;if(n){const N=p=>{const y={monday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},tuesday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},wednesday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},thursday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},friday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},saturday:{enabled:!0,openTime:"06:00",closeTime:"22:00"},sunday:{enabled:!0,openTime:"06:00",closeTime:"22:00"}};if(!p)return y;try{return JSON.parse(p)}catch{return y}};r.reset({name:n.name||"",municipalityName:((a=n.municipality)==null?void 0:a.name)||"",description:n.description||"",address:n.address||"",postalCode:n.postalCode||"",contactPhone:n.contactPhone||"",contactEmail:n.contactEmail||"",parkType:n.parkType||"",latitude:((h=n.latitude)==null?void 0:h.toString())||"",longitude:((g=n.longitude)==null?void 0:g.toString())||"",area:((f=n.area)==null?void 0:f.toString())||"",greenArea:n.greenArea||"",foundationYear:n.foundationYear||void 0,administrator:n.administrator||"",conservationStatus:n.conservationStatus||"",regulationUrl:n.regulationUrl||"",videoUrl:n.videoUrl||"",schedule:N(n.openingHours)})}},[n,r]);const b=H({mutationFn:async a=>{console.log("=== ACTUALIZANDO PARQUE ==="),console.log("Datos a enviar:",a);const{schedule:h,municipalityName:g,...f}=a,N={...f,openingHours:h?JSON.stringify(h):"{}",foundationYear:f.foundationYear||null};console.log("Datos procesados a enviar:",N);const p=await fetch(`/api/dev/parks/${i}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")?`Bearer ${localStorage.getItem("token")}`:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:JSON.stringify(N),credentials:"include"});if(!p.ok){const y=await p.text();throw new Error(`Error ${p.status}: ${y}`)}return p.json()},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/parks"]}),$.invalidateQueries({queryKey:[`/api/parks/${i}`]}),x({title:"Parque actualizado",description:"La información del parque ha sido actualizada correctamente."})},onError:a=>{console.error("Error al actualizar:",a),x({title:"Error",description:`Error al actualizar el parque: ${a.message}`,variant:"destructive"})}}),v=a=>{if(console.log("=== FORM SUBMIT ==="),console.log("Form values:",a),console.log("Form errors:",r.formState.errors),Object.keys(r.formState.errors).length>0){console.error("Formulario con errores:",r.formState.errors),x({title:"Error de validación",description:"Por favor revisa los campos del formulario",variant:"destructive"});return}b.mutate(a)};return m?e.jsx("div",{children:"Cargando..."}):n?e.jsx(J,{title:"Editar Parque",subtitle:n==null?void 0:n.name,children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex items-center gap-4 mb-4",children:e.jsx(F,{href:`/admin/parks/${i}/view`,children:e.jsxs(T,{variant:"ghost",size:"sm",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Volver al parque"]})})})}),e.jsx(X,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(v),className:"space-y-6",children:[e.jsxs(_,{defaultValue:"basic",className:"space-y-6",children:[e.jsxs(W,{className:"grid w-full grid-cols-3",children:[e.jsxs(S,{value:"basic",className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Información Básica"]}),e.jsxs(S,{value:"location",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Ubicación y Contacto"]}),e.jsxs(S,{value:"characteristics",className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Características"]})]}),e.jsx(w,{value:"basic",children:e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Información General"]}),e.jsx(P,{children:"Datos básicos del parque"})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:r.control,name:"name",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Nombre del Parque"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Nombre del parque",...a})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"parkType",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Tipo de Parque"}),e.jsxs(D,{onValueChange:a.onChange,value:a.value,children:[e.jsx(c,{children:e.jsx(R,{children:e.jsx(V,{placeholder:"Seleccione un tipo"})})}),e.jsxs(L,{children:[e.jsx(j,{value:"Urbano",children:"Parque Urbano"}),e.jsx(j,{value:"Metropolitano",children:"Parque Metropolitano"}),e.jsx(j,{value:"Linear",children:"Parque Linear"}),e.jsx(j,{value:"Comunitario",children:"Parque Comunitario"}),e.jsx(j,{value:"Natural",children:"Parque Natural"}),e.jsx(j,{value:"Temático",children:"Parque Temático"})]})]}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"municipalityName",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Municipio"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Nombre del municipio",...a})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:r.control,name:"description",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Descripción"}),e.jsx(c,{children:e.jsx(Z,{placeholder:"Descripción del parque...",className:"min-h-32",...a})}),e.jsx(d,{})]})})]})]})}),e.jsx(w,{value:"location",children:e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Ubicación y Contacto"]}),e.jsx(P,{children:"Información de ubicación y datos de contacto"})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:r.control,name:"address",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Dirección"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Dirección completa",...a})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"postalCode",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Código Postal"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Código postal",...a})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:r.control,name:"contactPhone",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Teléfono"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Número de teléfono",...a})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"contactEmail",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Email"}),e.jsx(c,{children:e.jsx(u,{type:"email",placeholder:"correo@ejemplo.com",...a})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium",children:"Coordenadas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:r.control,name:"latitude",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Latitud"}),e.jsx(c,{children:e.jsx(u,{placeholder:"20.123456",...a})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"longitude",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Longitud"}),e.jsx(c,{children:e.jsx(u,{placeholder:"-103.123456",...a})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Seleccionar ubicación en mapa"}),e.jsx(ce,{latitude:r.watch("latitude"),longitude:r.watch("longitude"),selectedLocation:r.watch("latitude")&&r.watch("longitude")?{lat:parseFloat(r.watch("latitude")||"0"),lng:parseFloat(r.watch("longitude")||"0")}:null,onLocationSelect:a=>{r.setValue("latitude",a.lat.toString()),r.setValue("longitude",a.lng.toString())}})]})]})]})]})}),e.jsx(w,{value:"characteristics",children:e.jsxs(C,{children:[e.jsxs(E,{children:[e.jsxs(k,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Características del Parque"]}),e.jsx(P,{children:"Información adicional y características específicas"})]}),e.jsxs(U,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:r.control,name:"area",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Área Total (m²)"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Área en metros cuadrados",...a})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"greenArea",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Área Verde"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Descripción del área verde",...a})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:r.control,name:"foundationYear",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Año de Fundación"}),e.jsx(c,{children:e.jsx(u,{type:"number",placeholder:"2024",...a,onChange:h=>a.onChange(h.target.value?parseInt(h.target.value):void 0)})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"administrator",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Administrador"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Nombre del administrador",...a})}),e.jsx(d,{})]})})]}),e.jsx(l,{control:r.control,name:"conservationStatus",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Estado de Conservación"}),e.jsxs(D,{onValueChange:a.onChange,value:a.value,children:[e.jsx(c,{children:e.jsx(R,{children:e.jsx(V,{placeholder:"Seleccione el estado"})})}),e.jsxs(L,{children:[e.jsx(j,{value:"Excelente",children:"Excelente"}),e.jsx(j,{value:"Bueno",children:"Bueno"}),e.jsx(j,{value:"Regular",children:"Regular"}),e.jsx(j,{value:"Malo",children:"Malo"}),e.jsx(j,{value:"Crítico",children:"Crítico"})]})]}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(l,{control:r.control,name:"regulationUrl",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"URL de Reglamento"}),e.jsx(c,{children:e.jsx(u,{placeholder:"https://...",...a})}),e.jsx(d,{})]})}),e.jsx(l,{control:r.control,name:"videoUrl",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"URL de Video"}),e.jsx(c,{children:e.jsx(u,{placeholder:"https://...",...a})}),e.jsx(d,{})]})})]})]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(F,{href:`/admin/parks/${i}/view`,children:e.jsx(T,{variant:"outline",children:"Cancelar"})}),e.jsx(T,{type:"submit",disabled:b.isPending,className:"min-w-32",children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"mr-2 h-4 w-4"}),"Guardar Cambios"]})})]})]})})]})}):e.jsx("div",{children:"Parque no encontrado"})}export{he as default};
