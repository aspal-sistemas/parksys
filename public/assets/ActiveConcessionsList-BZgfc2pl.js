import{Y as c,a6 as ee,u as k,a8 as se,j as e,aI as L,L as m,B as n,b2 as ae,cg as te,C as E,c as T,Z as le,I as ne,z as I,H as q,J as M,K as F,N as r,ak as ie,ax as re,a as ce,b as de,f,M as oe,m as me,h as A,i as xe,b7 as he,ba as $,bb as ge,at as je,au as ue,D as pe,r as Ne,t as ve,v as ye,n as fe,P as z,ai as be}from"./index-VG22aPDC.js";import{I as we}from"./images-F-WfAsIb.js";function Le(){const[x,B]=c.useState(""),[g,V]=c.useState("all"),[j,_]=c.useState("all"),[i,h]=c.useState(1),[a,R]=c.useState(null),[H,b]=c.useState(!1),u=10,w=ee(),{data:p,isLoading:K,refetch:G}=k({queryKey:["/api/active-concessions"],queryFn:async()=>(await fetch("/api/active-concessions")).json(),refetchOnWindowFocus:!0,staleTime:3e4}),{data:N}=k({queryKey:["/api/parks"],queryFn:async()=>(await fetch("/api/parks")).json()}),Q=se({mutationFn:s=>be(`/api/active-concessions/${s}`,{method:"DELETE"}),onSuccess:()=>{w.invalidateQueries({queryKey:["/api/active-concessions"]})}}),O=(p==null?void 0:p.data)||[],U=(N==null?void 0:N.data)||[],v=O.filter(s=>{const l=s.name||"",t=s.concessionTypeName||"",o=s.parkName||"",Z=s.status||"";return(l.toLowerCase().includes(x.toLowerCase())||t.toLowerCase().includes(x.toLowerCase())||o.toLowerCase().includes(x.toLowerCase()))&&(g==="all"||Z===g)&&(j==="all"||o===j)}),d=Math.ceil(v.length/u),C=(i-1)*u,X=v.slice(C,C+u),y=()=>{h(1)},S=s=>{const l={activa:{color:"bg-green-100 text-green-800",label:"Activa"},suspendida:{color:"bg-red-100 text-red-800",label:"Suspendida"},vencida:{color:"bg-gray-100 text-gray-800",label:"Vencida"},renovacion:{color:"bg-yellow-100 text-yellow-800",label:"En Renovación"}},t=l[s]||l.activa;return e.jsx(f,{className:t.color,children:t.label})},D=s=>{const l={alta:{color:"bg-red-100 text-red-800",label:"Alta"},normal:{color:"bg-blue-100 text-blue-800",label:"Normal"},baja:{color:"bg-gray-100 text-gray-800",label:"Baja"}},t=l[s]||l.normal;return e.jsx(f,{variant:"outline",className:t.color,children:t.label})},J=s=>{window.confirm(`¿Estás seguro de que deseas eliminar la concesión "${s.name}"?`)&&Q.mutate(s.id)},W=()=>{w.invalidateQueries({queryKey:["/api/active-concessions"]}),G()},Y=s=>{R(s),b(!0)},P=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(s);return K?e.jsx(L,{title:"Concesiones Activas",subtitle:"Gestión integral de concesiones operativas",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})}):e.jsx(L,{title:"Concesiones Activas",subtitle:"Gestión integral de concesiones operativas",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{href:"/admin/concessions/active/new",children:e.jsxs(n,{className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Nueva Concesión Activa"]})}),e.jsxs(n,{variant:"outline",onClick:W,className:"border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Actualizar"]})]})}),e.jsx(E,{children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ne,{placeholder:"Buscar concesiones...",value:x,onChange:s=>{B(s.target.value),y()},className:"pl-10"})]})}),e.jsxs(I,{value:g,onValueChange:s=>{V(s),y()},children:[e.jsx(q,{children:e.jsx(M,{placeholder:"Estado"})}),e.jsxs(F,{children:[e.jsx(r,{value:"all",children:"Todos los estados"}),e.jsx(r,{value:"active",children:"Activa"}),e.jsx(r,{value:"suspended",children:"Suspendida"}),e.jsx(r,{value:"expired",children:"Vencida"}),e.jsx(r,{value:"renewal",children:"En Renovación"})]})]}),e.jsxs(I,{value:j,onValueChange:s=>{_(s),y()},children:[e.jsx(q,{children:e.jsx(M,{placeholder:"Parque"})}),e.jsxs(F,{children:[e.jsx(r,{value:"all",children:"Todos los parques"}),U.map(s=>e.jsx(r,{value:s.name,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[v.length," concesión(es) encontrada(s)"]})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6",children:X.map(s=>e.jsxs(E,{className:"overflow-hidden hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"h-48 bg-gradient-to-br from-green-100 to-green-200 relative",children:[s.primaryImage?e.jsx("img",{src:`${s.primaryImage}${s.primaryImage.includes("?")?"&":"?"}t=${Date.now()}`,alt:s.name,className:"w-full h-full object-cover",onError:l=>{var t,o;l.currentTarget.style.display="none",(o=(t=l.currentTarget.parentElement)==null?void 0:t.querySelector(".fallback-icon"))==null||o.classList.remove("hidden")}}):null,e.jsx("div",{className:`fallback-icon flex items-center justify-center h-full ${s.primaryImage?"hidden":""}`,children:e.jsx(re,{className:"h-16 w-16 text-green-600 opacity-50"})}),e.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:S(s.status)}),e.jsx("div",{className:"absolute top-4 left-4",children:D(s.priority)})]}),e.jsxs(ce,{className:"pb-2",children:[e.jsx(de,{className:"text-lg font-semibold line-clamp-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description})]}),e.jsxs(T,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(f,{variant:"secondary",className:"text-xs",children:s.concessionTypeName})}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(oe,{className:"h-4 w-4 text-gray-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.parkName}),e.jsx("p",{className:"text-gray-600",children:s.specific_location})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(me,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"truncate",children:s.concessionaireName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(A,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:[new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]})]}),s.operating_hours&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:s.operating_hours})]}),s.monthly_payment&&e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"font-medium text-green-600",children:[P(s.monthly_payment),"/mes"]})}),e.jsxs("div",{className:"flex gap-2 pt-2 flex-wrap",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>Y(s),className:"flex-1",children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Ver"]}),e.jsx(m,{href:`/admin/concessions/active/${s.id}/edit`,children:e.jsx(n,{variant:"outline",size:"sm",children:e.jsx($,{className:"h-4 w-4"})})}),e.jsx(m,{href:`/admin/concessions/active/${s.id}/images`,children:e.jsx(n,{variant:"outline",size:"sm",className:"text-purple-600 hover:text-purple-700",children:e.jsx(we,{className:"h-4 w-4"})})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>J(s),className:"text-red-600 hover:text-red-700",children:e.jsx(ge,{className:"h-4 w-4"})})]})]})]},s.id))}),d>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 mt-8",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>h(s=>Math.max(s-1,1)),disabled:i===1,children:[e.jsx(je,{className:"h-4 w-4"}),"Anterior"]}),e.jsx("div",{className:"flex space-x-1",children:Array.from({length:Math.min(5,d)},(s,l)=>{const t=i<=3?l+1:i-2+l;return t>d?null:e.jsx(n,{variant:i===t?"default":"outline",size:"sm",onClick:()=>h(t),className:i===t?"bg-green-600 hover:bg-green-700":"",children:t},t)})}),e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>h(s=>Math.min(s+1,d)),disabled:i===d,children:["Siguiente",e.jsx(ue,{className:"h-4 w-4"})]})]}),e.jsx(pe,{open:H,onOpenChange:b,children:e.jsxs(Ne,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(ye,{className:"text-xl font-bold",children:a==null?void 0:a.name})}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-4",children:[S(a.status),D(a.priority)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Información General"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",a.concessionTypeName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripción:"})," ",a.description]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Ubicación:"})," ",a.parkName," - ",a.specificLocation]}),a.operatingHours&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Horarios:"})," ",a.operatingHours]}),a.operatingDays&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Días:"})," ",a.operatingDays]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Concesionario"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.concessionaireName]}),a.concessionaireEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:a.concessionaireEmail})]}),a.concessionairePhone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:a.concessionairePhone})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Vigencia"}),e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[new Date(a.startDate).toLocaleDateString()," - ",new Date(a.endDate).toLocaleDateString()]})]})})]}),a.monthlyPayment&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Información Financiera"}),e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pago mensual:"})," ",P(a.monthlyPayment)]})})]})]}),(a.emergencyContact||a.emergencyPhone)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Contacto de Emergencia"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[a.emergencyContact&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.emergencyContact]}),a.emergencyPhone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:a.emergencyPhone})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[e.jsx(m,{href:`/admin/concessions/active/${a.id}/edit`,children:e.jsxs(n,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Editar Concesión"]})}),e.jsx(m,{href:`/admin/concessions/active/${a.id}/images`,children:e.jsxs(n,{variant:"outline",children:["Gestionar Imágenes (",a.imageCount,")"]})})]})]})]})})]})})}export{Le as default};
