import{j as e,d as $,Y as k,u as _,k as L,L as j,B as u,A as y,f as P,C as i,a as o,b as d,F as S,c as x,i as D,M as b,m as E,P as F,n as I,ay as f,D as M,r as T,as as U}from"./index-VG22aPDC.js";function q({latitude:t,longitude:l,title:n,location:m,area:h}){const p=`https://www.openstreetmap.org/export/embed.html?bbox=${l-.01},${t-.01},${l+.01},${t+.01}&layer=mapnik&marker=${t},${l}`;return e.jsxs("div",{className:"w-full h-64 rounded-lg border overflow-hidden bg-gray-100 relative",children:[e.jsx("iframe",{src:p,width:"100%",height:"256",style:{border:0},title:`Mapa de ${n}`,loading:"lazy",className:"w-full h-full"}),e.jsxs("div",{className:"absolute top-2 left-2 bg-white bg-opacity-90 rounded-lg p-2 shadow-md max-w-xs",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-800",children:n}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:m}),h&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Área: ",h," m²"]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[t.toFixed(6),", ",l.toFixed(6)]})]}),e.jsx("div",{className:"absolute bottom-2 right-2",children:e.jsx("a",{href:`https://www.openstreetmap.org/?mlat=${t}&mlon=${l}#map=17/${t}/${l}`,target:"_blank",rel:"noopener noreferrer",className:"bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1 rounded shadow transition-colors",children:"Ver en mapa completo"})})]})}function O(){var N;const{id:t}=$(),[l,n]=k.useState(null),{data:m,isLoading:h,error:p}=_({queryKey:[`/api/active-concessions/${t}`],enabled:!!t}),s=m==null?void 0:m.data,v=a=>{if(!a)return console.log("No coordinates available"),null;try{console.log("Parsing coordinates:",a);const r=a.split(",").map(g=>parseFloat(g.trim()));if(console.log("Parsed coords array:",r),r.length===2&&!isNaN(r[0])&&!isNaN(r[1])){const g=[r[0],r[1]];return console.log("Valid coordinates result:",g),g}}catch(r){console.error("Error parsing coordinates:",r)}return null},c=s!=null&&s.coordinates?v(s.coordinates):null;if(console.log("Final coordinates for map:",c),h)return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-300 rounded w-1/4 mb-4"}),e.jsx("div",{className:"h-64 bg-gray-300 rounded-lg mb-6"}),e.jsx("div",{className:"h-48 bg-gray-300 rounded-lg"})]})})});if(p||!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 py-12",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center",children:[e.jsx(L,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Concesión no encontrada"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"La concesión que buscas no existe o ha sido removida."}),e.jsx(j,{href:"/concessions",children:e.jsxs(u,{className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Volver a concesiones"]})})]})});const w=a=>{switch(a.toLowerCase()){case"activo":return"bg-green-100 text-green-800 border-green-300";case"por vencer":return"bg-yellow-100 text-yellow-800 border-yellow-300";case"vencido":return"bg-red-100 text-red-800 border-red-300";default:return"bg-gray-100 text-gray-800 border-gray-300"}},C=a=>{switch(a.toLowerCase()){case"alimentario":return"🍽️";case"comercial":return"🛍️";case"servicios":return"⚙️";case"recreativo":return"🎯";default:return"🏪"}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:[e.jsx(j,{href:"/concessions",children:e.jsxs(u,{variant:"outline",className:"mb-4 border-green-300 text-green-700 hover:bg-green-50",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Volver a concesiones"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:"text-2xl",children:C(s.concessionTypeName)}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s.name})]}),e.jsxs("p",{className:"text-lg text-gray-600",children:["Operado por: ",s.concessionaireName]})]}),e.jsx("div",{className:"mt-4 md:mt-0",children:e.jsx(P,{className:`text-sm px-3 py-1 ${w(s.status)}`,children:s.status})})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"grid grid-cols-4 grid-rows-2 gap-2 h-64",children:[e.jsxs("div",{className:"col-span-2 row-span-2 relative cursor-pointer",onClick:()=>n(s.image_url),children:[e.jsx("img",{src:s.image_url||"/api/placeholder/400/400",alt:`${s.name} - Imagen principal`,className:"w-full h-full object-contain rounded-lg shadow-lg"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-10 transition-all duration-300 rounded-lg"})]}),s.images&&s.images.filter(a=>!a.is_primary).slice(0,4).map((a,r)=>e.jsxs("div",{className:"relative cursor-pointer",onClick:()=>n(a.image_url),children:[e.jsx("img",{src:a.image_url,alt:`${s.name} - Imagen ${r+2}`,className:"w-full h-full object-contain rounded-lg shadow-md"}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 hover:bg-opacity-10 transition-all duration-300 rounded-lg"})]},a.id)),s.images&&s.images.filter(a=>!a.is_primary).length<4&&[...Array(4-s.images.filter(a=>!a.is_primary).length)].map((a,r)=>e.jsx("div",{className:"relative bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-gray-400 text-sm",children:"Sin imagen"})},`placeholder-${r}`))]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[s.description&&e.jsxs(i,{children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5 text-gray-600"}),"Descripción"]})}),e.jsx(x,{children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:s.description})})]}),e.jsxs(i,{children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-gray-600"}),"Horarios de Operación"]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Horarios:"})," ",s.operating_hours]}),e.jsxs("p",{className:"text-gray-700",children:[e.jsx("strong",{children:"Días:"})," ",s.operating_days]})]})})]}),c&&s&&e.jsxs(i,{children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-gray-600"}),"Ubicación"]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx(q,{latitude:c[0],longitude:c[1],title:s.name,location:s.specific_location,area:(N=s.area)==null?void 0:N.toString()}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Ubicación específica:"})," ",s.specific_location]}),s.area&&e.jsxs("p",{children:[e.jsx("strong",{children:"Área:"})," ",s.area," m²"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Coordenadas: ",c[0],", ",c[1]]})]})]})})]}),!c&&s&&e.jsxs(i,{children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5 text-gray-600"}),"Ubicación (Debug)"]})}),e.jsxs(x,{children:[e.jsx("p",{className:"text-red-600",children:"Coordenadas no disponibles"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Coordenadas raw: ",s.coordinates]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Parsed: ",JSON.stringify(c)]})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(i,{children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-gray-600"}),"Contacto"]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Concesionario"}),e.jsx("p",{className:"text-gray-900 font-medium mt-1",children:s.concessionaireName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Contacto de emergencia"}),e.jsx("p",{className:"text-gray-900 font-medium mt-1",children:s.emergency_contact})]}),s.emergency_phone&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Teléfono de emergencia"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(F,{className:"h-4 w-4 text-gray-400"}),e.jsx("a",{href:`tel:${s.emergency_phone}`,className:"text-green-600 hover:text-green-700 font-medium",children:s.emergency_phone})]})]}),s.concessionaireEmail&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-500",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(I,{className:"h-4 w-4 text-gray-400"}),e.jsx("a",{href:`mailto:${s.concessionaireEmail}`,className:"text-green-600 hover:text-green-700 font-medium break-all",children:s.concessionaireEmail})]})]})]})]}),s.parkName&&e.jsxs(i,{children:[e.jsx(o,{children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-gray-600"}),"Parque"]})}),e.jsx(x,{children:e.jsx(j,{href:`/parque/${s.parkName.toLowerCase().replace(/\s+/g,"-")}-${s.park_id}`,children:e.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg border hover:bg-gray-50 transition-colors cursor-pointer",children:[e.jsx(f,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"text-green-600 hover:text-green-700 font-medium",children:s.parkName})]})})})]})]})]})]}),l&&e.jsx(M,{open:!!l,onOpenChange:()=>n(null),children:e.jsx(T,{className:"max-w-4xl w-full h-[80vh] p-0 bg-black/95",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx("button",{onClick:()=>n(null),className:"absolute top-4 right-4 z-50 p-2 rounded-full bg-black/50 hover:bg-black/70 text-white transition-colors",children:e.jsx(U,{className:"h-6 w-6"})}),e.jsx("img",{src:l,alt:"Imagen ampliada",className:"max-w-full max-h-full object-contain"})]})})})]})}export{O as default};
