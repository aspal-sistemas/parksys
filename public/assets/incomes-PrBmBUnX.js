import{cf as ve,cH as $,cg as w,Y as u,e as ye,u as J,a7 as ie,ag as te,a8 as B,j as e,aB as fe,aD as Ne,B as t,D as H,p as Ce,aW as be,r as Q,t as X,v as Y,w as U,aa as le,ab as l,ac as o,ad as c,z as p,ae as d,H as v,J as y,K as f,N as n,af as x,I as j,y as O,C as Ie,a as Se,b as we,ak as De,a3 as Ee,c as Fe,h as Me,a9 as Te,b3 as ke,b4 as Ae,aq as Oe,ar as Pe,bs as G}from"./index-BBGHPKhn.js";import{L as D}from"./loader-circle-vbPEwN9U.js";const oe=ve({parkId:$(),categoryId:$(),subcategory:w().optional(),amount:$().min(.01,"El monto debe ser mayor a 0"),description:w().min(1,"La descripción es requerida"),date:w().min(1,"La fecha es requerida"),source:w().optional(),notes:w().optional()}),Ke=()=>{const[ce,P]=u.useState(!1),[W,_]=u.useState(null),[de,E]=u.useState(!1),[xe,F]=u.useState(!1),[I,Z]=u.useState(null),[i,S]=u.useState({year:"",month:"",date:"",category:"",amount:""}),[g,M]=u.useState(1),q=10,{toast:N}=ye(),{data:T,isLoading:ee,refetch:he}=J({queryKey:["/api/actual-incomes"]}),{data:k,isLoading:qe}=J({queryKey:["/api/parks"]}),{data:C,isLoading:Le}=J({queryKey:["/api/income-categories"]}),m=ie({resolver:te(oe),defaultValues:{parkId:3,amount:void 0,description:"",date:new Date().toISOString().split("T")[0],source:"",notes:""}}),h=ie({resolver:te(oe),defaultValues:{parkId:3,amount:void 0,description:"",date:new Date().toISOString().split("T")[0],source:"",notes:""}}),L=B({mutationFn:async s=>{const r=await fetch("/api/actual-incomes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const a=await r.text();throw new Error(`Error al crear el ingreso: ${a}`)}return await r.json()},onSuccess:()=>{G.invalidateQueries({queryKey:["/api/actual-incomes"]}),P(!1),m.reset(),N({title:"Ingreso creado",description:"El ingreso se ha creado correctamente."})},onError:s=>{console.error("Error al crear ingreso:",s),N({title:"Error",description:"No se pudo crear el ingreso. Intenta nuevamente.",variant:"destructive"})}}),z=B({mutationFn:async s=>{const r=await fetch(`/api/actual-incomes/${W.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const a=await r.text();throw new Error(`Error al editar el ingreso: ${a}`)}return await r.json()},onSuccess:()=>{G.invalidateQueries({queryKey:["/api/actual-incomes"]}),E(!1),_(null),h.reset(),N({title:"Ingreso actualizado",description:"El ingreso se ha actualizado correctamente."})},onError:s=>{console.error("Error al editar ingreso:",s),N({title:"Error",description:"No se pudo editar el ingreso. Intenta nuevamente.",variant:"destructive"})}}),V=B({mutationFn:async s=>{const r=await fetch(`/api/actual-incomes/${s}`,{method:"DELETE"});if(!r.ok){const a=await r.text();throw new Error(`Error al eliminar el ingreso: ${a}`)}return await r.json()},onSuccess:()=>{G.invalidateQueries({queryKey:["/api/actual-incomes"]}),F(!1),Z(null),N({title:"Ingreso eliminado",description:"El ingreso se ha eliminado correctamente."})},onError:s=>{console.error("Error al eliminar ingreso:",s),N({title:"Error",description:"No se pudo eliminar el ingreso. Intenta nuevamente.",variant:"destructive"})}}),je=s=>{_(s),h.reset({parkId:s.parkId,categoryId:s.categoryId,amount:s.amount,description:s.description||"",date:s.date?s.date.split("T")[0]:new Date().toISOString().split("T")[0],source:s.source||"",notes:s.notes||""}),E(!0)},se=u.useMemo(()=>!T||!Array.isArray(T)?[]:T.filter(s=>{const r=new Date(s.date),a=r.getFullYear().toString(),ge=(r.getMonth()+1).toString().padStart(2,"0"),pe=r.toISOString().split("T")[0];return!(i.year&&a!==i.year||i.month&&ge!==i.month||i.date&&pe!==i.date||i.category&&s.categoryId.toString()!==i.category)}),[T,i]),A=se.length,b=Math.ceil(A/q),K=(g-1)*q,ae=K+q,R=se.slice(K,ae);u.useMemo(()=>{M(1)},[i]);const re=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(s),ne=s=>new Date(s).toLocaleDateString("es-MX"),me=s=>{L.mutate(s)},ue=s=>{z.mutate(s)};return e.jsx(fe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(Ne,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cédula de Ingresos"}),e.jsx("p",{className:"text-gray-600",children:"Gestión y registro de todos los ingresos del parque"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(t,{variant:"outline",onClick:()=>he(),className:"flex items-center gap-2",children:[e.jsx(D,{className:`h-4 w-4 ${ee?"animate-spin":""}`}),"Actualizar"]})})]}),e.jsxs(H,{open:ce,onOpenChange:P,children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(t,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Nuevo Ingreso"]})}),e.jsxs(Q,{className:"max-w-lg","aria-describedby":"income-form-description",children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Registrar Nuevo Ingreso"}),e.jsx("div",{id:"income-form-description",className:"sr-only",children:"Formulario para registrar un nuevo ingreso financiero en el sistema"}),e.jsx(U,{children:"Completa la información del ingreso a registrar."})]}),e.jsx(le,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(me),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:m.control,name:"parkId",render:({field:s})=>{var r;return e.jsxs(o,{children:[e.jsx(c,{children:"Parque"}),e.jsxs(p,{onValueChange:a=>s.onChange(parseInt(a)),value:(r=s.value)==null?void 0:r.toString(),children:[e.jsx(d,{children:e.jsx(v,{children:e.jsx(y,{placeholder:"Selecciona parque"})})}),e.jsx(f,{children:Array.isArray(k)&&k.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(x,{})]})}}),e.jsx(l,{control:m.control,name:"categoryId",render:({field:s})=>{var r;return e.jsxs(o,{children:[e.jsx(c,{children:"Categoría"}),e.jsxs(p,{onValueChange:a=>s.onChange(parseInt(a)),value:(r=s.value)==null?void 0:r.toString(),children:[e.jsx(d,{children:e.jsx(v,{children:e.jsx(y,{placeholder:"Selecciona categoría"})})}),e.jsx(f,{children:Array.isArray(C)&&C.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(x,{})]})}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:m.control,name:"amount",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Monto"}),e.jsx(d,{children:e.jsx(j,{type:"number",placeholder:"0.00",...s,onChange:r=>s.onChange(parseFloat(r.target.value)||0)})}),e.jsx(x,{})]})}),e.jsx(l,{control:m.control,name:"date",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Fecha"}),e.jsx(d,{children:e.jsx(j,{type:"date",...s})}),e.jsx(x,{})]})})]}),e.jsx(l,{control:m.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Descripción"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Descripción del ingreso",...s})}),e.jsx(x,{})]})}),e.jsx(l,{control:m.control,name:"source",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Fuente (Opcional)"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Fuente del ingreso",...s})}),e.jsx(x,{})]})}),e.jsx(l,{control:m.control,name:"notes",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Notas (Opcional)"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Notas adicionales",...s})}),e.jsx(x,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),e.jsxs(t,{type:"submit",disabled:L.isPending,children:[L.isPending&&e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Registrar Ingreso"]})]})]})})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Filtros"}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"filter-year",children:"Año"}),e.jsxs(p,{value:i.year,onValueChange:s=>S({...i,year:s}),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Año"})}),e.jsxs(f,{children:[e.jsx(n,{value:"all",children:"Todos los años"}),e.jsx(n,{value:"2025",children:"2025"}),e.jsx(n,{value:"2024",children:"2024"}),e.jsx(n,{value:"2023",children:"2023"})]})]})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"filter-month",children:"Mes"}),e.jsxs(p,{value:i.month,onValueChange:s=>S({...i,month:s}),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Mes"})}),e.jsxs(f,{children:[e.jsx(n,{value:"all",children:"Todos los meses"}),e.jsx(n,{value:"01",children:"Enero"}),e.jsx(n,{value:"02",children:"Febrero"}),e.jsx(n,{value:"03",children:"Marzo"}),e.jsx(n,{value:"04",children:"Abril"}),e.jsx(n,{value:"05",children:"Mayo"}),e.jsx(n,{value:"06",children:"Junio"}),e.jsx(n,{value:"07",children:"Julio"}),e.jsx(n,{value:"08",children:"Agosto"}),e.jsx(n,{value:"09",children:"Septiembre"}),e.jsx(n,{value:"10",children:"Octubre"}),e.jsx(n,{value:"11",children:"Noviembre"}),e.jsx(n,{value:"12",children:"Diciembre"})]})]})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"filter-date",children:"Fecha específica"}),e.jsx(j,{type:"date",value:i.date,onChange:s=>S({...i,date:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"filter-category",children:"Categoría"}),e.jsxs(p,{value:i.category,onValueChange:s=>S({...i,category:s}),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Categoría"})}),e.jsxs(f,{children:[e.jsx(n,{value:"all",children:"Todas las categorías"}),Array.isArray(C)&&C.map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(t,{variant:"outline",onClick:()=>S({year:"",month:"",date:"",category:"",amount:""}),className:"w-full",children:"Limpiar filtros"})})]})]}),e.jsxs(Ie,{children:[e.jsxs(Se,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Registro de Ingresos"]}),e.jsxs(Ee,{children:["Listado completo de todos los ingresos registrados (",A," registros)"]})]}),e.jsxs(Fe,{children:[ee?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(D,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Cargando ingresos..."})]}):R&&R.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-8 gap-4 text-sm font-medium text-gray-500 pb-2 border-b",children:[e.jsx("div",{children:"Fecha"}),e.jsx("div",{children:"Parque"}),e.jsx("div",{children:"Categoría"}),e.jsx("div",{children:"Descripción"}),e.jsx("div",{children:"Monto"}),e.jsx("div",{children:"Fuente"}),e.jsx("div",{children:"Estado"}),e.jsx("div",{children:"Acciones"})]}),R.map(s=>e.jsxs("div",{className:"grid grid-cols-8 gap-4 text-sm py-3 border-b border-gray-100 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 text-gray-400"}),ne(s.date)]}),e.jsx("div",{className:"font-medium",children:s.parkName||"N/A"}),e.jsx("div",{children:e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:s.categoryName||"Sin categoría"})}),e.jsx("div",{className:"text-gray-600",children:s.description}),e.jsx("div",{className:"font-semibold text-green-600",children:re(s.amount)}),e.jsx("div",{className:"text-gray-500",children:s.source||"-"}),e.jsx("div",{children:e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Te,{className:"h-4 w-4"}),"Registrado"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>je(s),className:"h-8 w-8 p-0",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>{Z(s),F(!0)},className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Ae,{className:"h-4 w-4"})})]})]},s.id))]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No se encontraron ingresos registrados"}),b>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Página ",g," de ",b," - Mostrando ",K+1,"-",Math.min(ae,A)," de ",A," ingresos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>M(Math.max(1,g-1)),disabled:g===1,className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Anterior"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,b)},(s,r)=>{const a=Math.max(1,Math.min(b-4,g-2))+r;return e.jsx(t,{variant:g===a?"default":"outline",size:"sm",onClick:()=>M(a),className:"w-8 h-8 p-0",children:a},a)})}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>M(Math.min(b,g+1)),disabled:g===b,className:"flex items-center gap-1",children:["Siguiente",e.jsx(Pe,{className:"h-4 w-4"})]})]})]})]})]}),e.jsx(H,{open:de,onOpenChange:E,children:e.jsxs(Q,{className:"max-w-lg","aria-describedby":"income-edit-description",children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Editar Ingreso"}),e.jsx("div",{id:"income-edit-description",className:"sr-only",children:"Formulario para editar un ingreso financiero existente"}),e.jsx(U,{children:"Modifica la información del ingreso."})]}),W&&e.jsx(le,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(ue),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:h.control,name:"parkId",render:({field:s})=>{var r;return e.jsxs(o,{children:[e.jsx(c,{children:"Parque"}),e.jsxs(p,{onValueChange:a=>s.onChange(parseInt(a)),value:(r=s.value)==null?void 0:r.toString(),children:[e.jsx(d,{children:e.jsx(v,{children:e.jsx(y,{placeholder:"Selecciona parque"})})}),e.jsx(f,{children:Array.isArray(k)&&k.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(x,{})]})}}),e.jsx(l,{control:h.control,name:"categoryId",render:({field:s})=>{var r;return e.jsxs(o,{children:[e.jsx(c,{children:"Categoría"}),e.jsxs(p,{onValueChange:a=>s.onChange(parseInt(a)),value:(r=s.value)==null?void 0:r.toString(),children:[e.jsx(d,{children:e.jsx(v,{children:e.jsx(y,{placeholder:"Selecciona categoría"})})}),e.jsx(f,{children:Array.isArray(C)&&C.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(x,{})]})}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:h.control,name:"amount",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Monto"}),e.jsx(d,{children:e.jsx(j,{type:"number",placeholder:"0.00",...s,onChange:r=>s.onChange(parseFloat(r.target.value)||0)})}),e.jsx(x,{})]})}),e.jsx(l,{control:h.control,name:"date",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Fecha"}),e.jsx(d,{children:e.jsx(j,{type:"date",...s})}),e.jsx(x,{})]})})]}),e.jsx(l,{control:h.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Descripción"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Descripción del ingreso",...s})}),e.jsx(x,{})]})}),e.jsx(l,{control:h.control,name:"source",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Fuente (Opcional)"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Fuente del ingreso",...s})}),e.jsx(x,{})]})}),e.jsx(l,{control:h.control,name:"notes",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Notas (Opcional)"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Notas adicionales",...s})}),e.jsx(x,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsxs(t,{type:"submit",disabled:z.isPending,children:[z.isPending&&e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Actualizar Ingreso"]})]})]})})]})}),e.jsx(H,{open:xe,onOpenChange:F,children:e.jsxs(Q,{children:[e.jsxs(X,{children:[e.jsx(Y,{children:"Confirmar Eliminación"}),e.jsx(U,{children:"¿Estás seguro de que deseas eliminar este ingreso? Esta acción no se puede deshacer."})]}),I&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Descripción:"})," ",I.description]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Monto:"})," ",re(I.amount)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",ne(I.date)]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),e.jsxs(t,{variant:"destructive",onClick:()=>V.mutate(I.id),disabled:V.isPending,children:[V.isPending&&e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Eliminar Ingreso"]})]})]})})]})})};export{Ke as default};
