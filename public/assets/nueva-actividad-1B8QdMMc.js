import{a5 as i,al as ae,e as se,a6 as re,Y as b,u as z,a7 as ne,a8 as ie,j as e,aB as ce,B as N,aa as oe,ab as c,ac as o,ad as t,ae as l,I as f,af as d,O as V,z as E,H as G,J as M,K as T,N as P,bt as S,bu as K,l as U,h as _,X as q,b6 as $,aX as te,S as H,b4 as le,ag as de,ah as me}from"./index-BBGHPKhn.js";import{C as he}from"./checkbox-DK4Ni3Jp.js";import{C as O}from"./calendar-CINRWzw_.js";import{P as J,a as Q,b as X}from"./popover-D0eXtsNc.js";import{L as xe}from"./LocationSelector-DgCtE4DR.js";import"./subDays-Dk5VivQJ.js";import"./isSameMonth-BMtjuyI-.js";import"./startOfMonth-Cxv5uHqS.js";import"./addMonths-FaidB020.js";const ue=i.object({nombre:i.string().min(3,"El nombre debe tener al menos 3 caracteres"),descripcion:i.string().min(10,"La descripción debe tener al menos 10 caracteres"),categoria:i.string({required_error:"Selecciona una categoría"}),parqueId:i.number({required_error:"Selecciona un parque"}),fechaInicio:i.date({required_error:"Selecciona una fecha de inicio"}),fechaFin:i.date().optional(),horaInicio:i.string().min(1,"Selecciona una hora de inicio"),duracion:i.number().min(1,"La duración debe ser al menos 1 minuto"),capacidad:i.number().optional(),materiales:i.string().optional(),personalRequerido:i.number().optional(),esRecurrente:i.boolean().default(!1),esGratuita:i.boolean().default(!0),precio:i.number().optional(),ubicacion:i.string().optional(),ubicaciones:i.array(i.string()).optional(),diasRecurrentes:i.array(i.string()).optional(),requisitos:i.string().optional(),instructorId:i.number().optional()}),je=({onImagesChange:F,selectedImages:h})=>{const[u,w]=b.useState([]),[p,R]=b.useState(0),j=x=>{const g=Array.from(x.target.files||[]).filter(v=>v.type.startsWith("image/"));if(g.length>0){const v=[...h,...g];F(v),g.forEach(r=>{const I=new FileReader;I.onload=k=>{w(L=>{var y;return[...L,(y=k.target)==null?void 0:y.result]})},I.readAsDataURL(r)})}},A=x=>{const m=h.filter((v,r)=>r!==x),g=u.filter((v,r)=>r!==x);F(m),w(g),p>=m.length&&R(Math.max(0,m.length-1))},D=x=>{R(x)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("input",{type:"file",multiple:!0,accept:"image/*",onChange:j,className:"hidden",id:"image-upload"}),e.jsxs("label",{htmlFor:"image-upload",className:"cursor-pointer",children:[e.jsx(te,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Haz clic para subir imágenes o arrastra archivos aquí"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, GIF hasta 10MB cada una"})]})]}),u.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:u.map((x,m)=>e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"aspect-square rounded-lg overflow-hidden bg-gray-100",children:e.jsx("img",{src:x,alt:`Preview ${m+1}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg flex items-center justify-center space-x-2",children:[e.jsxs(N,{type:"button",size:"sm",variant:p===m?"default":"secondary",onClick:()=>D(m),className:"text-xs",children:[e.jsx(H,{className:"w-3 h-3 mr-1"}),p===m?"Principal":"Hacer principal"]}),e.jsx(N,{type:"button",size:"sm",variant:"destructive",onClick:()=>A(m),children:e.jsx(le,{className:"w-3 h-3"})})]}),p===m&&e.jsxs("div",{className:"absolute top-2 left-2 bg-yellow-500 text-white px-2 py-1 rounded text-xs font-semibold",children:[e.jsx(H,{className:"w-3 h-3 inline mr-1"}),"Principal"]})]},m))}),h.length>0&&e.jsxs("p",{className:"text-sm text-gray-600",children:[h.length," imagen",h.length!==1?"es":""," seleccionada",h.length!==1?"s":"",h.length>0&&` • Imagen principal: ${p+1}`]})]})},we=()=>{const[F,h]=ae(),{toast:u}=se(),w=re();b.useState("");const[p,R]=b.useState([]),[j,A]=b.useState([]);b.useState([]);const[D,x]=b.useState(0),{data:m=[]}=z({queryKey:["/api/parks"]}),{data:g=[]}=z({queryKey:["/api/activity-categories"]}),{data:v=[]}=z({queryKey:["/api/instructors"]}),r=ne({resolver:de(ue),defaultValues:{nombre:"",descripcion:"",categoria:"",fechaInicio:void 0,horaInicio:"",duracion:60,capacidad:void 0,esRecurrente:!1,esGratuita:!0,precio:void 0,ubicacion:"",ubicaciones:[],diasRecurrentes:[]}}),I=r.watch("esRecurrente"),k=r.watch("esGratuita"),L=r.watch("parqueId"),y=ie({mutationFn:async a=>await me("/api/activities",{method:"POST",data:a}),onSuccess:async a=>{console.log("🎯 Actividad creada exitosamente:",a),console.log("🎯 Imágenes seleccionadas:",j.length),console.log("🎯 ID de actividad recibido:",a.id),u({title:"Actividad creada",description:"La actividad ha sido creada exitosamente."}),w.invalidateQueries({queryKey:["/api/activities"]}),j.length>0&&a.id?(console.log("🎯 Iniciando subida de imágenes..."),await W(a.id)):(console.log("🎯 No hay imágenes para subir, redirigiendo..."),h("/admin/organizador"))},onError:a=>{u({title:"Error",description:a.message||"No se pudo crear la actividad",variant:"destructive"})}}),W=async a=>{try{for(let s=0;s<j.length;s++){const n=j[s],C=new FormData;C.append("image",n),C.append("isPrimary",(s===D).toString()),await fetch(`/api/activities/${a}/images`,{method:"POST",body:C})}u({title:"Imágenes subidas",description:`Se subieron ${j.length} imágenes exitosamente.`}),h("/admin/organizador")}catch(s){console.error("Error subiendo imágenes:",s),u({title:"Error al subir imágenes",description:"La actividad se creó, pero hubo un problema al subir las imágenes.",variant:"destructive"}),h("/admin/organizador")}},Y=a=>{const s={...a,ubicaciones:p};y.mutate(s)},Z=[{id:"lunes",label:"Lunes"},{id:"martes",label:"Martes"},{id:"miercoles",label:"Miércoles"},{id:"jueves",label:"Jueves"},{id:"viernes",label:"Viernes"},{id:"sabado",label:"Sábado"},{id:"domingo",label:"Domingo"}];return e.jsxs(ce,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(N,{variant:"outline",className:"mb-4",onClick:()=>h("/admin/organizador"),children:"← Volver a Organizador"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Crear Nueva Actividad"}),e.jsx("p",{className:"text-gray-500",children:"Completa el formulario para crear una nueva actividad o evento"})]}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-sm border border-gray-100",children:e.jsx(oe,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(Y),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold border-b pb-2",children:"Información Básica"}),e.jsx(c,{control:r.control,name:"nombre",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Nombre de la actividad"}),e.jsx(l,{children:e.jsx(f,{placeholder:"Ej: Taller de pintura",...a})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"descripcion",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Descripción"}),e.jsx(l,{children:e.jsx(V,{placeholder:"Describe brevemente la actividad...",className:"min-h-[120px]",...a})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"categoria",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Categoría"}),e.jsxs(E,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(l,{children:e.jsx(G,{children:e.jsx(M,{placeholder:"Selecciona una categoría"})})}),e.jsx(T,{children:g.map(s=>e.jsx(P,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"parqueId",render:({field:a})=>{var s;return e.jsxs(o,{children:[e.jsx(t,{children:"Parque"}),e.jsxs(E,{onValueChange:n=>a.onChange(Number(n)),defaultValue:(s=a.value)==null?void 0:s.toString(),children:[e.jsx(l,{children:e.jsx(G,{children:e.jsx(M,{placeholder:"Selecciona un parque"})})}),e.jsx(T,{children:m.map(n=>e.jsx(P,{value:n.id.toString(),children:n.name},n.id))})]}),e.jsx(d,{})]})}}),e.jsx(c,{control:r.control,name:"instructorId",render:({field:a})=>{var s;return e.jsxs(o,{children:[e.jsx(t,{children:"Instructor Asignado"}),e.jsxs(E,{onValueChange:n=>a.onChange(n==="0"?void 0:Number(n)),defaultValue:((s=a.value)==null?void 0:s.toString())||"0",children:[e.jsx(l,{children:e.jsx(G,{children:e.jsx(M,{placeholder:"Selecciona un instructor (opcional)"})})}),e.jsxs(T,{children:[e.jsx(P,{value:"0",children:"Sin instructor asignado"}),v.map(n=>e.jsxs(P,{value:n.id.toString(),children:[n.firstName," ",n.lastName,n.specialties&&n.specialties.length>0&&e.jsxs("span",{className:"text-muted-foreground ml-2",children:["(",n.specialties.slice(0,2).join(", "),")"]})]},n.id))]})]}),e.jsx(S,{children:"Asigna un instructor responsable de dirigir esta actividad"}),e.jsx(d,{})]})}}),e.jsx(c,{control:r.control,name:"ubicacion",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Ubicación"}),e.jsx(l,{children:e.jsx(xe,{parkId:L,value:a.value,onChange:a.onChange,placeholder:"Seleccionar ubicación"})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold border-b pb-2",children:"Programación y Detalles"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"fechaInicio",render:({field:a})=>e.jsxs(o,{className:"flex flex-col",children:[e.jsx(t,{children:"Fecha de inicio"}),e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(l,{children:e.jsxs(N,{variant:"outline",className:K("pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),children:[a.value?U(a.value,"PPP",{locale:q}):e.jsx("span",{children:"Seleccionar fecha"}),e.jsx(_,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(X,{className:"w-auto p-0",align:"start",children:e.jsx(O,{mode:"single",selected:a.value,onSelect:a.onChange,initialFocus:!0,locale:q})})]}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"fechaFin",render:({field:a})=>e.jsxs(o,{className:"flex flex-col",children:[e.jsx(t,{children:"Fecha de fin (opcional)"}),e.jsxs(J,{children:[e.jsx(Q,{asChild:!0,children:e.jsx(l,{children:e.jsxs(N,{variant:"outline",className:K("pl-3 text-left font-normal",!a.value&&"text-muted-foreground"),children:[a.value?U(a.value,"PPP",{locale:q}):e.jsx("span",{children:"Seleccionar fecha"}),e.jsx(_,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(X,{className:"w-auto p-0",align:"start",children:e.jsx(O,{mode:"single",selected:a.value,onSelect:a.onChange,initialFocus:!0,locale:q,disabled:s=>{const n=r.getValues("fechaInicio");return n?s<n:!1}})})]}),e.jsx(S,{children:"Dejar en blanco para actividades de un solo día"}),e.jsx(d,{})]})})]}),e.jsx(c,{control:r.control,name:"horaInicio",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Hora de inicio"}),e.jsx(l,{children:e.jsx(f,{type:"time",...a})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"duracion",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Duración (minutos)"}),e.jsx(l,{children:e.jsx(f,{type:"number",min:1,...a,onChange:s=>a.onChange(Number(s.target.value))})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"capacidad",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Capacidad máxima (opcional)"}),e.jsx(l,{children:e.jsx(f,{type:"number",min:1,placeholder:"Deja en blanco si no hay límite",value:a.value||"",onChange:s=>{const n=s.target.value;a.onChange(n===""?void 0:Number(n))}})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"esRecurrente",render:({field:a})=>e.jsxs(o,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Actividad recurrente"}),e.jsx(S,{children:"Se repite semanalmente"})]}),e.jsx(l,{children:e.jsx($,{checked:a.value,onCheckedChange:a.onChange})})]})}),e.jsx(c,{control:r.control,name:"esGratuita",render:({field:a})=>e.jsxs(o,{className:"flex flex-row items-center justify-between rounded-lg border p-3",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Actividad gratuita"}),e.jsx(S,{children:"No tiene costo para los participantes"})]}),e.jsx(l,{children:e.jsx($,{checked:a.value,onCheckedChange:a.onChange})})]})})]}),!k&&e.jsx(c,{control:r.control,name:"precio",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Precio (MXN)"}),e.jsx(l,{children:e.jsx(f,{type:"number",min:1,step:.01,...a,onChange:s=>a.onChange(Number(s.target.value))})}),e.jsx(d,{})]})}),I&&e.jsx(c,{control:r.control,name:"diasRecurrentes",render:()=>e.jsxs(o,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{className:"text-base",children:"Días de la semana"}),e.jsx(S,{children:"Selecciona los días en que se repite la actividad"})]}),e.jsx("div",{className:"grid grid-cols-3 md:grid-cols-4 gap-2",children:Z.map(a=>e.jsx(c,{control:r.control,name:"diasRecurrentes",render:({field:s})=>{var n;return e.jsxs(o,{className:"flex flex-row items-start space-x-2 space-y-0",children:[e.jsx(l,{children:e.jsx(he,{checked:(n=s.value)==null?void 0:n.includes(a.id),onCheckedChange:C=>{const B=s.value||[];return C?s.onChange([...B,a.id]):s.onChange(B.filter(ee=>ee!==a.id))}})}),e.jsx(t,{className:"font-normal",children:a.label})]},a.id)}},a.id))}),e.jsx(d,{})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold border-b pb-2",children:"Detalles Adicionales"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{control:r.control,name:"materiales",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Materiales necesarios (opcional)"}),e.jsx(l,{children:e.jsx(V,{placeholder:"Lista de materiales requeridos para la actividad...",className:"min-h-[100px]",...a})}),e.jsx(d,{})]})}),e.jsx(c,{control:r.control,name:"requisitos",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Requisitos para participantes (opcional)"}),e.jsx(l,{children:e.jsx(V,{placeholder:"Requisitos o recomendaciones para los participantes...",className:"min-h-[100px]",...a})}),e.jsx(d,{})]})})]}),e.jsx(c,{control:r.control,name:"personalRequerido",render:({field:a})=>e.jsxs(o,{children:[e.jsx(t,{children:"Personal requerido (opcional)"}),e.jsx(l,{children:e.jsx(f,{type:"number",min:0,placeholder:"Número de personas necesarias para organizar la actividad",value:a.value||"",onChange:s=>{const n=s.target.value;a.onChange(n===""?void 0:Number(n))}})}),e.jsx(d,{})]})})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Imágenes de la actividad"}),e.jsx(je,{onImagesChange:A,selectedImages:j})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>h("/admin/organizador"),children:"Cancelar"}),e.jsx(N,{type:"submit",disabled:y.isPending,children:y.isPending?"Creando actividad...":"Crear Actividad"})]})]})})})]})};export{we as default};
