import{a2 as S,u as T,j as e,aX as x,f as d,m as v,g as h,h as g,B as f,aM as M,aN as F,i as j,o as b,n as _,U as I,as as L}from"./index-D5qLf1ib.js";const $={borrador:"bg-gray-100 text-gray-800",solicitado:"bg-blue-100 text-blue-800",en_revision:"bg-yellow-100 text-yellow-800",aprobado:"bg-green-100 text-green-800",rechazado:"bg-red-100 text-red-800",cancelado:"bg-gray-100 text-gray-800",realizado:"bg-purple-100 text-purple-800"},z={bajo_impacto:"bg-emerald-100 text-emerald-800",alto_impacto:"bg-orange-100 text-orange-800"};function R(){const[m,y]=S.useState(new Date),l=m.getMonth(),c=m.getFullYear(),{data:o=[],isLoading:w,error:p}=T({queryKey:["/api/eventos-ambu/calendar",l,c],queryFn:async()=>{try{const s=new Date(c,l,1).toISOString().split("T")[0],a=new Date(c,l+1,0).toISOString().split("T")[0],n=new URLSearchParams({fecha_desde:s,fecha_hasta:a,limit:"100"}),t=await fetch(`/api/eventos-ambu?${n}`);if(!t.ok)throw new Error("Error al cargar eventos");const r=await t.json();console.log("Datos recibidos:",r);let i=[];return Array.isArray(r)?i=r:r.eventos&&Array.isArray(r.eventos)?i=r.eventos:(console.warn("Estructura de datos inesperada:",r),i=[]),i}catch(s){throw console.error("Error en queryFn:",s),s}},retry:1,staleTime:0}),u=s=>{const a=new Date(m);s==="anterior"?a.setMonth(l-1):a.setMonth(l+1),y(a)},D=s=>{const a=new Date(c,l,s).toISOString().split("T")[0];return o.filter(n=>n.fechaEvento===a)},E=()=>{const s=new Date(c,l,1),a=new Date(c,l+1,0),n=s.getDay(),t=a.getDate(),r=[];for(let i=0;i<n;i++)r.push(null);for(let i=1;i<=t;i++)r.push(i);return r},C=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],A=["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],N=s=>{if(!s)return"0.00";const a=typeof s=="string"?parseFloat(s):s;return isNaN(a)?"0.00":a.toFixed(2)};return p?e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600",children:"Error al cargar el calendario"}),e.jsx("p",{className:"text-gray-600 mt-2",children:p.message})]})})}):w?e.jsx(x,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando calendario..."})]})})}):e.jsx(x,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Calendario de Eventos"})]}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Vista mensual de eventos de bajo y alto impacto (",o.length," eventos cargados)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(d,{children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"text-xl",children:[C[l]," ",c]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{variant:"outline",size:"sm",onClick:()=>u("anterior"),children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx(f,{variant:"outline",size:"sm",onClick:()=>u("siguiente"),children:e.jsx(F,{className:"h-4 w-4"})})]})]})}),e.jsxs(j,{children:[e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:A.map(s=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-gray-600",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:E().map((s,a)=>{const n=s?D(s):[];return e.jsx("div",{className:"min-h-24 p-1 border border-gray-200 rounded",children:s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 mb-1",children:s}),e.jsxs("div",{className:"space-y-1",children:[n.slice(0,2).map(t=>e.jsx("div",{className:`text-xs p-1 rounded text-white ${t.impactoTipo==="bajo_impacto"?"bg-emerald-500":"bg-orange-500"}`,title:t.titulo,children:t.titulo.length>15?t.titulo.substring(0,15)+"...":t.titulo},`evento-${t.id}`)),n.length>2&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",n.length-2," más"]})]})]})},`${a}-${s||"empty"}`)})})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(g,{className:"text-lg",children:"Próximos Eventos"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-3",children:[o.filter(s=>new Date(s.fechaEvento)>=new Date).sort((s,a)=>new Date(s.fechaEvento).getTime()-new Date(a.fechaEvento).getTime()).slice(0,5).map(s=>e.jsxs("div",{className:"border-l-4 border-blue-500 pl-3 py-2",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("h4",{className:"font-medium text-sm line-clamp-2",children:s.titulo}),e.jsx(b,{className:z[s.impactoTipo],variant:"secondary",children:s.impactoTipo==="bajo_impacto"?"Bajo":"Alto"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(v,{className:"h-3 w-3"}),new Date(s.fechaEvento).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(_,{className:"h-3 w-3"}),s.horaInicio," - ",s.horaFin]}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(I,{className:"h-3 w-3"}),s.numeroAsistentes," asistentes"]}),s.costoTotal&&parseFloat(N(s.costoTotal))>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-600",children:[e.jsx(L,{className:"h-3 w-3"}),"$",N(s.costoTotal)]})]}),e.jsx(b,{className:$[s.status],variant:"outline",children:s.status.replace("_"," ").toUpperCase()})]},`proximo-${s.id}`)),o.filter(s=>new Date(s.fechaEvento)>=new Date).length===0&&e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"No hay eventos próximos"})]})})]}),e.jsxs(d,{children:[e.jsx(h,{children:e.jsx(g,{className:"text-lg",children:"Leyenda"})}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Tipo de Impacto"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded"}),e.jsx("span",{className:"text-sm",children:"Bajo Impacto (≤10 días)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-500 rounded"}),e.jsx("span",{className:"text-sm",children:"Alto Impacto (2 meses)"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Estados"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),e.jsx("span",{children:"Solicitado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),e.jsx("span",{children:"En Revisión"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{children:"Aprobado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full"}),e.jsx("span",{children:"Realizado"})]})]})]})]})})]})]})]})]})})}export{R as default};
