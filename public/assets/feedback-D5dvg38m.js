import{e as re,a6 as le,Y as i,u as T,a8 as ie,j as e,aI as ne,C as n,c,Q as v,i as K,ba as U,a9 as ce,y as t,Z as de,I as oe,z as N,H as y,J as f,K as w,N as l,B as x,ak as me,m as xe,n as he,P as je,M as ue,l as k,an as pe,f as b,b7 as ge,D as J,r as $,t as G,v as X,w as Y,O as ve,be as Ne,h as ye,bf as fe,aJ as we,X as P}from"./index-VG22aPDC.js";function Ce(){const{toast:q}=re(),A=le(),[a,_]=i.useState(null),[Z,D]=i.useState(!1),[W,h]=i.useState(!1),[j,R]=i.useState(""),[u,z]=i.useState("all"),[p,B]=i.useState("all"),[g,L]=i.useState("all"),[d,C]=i.useState({status:"",adminNotes:"",tags:[]}),{data:F,isLoading:ee}=T({queryKey:["/api/feedback",{search:j,park:u,formType:p,status:g}],queryFn:async()=>{const s=new URLSearchParams;j&&s.append("search",j),u!=="all"&&s.append("park",u),p!=="all"&&s.append("formType",p),g!=="all"&&s.append("status",g);const r=await fetch(`/api/feedback?${s.toString()}`);if(!r.ok)throw new Error("Error al cargar retroalimentación");return r.json()}}),{data:E}=T({queryKey:["/api/parks"],queryFn:async()=>{const s=await fetch("/api/parks");if(!s.ok)throw new Error("Error al cargar parques");return await s.json()}}),M=(E==null?void 0:E.data)||[],{data:o}=T({queryKey:["/api/feedback/stats"],queryFn:async()=>{const s=await fetch("/api/feedback/stats");if(!s.ok)throw new Error("Error al cargar estadísticas");return s.json()}}),S=ie({mutationFn:async s=>{const r=await fetch(`/api/feedback/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error("Error al actualizar retroalimentación");return r.json()},onSuccess:()=>{A.invalidateQueries({queryKey:["/api/feedback"]}),A.invalidateQueries({queryKey:["/api/feedback/stats"]}),h(!1),q({title:"Actualizado",description:"La retroalimentación ha sido actualizada exitosamente"})},onError:()=>{q({title:"Error",description:"No se pudo actualizar la retroalimentación",variant:"destructive"})}}),se=s=>{_(s),C({status:s.status,adminNotes:s.adminNotes||"",tags:s.tags||[]}),h(!0)},ae=s=>{_(s),D(!0)},te=()=>{a&&S.mutate({id:a.id,status:d.status,adminNotes:d.adminNotes,tags:d.tags})},O=s=>{switch(s){case"share":return e.jsx(v,{className:"h-4 w-4"});case"report_problem":return e.jsx(we,{className:"h-4 w-4"});case"suggest_improvement":return e.jsx(fe,{className:"h-4 w-4"});case"propose_event":return e.jsx(ye,{className:"h-4 w-4"});default:return e.jsx(v,{className:"h-4 w-4"})}},V=s=>{switch(s){case"share":return"Compartir Parque";case"report_problem":return"Reportar Problema";case"suggest_improvement":return"Sugerir Mejora";case"propose_event":return"Proponer Evento";default:return s}},I=s=>{const r={pending:"default",reviewed:"secondary",in_progress:"outline",resolved:"secondary",closed:"destructive"},m={pending:"Pendiente",reviewed:"Revisado",in_progress:"En Progreso",resolved:"Resuelto",closed:"Cerrado"};return e.jsx(b,{variant:r[s]||"default",children:m[s]||s})},Q=s=>{if(!s)return null;const r={low:"outline",medium:"secondary",high:"destructive",urgent:"destructive"},m={low:"Baja",medium:"Media",high:"Alta",urgent:"Urgente"};return e.jsx(b,{variant:r[s]||"default",className:"ml-2",children:m[s]||s})};if(ee)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})});const H=(F==null?void 0:F.feedback)||[];return e.jsx(ne,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Retroalimentación de Parques"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gestiona la retroalimentación de los visitantes sobre los parques"})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:o.total})]}),e.jsx(v,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pendientes"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:o.pending})]}),e.jsx(K,{className:"h-8 w-8 text-orange-600"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"En Progreso"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:o.in_progress})]}),e.jsx(U,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Resueltos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:o.resolved})]}),e.jsx(ce,{className:"h-8 w-8 text-green-600"})]})})})]}),e.jsx(n,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"search",children:"Búsqueda"}),e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(oe,{id:"search",placeholder:"Buscar por nombre, email...",value:j,onChange:s=>R(s.target.value),className:"pl-10"})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"park-filter",children:"Parque"}),e.jsxs(N,{value:u,onValueChange:z,children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Todos los parques"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"Todos los parques"}),M==null?void 0:M.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"form-type-filter",children:"Tipo de Formulario"}),e.jsxs(N,{value:p,onValueChange:B,children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Todos los tipos"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"Todos los tipos"}),e.jsx(l,{value:"share",children:"Compartir Parque"}),e.jsx(l,{value:"report_problem",children:"Reportar Problema"}),e.jsx(l,{value:"suggest_improvement",children:"Sugerir Mejora"}),e.jsx(l,{value:"propose_event",children:"Proponer Evento"})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"status-filter",children:"Estado"}),e.jsxs(N,{value:g,onValueChange:L,children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Todos los estados"})}),e.jsxs(w,{children:[e.jsx(l,{value:"all",children:"Todos los estados"}),e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"reviewed",children:"Revisado"}),e.jsx(l,{value:"in_progress",children:"En Progreso"}),e.jsx(l,{value:"resolved",children:"Resuelto"}),e.jsx(l,{value:"closed",children:"Cerrado"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(x,{variant:"outline",onClick:()=>{R(""),z("all"),B("all"),L("all")},className:"w-full",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Limpiar Filtros"]})})]})})}),e.jsx("div",{className:"grid gap-4",children:H.length===0?e.jsx(n,{children:e.jsxs(c,{className:"p-8 text-center",children:[e.jsx(v,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay retroalimentación disponible"}),e.jsx("p",{className:"text-gray-600",children:"No se encontró retroalimentación con los filtros aplicados"})]})}):H.map(s=>e.jsx(n,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[O(s.formType),e.jsx("span",{className:"font-medium text-gray-900",children:V(s.formType)})]}),I(s.status),Q(s.priority)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),s.fullName]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),s.email]}),s.phone&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),s.phone]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),s.parkName]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),k(new Date(s.createdAt),"dd 'de' MMMM, yyyy 'a las' HH:mm",{locale:P})]}),s.category&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),s.category]})]})]}),s.subject&&e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:s.subject}),e.jsx("p",{className:"text-gray-700 mb-4 line-clamp-3",children:s.message}),s.tags&&s.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mb-4",children:s.tags.map((r,m)=>e.jsx(b,{variant:"outline",className:"text-xs",children:r},m))})]}),e.jsxs("div",{className:"flex space-x-2 ml-4",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>ae(s),children:e.jsx(ge,{className:"h-4 w-4"})}),e.jsx(x,{variant:"outline",size:"sm",onClick:()=>se(s),children:e.jsx(U,{className:"h-4 w-4"})})]})]})})},s.id))}),e.jsx(J,{open:Z,onOpenChange:D,children:e.jsxs($,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(G,{children:[e.jsxs(X,{className:"flex items-center space-x-2",children:[a&&O(a.formType),e.jsx("span",{children:a&&V(a.formType)})]}),e.jsx(Y,{children:"Detalles completos de la retroalimentación"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Estado"}),e.jsxs("div",{className:"mt-1",children:[I(a.status),Q(a.priority)]})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Parque"}),e.jsx("p",{className:"mt-1",children:a.parkName})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Nombre Completo"}),e.jsx("p",{className:"mt-1",children:a.fullName})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Email"}),e.jsx("p",{className:"mt-1",children:a.email})]})]}),a.phone&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Teléfono"}),e.jsx("p",{className:"mt-1",children:a.phone})]}),a.subject&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Asunto"}),e.jsx("p",{className:"mt-1",children:a.subject})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Mensaje"}),e.jsx("p",{className:"mt-1 whitespace-pre-wrap",children:a.message})]}),a.category&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Categoría"}),e.jsx("p",{className:"mt-1",children:a.category})]}),a.eventType&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Tipo de Evento"}),e.jsx("p",{className:"mt-1",children:a.eventType})]}),a.expectedAttendance&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Asistencia Esperada"}),e.jsxs("p",{className:"mt-1",children:[a.expectedAttendance," personas"]})]})]}),a.suggestedDate&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Fecha Sugerida"}),e.jsx("p",{className:"mt-1",children:k(new Date(a.suggestedDate),"dd 'de' MMMM, yyyy",{locale:P})})]}),a.socialMedia&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Redes Sociales"}),e.jsx("p",{className:"mt-1",children:a.socialMedia})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Fecha de Creación"}),e.jsx("p",{className:"mt-1",children:k(new Date(a.createdAt),"dd 'de' MMMM, yyyy 'a las' HH:mm",{locale:P})})]}),a.tags&&a.tags.length>0&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Etiquetas"}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:a.tags.map((s,r)=>e.jsx(b,{variant:"outline",children:s},r))})]}),a.adminNotes&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium text-gray-600",children:"Notas Administrativas"}),e.jsx("p",{className:"mt-1 whitespace-pre-wrap",children:a.adminNotes})]})]})]})}),e.jsx(J,{open:W,onOpenChange:h,children:e.jsxs($,{className:"max-w-md",children:[e.jsxs(G,{children:[e.jsx(X,{children:"Actualizar Retroalimentación"}),e.jsx(Y,{children:"Actualiza el estado y agrega notas administrativas"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(t,{htmlFor:"status",children:"Estado"}),e.jsxs(N,{value:d.status,onValueChange:s=>C(r=>({...r,status:s})),children:[e.jsx(y,{children:e.jsx(f,{})}),e.jsxs(w,{children:[e.jsx(l,{value:"pending",children:"Pendiente"}),e.jsx(l,{value:"reviewed",children:"Revisado"}),e.jsx(l,{value:"in_progress",children:"En Progreso"}),e.jsx(l,{value:"resolved",children:"Resuelto"}),e.jsx(l,{value:"closed",children:"Cerrado"})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{htmlFor:"admin-notes",children:"Notas Administrativas"}),e.jsx(ve,{id:"admin-notes",placeholder:"Agrega notas sobre esta retroalimentación...",value:d.adminNotes,onChange:s=>C(r=>({...r,adminNotes:s.target.value})),rows:4})]})]}),e.jsxs(Ne,{children:[e.jsx(x,{variant:"outline",onClick:()=>h(!1),children:"Cancelar"}),e.jsx(x,{onClick:te,disabled:S.isPending,children:S.isPending?"Actualizando...":"Actualizar"})]})]})})]})})}export{Ce as default};
