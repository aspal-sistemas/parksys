import{l as As,ae as Ps,a2 as b,u as xe,r as V,ag as ks,j as e,aX as Is,f as j,U as as,B as v,bh as rs,b1 as Rs,b2 as Os,b3 as Ae,b4 as Pe,g as B,h as K,m as te,i as y,n as ue,aY as ke,aR as $s,D as is,ar as ns,N as D,O as Q,b0 as Se,M as we,o as ge,A as Vs,a5 as Fs,a6 as qs,aM as _s,aN as Us,a7 as Gs,Q as ne,V as oe,W as le,Y as de,_ as E,F as Ie,bi as zs,b5 as Re,bd as Bs,be as Ks,bf as Qs,ba as Oe,bj as Ws,bk as Ys,b7 as os,b8 as ls,b9 as ds,bl as $e,bc as Hs,$ as Js,bm as Xs,a1 as F,aq as cs}from"./index-D5qLf1ib.js";import{utils as pe,writeFile as Zs}from"./xlsx-B6sNpj_1.js";import{B as et}from"./BarChart-BX_xVycl.js";import{S as Ve}from"./sun-EUex_3oP.js";import{C as st}from"./cloud-rain-D34Iidk5.js";import{C as tt}from"./cloud-C4d9J89w.js";function gt(){var Ke,Qe,We,Ye,He,Je,Xe,Ze,es;const{toast:S}=As(),ce=Ps();b.useRef(null);const Fe={sunny:"Soleado",cloudy:"Nublado",rainy:"Lluvioso",other:"Otro"},ms={estimation:"Estimación",manual_counter:"Contador manual",event_based:"Basado en eventos",entrance_control:"Control de acceso"},[De,at]=b.useState(""),[hs,Ee]=b.useState(!1),[O,qe]=b.useState("daily"),[me,_e]=b.useState("average"),[J,xs]=b.useState("month"),[X,us]=b.useState("all"),[Te,rt]=b.useState(1),[P,je]=b.useState(1),[Ne,Ue]=b.useState("grid"),[Z,it]=b.useState(""),[ae,nt]=b.useState(""),[$,ot]=b.useState("all");b.useState(!1);const q=10,[G,Ge]=b.useState(null),[W,ve]=b.useState("month"),[ye,gs]=b.useState(""),[fe,ps]=b.useState(""),[js,Ce]=b.useState("reportes"),[m,k]=b.useState({parkId:0,date:new Date().toISOString().split("T")[0],startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],adults:0,children:0,seniors:0,pets:0,groups:0,countingMethod:"estimation",dayType:"weekday",weather:"sunny",notes:""}),re=()=>{const s=new Date;let t,n=s;switch(W){case"week":t=new Date(s),t.setDate(s.getDate()-7);break;case"month":t=new Date(s),t.setMonth(s.getMonth()-1);break;case"quarter":t=new Date(s),t.setMonth(s.getMonth()-3);break;case"custom":return{startDate:ye||s.toISOString().split("T")[0],endDate:fe||s.toISOString().split("T")[0]};default:t=new Date(s),t.setMonth(s.getMonth()-1)}return{startDate:t.toISOString().split("T")[0],endDate:n.toISOString().split("T")[0]}},{data:ee}=xe({queryKey:["/api/parks"],retry:1}),Y=Array.isArray(ee)?ee:ee!=null&&ee.data&&Array.isArray(ee.data)?ee.data:[],{data:r,isLoading:lt}=xe({queryKey:["/api/visitor-counts",De,Te,Z,ae,$,X,J],queryFn:async()=>{const s=new URLSearchParams,t=X!=="all"?X:De;if(t&&t!=="all"&&s.set("parkId",t),s.set("limit",q.toString()),s.set("offset",((Te-1)*q).toString()),Z&&s.set("search",Z),$&&s.set("method",$),J!=="all"){const d=new Date;let x;switch(J){case"week":x=new Date(d.getTime()-7*24*60*60*1e3);break;case"month":x=new Date(d.getFullYear(),d.getMonth()-1,d.getDate());break;case"quarter":x=new Date(d.getFullYear(),d.getMonth()-3,d.getDate());break;case"year":x=new Date(d.getFullYear()-1,d.getMonth(),d.getDate());break;default:x=new Date(0)}s.set("startDate",x.toISOString().split("T")[0])}else ae&&s.set("startDate",ae);return console.log("🌐 [UNIFIED FILTER] Consultando con parámetros:",Object.fromEntries(s.entries())),(await fetch(`/api/visitor-counts?${s}`)).json()}});xe({queryKey:["/api/visitor-counts/global",X,J,ae,$],queryFn:async()=>{const s=new URLSearchParams,t=X!=="all"?X:De;if(t&&t!=="all"&&s.set("parkId",t),$&&$!=="all"&&s.set("method",$),J!=="all"){const d=new Date;let x;switch(J){case"week":x=new Date(d.getTime()-7*24*60*60*1e3);break;case"month":x=new Date(d.getFullYear(),d.getMonth()-1,d.getDate());break;case"quarter":x=new Date(d.getFullYear(),d.getMonth()-3,d.getDate());break;case"year":x=new Date(d.getFullYear()-1,d.getMonth(),d.getDate());break;default:x=new Date(0)}s.set("startDate",x.toISOString().split("T")[0])}else ae&&s.set("startDate",ae);return s.set("limit","10000"),console.log("🌐 [GLOBAL STATS] Consultando con parámetros:",Object.fromEntries(s.entries())),(await fetch(`/api/visitor-counts?${s}`)).json()},retry:1});const{data:p}=xe({queryKey:["/api/visitor-counts/park-summary",W,ye,fe],queryFn:async()=>{const{startDate:s,endDate:t}=re(),n=new URLSearchParams;return n.set("startDate",s),n.set("endDate",t),n.set("groupBy","park"),(await fetch(`/api/visitor-counts/park-summary?${n}`)).json()},retry:1}),{data:T,isLoading:Ns}=xe({queryKey:["/api/visitor-counts","park-detail",G,W,ye,fe,P],queryFn:async()=>{if(!G)return null;const{startDate:s,endDate:t}=re(),n=new URLSearchParams;return n.set("parkId",G.toString()),n.set("startDate",s),n.set("endDate",t),n.set("limit",q.toString()),n.set("offset",((P-1)*q).toString()),console.log(`🔍 [DETAIL QUERY] Página ${P}, offset: ${(P-1)*q}, params:`,Object.fromEntries(n.entries())),(await fetch(`/api/visitor-counts?${n}`)).json()},enabled:!!G,retry:1});b.useMemo(()=>{if(!(r!=null&&r.data))return[];let s=[...r.data];return Z&&(s=s.filter(t=>{var n;return t.parkName.toLowerCase().includes(Z.toLowerCase())||((n=t.notes)==null?void 0:n.toLowerCase().includes(Z.toLowerCase()))})),$&&$!=="all"&&(s=s.filter(t=>t.countingMethod===$)),s},[r==null?void 0:r.data,Z,$]),Math.ceil((((Ke=r==null?void 0:r.pagination)==null?void 0:Ke.total)||0)/q);const vs=(Te-1)*q;Math.min(vs+q,((Qe=r==null?void 0:r.pagination)==null?void 0:Qe.total)||0);const ys=()=>{var ie;if(!((ie=r==null?void 0:r.data)!=null&&ie.length)){S({title:"No hay datos",description:"No hay registros para exportar",variant:"destructive"});return}const s=new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),t=r.data.reduce((o,g)=>o+g.totalVisitors,0),n=r.data.reduce((o,g)=>o+g.adults,0),d=r.data.reduce((o,g)=>o+g.children,0),x=r.data.reduce((o,g)=>o+g.seniors,0),N=r.data.reduce((o,g)=>o+g.pets,0),C=r.data.reduce((o,g)=>o+g.groups,0),w=r.data.length>0?Math.round(t/r.data.length):0,l=r.data.reduce((o,g)=>{const H=be(g.countingMethod);return o[H]=(o[H]||0)+1,o},{}),u=r.data.reduce((o,g)=>{const H=he(g.weather);return o[H]=(o[H]||0)+1,o},{}),A={counting:"Conteo manual",estimation:"Estimación",manual_counter:"Contador manual",event_based:"Basado en eventos",entrance_control:"Control de acceso"},_={sunny:"Soleado",cloudy:"Nublado",rainy:"Lluvioso",other:"Otro"},c={weekday:"Día laborable",weekend:"Fin de semana",holiday:"Día festivo"},h=r.data.map(o=>({Fecha:V(new Date(o.date),"dd/MM/yyyy",{locale:F}),Parque:o.parkName,Adultos:o.adults,Niños:o.children,"Adultos Mayores":o.seniors,Mascotas:o.pets,Grupos:o.groups,"Total Visitantes":o.totalVisitors,"Método de Conteo":A[o.countingMethod]||o.countingMethod,"Tipo de Día":c[o.dayType||"weekday"]||o.dayType,Clima:_[o.weather||"sunny"]||o.weather,Notas:o.notes||"Sin observaciones"})),M=["SISTEMA DE GESTIÓN DE PARQUES URBANOS","REPORTE DE CONTEO DE VISITANTES",`Generado el: ${s}`,`Total de registros: ${r.data.length}`,"","RESUMEN EJECUTIVO",`Total de visitantes registrados: ${t.toLocaleString("es-ES")}`,`Promedio diario de visitantes: ${w.toLocaleString("es-ES")}`,`Adultos: ${n.toLocaleString("es-ES")} | Niños: ${d.toLocaleString("es-ES")} | Adultos Mayores: ${x.toLocaleString("es-ES")}`,`Mascotas: ${N.toLocaleString("es-ES")} | Grupos organizados: ${C.toLocaleString("es-ES")}`,"","MÉTODOS DE CONTEO UTILIZADOS",...Object.entries(l).map(([o,g])=>`${o}: ${g} registros`),"","CONDICIONES CLIMÁTICAS",...Object.entries(u).map(([o,g])=>`${o}: ${g} días`),"","DETALLE DE REGISTROS",""],f=Object.keys(h[0]),L=[...M,f.join(","),...h.map(o=>f.map(g=>`"${o[g]}"`).join(","))].join(`
`),I="\uFEFF",se=new Blob([I+L],{type:"text/csv;charset=utf-8;"}),z=document.createElement("a");z.href=URL.createObjectURL(se),z.download=`conteo_visitantes_profesional_${V(new Date,"dd-MM-yyyy",{locale:F})}.csv`,z.click(),S({title:"Exportación CSV exitosa",description:`Se exportaron ${r.data.length} registros con resumen ejecutivo`})},fs=async()=>{var s;if(!((s=r==null?void 0:r.data)!=null&&s.length)){S({title:"No hay datos",description:"No hay registros para exportar",variant:"destructive"});return}try{const t=await Xs(()=>import("./xlsx-B6sNpj_1.js"),[]),n=new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),d=r.data.reduce((a,i)=>a+i.totalVisitors,0),x=r.data.reduce((a,i)=>a+i.adults,0),N=r.data.reduce((a,i)=>a+i.children,0),C=r.data.reduce((a,i)=>a+i.seniors,0),w=r.data.reduce((a,i)=>a+i.pets,0),l=r.data.reduce((a,i)=>a+i.groups,0),u=r.data.length>0?Math.round(d/r.data.length):0,A=Array.from(new Set(r.data.map(a=>a.parkName))).length,_={counting:"Conteo manual",estimation:"Estimación",manual_counter:"Contador manual",event_based:"Basado en eventos",entrance_control:"Control de acceso"},c={sunny:"Soleado",cloudy:"Nublado",rainy:"Lluvioso",other:"Otro"},h={weekday:"Día laborable",weekend:"Fin de semana",holiday:"Día festivo"},M=r.data.map(a=>({Fecha:V(new Date(a.date),"dd/MM/yyyy",{locale:F}),Parque:a.parkName,Adultos:a.adults,Niños:a.children,"Adultos Mayores":a.seniors,Mascotas:a.pets,Grupos:a.groups,"Total Visitantes":a.totalVisitors,"Método de Conteo":_[a.countingMethod]||a.countingMethod,"Tipo de Día":h[a.dayType||"weekday"]||a.dayType,Clima:c[a.weather||"sunny"]||a.weather,Notas:a.notes||"Sin observaciones"})),f=r.data.reduce((a,i)=>{const U=be(i.countingMethod);return a[U]=(a[U]||0)+1,a},{}),L=r.data.reduce((a,i)=>{const U=he(i.weather);return a[U]=(a[U]||0)+1,a},{}),I=r.data.reduce((a,i)=>{const U=h[i.dayType||"weekday"]||i.dayType||"Día de semana";return a[U]=(a[U]||0)+1,a},{}),se=r.data.reduce((a,i)=>(a[i.parkName]||(a[i.parkName]={registros:0,visitantes:0,adultos:0,niños:0,seniors:0,mascotas:0,grupos:0}),a[i.parkName].registros+=1,a[i.parkName].visitantes+=i.totalVisitors,a[i.parkName].adultos+=i.adults,a[i.parkName].niños+=i.children,a[i.parkName].seniors+=i.seniors,a[i.parkName].mascotas+=i.pets,a[i.parkName].grupos+=i.groups,a),{}),z=[["SISTEMA DE GESTIÓN DE PARQUES URBANOS"],["REPORTE PROFESIONAL DE CONTEO DE VISITANTES"],[`Generado el: ${n}`],[`Período de análisis: ${r.data.length} registros`],[""],["═══════════════════════════════════════"],["RESUMEN EJECUTIVO GENERAL"],["═══════════════════════════════════════"],[""],["MÉTRICAS PRINCIPALES"],["Indicador","Valor","Observaciones"],["Total de registros",r.data.length.toLocaleString("es-ES"),"Conteos realizados"],["Total de visitantes",d.toLocaleString("es-ES"),"Suma de todos los visitantes"],["Promedio diario de visitantes",u.toLocaleString("es-ES"),"Visitantes por día"],["Parques únicos monitoreados",A,"Diferentes ubicaciones"],[""],["DISTRIBUCIÓN DEMOGRÁFICA"],["Segmento Poblacional","Total","Porcentaje","Promedio Diario"],["Adultos",x.toLocaleString("es-ES"),`${(x/d*100).toFixed(1)}%`,Math.round(x/r.data.length)],["Niños",N.toLocaleString("es-ES"),`${(N/d*100).toFixed(1)}%`,Math.round(N/r.data.length)],["Adultos Mayores",C.toLocaleString("es-ES"),`${(C/d*100).toFixed(1)}%`,Math.round(C/r.data.length)],[""],["OTROS REGISTROS"],["Tipo","Total","Promedio por Registro"],["Mascotas",w.toLocaleString("es-ES"),Math.round(w/r.data.length)],["Grupos organizados",l.toLocaleString("es-ES"),Math.round(l/r.data.length)],[""],["ANÁLISIS POR MÉTODOS DE CONTEO"],["Método","Registros","Porcentaje de Uso"],...Object.entries(f).map(([a,i])=>[a,i,`${(i/r.data.length*100).toFixed(1)}%`]),[""],["ANÁLISIS POR CONDICIONES CLIMÁTICAS"],["Condición Climática","Días Registrados","Porcentaje"],...Object.entries(L).map(([a,i])=>[a,i,`${(i/r.data.length*100).toFixed(1)}%`]),[""],["ANÁLISIS POR TIPO DE DÍA"],["Tipo de Día","Registros","Porcentaje"],...Object.entries(I).map(([a,i])=>[a,i,`${(i/r.data.length*100).toFixed(1)}%`])],ie=[["ANÁLISIS DETALLADO POR PARQUES"],[`Generado el: ${n}`],[""],["Parque","Total Registros","Total Visitantes","Promedio por Registro","Adultos","Niños","Seniors","Mascotas","Grupos"],...Object.entries(se).map(([a,i])=>[a,i.registros,i.visitantes.toLocaleString("es-ES"),Math.round(i.visitantes/i.registros),i.adultos.toLocaleString("es-ES"),i.niños.toLocaleString("es-ES"),i.seniors.toLocaleString("es-ES"),i.mascotas.toLocaleString("es-ES"),i.grupos.toLocaleString("es-ES")])],o=t.utils.book_new(),g=t.utils.aoa_to_sheet(z);g["!cols"]=[{wch:30},{wch:20},{wch:25},{wch:20}],g.A1&&(g.A1.s={font:{bold:!0,sz:16}}),g.A2&&(g.A2.s={font:{bold:!0,sz:14}}),t.utils.book_append_sheet(o,g,"Resumen Ejecutivo");const H=t.utils.aoa_to_sheet(ie);H["!cols"]=[{wch:25},{wch:15},{wch:18},{wch:18},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12}],t.utils.book_append_sheet(o,H,"Análisis por Parques");const ss=t.utils.json_to_sheet(M),Es=[{wch:12},{wch:25},{wch:10},{wch:10},{wch:15},{wch:10},{wch:10},{wch:15},{wch:20},{wch:15},{wch:12},{wch:35}];ss["!cols"]=Es,t.utils.book_append_sheet(o,ss,"Datos Detallados");const Ts=[["DATOS PARA GRÁFICOS Y ANÁLISIS DE TENDENCIAS"],[`Generado el: ${n}`],[""],["RESUMEN POR FECHAS (últimos registros)"],["Fecha","Total Visitantes","Adultos","Niños","Seniors","Mascotas","Grupos"],...r.data.slice(0,30).map(a=>[V(new Date(a.date),"dd/MM/yyyy",{locale:F}),a.totalVisitors,a.adults,a.children,a.seniors,a.pets,a.groups]),[""],["COMPARATIVO DE MÉTODOS DE CONTEO"],["Método","Frecuencia de Uso","Porcentaje"],...Object.entries(f).map(([a,i])=>[a,i,`${(i/r.data.length*100).toFixed(1)}%`]),[""],["ANÁLISIS CLIMÁTICO"],["Condición","Days","Porcentaje","Impacto en Visitantes"],...Object.entries(L).map(([a,i])=>{const U=r.data.filter(Le=>he(Le.weather)===a).reduce((Le,Ls)=>Le+Ls.totalVisitors,0),Ms=i>0?Math.round(U/i):0;return[a,i,`${(i/r.data.length*100).toFixed(1)}%`,`${Ms} visitantes promedio`]}),[""],["NOTAS Y METODOLOGÍA"],["• Los datos incluyen solo registros con información completa"],["• Los promedios se calculan sobre días registrados, no días calendarios"],["• Los porcentajes demográficos se basan en el total de visitantes"],["• Las condiciones climáticas afectan significativamente la asistencia"],[""],["RECOMENDACIONES OPERATIVAS"],["• Implementar conteo sistemático en días de alta afluencia"],["• Considerar clima en planificación de eventos"],["• Monitorear patrones estacionales para mejor gestión"],["• Documentar observaciones específicas por parque"]],ts=t.utils.aoa_to_sheet(Ts);ts["!cols"]=[{wch:25},{wch:15},{wch:15},{wch:25}],t.utils.book_append_sheet(o,ts,"Gráficos y Tendencias");const Cs=`conteo_visitantes_${V(new Date,"dd-MM-yyyy",{locale:F})}.xlsx`;t.writeFile(o,Cs),S({title:"Exportación Excel Profesional Exitosa",description:`Se generó un archivo Excel con ${r.data.length} registros, 4 hojas de análisis y estadísticas completas`})}catch(t){console.error("Error exportando a Excel:",t),S({title:"Error en exportación",description:"No se pudo generar el archivo Excel",variant:"destructive"})}},bs=()=>{const s=document.createElement("input");s.type="file",s.accept=".csv",s.onchange=t=>{var x;const n=(x=t.target.files)==null?void 0:x[0];if(!n)return;const d=new FileReader;d.onload=N=>{var C;try{const w=(C=N.target)==null?void 0:C.result;console.log("📥 [PARK SUMMARY] Importando CSV:",w.substring(0,200)),S({title:"Importación de resumen iniciada",description:"Procesando archivo CSV del resumen por parques..."}),setTimeout(()=>{ce.invalidateQueries({queryKey:["/api/visitor-counts/park-summary"]}),S({title:"Importación completada",description:"Los datos del resumen por parques se han actualizado exitosamente"})},1e3)}catch(w){console.error("Error importando CSV del resumen:",w),S({title:"Error en importación",description:"No se pudo procesar el archivo CSV del resumen",variant:"destructive"})}},d.readAsText(n)},s.click()},Ss=()=>{try{if(!(p!=null&&p.data)||p.data.length===0){S({title:"Sin datos para exportar",description:"No hay datos de resumen por parques para exportar",variant:"destructive"});return}const s=new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),t=p.data.map(l=>({Parque:l.parkName||"N/A","Total Visitantes":l.totalVisitors||0,"Promedio Diario":l.avgDaily||0,"Máximo Diario":l.maxDaily||0,"Mínimo Diario":l.minDaily||0,"Total Adultos":l.totalAdults||0,"Total Niños":l.totalChildren||0,"Total Seniors":l.totalSeniors||0,"Total Mascotas":l.totalPets||0,"Total Registros":l.totalRecords||0})),n=["SISTEMA DE GESTIÓN DE PARQUES URBANOS","RESUMEN EJECUTIVO POR PARQUES",`Generado el: ${s}`,`Período de análisis: ${(()=>{const{startDate:l,endDate:u}=re();return`${l} hasta ${u}`})()}`,`Total de parques analizados: ${p.data.length}`,"","═══════════════════════════════════════","DATOS DETALLADOS POR PARQUE","═══════════════════════════════════════",""],d=Object.keys(t[0]),x=[...n,d.join(","),...t.map(l=>d.map(u=>`"${l[u]}"`).join(","))].join(`
`),N="\uFEFF",C=new Blob([N+x],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a");w.href=URL.createObjectURL(C),w.download=`resumen_parques_${V(new Date,"dd-MM-yyyy",{locale:F})}.csv`,w.click(),S({title:"CSV exportado exitosamente",description:`Resumen de ${p.data.length} parques exportado correctamente`})}catch(s){console.error("Error exportando CSV del resumen:",s),S({title:"Error en exportación",description:"No se pudo generar el archivo CSV del resumen",variant:"destructive"})}},ws=()=>{try{if(!(p!=null&&p.data)||p.data.length===0){S({title:"Sin datos para exportar",description:"No hay datos de resumen por parques para exportar",variant:"destructive"});return}const s=new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),t=p.data.reduce((l,u)=>l+(u.totalVisitors||0),0),n=p.data.reduce((l,u)=>l+(u.avgDaily||0),0),d=[["SISTEMA DE GESTIÓN DE PARQUES URBANOS"],["RESUMEN EJECUTIVO POR PARQUES"],[`Generado el: ${s}`],[`Período: ${(()=>{const{startDate:l,endDate:u}=re();return`${l} hasta ${u}`})()}`],[""],["═══════════════════════════════════════"],["MÉTRICAS GENERALES"],["═══════════════════════════════════════"],[""],["Indicador","Valor"],["Parques analizados",p.data.length],["Total visitantes (todos los parques)",t.toLocaleString("es-ES")],["Promedio de visitantes por parque",Math.round(t/p.data.length).toLocaleString("es-ES")],["Promedio diario combinado",Math.round(n/p.data.length).toLocaleString("es-ES")],[""],["RANKING DE PARQUES POR VISITANTES"],["Posición","Parque","Total Visitantes","Promedio Diario"],...p.data.sort((l,u)=>(u.totalVisitors||0)-(l.totalVisitors||0)).map((l,u)=>[u+1,l.parkName||"N/A",(l.totalVisitors||0).toLocaleString("es-ES"),(l.avgDaily||0).toLocaleString("es-ES")])],x=[["DATOS DETALLADOS POR PARQUE"],[`Generado el: ${s}`],[""],["Parque","Total Visitantes","Promedio Diario","Máximo Diario","Mínimo Diario","Total Adultos","Total Niños","Total Seniors","Total Mascotas","Total Registros"],...p.data.map(l=>[l.parkName||"N/A",(l.totalVisitors||0).toLocaleString("es-ES"),(l.avgDaily||0).toLocaleString("es-ES"),(l.maxDaily||0).toLocaleString("es-ES"),(l.minDaily||0).toLocaleString("es-ES"),(l.totalAdults||0).toLocaleString("es-ES"),(l.totalChildren||0).toLocaleString("es-ES"),(l.totalSeniors||0).toLocaleString("es-ES"),(l.totalPets||0).toLocaleString("es-ES"),(l.totalRecords||0).toLocaleString("es-ES")])],N=pe.book_new(),C=pe.aoa_to_sheet(d);C["!cols"]=[{wch:30},{wch:25},{wch:20},{wch:20}],pe.book_append_sheet(N,C,"Resumen Ejecutivo");const w=pe.aoa_to_sheet(x);w["!cols"]=[{wch:25},{wch:15},{wch:15},{wch:15},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:15}],pe.book_append_sheet(N,w,"Datos Detallados"),Zs(N,`resumen_parques_${V(new Date,"dd-MM-yyyy",{locale:F})}.xlsx`),S({title:"Excel exportado exitosamente",description:`Resumen completo de ${p.data.length} parques exportado correctamente`})}catch(s){console.error("Error exportando Excel del resumen:",s),S({title:"Error en exportación",description:"No se pudo generar el archivo Excel del resumen",variant:"destructive"})}},R=b.useMemo(()=>{const s=(r==null?void 0:r.data)||[];if(s.length===0)return console.log("🌐 [REPORT DATA] No hay datos disponibles"),null;console.log(`🌐 [REPORT DATA] Usando ${s.length} registros para estadísticas`);const t=s.reduce((c,h)=>c+(h.totalVisitors||0),0),n=s.reduce((c,h)=>c+(h.adults||0),0),d=s.reduce((c,h)=>c+(h.children||0),0),x=s.reduce((c,h)=>c+(h.seniors||0),0),N=s.reduce((c,h)=>c+(h.pets||0),0),C=s.length>0?Math.round(t/s.length):0;console.log(`🌐 [REPORT DATA] Estadísticas calculadas: ${t.toLocaleString()} visitantes totales`);const w=[{name:"Adultos",value:n,color:"#067f5f"},{name:"Niños",value:d,color:"#bcd256"},{name:"Seniors",value:x,color:"#8498a5"},{name:"Mascotas",value:N,color:"#00a587"}].filter(c=>c.value>0),l=s.reduce((c,h)=>{const M=c.find(f=>f.parkName===h.parkName);return M?(M.visitors+=h.totalVisitors,M.records+=1):c.push({parkName:h.parkName,visitors:h.totalVisitors,records:1}),c},[]),u=s.reduce((c,h)=>{const M=h.countingMethod,f=ms[M]||M||"No especificado",L=c.find(I=>I.method===f);return L?(L.count+=1,L.visitors+=h.totalVisitors):c.push({method:f,count:1,visitors:h.totalVisitors}),c},[]),A=s.reduce((c,h)=>{const M=h.weather||"other",f=Fe[M]||"No especificado",L=c.find(I=>I.weather===f);return L?(L.count+=1,L.visitors+=h.totalVisitors):c.push({weather:f,count:1,visitors:h.totalVisitors}),c},[]),_=s.sort((c,h)=>new Date(c.date).getTime()-new Date(h.date).getTime()).slice(-7).map(c=>({date:V(new Date(c.date),"dd/MM",{locale:F}),visitors:c.totalVisitors,adults:c.adults,children:c.children}));return{summary:{totalVisitors:t,totalAdults:n,totalChildren:d,totalSeniors:x,totalPets:N,avgDaily:C,totalRecords:s.length,uniqueParks:Array.from(new Set(s.map(c=>c.parkName))).length},charts:{demographic:w,parks:l,methods:u,weather:A,trend:_}}},[r]),Me=ks({mutationFn:async s=>{if(console.log("Datos del formulario de conteo de visitantes:",s),console.log("Modo de conteo:",O),O==="range"){const t=[],n=new Date(s.startDate),d=new Date(s.endDate),x=d.getTime()-n.getTime(),N=Math.ceil(x/(1e3*3600*24))+1;if(console.log(`📊 Modo distribución: ${me}, Días: ${N}`),console.log(`Total originales: ${s.adults} adultos, ${s.children} niños, ${s.seniors} seniors, ${s.pets} mascotas, ${s.groups} grupos`),me==="average"){const u=Math.round(s.adults/N),A=Math.round(s.children/N),_=Math.round(s.seniors/N),c=Math.round(s.pets/N),h=Math.round(s.groups/N);console.log(`📈 Promedio diario: ${u} adultos, ${A} niños, ${_} seniors, ${c} mascotas, ${h} grupos`);const M=f=>{if(f===0)return 0;const L=Math.round(f*.15),I=Math.floor(Math.random()*(L*2+1))-L;return Math.max(0,f+I)};for(let f=new Date(n);f<=d;f.setDate(f.getDate()+1)){const L=f.toISOString().split("T")[0],I=M(u),se=M(A),z=M(_),ie=M(c),o=M(h),g={parkId:s.parkId,date:L,adults:I,children:se,seniors:z,pets:ie,groups:o,countingMethod:s.countingMethod,dayType:s.dayType,weather:s.weather,notes:`${s.notes||""} (Promedio diario distribuido del período ${s.startDate} a ${s.endDate})`.trim(),registeredBy:1};console.log(`📅 ${L}: ${I+se+z} visitantes (${I}+${se}+${z})`),t.push(g)}}else{console.log("📋 Usando números idénticos cada día");for(let u=new Date(n);u<=d;u.setDate(u.getDate()+1)){const A=u.toISOString().split("T")[0],_={parkId:s.parkId,date:A,adults:s.adults,children:s.children,seniors:s.seniors,pets:s.pets,groups:s.groups,countingMethod:s.countingMethod,dayType:s.dayType,weather:s.weather,notes:`${s.notes||""} (Números idénticos para período ${s.startDate} a ${s.endDate})`.trim(),registeredBy:1};console.log(`📅 ${A}: ${s.adults+s.children+s.seniors} visitantes (números idénticos)`),t.push(_)}}const C=[];let w=0,l=0;for(const u of t)try{const A=await cs("/api/visitor-counts",{method:"POST",data:u});C.push(A),w++}catch(A){if(A.status===409)console.log(`⚠️ Registro duplicado para fecha ${u.date}`),l++;else throw A}return{responses:C,successCount:w,duplicateCount:l}}else{const t={parkId:s.parkId,date:s.date,adults:s.adults,children:s.children,seniors:s.seniors,pets:s.pets,groups:s.groups,countingMethod:s.countingMethod,dayType:s.dayType,weather:s.weather,notes:s.notes,registeredBy:1};return console.log("Datos para enviar (conteo diario):",t),cs("/api/visitor-counts",{method:"POST",data:t})}},onSuccess:s=>{if(O==="range"&&s.successCount!==void 0){Math.ceil((new Date(m.endDate).getTime()-new Date(m.startDate).getTime())/(1e3*60*60*24))+1;let t=`${s.successCount} registro(s) creado(s) exitosamente`;s.duplicateCount>0&&(t+=`, ${s.duplicateCount} ya existían`),S({title:"Registro completado",description:t})}else S({title:"Registro exitoso",description:"Registro de visitantes creado correctamente"});ce.invalidateQueries({queryKey:["/api/visitor-counts"]}),ce.invalidateQueries({queryKey:["/api/visitor-counts/dashboard"]}),ce.invalidateQueries({queryKey:["/api/visitor-summary"]}),Ee(!1),k({parkId:0,date:new Date().toISOString().split("T")[0],startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],adults:0,children:0,seniors:0,pets:0,groups:0,countingMethod:"estimation",dayType:"weekday",weather:"sunny",notes:""})},onError:s=>{S({title:"Error",description:"No se pudo registrar el conteo de visitantes",variant:"destructive"})}}),Ds=s=>{if(s.preventDefault(),console.log("🔍 Datos del formulario antes de enviar:",m),console.log("🔍 Modo de conteo:",O),m.parkId===0){S({title:"Error",description:"Por favor selecciona un parque",variant:"destructive"});return}if(O==="range"){if(!m.startDate||!m.endDate){S({title:"Error",description:"Por favor selecciona las fechas de inicio y fin",variant:"destructive"});return}if(new Date(m.startDate)>new Date(m.endDate)){S({title:"Error",description:"La fecha de inicio debe ser anterior a la fecha de fin",variant:"destructive"});return}}Me.mutate(m)},be=s=>s?{estimation:"Estimación",manual_counter:"Contador manual",event_based:"Basado en eventos",entrance_control:"Control de acceso",counting:"Conteo manual"}[s]||s:"No especificado",ze=s=>s?{weekday:"Día laborable",weekend:"Fin de semana",holiday:"Día festivo"}[s]||s:"No especificado",Be=s=>{switch(s){case"sunny":return e.jsx(Ve,{className:"h-4 w-4"});case"cloudy":return e.jsx(tt,{className:"h-4 w-4"});case"rainy":return e.jsx(st,{className:"h-4 w-4"});default:return e.jsx(Ve,{className:"h-4 w-4"})}},he=s=>s?Fe[s]||s:"No especificado";return e.jsx(Is,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(j,{className:"p-4 bg-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Conteo"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestión diaria de visitantes por parque"})]})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(v,{onClick:()=>Ee(!0),className:"bg-emerald-600 hover:bg-emerald-700",children:[e.jsx(rs,{className:"h-4 w-4 mr-2"}),"Nuevo Registro"]})})]})}),e.jsxs(Rs,{value:js,onValueChange:Ce,className:"w-full",children:[e.jsxs(Os,{className:"grid w-full grid-cols-3",children:[e.jsx(Ae,{value:"resumen",children:"Resumen por Parque"}),e.jsx(Ae,{value:"detalle",disabled:!G,children:G?`Detalle - ${(We=Y.find(s=>s.id===G))==null?void 0:We.name}`:"Detalle del Parque"}),e.jsx(Ae,{value:"reportes",children:"Reportes"})]}),e.jsxs(Pe,{value:"resumen",className:"space-y-4",children:[e.jsxs(j,{children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Período de Análisis"]})}),e.jsxs(y,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsxs(v,{variant:W==="week"?"default":"outline",size:"lg",onClick:()=>ve("week"),className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Semana"]}),e.jsxs(v,{variant:W==="month"?"default":"outline",size:"lg",onClick:()=>ve("month"),className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Mes"]}),e.jsxs(v,{variant:W==="quarter"?"default":"outline",size:"lg",onClick:()=>ve("quarter"),className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5"}),"Trimestre"]}),e.jsxs(v,{variant:W==="custom"?"default":"outline",size:"lg",onClick:()=>ve("custom"),className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Personalizado"]}),e.jsx("div",{className:"h-6 w-px bg-gray-300 mx-2"}),e.jsxs(v,{variant:"outline",size:"lg",onClick:bs,className:"border-blue-200 text-blue-700 hover:bg-blue-50 flex items-center gap-2",children:[e.jsx($s,{className:"h-5 w-5"}),"Importar CSV"]}),e.jsxs(v,{variant:"outline",size:"lg",onClick:Ss,className:"border-green-200 text-green-700 hover:bg-green-50 flex items-center gap-2",children:[e.jsx(is,{className:"h-5 w-5"}),"Exportar CSV"]}),e.jsxs(v,{variant:"outline",size:"lg",onClick:ws,className:"border-purple-200 text-purple-700 hover:bg-purple-50 flex items-center gap-2",children:[e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",style:{width:"24px",height:"24px",minWidth:"24px",minHeight:"24px"},children:[e.jsx("path",{d:"M36 20C36 16.6863 33.3137 14 30 14C29.2187 14 28.4863 14.1562 27.8125 14.4375C26.6875 11.0625 23.5625 8.5 20 8.5C15.3125 8.5 11.5 12.3125 11.5 17C11.5 17.5 11.5312 18 11.625 18.4687C9.0625 19.4375 7.25 21.9687 7.25 25C7.25 28.8750 10.375 32 14.25 32H35.5C39.6406 32 43 28.6406 43 24.5C43 21.0625 40.1875 18.3125 36.6875 17.875C36.4375 18.9375 36.2188 19.9688 36 20Z",stroke:"#22c55e",strokeWidth:"2.5",fill:"none"}),e.jsxs("g",{stroke:"#22c55e",strokeWidth:"2.5",fill:"none",children:[e.jsx("path",{d:"M18 38L18 34L16 36M18 34L20 36"}),e.jsx("path",{d:"M18 38L18 34"}),e.jsx("path",{d:"M24 40L24 36L22 38M24 36L26 38"}),e.jsx("path",{d:"M24 40L24 36"}),e.jsx("path",{d:"M30 38L30 34L28 36M30 34L32 36"}),e.jsx("path",{d:"M30 38L30 34"})]})]}),"Excel"]}),e.jsxs(v,{onClick:()=>{ce.invalidateQueries({queryKey:["/api/visitor-counts/park-summary"]}),S({title:"Actualizando datos",description:"Se están actualizando los datos del resumen por parques"})},size:"lg",className:"bg-emerald-600 hover:bg-emerald-700 flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),"Actualizar"]})]}),W==="custom"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4 p-4 bg-blue-50 rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"custom-start-date",children:"Fecha Inicio"}),e.jsx(Q,{id:"custom-start-date",type:"date",value:ye,onChange:s=>gs(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"custom-end-date",children:"Fecha Final"}),e.jsx(Q,{id:"custom-end-date",type:"date",value:fe,onChange:s=>ps(s.target.value)})]})]}),e.jsx("div",{className:"bg-emerald-50 border border-emerald-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-emerald-600"}),e.jsxs("span",{className:"text-sm font-medium text-emerald-700",children:["Período Seleccionado: ",(()=>{const{startDate:s,endDate:t}=re();return`${s} hasta ${t}`})()]})]})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:p?((Ye=p==null?void 0:p.data)==null?void 0:Ye.length)===0?e.jsx(j,{className:"col-span-full",children:e.jsxs(y,{className:"text-center py-8",children:[e.jsx(Se,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay datos para el período seleccionado"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Selecciona un período diferente o registra conteos de visitantes"})]})}):(He=p==null?void 0:p.data)==null?void 0:He.map(s=>e.jsx(j,{className:"hover:shadow-lg transition-all duration-200 cursor-pointer hover:border-emerald-200",onClick:()=>{Ge(s.parkId),je(1),Ce("detalle")},children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"h-5 w-5 text-emerald-600"}),e.jsx("h3",{className:"font-semibold text-lg text-gray-900",children:s.parkName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsxs("span",{children:[s.totalRecords||0," registros en el período"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-emerald-600",children:Number(s.totalVisitors||0).toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-500",children:"visitantes totales"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-700",children:Number(s.avgDaily||0).toLocaleString()}),e.jsx("div",{className:"text-xs text-blue-600",children:"Promedio diario"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-green-700",children:Number(s.maxDaily||0).toLocaleString()}),e.jsx("div",{className:"text-xs text-green-600",children:"Máximo diario"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-orange-700",children:Number(s.minDaily||0).toLocaleString()}),e.jsx("div",{className:"text-xs text-orange-600",children:"Mínimo diario"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[e.jsxs("div",{className:"text-center p-2 bg-slate-50 rounded",children:[e.jsx("div",{className:"text-sm font-semibold text-slate-700",children:Number(s.totalAdults||0).toLocaleString()}),e.jsx("div",{className:"text-xs text-slate-600",children:"Adultos"})]}),e.jsxs("div",{className:"text-center p-2 bg-teal-50 rounded",children:[e.jsx("div",{className:"text-sm font-semibold text-teal-700",children:Number(s.totalChildren||0).toLocaleString()}),e.jsx("div",{className:"text-xs text-teal-600",children:"Niños"})]}),e.jsxs("div",{className:"text-center p-2 bg-amber-50 rounded",children:[e.jsx("div",{className:"text-sm font-semibold text-amber-700",children:Number(s.totalSeniors||0).toLocaleString()}),e.jsx("div",{className:"text-xs text-amber-600",children:"Mayores"})]}),e.jsxs("div",{className:"text-center p-2 bg-pink-50 rounded",children:[e.jsx("div",{className:"text-sm font-semibold text-pink-700",children:Number(s.totalPets||0).toLocaleString()}),e.jsx("div",{className:"text-xs text-pink-600",children:"Mascotas"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsxs("span",{children:["Último registro: ",s.lastRecord?V(new Date(s.lastRecord),"dd/MM/yyyy",{locale:F}):"N/A"]})]}),e.jsx(ge,{variant:"outline",className:"text-xs bg-emerald-50 text-emerald-700 border-emerald-200",children:"Click para ver detalles"})]})]})})},s.parkId)):e.jsxs("div",{className:"text-center py-8 col-span-full",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando resumen por parques..."})]})})]}),e.jsx(Pe,{value:"detalle",className:"space-y-4",children:G?e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-emerald-600"}),"Detalle del Parque - ",(Je=Y.find(s=>s.id===G))==null?void 0:Je.name]})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Vista detallada de los registros diarios para el parque seleccionado en el período actual"}),e.jsxs(v,{variant:"outline",size:"sm",onClick:()=>{Ge(null),Ce("resumen")},children:[e.jsx(Vs,{className:"h-4 w-4 mr-2"}),"Volver al Resumen"]})]})})]}),e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Período:"}),e.jsx("span",{className:"text-sm text-gray-600",children:(()=>{const{startDate:s,endDate:t}=re();return`${s} hasta ${t}`})()})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:Ne==="grid"?"default":"outline",size:"sm",onClick:()=>Ue("grid"),children:e.jsx(Fs,{className:"h-4 w-4"})}),e.jsx(v,{variant:Ne==="list"?"default":"outline",size:"sm",onClick:()=>Ue("list"),children:e.jsx(qs,{className:"h-4 w-4"})})]})]})})}),e.jsx("div",{className:"space-y-4",children:Ns?e.jsx(j,{children:e.jsxs(y,{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando registros del parque..."})]})}):((Xe=T==null?void 0:T.data)==null?void 0:Xe.length)===0?e.jsx(j,{children:e.jsxs(y,{className:"text-center py-8",children:[e.jsx(Se,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay registros para este parque en el período seleccionado"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Intenta cambiar el período de tiempo o registra nuevos conteos"})]})}):e.jsxs(e.Fragment,{children:[Ne==="grid"&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(Ze=T==null?void 0:T.data)==null?void 0:Ze.map(s=>e.jsx(j,{className:"hover:shadow-md transition-shadow",children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{className:"font-medium text-sm",children:V(new Date(s.date),"dd/MM/yyyy",{locale:F})})]}),e.jsx(ge,{variant:"outline",className:"text-xs",children:be(s.counting_method)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-700",children:s.adults}),e.jsx("div",{className:"text-xs text-blue-600",children:"Adultos"})]}),e.jsxs("div",{className:"text-center p-2 bg-green-50 rounded",children:[e.jsx("div",{className:"text-lg font-semibold text-green-700",children:s.children}),e.jsx("div",{className:"text-xs text-green-600",children:"Niños"})]}),e.jsxs("div",{className:"text-center p-2 bg-amber-50 rounded",children:[e.jsx("div",{className:"text-lg font-semibold text-amber-700",children:s.seniors}),e.jsx("div",{className:"text-xs text-amber-600",children:"Mayores"})]}),e.jsxs("div",{className:"text-center p-2 bg-pink-50 rounded",children:[e.jsx("div",{className:"text-lg font-semibold text-pink-700",children:s.pets}),e.jsx("div",{className:"text-xs text-pink-600",children:"Mascotas"})]})]}),e.jsxs("div",{className:"text-center p-2 bg-emerald-50 rounded border border-emerald-200",children:[e.jsx("div",{className:"text-xl font-bold text-emerald-700",children:(s.adults+s.children+s.seniors).toLocaleString()}),e.jsx("div",{className:"text-xs text-emerald-600",children:"Total Visitantes"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[Be(s.weather),e.jsx("span",{children:he(s.weather)})]}),e.jsx(ge,{variant:"secondary",className:"text-xs",children:ze(s.dayType)})]}),s.notes&&e.jsxs("div",{className:"text-xs text-gray-600 bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:"Notas:"})," ",s.notes]})]})})},s.id))}),Ne==="list"&&e.jsx(j,{children:e.jsx(y,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-700",children:"Fecha"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-700",children:"Método"}),e.jsx("th",{className:"text-center p-3 text-sm font-medium text-gray-700",children:"Adultos"}),e.jsx("th",{className:"text-center p-3 text-sm font-medium text-gray-700",children:"Niños"}),e.jsx("th",{className:"text-center p-3 text-sm font-medium text-gray-700",children:"Mayores"}),e.jsx("th",{className:"text-center p-3 text-sm font-medium text-gray-700",children:"Mascotas"}),e.jsx("th",{className:"text-center p-3 text-sm font-medium text-gray-700",children:"Total"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-700",children:"Clima"}),e.jsx("th",{className:"text-left p-3 text-sm font-medium text-gray-700",children:"Tipo Día"})]})}),e.jsx("tbody",{children:(es=T==null?void 0:T.data)==null?void 0:es.map((s,t)=>e.jsxs("tr",{className:t%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"p-3 text-sm",children:V(new Date(s.date),"dd/MM/yyyy",{locale:F})}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx(ge,{variant:"outline",className:"text-xs",children:be(s.countingMethod)})}),e.jsx("td",{className:"p-3 text-sm text-center font-medium",children:s.adults}),e.jsx("td",{className:"p-3 text-sm text-center font-medium",children:s.children}),e.jsx("td",{className:"p-3 text-sm text-center font-medium",children:s.seniors}),e.jsx("td",{className:"p-3 text-sm text-center font-medium",children:s.pets}),e.jsx("td",{className:"p-3 text-sm text-center font-bold text-emerald-700",children:(s.adults+s.children+s.seniors).toLocaleString()}),e.jsx("td",{className:"p-3 text-sm",children:e.jsxs("div",{className:"flex items-center gap-1",children:[Be(s.weather),e.jsx("span",{children:he(s.weather)})]})}),e.jsx("td",{className:"p-3 text-sm",children:e.jsx(ge,{variant:"secondary",className:"text-xs",children:ze(s.dayType)})})]},s.id))})]})})})}),(T==null?void 0:T.pagination)&&T.pagination.totalPages>1&&e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",(P-1)*q+1," a ",Math.min(P*q,T.pagination.total)," de ",T.pagination.total," registros"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>{const s=Math.max(1,P-1);console.log(`🔍 [PAGINATION] Página anterior: ${P} → ${s}`),je(s)},disabled:P<=1,children:e.jsx(_s,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,T.pagination.totalPages)},(s,t)=>{const n=t+1;return e.jsx(v,{variant:P===n?"default":"outline",size:"sm",onClick:()=>{console.log(`🔍 [PAGINATION] Página seleccionada: ${P} → ${n}`),je(n)},className:"w-8 h-8 p-0",children:n},n)})}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>je(Math.min(T.pagination.totalPages,P+1)),disabled:P>=T.pagination.totalPages,children:e.jsx(Us,{className:"h-4 w-4"})})]})]})})})]})})]}):e.jsx(j,{children:e.jsxs(y,{className:"text-center py-8",children:[e.jsx(we,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Selecciona un parque del resumen para ver sus detalles"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:'Haz clic en cualquier tarjeta de parque en la pestaña "Resumen por Parque"'})]})})}),e.jsx(Pe,{value:"reportes",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Gs,{className:"h-5 w-5"}),"Filtros de Reporte"]})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium",children:"Parque"}),e.jsxs(ne,{value:X,onValueChange:us,children:[e.jsx(oe,{children:e.jsx(le,{placeholder:"Selecciona un parque"})}),e.jsxs(de,{children:[e.jsx(E,{value:"all",children:"Todos los parques"}),Y&&Array.isArray(Y)&&Y.filter(s=>s.id&&s.name).map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium",children:"Período"}),e.jsxs(ne,{value:J,onValueChange:s=>xs(s),children:[e.jsx(oe,{children:e.jsx(le,{})}),e.jsxs(de,{children:[e.jsx(E,{value:"week",children:"Última semana"}),e.jsx(E,{value:"month",children:"Último mes"}),e.jsx(E,{value:"quarter",children:"Último trimestre"}),e.jsx(E,{value:"year",children:"Último año"}),e.jsx(E,{value:"all",children:"Todo el año"})]})]})]})]})})]}),R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Visitantes"}),e.jsx("p",{className:"text-2xl font-bold text-[#067f5f]",children:R.summary.totalVisitors.toLocaleString()})]}),e.jsx(as,{className:"h-8 w-8 text-[#067f5f]"})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Promedio Diario"}),e.jsx("p",{className:"text-2xl font-bold text-[#00a587]",children:Number(R.summary.avgDaily||0).toLocaleString()})]}),e.jsx(ke,{className:"h-8 w-8 text-[#00a587]"})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Registros"}),e.jsx("p",{className:"text-2xl font-bold text-[#bcd256]",children:Number(R.summary.totalRecords||0).toLocaleString()})]}),e.jsx(Ie,{className:"h-8 w-8 text-[#bcd256]"})]})})}),e.jsx(j,{children:e.jsx(y,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Parques Únicos"}),e.jsx("p",{className:"text-2xl font-bold text-[#8498a5]",children:Number(R.summary.uniqueParks||0).toLocaleString()})]}),e.jsx(we,{className:"h-8 w-8 text-[#8498a5]"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(j,{children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(zs,{className:"h-5 w-5"}),"Distribución Demográfica"]})}),e.jsx(y,{children:e.jsx("div",{className:"h-80",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Bs,{children:[e.jsx(Ks,{data:R.charts.demographic,cx:"50%",cy:"45%",labelLine:!0,label:({name:s,percent:t,value:n})=>t>.05?`${s}: ${Number(n||0).toLocaleString()} (${(t*100).toFixed(1)}%)`:"",outerRadius:70,innerRadius:20,fill:"#8884d8",dataKey:"value",minAngle:5,children:R.charts.demographic.map((s,t)=>e.jsx(Qs,{fill:s.color},`cell-${t}`))}),e.jsx(Oe,{formatter:(s,t)=>[`${Number(s||0).toLocaleString()} visitantes`,t]}),e.jsx(Ws,{verticalAlign:"bottom",height:36,iconType:"circle",formatter:(s,t)=>{var n;return`${s}: ${Number(((n=t.payload)==null?void 0:n.value)||0).toLocaleString()}`}})]})})})})]}),e.jsxs(j,{children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ns,{className:"h-5 w-5"}),"Tendencia Últimos 7 Días"]})}),e.jsx(y,{children:e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(Ys,{data:R.charts.trend,children:[e.jsx(os,{strokeDasharray:"3 3"}),e.jsx(ls,{dataKey:"date"}),e.jsx(ds,{}),e.jsx(Oe,{formatter:s=>[Number(s).toLocaleString(),"Visitantes"]}),e.jsx($e,{type:"monotone",dataKey:"visitors",stroke:"#067f5f",strokeWidth:2}),e.jsx($e,{type:"monotone",dataKey:"adults",stroke:"#00a587",strokeWidth:2}),e.jsx($e,{type:"monotone",dataKey:"children",stroke:"#bcd256",strokeWidth:2})]})})})})]}),e.jsxs(j,{children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-5 w-5"}),"Visitantes por Parque"]})}),e.jsx(y,{children:e.jsx("div",{className:"h-64",children:e.jsx(Re,{width:"100%",height:"100%",children:e.jsxs(et,{data:R.charts.parks,children:[e.jsx(os,{strokeDasharray:"3 3"}),e.jsx(ls,{dataKey:"parkName",angle:-45,textAnchor:"end",height:100}),e.jsx(ds,{}),e.jsx(Oe,{formatter:s=>[Number(s).toLocaleString(),"Visitantes"]}),e.jsx(Hs,{dataKey:"visitors",fill:"#067f5f"})]})})})})]}),e.jsxs(j,{children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5"}),"Métodos de Conteo"]})}),e.jsx(y,{children:e.jsx("div",{className:"space-y-3",children:R.charts.methods.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.method}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.count," registros"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-semibold text-[#067f5f]",children:s.visitors.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"visitantes"})]})]},t))})})]})]}),e.jsxs(j,{children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-5 w-5"}),"Análisis por Condiciones Climáticas"]})}),e.jsx(y,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Clima"}),e.jsx("th",{className:"text-center p-2",children:"Registros"}),e.jsx("th",{className:"text-center p-2",children:"Total Visitantes"}),e.jsx("th",{className:"text-center p-2",children:"Promedio"})]})}),e.jsx("tbody",{children:R.charts.weather.map((s,t)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2 font-medium",children:s.weather}),e.jsx("td",{className:"text-center p-2",children:s.count}),e.jsx("td",{className:"text-center p-2",children:s.visitors.toLocaleString()}),e.jsx("td",{className:"text-center p-2",children:Math.round(s.visitors/s.count)})]},t))})]})})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(v,{onClick:ys,className:"bg-[#067f5f] hover:bg-[#00a587]",children:[e.jsx(is,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]}),e.jsxs(v,{onClick:fs,className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Exportar Excel"]})]})})]}),!R&&e.jsx(j,{children:e.jsx(y,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ie,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay datos disponibles para generar reportes"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Asegúrate de tener registros de visitantes para visualizar los análisis"})]})})})]})})]}),hs&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(j,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(B,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-5 w-5"}),"Nuevo Registro de Visitantes"]})}),e.jsx(y,{children:e.jsxs("form",{onSubmit:Ds,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Modo de conteo *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(v,{type:"button",variant:O==="daily"?"default":"outline",onClick:()=>qe("daily"),className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Conteo diario"]}),e.jsxs(v,{type:"button",variant:O==="range"?"default":"outline",onClick:()=>qe("range"),className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Rango de fechas"]})]})]}),O==="range"&&e.jsxs("div",{className:"space-y-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsx(D,{children:"Tipo de distribución para el período *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(v,{type:"button",variant:me==="average"?"default":"outline",onClick:()=>_e("average"),className:"flex items-center gap-2 text-sm",size:"sm",children:[e.jsx(ke,{className:"h-4 w-4"}),"Promedio diario distribuido"]}),e.jsxs(v,{type:"button",variant:me==="equal"?"default":"outline",onClick:()=>_e("equal"),className:"flex items-center gap-2 text-sm",size:"sm",children:[e.jsx(Se,{className:"h-4 w-4"}),"Números idénticos"]})]}),e.jsx("p",{className:"text-xs text-gray-600 mt-2",children:me==="average"?"Los números se dividirán entre los días del período con variaciones naturales (±15%)":"Los mismos números se aplicarán idénticamente a cada día del período"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"parkId",children:"Parque *"}),e.jsxs(ne,{value:m.parkId.toString(),onValueChange:s=>k({...m,parkId:parseInt(s)}),children:[e.jsx(oe,{children:e.jsx(le,{placeholder:"Selecciona un parque"})}),e.jsx(de,{children:Y&&Array.isArray(Y)&&Y.filter(s=>s.id&&s.name).map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id))})]})]}),O==="daily"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"date",children:"Fecha *"}),e.jsx(Q,{type:"date",value:m.date,onChange:s=>k({...m,date:s.target.value}),required:!0})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{children:"Rango de fechas *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"startDate",className:"text-sm",children:"Desde"}),e.jsx(Q,{type:"date",value:m.startDate,onChange:s=>k({...m,startDate:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"endDate",className:"text-sm",children:"Hasta"}),e.jsx(Q,{type:"date",value:m.endDate,onChange:s=>k({...m,endDate:s.target.value}),required:!0})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 border rounded-lg bg-blue-50",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"Contador de Visitantes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"adults",children:"Adultos"}),e.jsx(Q,{type:"number",min:"0",value:m.adults,onChange:s=>k({...m,adults:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"children",children:"Niños"}),e.jsx(Q,{type:"number",min:"0",value:m.children,onChange:s=>k({...m,children:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"seniors",children:"Adultos mayores"}),e.jsx(Q,{type:"number",min:"0",value:m.seniors,onChange:s=>k({...m,seniors:parseInt(s.target.value)||0})})]})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-pink-50",children:[e.jsx("h3",{className:"font-semibold text-pink-900 mb-3",children:"Contador de Mascotas"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"pets",children:"Mascotas (perros)"}),e.jsx(Q,{type:"number",min:"0",value:m.pets,onChange:s=>k({...m,pets:parseInt(s.target.value)||0})})]}),e.jsx("div",{className:"text-sm text-pink-700 mt-2",children:"Conteo separado para mascotas que ingresan al parque"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"p-4 bg-emerald-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-700",children:m.adults+m.children+m.seniors}),e.jsx("div",{className:"text-sm text-emerald-600",children:"Total de visitantes"})]})}),e.jsx("div",{className:"p-4 bg-pink-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-pink-700",children:m.pets}),e.jsx("div",{className:"text-sm text-pink-600",children:"Total de mascotas"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"countingMethod",children:"Método de conteo *"}),e.jsxs(ne,{value:m.countingMethod,onValueChange:s=>k({...m,countingMethod:s}),children:[e.jsx(oe,{children:e.jsx(le,{})}),e.jsxs(de,{children:[e.jsx(E,{value:"estimation",children:"Estimación"}),e.jsx(E,{value:"manual_counter",children:"Contador manual"}),e.jsx(E,{value:"event_based",children:"Basado en eventos"}),e.jsx(E,{value:"entrance_control",children:"Control de acceso"})]})]})]}),O==="daily"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"dayType",children:"Tipo de día *"}),e.jsxs(ne,{value:m.dayType,onValueChange:s=>k({...m,dayType:s}),children:[e.jsx(oe,{children:e.jsx(le,{})}),e.jsxs(de,{children:[e.jsx(E,{value:"weekday",children:"Día laborable"}),e.jsx(E,{value:"weekend",children:"Fin de semana"}),e.jsx(E,{value:"holiday",children:"Día festivo"})]})]})]})]}),O==="daily"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"weather",children:"Clima"}),e.jsxs(ne,{value:m.weather,onValueChange:s=>k({...m,weather:s}),children:[e.jsx(oe,{children:e.jsx(le,{})}),e.jsxs(de,{children:[e.jsx(E,{value:"sunny",children:"Soleado"}),e.jsx(E,{value:"cloudy",children:"Nublado"}),e.jsx(E,{value:"rainy",children:"Lluvioso"}),e.jsx(E,{value:"other",children:"Otro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"notes",children:"Notas adicionales"}),e.jsx(Js,{value:m.notes,onChange:s=>k({...m,notes:s.target.value}),placeholder:"Observaciones, eventos especiales, etc.",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>Ee(!1),children:"Cancelar"}),e.jsx(v,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700",disabled:Me.isPending,children:Me.isPending?"Guardando...":"Guardar Registro"})]})]})})]})})]})})}export{gt as default};
