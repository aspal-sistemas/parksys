import{az as ae,a2 as x,ae as le,l as re,u as te,ag as ie,R as E,j as e,aX as ne,b$ as ce,c1 as oe,c2 as de,c3 as xe,c4 as he,c5 as me,c6 as je,c7 as ue,f as u,cq as z,B as h,bh as pe,cN as ge,cO as Ne,D as ve,c_ as fe,cP as we,cQ as ye,cR as be,cS as P,cv as L,g as v,h as f,i as w,U as Ce,a_ as Ae,cT as De,a4 as Se,O as Ee,Q as H,V as Q,W as V,Y as $,_ as m,bQ as O,K as Pe,bH as Le,bI as Me,bJ as K,bK as t,cn as Te,bL as Ie,bM as i,au as Fe,bq as ke,cw as qe,cx as Be,cz as M,cy as Re,cA as ze,cB as He,r as Qe,a1 as Ve,o as n,aq as $e}from"./index-D5qLf1ib.js";function Ke(){const[,y]=ae(),[r,T]=x.useState(1),[c,I]=x.useState(""),[j,F]=x.useState("all"),[o,k]=x.useState("all"),[U,b]=x.useState(!1),p=10,Y=le(),{toast:q}=re(),{data:l=[],isLoading:_,isError:G,refetch:J}=te({queryKey:["/api/instructors"],retry:1,suspense:!1,enabled:!0}),C=ie({mutationFn:async()=>await $e("/api/instructors/batch/all",{method:"DELETE"}),onSuccess:s=>{q({title:"Instructores inactivados",description:`${s.count} instructores han sido inactivados correctamente`,variant:"default"}),Y.invalidateQueries({queryKey:["/api/instructors"]}),b(!1)},onError:s=>{console.error("Error al eliminar todos los instructores:",s),q({title:"Error",description:"No se pudieron eliminar los instructores. Por favor, inténtalo de nuevo.",variant:"destructive"}),b(!1)}}),A=E.useMemo(()=>Array.isArray(l)?l.filter(s=>{var R;const a=c===""||`${s.firstName} ${s.lastName}`.toLowerCase().includes(c.toLowerCase())||((R=s.email)==null?void 0:R.toLowerCase().includes(c.toLowerCase())),d=j==="all"||s.status===j,S=o==="all"||s.specialties&&(Array.isArray(s.specialties)?s.specialties.some(se=>se.toLowerCase().includes(o.toLowerCase())):s.specialties.toLowerCase().includes(o.toLowerCase()));return a&&d&&S}):[],[l,c,j,o]),g=E.useMemo(()=>{const s=(r-1)*p;return A.slice(s,s+p)},[A,r,p]),N=Math.ceil(A.length/p),D=s=>{T(s)},W=()=>{C.mutate()};x.useEffect(()=>{T(1)},[c,j,o]);const B=E.useMemo(()=>{if(!l)return[];const s=new Set;return l.forEach(a=>{a.specialties&&Array.isArray(a.specialties)?a.specialties.forEach(d=>{s.add(d.trim())}):a.specialties&&typeof a.specialties=="string"&&a.specialties.split(",").forEach(S=>{s.add(S.trim())})}),Array.from(s)},[l]),X=s=>{if(!s)return"Fecha desconocida";try{const a=new Date(s);return Qe(a,"dd MMM yyyy",{locale:Ve})}catch{return"Fecha inválida"}},Z=s=>{switch(s){case"active":return e.jsx(n,{className:"bg-green-100 text-green-800 hover:bg-green-200",children:"Activo"});case"inactive":return e.jsx(n,{className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:"Inactivo"});case"pending":return e.jsx(n,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",children:"Pendiente"});default:return e.jsx(n,{children:s})}},ee=s=>!s||!Array.isArray(s)||s.length===0?e.jsx("span",{className:"text-gray-400 italic",children:"No especificado"}):s.length<=2?s.map((a,d)=>e.jsx(n,{variant:"outline",className:"mr-1",children:a},d)):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"outline",className:"mr-1",children:s[0]}),e.jsxs(n,{variant:"outline",className:"mr-1",children:["+",s.length-1," más"]})]});return e.jsxs(ne,{children:[e.jsx(ce,{open:U,onOpenChange:b,children:e.jsxs(oe,{children:[e.jsxs(de,{children:[e.jsx(xe,{children:"¿Estás seguro?"}),e.jsx(he,{children:"Esta acción desactivará a todos los instructores en el sistema y no se puede deshacer. Los instructores marcados como inactivos ya no aparecerán en las listas públicas ni podrán ser asignados a actividades."})]}),e.jsxs(me,{children:[e.jsx(je,{children:"Cancelar"}),e.jsx(ue,{onClick:W,disabled:C.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:C.isPending?"Procesando...":"Confirmar eliminación"})]})]})}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(u,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Instructores"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestiona la lista de instructores registrados en la plataforma"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(h,{onClick:()=>y("/admin/activities/instructors/new"),children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Nuevo Instructor"]}),e.jsxs(ge,{children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(h,{variant:"outline",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Exportar",e.jsx(fe,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(we,{children:[e.jsx(ye,{children:"Formato"}),e.jsx(be,{}),e.jsxs(P,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Excel"]}),e.jsxs(P,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"CSV"]}),e.jsxs(P,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"PDF"]})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs(u,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Total"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:l?l.length:0})]})})]}),e.jsxs(u,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Activos"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:l?l.filter(s=>s.status==="active").length:0})]})})]}),e.jsxs(u,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Experiencia promedio"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{className:"h-5 w-5 text-amber-600 mr-2"}),e.jsxs("span",{className:"text-2xl font-bold",children:[l&&l.length>0?Math.round(l.reduce((s,a)=>s+(a.experienceYears||0),0)/l.length):0," años"]})]})})]}),e.jsxs(u,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Especialidades"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-5 w-5 text-purple-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:B.length})]})})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4 items-end",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Buscar por nombre o email...",className:"pl-8",value:c,onChange:s=>I(s.target.value)})]})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsxs(H,{value:j,onValueChange:F,children:[e.jsx(Q,{children:e.jsx(V,{placeholder:"Filtrar por estado"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"Todos los estados"}),e.jsx(m,{value:"active",children:"Activos"}),e.jsx(m,{value:"inactive",children:"Inactivos"}),e.jsx(m,{value:"pending",children:"Pendientes"})]})]})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsxs(H,{value:o,onValueChange:k,children:[e.jsx(Q,{children:e.jsx(V,{placeholder:"Filtrar por especialidad"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"Todas las especialidades"}),B.map((s,a)=>e.jsx(m,{value:s,children:s},a))]})]})}),e.jsxs(h,{variant:"outline",className:"w-full md:w-auto",onClick:()=>{I(""),F("all"),k("all")},children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Limpiar filtros"]})]}),e.jsxs("div",{className:"bg-white rounded-md shadow",children:[_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Cargando instructores..."})]}):G?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Pe,{className:"h-8 w-8 mx-auto text-red-500"}),e.jsx("p",{className:"mt-2 text-red-500",children:"Error al cargar los instructores"}),e.jsx(h,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>J(),children:"Reintentar"})]}):(g==null?void 0:g.length)===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:l?"No se encontraron instructores que coincidan con los criterios de búsqueda.":"Haz clic en 'Cargar instructores' para ver los datos."})}):e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs(Le,{children:[e.jsx(Me,{children:e.jsxs(K,{children:[e.jsx(t,{children:"Nombre"}),e.jsx(t,{children:"Contacto"}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center",children:["Estado",e.jsx(Te,{className:"ml-2 h-4 w-4"})]})}),e.jsx(t,{children:"Especialidades"}),e.jsx(t,{children:"Experiencia"}),e.jsx(t,{children:"Inicio"}),e.jsx(t,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ie,{children:g.map(s=>e.jsxs(K,{children:[e.jsxs(i,{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsxs(i,{children:[e.jsx("div",{children:s.email}),s.phone&&e.jsx("div",{className:"text-muted-foreground text-xs",children:s.phone})]}),e.jsx(i,{children:Z(s.status)}),e.jsx(i,{children:ee(s.specialties)}),e.jsxs(i,{children:[s.experienceYears," ",s.experienceYears===1?"año":"años"]}),e.jsx(i,{children:X(s.createdAt)}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>y(`/admin/instructors/detail/${s.id}`),title:"Ver detalles",children:e.jsx(Fe,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>y(`/admin/instructors/edit/${s.id}`),title:"Editar instructor",children:e.jsx(ke,{className:"h-4 w-4"})})]})})]},s.id))})]})}),N>1&&e.jsx("div",{className:"mt-4",children:e.jsx(qe,{children:e.jsxs(Be,{children:[e.jsx(M,{children:e.jsx(Re,{onClick:()=>D(Math.max(1,r-1)),className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:N},(s,a)=>a+1).map(s=>e.jsx(M,{children:e.jsx(ze,{onClick:()=>D(s),isActive:r===s,children:s})},s)),e.jsx(M,{children:e.jsx(He,{onClick:()=>D(Math.min(N,r+1)),className:r===N?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]})]})}export{Ke as default};
