import{Y as h,e as ce,a6 as de,u as j,s as o,a8 as oe,j as e,aI as X,B as p,b2 as xe,I as g,z as v,H as N,J as y,K as f,N as n,C as x,c as m,a9 as $,F as D,al as me,i as G,f as _,b7 as he,ba as je,D as H,r as J,t as Y,v as U,y as t,O,aO as ue,aP as pe,aQ as F,aR as T}from"./index-Dzu3mJf5.js";import{C as W}from"./circle-x-C53LJYQf.js";const Ne=()=>{const[b,Z]=h.useState(""),[I,ee]=h.useState("all"),[a,se]=h.useState(null),[ae,w]=h.useState(!1),[te,A]=h.useState(!1),[r,K]=h.useState({sponsorId:0,packageId:0,campaignId:0,contractNumber:"",title:"",description:"",startDate:"",endDate:"",totalAmount:0,paymentSchedule:"monthly",status:"draft",termsConditions:"",deliverables:"",performanceMetrics:"",contactPerson:"",contactEmail:"",contactPhone:""}),{toast:B}=ce(),le=de(),{data:P,isLoading:ne}=j({queryKey:["sponsorship-contracts"],queryFn:()=>o("/api/sponsorship-contracts")}),{data:q}=j({queryKey:["sponsors"],queryFn:()=>o("/api/sponsors")}),{data:M}=j({queryKey:["sponsorship-packages"],queryFn:()=>o("/api/sponsorship-packages")}),{data:V}=j({queryKey:["sponsorship-campaigns"],queryFn:()=>o("/api/sponsorship-campaigns")}),{data:E}=j({queryKey:["contract-payments",a==null?void 0:a.id],queryFn:()=>o(`/api/sponsorship-contracts/${a==null?void 0:a.id}/payments`),enabled:!!(a!=null&&a.id)}),{data:k}=j({queryKey:["contract-events",a==null?void 0:a.id],queryFn:()=>o(`/api/sponsorship-contracts/${a==null?void 0:a.id}/events`),enabled:!!(a!=null&&a.id)}),L=oe({mutationFn:s=>o("/api/sponsorship-contracts",{method:"POST",body:JSON.stringify(s)}),onSuccess:()=>{le.invalidateQueries({queryKey:["sponsorship-contracts"]}),w(!1),B({title:"Contrato creado",description:"El contrato ha sido creado exitosamente."}),K({sponsorId:0,packageId:0,campaignId:0,contractNumber:"",title:"",description:"",startDate:"",endDate:"",totalAmount:0,paymentSchedule:"monthly",status:"draft",termsConditions:"",deliverables:"",performanceMetrics:"",contactPerson:"",contactEmail:"",contactPhone:""})},onError:s=>{B({title:"Error",description:"No se pudo crear el contrato. Por favor, intente nuevamente.",variant:"destructive"})}}),l=P==null?void 0:P.filter(s=>{var S;const c=s.title.toLowerCase().includes(b.toLowerCase())||((S=s.sponsor_name)==null?void 0:S.toLowerCase().includes(b.toLowerCase()))||s.contract_number.toLowerCase().includes(b.toLowerCase()),u=I==="all"||s.status===I;return c&&u}),z=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"pending":return"bg-orange-100 text-orange-800";case"expired":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},Q=s=>{switch(s){case"active":return e.jsx($,{className:"h-4 w-4"});case"draft":return e.jsx(D,{className:"h-4 w-4"});case"pending":return e.jsx(G,{className:"h-4 w-4"});case"expired":return e.jsx(W,{className:"h-4 w-4"});case"cancelled":return e.jsx(W,{className:"h-4 w-4"});default:return e.jsx(D,{className:"h-4 w-4"})}},C=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),d=s=>new Date(s).toLocaleDateString("es-MX",{year:"numeric",month:"short",day:"numeric"}),re=s=>{se(s),A(!0)},ie=()=>{const s=`CTR-${new Date().getFullYear()}-${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,c={...r,contractNumber:s};L.mutate(c)},i=(s,c)=>{K(u=>({...u,[s]:c}))};return ne?e.jsx(X,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#00a587] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando contratos..."})]})})}):e.jsx(X,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Contratos de Patrocinio"}),e.jsx("p",{className:"text-gray-600",children:"Gesti√≥n de contratos, pagos y compromisos"})]}),e.jsxs(p,{onClick:()=>w(!0),className:"bg-[#00a587] hover:bg-[#067f5f] text-white",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Nuevo Contrato"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(g,{placeholder:"Buscar por t√≠tulo, patrocinador o n√∫mero de contrato...",value:b,onChange:s=>Z(s.target.value),className:"max-w-md"})}),e.jsxs(v,{value:I,onValueChange:ee,children:[e.jsx(N,{className:"w-48",children:e.jsx(y,{placeholder:"Filtrar por estado"})}),e.jsxs(f,{children:[e.jsx(n,{value:"all",children:"Todos los estados"}),e.jsx(n,{value:"active",children:"Activos"}),e.jsx(n,{value:"draft",children:"Borradores"}),e.jsx(n,{value:"pending",children:"Pendientes"}),e.jsx(n,{value:"expired",children:"Expirados"}),e.jsx(n,{value:"cancelled",children:"Cancelados"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contratos Activos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:(l==null?void 0:l.filter(s=>s.status==="active").length)||0})]}),e.jsx($,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(x,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Borradores"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:(l==null?void 0:l.filter(s=>s.status==="draft").length)||0})]}),e.jsx(D,{className:"h-8 w-8 text-yellow-500"})]})})}),e.jsx(x,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:C((l==null?void 0:l.reduce((s,c)=>s+c.total_amount,0))||0)})]}),e.jsx(me,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(x,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Pr√≥ximos a Vencer"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:(l==null?void 0:l.filter(s=>{const c=new Date(s.end_date),u=new Date,S=c.getTime()-u.getTime(),R=Math.ceil(S/(1e3*60*60*24));return R<=30&&R>0}).length)||0})]}),e.jsx(G,{className:"h-8 w-8 text-orange-500"})]})})})]}),e.jsx("div",{className:"grid gap-4",children:l==null?void 0:l.map(s=>e.jsx(x,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(m,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsxs(_,{className:z(s.status),children:[Q(s.status),e.jsx("span",{className:"ml-1 capitalize",children:s.status})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-500",children:[e.jsxs("span",{children:["#",s.contract_number]}),e.jsxs("span",{children:["üè¢ ",s.sponsor_name]}),e.jsxs("span",{children:["üì¶ ",s.package_name]}),e.jsxs("span",{children:["üéØ ",s.campaign_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-[#00a587]",children:C(s.total_amount)}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:s.payment_schedule})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["üìÖ ",d(s.start_date)," - ",d(s.end_date)]}),s.signed_date&&e.jsxs("span",{children:["‚úÖ Firmado: ",d(s.signed_date)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>re(s),children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Ver Detalles"]}),e.jsxs(p,{variant:"outline",size:"sm",className:"text-blue-600 hover:text-blue-700",children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"Editar"]})]})]})]})},s.id))}),e.jsx(H,{open:ae,onOpenChange:w,children:e.jsxs(J,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(U,{children:"Crear Nuevo Contrato"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Patrocinador"}),e.jsxs(v,{value:String(r.sponsorId),onValueChange:s=>i("sponsorId",parseInt(s)),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Seleccionar patrocinador"})}),e.jsx(f,{children:q==null?void 0:q.map(s=>e.jsx(n,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Paquete"}),e.jsxs(v,{value:String(r.packageId),onValueChange:s=>i("packageId",parseInt(s)),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Seleccionar paquete"})}),e.jsx(f,{children:M==null?void 0:M.map(s=>e.jsx(n,{value:String(s.id),children:s.name},s.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Campa√±a"}),e.jsxs(v,{value:String(r.campaignId),onValueChange:s=>i("campaignId",parseInt(s)),children:[e.jsx(N,{children:e.jsx(y,{placeholder:"Seleccionar campa√±a"})}),e.jsx(f,{children:V==null?void 0:V.map(s=>e.jsx(n,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"T√≠tulo del Contrato"}),e.jsx(g,{value:r.title,onChange:s=>i("title",s.target.value),placeholder:"T√≠tulo del contrato"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Descripci√≥n"}),e.jsx(O,{value:r.description,onChange:s=>i("description",s.target.value),placeholder:"Descripci√≥n del contrato",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Fecha de Inicio"}),e.jsx(g,{type:"date",value:r.startDate,onChange:s=>i("startDate",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Fecha de Fin"}),e.jsx(g,{type:"date",value:r.endDate,onChange:s=>i("endDate",s.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Monto Total"}),e.jsx(g,{type:"number",value:r.totalAmount,onChange:s=>i("totalAmount",parseFloat(s.target.value)),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Frecuencia de Pago"}),e.jsxs(v,{value:r.paymentSchedule,onValueChange:s=>i("paymentSchedule",s),children:[e.jsx(N,{children:e.jsx(y,{})}),e.jsxs(f,{children:[e.jsx(n,{value:"monthly",children:"Mensual"}),e.jsx(n,{value:"quarterly",children:"Trimestral"}),e.jsx(n,{value:"biannual",children:"Semestral"}),e.jsx(n,{value:"annual",children:"Anual"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"T√©rminos y Condiciones"}),e.jsx(O,{value:r.termsConditions,onChange:s=>i("termsConditions",s.target.value),placeholder:"T√©rminos y condiciones del contrato",rows:3})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Entregables"}),e.jsx(O,{value:r.deliverables,onChange:s=>i("deliverables",s.target.value),placeholder:"Descripci√≥n de los entregables",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(p,{variant:"outline",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(p,{onClick:ie,className:"bg-[#00a587] hover:bg-[#067f5f]",disabled:L.isPending,children:L.isPending?"Creando...":"Crear Contrato"})]})]})]})}),e.jsx(H,{open:te,onOpenChange:A,children:e.jsxs(J,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Y,{children:e.jsx(U,{children:"Detalles del Contrato"})}),a&&e.jsxs(ue,{defaultValue:"general",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-4",children:[e.jsx(F,{value:"general",children:"General"}),e.jsx(F,{value:"payments",children:"Pagos"}),e.jsx(F,{value:"events",children:"Eventos"}),e.jsx(F,{value:"documents",children:"Documentos"})]}),e.jsxs(T,{value:"general",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"N√∫mero de Contrato"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.contract_number})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Estado"}),e.jsxs(_,{className:z(a.status),children:[Q(a.status),e.jsx("span",{className:"ml-1 capitalize",children:a.status})]})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Patrocinador"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.sponsor_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Paquete"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.package_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Campa√±a"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.campaign_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Valor Total"}),e.jsx("p",{className:"text-sm text-gray-600",children:C(a.total_amount)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Fecha de Inicio"}),e.jsx("p",{className:"text-sm text-gray-600",children:d(a.start_date)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Fecha de Fin"}),e.jsx("p",{className:"text-sm text-gray-600",children:d(a.end_date)})]})]}),a.terms_conditions&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"T√©rminos y Condiciones"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.terms_conditions})]}),a.deliverables&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Entregables"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.deliverables})]})]}),e.jsx(T,{value:"payments",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:E==null?void 0:E.map(s=>e.jsx(x,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Pago #",s.payment_number]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Vencimiento: ",d(s.due_date),s.payment_date&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(Pagado: ",d(s.payment_date),")"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:C(s.amount)}),e.jsx(_,{className:s.status==="paid"?"bg-green-100 text-green-800":s.status==="overdue"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:s.status})]})]})})},s.id))})}),e.jsx(T,{value:"events",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:k==null?void 0:k.map(s=>e.jsx(x,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.event_title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{children:["üìÖ ",d(s.event_date)]}),e.jsxs("span",{children:["üèõÔ∏è ",s.park_name]}),e.jsxs("span",{children:["üë• ",s.expected_attendance," personas"]})]})]}),e.jsx(_,{className:s.status==="completed"?"bg-green-100 text-green-800":s.status==="cancelled"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800",children:s.status})]})})},s.id))})}),e.jsx(T,{value:"documents",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Funcionalidad de documentos en desarrollo"})]})})]})]})})]})})};export{Ne as default};
