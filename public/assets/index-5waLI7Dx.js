import{aD as $,Y as b,e as le,a6 as ce,u as de,a7 as P,a8 as z,j as e,aI as xe,D as L,p as me,B as d,b2 as ue,r as M,t as T,v as F,w as O,aa as B,ab as n,ac as r,ad as i,ae as o,I as U,af as l,O as j,z as V,H,J as X,K as _,N as g,be as G,C as he,a as je,b as ge,a3 as pe,c as ve,bh as be,bi as ye,bj as K,bk as y,bl as fe,bm as f,f as D,ba as Ce,at as Ne,au as we,aJ as Re,a5 as p,ah as Q}from"./index-VG22aPDC.js";import{H as Ie}from"./Helmet-CoO02W0T.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=$("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=$("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]),J=p.object({name:p.string().min(3,"El nombre debe tener al menos 3 caracteres"),description:p.string().min(10,"La descripción debe tener al menos 10 caracteres"),technicalRequirements:p.string().optional(),legalRequirements:p.string().optional(),operatingRules:p.string().optional(),impactLevel:p.enum(["bajo","medio","alto","muy_alto"]),isActive:p.boolean().default(!0)});function De(){const[Y,R]=b.useState(!1),[W,C]=b.useState(!1),[k,Z]=b.useState(null),[x,I]=b.useState(1),N=10,{toast:v}=le(),S=ce(),{data:q,isLoading:ee}=de({queryKey:["/api/concession-types/all"]}),m=P({resolver:Q(J),defaultValues:{name:"",description:"",technicalRequirements:"",legalRequirements:"",operatingRules:"",impactLevel:"bajo",isActive:!0}}),c=P({resolver:Q(J),defaultValues:{name:"",description:"",technicalRequirements:"",legalRequirements:"",operatingRules:"",impactLevel:"bajo",isActive:!0}}),E=z({mutationFn:async s=>{const a=await fetch("/api/concession-types",{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:JSON.stringify(s)});if(!a.ok){const h=await a.json();throw new Error(h.message||"Error al crear el tipo de concesión")}return await a.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/concession-types/all"]}),v({title:"Tipo de concesión creado",description:"El tipo de concesión ha sido creado exitosamente."}),m.reset(),R(!1)},onError:s=>{v({title:"Error",description:s.message,variant:"destructive"})}}),A=z({mutationFn:async s=>{const{id:a,...h}=s,t=await fetch(`/api/concession-types/${a}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:JSON.stringify(h)});if(!t.ok){const w=await t.json();throw new Error(w.message||"Error al actualizar el tipo de concesión")}return await t.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/concession-types/all"]}),v({title:"Tipo de concesión actualizado",description:"El tipo de concesión ha sido actualizado exitosamente."}),c.reset(),C(!1)},onError:s=>{v({title:"Error",description:s.message,variant:"destructive"})}}),se=z({mutationFn:async s=>{const a=await fetch(`/api/concession-types/${s}/toggle-status`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""}});if(!a.ok){const h=await a.json();throw new Error(h.message||"Error al cambiar el estado del tipo de concesión")}return await a.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/concession-types/all"]}),v({title:"Estado actualizado",description:"El estado del tipo de concesión ha sido actualizado."})},onError:s=>{v({title:"Error",description:s.message,variant:"destructive"})}}),ae=s=>{E.mutate(s)},te=s=>{k&&A.mutate({...s,id:k.id})},ne=s=>{Z(s),c.reset({name:s.name,description:s.description,technicalRequirements:s.technicalRequirements||"",legalRequirements:s.legalRequirements||"",operatingRules:s.operatingRules||"",impactLevel:s.impactLevel,isActive:s.isActive}),C(!0)},re=s=>{se.mutate(s)},u=b.useMemo(()=>{const s=Array.isArray(q)?q:[];if(s.length===0)return{data:[],totalItems:0,totalPages:0,startIndex:0,endIndex:0};const a=s.length,h=Math.ceil(a/N),t=(x-1)*N,w=Math.min(t+N,a);return{data:s.slice(t,w),totalItems:a,totalPages:h,startIndex:t+1,endIndex:w}},[q,x,N]),ie=s=>{switch(s){case"bajo":return"bg-green-100 text-green-800";case"medio":return"bg-yellow-100 text-yellow-800";case"alto":return"bg-orange-100 text-orange-800";case"muy_alto":return"bg-red-100 text-red-800";default:return""}},oe=s=>{switch(s){case"bajo":return"Bajo";case"medio":return"Medio";case"alto":return"Alto";case"muy_alto":return"Muy alto";default:return s}};return e.jsxs(xe,{children:[e.jsxs(Ie,{children:[e.jsx("title",{children:"Catálogo de Concesiones | Bosques Urbanos"}),e.jsx("meta",{name:"description",content:"Gestiona el catálogo de tipos de concesiones disponibles para los parques"})]}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Catálogo de Concesiones"}),e.jsx("p",{className:"text-muted-foreground",children:"Administra los tipos de concesiones disponibles para los parques"})]}),e.jsxs(L,{open:Y,onOpenChange:R,children:[e.jsx(me,{asChild:!0,children:e.jsxs(d,{className:"gap-2",children:[e.jsx(ue,{size:16}),"Nuevo tipo de concesión"]})}),e.jsxs(M,{className:"sm:max-w-[600px]",children:[e.jsxs(T,{children:[e.jsx(F,{children:"Crear nuevo tipo de concesión"}),e.jsx(O,{children:"Introduce la información del nuevo tipo de concesión para el catálogo"})]}),e.jsx(B,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(ae),className:"space-y-4",children:[e.jsx(n,{control:m.control,name:"name",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Nombre"}),e.jsx(o,{children:e.jsx(U,{placeholder:"Ej: Venta de alimentos",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:m.control,name:"description",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Descripción"}),e.jsx(o,{children:e.jsx(j,{placeholder:"Describe en qué consiste este tipo de concesión",...s,rows:3})}),e.jsx(l,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:m.control,name:"technicalRequirements",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Requisitos técnicos"}),e.jsx(o,{children:e.jsx(j,{placeholder:"Requisitos técnicos para este tipo de concesión",...s,rows:3})}),e.jsx(l,{})]})}),e.jsx(n,{control:m.control,name:"legalRequirements",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Requisitos legales"}),e.jsx(o,{children:e.jsx(j,{placeholder:"Requisitos legales para este tipo de concesión",...s,rows:3})}),e.jsx(l,{})]})})]}),e.jsx(n,{control:m.control,name:"operatingRules",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Reglas de operación"}),e.jsx(o,{children:e.jsx(j,{placeholder:"Reglas de operación para este tipo de concesión",...s,rows:3})}),e.jsx(l,{})]})}),e.jsx(n,{control:m.control,name:"impactLevel",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Nivel de impacto ambiental/social"}),e.jsxs(V,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(o,{children:e.jsx(H,{children:e.jsx(X,{placeholder:"Selecciona un nivel de impacto"})})}),e.jsxs(_,{children:[e.jsx(g,{value:"bajo",children:"Bajo"}),e.jsx(g,{value:"medio",children:"Medio"}),e.jsx(g,{value:"alto",children:"Alto"}),e.jsx(g,{value:"muy_alto",children:"Muy alto"})]})]}),e.jsx(l,{})]})}),e.jsxs(G,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>R(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:E.isPending,children:E.isPending?"Guardando...":"Guardar"})]})]})})]})]})]}),e.jsxs(he,{children:[e.jsxs(je,{children:[e.jsx(ge,{children:"Tipos de concesiones"}),e.jsx(pe,{children:"Lista de tipos de concesiones disponibles para asignar a los parques"})]}),e.jsx(ve,{children:ee?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("p",{children:"Cargando catálogo de concesiones..."})}):u.totalItems>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(be,{children:[e.jsx(ye,{children:e.jsxs(K,{children:[e.jsx(y,{children:"Nombre"}),e.jsx(y,{children:"Descripción"}),e.jsx(y,{children:"Nivel de impacto"}),e.jsx(y,{children:"Estado"}),e.jsx(y,{className:"text-right",children:"Acciones"})]})}),e.jsx(fe,{children:u.data.map(s=>e.jsxs(K,{children:[e.jsx(f,{className:"font-medium",children:s.name}),e.jsx(f,{className:"max-w-[300px] truncate",children:s.description}),e.jsx(f,{children:e.jsx(D,{className:ie(s.impactLevel),children:oe(s.impactLevel)})}),e.jsx(f,{children:s.isActive?e.jsx(D,{variant:"outline",className:"bg-green-100 text-green-800 border-green-200",children:"Activo"}):e.jsx(D,{variant:"outline",className:"bg-gray-100 text-gray-800 border-gray-200",children:"Inactivo"})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>ne(s),title:"Editar",children:e.jsx(Ce,{size:16})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>re(s.id),title:s.isActive?"Desactivar":"Activar",children:s.isActive?e.jsx(qe,{size:16,className:"text-green-500"}):e.jsx(Se,{size:16,className:"text-gray-500"})})]})})]},s.id))})]})}),u.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Mostrando ",u.startIndex," a ",u.endIndex," de ",u.totalItems," tipos de concesiones"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>I(x-1),disabled:x===1,className:"gap-1",children:[e.jsx(Ne,{size:16}),"Anterior"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,u.totalPages)},(s,a)=>{const t=Math.max(1,x-2)+a;return t>u.totalPages?null:e.jsx(d,{variant:t===x?"default":"outline",size:"sm",onClick:()=>I(t),className:t===x?"bg-[#00a587] hover:bg-[#067f5f]":"",children:t},t)})}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>I(x+1),disabled:x===u.totalPages,className:"gap-1",children:["Siguiente",e.jsx(we,{size:16})]})]})]})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(Re,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-semibold",children:"No hay tipos de concesiones"}),e.jsx("p",{className:"text-muted-foreground max-w-md mt-2",children:"No se encontraron tipos de concesiones en el catálogo. Crea un nuevo tipo para comenzar."})]})})]})]}),e.jsx(L,{open:W,onOpenChange:C,children:e.jsxs(M,{className:"sm:max-w-[600px]",children:[e.jsxs(T,{children:[e.jsx(F,{children:"Editar tipo de concesión"}),e.jsx(O,{children:"Modifica la información del tipo de concesión"})]}),e.jsx(B,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(te),className:"space-y-4",children:[e.jsx(n,{control:c.control,name:"name",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Nombre"}),e.jsx(o,{children:e.jsx(U,{...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"description",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Descripción"}),e.jsx(o,{children:e.jsx(j,{...s,rows:3})}),e.jsx(l,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:c.control,name:"technicalRequirements",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Requisitos técnicos"}),e.jsx(o,{children:e.jsx(j,{...s,rows:3})}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"legalRequirements",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Requisitos legales"}),e.jsx(o,{children:e.jsx(j,{...s,rows:3})}),e.jsx(l,{})]})})]}),e.jsx(n,{control:c.control,name:"operatingRules",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Reglas de operación"}),e.jsx(o,{children:e.jsx(j,{...s,rows:3})}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"impactLevel",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Nivel de impacto ambiental/social"}),e.jsxs(V,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(o,{children:e.jsx(H,{children:e.jsx(X,{placeholder:"Selecciona un nivel de impacto"})})}),e.jsxs(_,{children:[e.jsx(g,{value:"bajo",children:"Bajo"}),e.jsx(g,{value:"medio",children:"Medio"}),e.jsx(g,{value:"alto",children:"Alto"}),e.jsx(g,{value:"muy_alto",children:"Muy alto"})]})]}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"isActive",render:({field:s})=>e.jsxs(r,{className:"flex flex-row items-center space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:s.onChange,className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"})}),e.jsx("div",{className:"leading-none",children:e.jsx(i,{children:"Activo"})})]})}),e.jsxs(G,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:A.isPending,children:A.isPending?"Guardando...":"Guardar cambios"})]})]})})]})})]})}export{De as default};
