import{c as te,a2 as o,l as ne,ae as le,u as F,ag as U,j as e,aX as ie,w as V,x as B,B as d,bh as oe,y as z,z as X,I as K,Q as j,V as u,W as g,Y as y,_ as t,f as c,i as m,F as k,ah as Q,as as de,a4 as ce,O as me,g as xe,h as he,o as A,r as b,au as pe,D as je,a1 as ue,n as ge}from"./index-D5qLf1ib.js";import{S as H}from"./send-Bxi1PaXf.js";import{P as ye}from"./printer-C4fk6c7h.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=te("FileCheck",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);function be(){const[w,W]=o.useState(""),[N,_]=o.useState(""),[f,J]=o.useState(""),[v,Y]=o.useState("");o.useState(null);const[Z,S]=o.useState(!1),[C,L]=o.useState(""),[D,T]=o.useState(""),{toast:l}=ne(),I=le(),{data:x=[],isLoading:ee}=F({queryKey:["/api/hr/payroll-receipts",{employeeId:f,periodId:N,status:v}],queryFn:async()=>{const s=new URLSearchParams;f&&s.append("employeeId",f),N&&s.append("periodId",N),v&&s.append("status",v);const a=await fetch(`/api/hr/payroll-receipts?${s}`);if(!a.ok)throw new Error("Error al obtener recibos");return a.json()}}),{data:M=[]}=F({queryKey:["/api/hr/payroll-periods"],queryFn:async()=>{const s=await fetch("/api/hr/payroll-periods");if(!s.ok)throw new Error("Error al obtener períodos");return s.json()}}),{data:G=[]}=F({queryKey:["/api/hr/employees"],queryFn:async()=>{const s=await fetch("/api/hr/employees");if(!s.ok)throw new Error("Error al obtener empleados");return s.json()}}),E=U({mutationFn:async s=>{const a=await fetch("/api/hr/generate-receipt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){const r=await a.json();throw new Error(r.error||"Error al generar recibo")}return a.json()},onSuccess:()=>{I.invalidateQueries({queryKey:["/api/hr/payroll-receipts"]}),l({title:"Recibo generado",description:"El recibo se ha generado exitosamente",variant:"default"}),S(!1),L(""),T("")},onError:s=>{l({title:"Error",description:s.message,variant:"destructive"})}}),$=U({mutationFn:async s=>{const a=await fetch(`/api/hr/payroll-receipts/${s}/generate-pdf`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!a.ok){const r=await a.json();throw new Error(r.error||"Error al generar PDF")}return a.json()},onSuccess:()=>{I.invalidateQueries({queryKey:["/api/hr/payroll-receipts"]}),l({title:"PDF generado",description:"El PDF del recibo se ha generado exitosamente",variant:"default"})},onError:s=>{l({title:"Error",description:s.message,variant:"destructive"})}}),P=x.filter(s=>s.employeeName.toLowerCase().includes(w.toLowerCase())||s.receiptNumber.toLowerCase().includes(w.toLowerCase())),p={total:x.length,generated:x.filter(s=>s.status==="generated").length,sent:x.filter(s=>s.status==="sent").length,confirmed:x.filter(s=>s.status==="confirmed").length,totalAmount:x.reduce((s,a)=>s+parseFloat(a.totalNet||"0"),0)},q=s=>{const a={draft:{label:"Borrador",variant:"secondary",icon:ge},generated:{label:"Generado",variant:"default",icon:R},sent:{label:"Enviado",variant:"outline",icon:H},confirmed:{label:"Confirmado",variant:"default",icon:Q}},r=a[s]||a.draft,i=r.icon;return e.jsxs(A,{variant:r.variant,className:"flex items-center gap-1",children:[e.jsx(i,{className:"w-3 h-3"}),r.label]})},se=async s=>{try{const a=await fetch(`/api/hr/payroll-receipts/${s}/download`);if(!a.ok)throw new Error("Error al descargar PDF");const r=await a.blob(),i=window.URL.createObjectURL(r),n=document.createElement("a");n.href=i,n.download=`recibo_${s}.pdf`,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(i),document.body.removeChild(n)}catch{l({title:"Error",description:"No se pudo descargar el PDF",variant:"destructive"})}},ae=async s=>{try{const a=await fetch(`/api/hr/payroll-receipts/${s}/download`);if(!a.ok)throw new Error("Error al obtener PDF para impresión");const r=await a.blob(),i=window.URL.createObjectURL(r),n=window.open(i,"_blank");if(n)n.onload=()=>{n.print()};else{const h=document.createElement("iframe");h.style.display="none",h.src=i,document.body.appendChild(h),h.onload=()=>{var O;(O=h.contentWindow)==null||O.print(),setTimeout(()=>{document.body.removeChild(h),window.URL.revokeObjectURL(i)},1e3)}}l({title:"Éxito",description:"Preparando recibo para impresión"})}catch{l({title:"Error",description:"No se pudo preparar el recibo para impresión",variant:"destructive"})}},re=()=>{if(!C||!D){l({title:"Error",description:"Selecciona un empleado y un período",variant:"destructive"});return}E.mutate({employeeId:parseInt(C),periodId:parseInt(D)})};return e.jsx(ie,{title:"Recibos de Nómina",subtitle:"Gestión completa de recibos de pago para empleados",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsxs(V,{open:Z,onOpenChange:S,children:[e.jsx(B,{asChild:!0,children:e.jsxs(d,{className:"bg-[#00a587] hover:bg-[#067f5f]",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"Generar Recibo"]})}),e.jsxs(z,{children:[e.jsx(X,{children:e.jsx(K,{children:"Generar Nuevo Recibo"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Empleado"}),e.jsxs(j,{value:C,onValueChange:L,children:[e.jsx(u,{children:e.jsx(g,{placeholder:"Selecciona un empleado"})}),e.jsx(y,{children:G.map(s=>e.jsxs(t,{value:s.id.toString(),children:[s.fullName," - ",s.position]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Período"}),e.jsxs(j,{value:D,onValueChange:T,children:[e.jsx(u,{children:e.jsx(g,{placeholder:"Selecciona un período"})}),e.jsx(y,{children:M.map(s=>e.jsx(t,{value:s.id.toString(),children:s.period},s.id))})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{onClick:re,disabled:E.isPending,className:"flex-1 bg-[#00a587] hover:bg-[#067f5f]",children:E.isPending?"Generando...":"Generar Recibo"}),e.jsx(d,{variant:"outline",onClick:()=>S(!1),className:"flex-1",children:"Cancelar"})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsx(c,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Recibos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:p.total})]}),e.jsx(k,{className:"w-8 h-8 text-[#00a587]"})]})})}),e.jsx(c,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Generados"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:p.generated})]}),e.jsx(R,{className:"w-8 h-8 text-blue-600"})]})})}),e.jsx(c,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Enviados"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:p.sent})]}),e.jsx(H,{className:"w-8 h-8 text-orange-600"})]})})}),e.jsx(c,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Confirmados"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:p.confirmed})]}),e.jsx(Q,{className:"w-8 h-8 text-green-600"})]})})}),e.jsx(c,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Monto Total"}),e.jsxs("p",{className:"text-2xl font-bold text-[#00a587]",children:["$",p.totalAmount.toLocaleString("es-MX",{minimumFractionDigits:2})]})]}),e.jsx(de,{className:"w-8 h-8 text-[#00a587]"})]})})})]}),e.jsx(c,{children:e.jsx(m,{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(me,{placeholder:"Buscar por nombre o número...",value:w,onChange:s=>W(s.target.value),className:"pl-10"})]}),e.jsxs(j,{value:N,onValueChange:_,children:[e.jsx(u,{children:e.jsx(g,{placeholder:"Filtrar por período"})}),e.jsxs(y,{children:[e.jsx(t,{value:"all",children:"Todos los períodos"}),M.map(s=>e.jsx(t,{value:s.id.toString(),children:s.period},s.id))]})]}),e.jsxs(j,{value:f,onValueChange:J,children:[e.jsx(u,{children:e.jsx(g,{placeholder:"Filtrar por empleado"})}),e.jsxs(y,{children:[e.jsx(t,{value:"all",children:"Todos los empleados"}),G.map(s=>e.jsx(t,{value:s.id.toString(),children:s.fullName},s.id))]})]}),e.jsxs(j,{value:v,onValueChange:Y,children:[e.jsx(u,{children:e.jsx(g,{placeholder:"Filtrar por estado"})}),e.jsxs(y,{children:[e.jsx(t,{value:"all",children:"Todos los estados"}),e.jsx(t,{value:"draft",children:"Borrador"}),e.jsx(t,{value:"generated",children:"Generado"}),e.jsx(t,{value:"sent",children:"Enviado"}),e.jsx(t,{value:"confirmed",children:"Confirmado"})]})]})]})})}),e.jsxs(c,{children:[e.jsx(xe,{children:e.jsxs(he,{children:["Recibos de Nómina (",P.length,")"]})}),e.jsx(m,{children:ee?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"text-gray-500",children:"Cargando recibos..."})}):P.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(k,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No se encontraron recibos"})]}):e.jsx("div",{className:"space-y-4",children:P.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.receiptNumber}),q(s.status),s.pdfGenerated&&e.jsxs(A,{variant:"outline",className:"text-green-600",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"PDF Disponible"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Empleado"}),e.jsx("p",{className:"font-medium",children:s.employeeName}),e.jsx("p",{className:"text-gray-500",children:s.employeePosition})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Período"}),e.jsx("p",{className:"font-medium",children:s.periodName}),e.jsx("p",{className:"text-gray-500",children:s.periodStartDate&&s.periodEndDate&&`${b(new Date(s.periodStartDate),"dd/MM/yyyy")} - ${b(new Date(s.periodEndDate),"dd/MM/yyyy")}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Fecha de Pago"}),e.jsx("p",{className:"font-medium",children:b(new Date(s.payDate),"dd/MM/yyyy",{locale:ue})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600",children:"Neto a Pagar"}),e.jsxs("p",{className:"font-bold text-[#00a587] text-lg",children:["$",parseFloat(s.totalNet).toLocaleString("es-MX",{minimumFractionDigits:2})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[e.jsxs(V,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(pe,{className:"w-4 h-4 mr-1"}),"Ver"]})}),e.jsxs(z,{className:"max-w-2xl",children:[e.jsx(X,{children:e.jsxs(K,{children:["Detalle del Recibo - ",s.receiptNumber]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Información del Empleado"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",s.employeeName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Puesto:"})," ",s.employeePosition]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Departamento:"})," ",s.employeeDepartment]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold",children:"Información del Pago"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Período:"})," ",s.periodName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de Pago:"})," ",b(new Date(s.payDate),"dd/MM/yyyy")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"})," ",q(s.status)]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Resumen Financiero"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Percepciones"}),e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["$",parseFloat(s.totalGross).toLocaleString("es-MX",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"text-center p-3 bg-red-50 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Deducciones"}),e.jsxs("p",{className:"text-lg font-bold text-red-600",children:["$",parseFloat(s.totalDeductions).toLocaleString("es-MX",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"text-center p-3 bg-[#00a587]/10 rounded",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Neto a Pagar"}),e.jsxs("p",{className:"text-xl font-bold text-[#00a587]",children:["$",parseFloat(s.totalNet).toLocaleString("es-MX",{minimumFractionDigits:2})]})]})]})]})]})]})]}),!s.pdfGenerated&&e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>$.mutate(s.id),disabled:$.isPending,children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"Generar PDF"]}),s.pdfGenerated&&e.jsxs(e.Fragment,{children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>se(s.id),children:[e.jsx(je,{className:"w-4 h-4 mr-1"}),"Descargar"]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>ae(s.id),className:"bg-[#00a587] text-white hover:bg-[#067f5f]",children:[e.jsx(ye,{className:"w-4 h-4 mr-1"}),"Imprimir"]})]})]})]})},s.id))})})]})]})})}export{be as default};
