import{ce as L,cf as c,k as E,az as w,l as M,ae as k,u as q,af as A,a2 as P,ag as S,j as a,aX as v,B as o,A as y,f as z,g as D,h as T,ab as U,i as Q,ai as I,aw as K,M as V,ay as $,aj as d,ak as u,al as m,am as x,O as j,aF as p,an as h,d as B,ap as G,aq as H}from"./index-D5qLf1ib.js";import{S as N}from"./skeleton-XQWc31Aw.js";const R=L({latitude:c().refine(r=>{const s=parseFloat(r);return!isNaN(s)&&s>=-90&&s<=90},{message:"La latitud debe ser un número entre -90 y 90"}),longitude:c().refine(r=>{const s=parseFloat(r);return!isNaN(s)&&s>=-180&&s<=180},{message:"La longitud debe ser un número entre -180 y 180"}),location:c().optional()}),J=()=>{const s=E().id,[O,i]=w(),{toast:g}=M(),b=k(),{data:t,isLoading:f}=q({queryKey:[`/api/assets/${s}`],enabled:!!s}),n=A({resolver:G(R),defaultValues:{latitude:"",longitude:"",location:""}});P.useEffect(()=>{t&&n.reset({latitude:t.latitude||"",longitude:t.longitude||"",location:t.location||""})},[t,n]);const l=S({mutationFn:e=>{const F=t||{};return H(`/api/assets/${s}`,"PUT",{...F,latitude:e.latitude,longitude:e.longitude,location:e.location})},onSuccess:()=>{b.invalidateQueries({queryKey:[`/api/assets/${s}`]}),b.invalidateQueries({queryKey:["/api/assets"]}),g({title:"Ubicación actualizada",description:"Las coordenadas del activo se han actualizado correctamente."}),i("/admin/assets/map")},onError:e=>{g({title:"Error",description:"Ha ocurrido un error al actualizar las coordenadas.",variant:"destructive"}),console.error("Error al actualizar coordenadas:",e)}}),C=e=>{l.mutate(e)};return f?a.jsx(v,{children:a.jsxs("div",{className:"container py-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),children:[a.jsx(y,{className:"mr-2 h-4 w-4"}),"Volver al Mapa"]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(N,{className:"h-8 w-96"}),a.jsx(N,{className:"h-64 w-full"})]})]})}):a.jsx(v,{children:a.jsxs("div",{className:"container py-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),children:[a.jsx(y,{className:"mr-2 h-4 w-4"}),"Volver al Mapa"]})}),a.jsxs(z,{className:"max-w-lg mx-auto",children:[a.jsxs(D,{children:[a.jsx(T,{className:"text-xl",children:"Editar Ubicación"}),a.jsxs(U,{children:["Activo: ",t==null?void 0:t.name]})]}),a.jsx(Q,{children:a.jsx(I,{...n,children:a.jsxs("form",{onSubmit:n.handleSubmit(C),className:"space-y-6",children:[a.jsxs(K,{className:"bg-blue-50 border-blue-200",children:[a.jsx(V,{className:"h-4 w-4 text-blue-600"}),a.jsx($,{className:"text-blue-700",children:"Ingresa las coordenadas de ubicación para este activo. Para México, la latitud suele ser positiva (norte) y la longitud negativa (oeste)."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(d,{control:n.control,name:"latitude",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Latitud"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: 19.432608",...e})}),a.jsx(p,{children:"Coordenada norte (+) / sur (-)"}),a.jsx(h,{})]})}),a.jsx(d,{control:n.control,name:"longitude",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Longitud"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: -99.133209",...e})}),a.jsx(p,{children:"Coordenada este (+) / oeste (-)"}),a.jsx(h,{})]})})]}),a.jsx(d,{control:n.control,name:"location",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Descripción de Ubicación"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: Cerca de la entrada principal",...e})}),a.jsx(p,{children:"Describe dónde se encuentra este activo dentro del parque"}),a.jsx(h,{})]})}),a.jsxs("div",{className:"flex items-center justify-end gap-4",children:[a.jsx(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),type:"button",children:"Cancelar"}),a.jsxs(o,{type:"submit",disabled:l.isPending,children:[l.isPending?"Guardando...":"Guardar Ubicación",a.jsx(B,{className:"ml-2 h-4 w-4"})]})]})]})})})]})]})})};export{J as default};
