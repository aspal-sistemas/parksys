import{Y as b,e as as,u as B,l as A,j as s,aI as F,C as n,c as d,a as j,b as m,ak as ts,z as $,H as O,J as E,K as U,N as u,I as ls,U as is,aK as rs,aj as ns,M as ds,aO as cs,aP as os,aQ as w,aR as k,aS as g,aT as xs,aU as M,aV as P,aW as T,aX as y,aY as hs,aZ as C,a_ as _,a$ as X,b0 as Y,X as z,b1 as js}from"./index-Dzu3mJf5.js";import{B as H}from"./BarChart-Bu_4ahC_.js";import{p as Q}from"./parseISO-CNPmwbB6.js";const V=["#00a587","#067f5f","#bcd256","#8498a5","#4CAF50","#FF6B6B","#4ECDC4","#45B7D1"],ms={estimation:"Estimaci칩n",manual_counter:"Contador Manual",event_based:"Basado en Eventos",entrance_control:"Control de Acceso"},us={sunny:"Soleado",cloudy:"Nublado",rainy:"Lluvioso",other:"Otro"};function Ns(){var L,R,K,I,q;const[N,G]=b.useState("all"),[f,J]=b.useState("30"),[W,Z]=b.useState("");as();const{data:o,isLoading:ss}=B({queryKey:["/api/visitor-counts/dashboard",N,f],queryFn:async()=>{const t=new URLSearchParams;if(N!=="all"&&t.append("parkId",N),f!=="all"){const D=parseInt(f),l=A(js(new Date,D),"yyyy-MM-dd");t.append("startDate",l)}t.append("limit","1000");const v=await(await fetch(`/api/visitor-counts/dashboard?${t}`)).json();return console.log("游깷 [FRONTEND] Datos recibidos del dashboard:",v),v}}),{data:S}=B({queryKey:["/api/parks"]}),x=(o==null?void 0:o.records)||[],e=(o==null?void 0:o.metrics)||null,es=(o==null?void 0:o.parkSummaries)||[],h=b.useMemo(()=>{if(!x||!Array.isArray(x))return{daily:[],parks:[],methods:[],weather:[]};const t=x.reduce((l,a)=>{const c=a.date,r=l.find(p=>p.date===c);return r?(r.visitors+=a.totalVisitors,r.adults+=a.adults,r.children+=a.children,r.seniors+=a.seniors,r.pets+=a.pets):l.push({date:c,visitors:a.totalVisitors,adults:a.adults,children:a.children,seniors:a.seniors,pets:a.pets,formattedDate:A(Q(c),"dd/MM",{locale:z})}),l},[]).sort((l,a)=>l.date.localeCompare(a.date)),i=x.reduce((l,a)=>{const c=l.find(r=>r.parkName===a.parkName);return c?(c.visitors+=a.totalVisitors,c.records+=1):l.push({parkName:a.parkName,visitors:a.totalVisitors,records:1}),l},[]).sort((l,a)=>a.visitors-l.visitors),v=x.reduce((l,a)=>{const c=ms[a.countingMethod]||a.countingMethod,r=l.find(p=>p.method===c);return r?(r.count+=1,r.visitors+=a.totalVisitors):l.push({method:c,count:1,visitors:a.totalVisitors}),l},[]),D=x.reduce((l,a)=>{const c=us[a.weather]||a.weather,r=l.find(p=>p.weather===c);return r?(r.count+=1,r.visitors+=a.totalVisitors):l.push({weather:c,count:1,visitors:a.totalVisitors}),l},[]);return{daily:t,parks:i,methods:v,weather:D}},[x]);return ss?s.jsx(F,{children:s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Panel de Visitantes"})}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((t,i)=>s.jsx(n,{className:"animate-pulse",children:s.jsxs(d,{className:"p-6",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),s.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})},i))})]})}):s.jsx(F,{children:s.jsxs("div",{className:"p-6 space-y-6",children:[s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Panel de Visitantes"}),s.jsx("p",{className:"text-gray-600",children:"An치lisis y estad칤sticas del conteo de visitantes"})]})}),s.jsxs(n,{children:[s.jsx(j,{children:s.jsxs(m,{className:"flex items-center",children:[s.jsx(ts,{className:"w-5 h-5 mr-2"}),"Filtros"]})}),s.jsx(d,{children:s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parque"}),s.jsxs($,{value:N,onValueChange:G,children:[s.jsx(O,{children:s.jsx(E,{placeholder:"Seleccionar parque"})}),s.jsxs(U,{children:[s.jsx(u,{value:"all",children:"Todos los parques"}),S&&Array.isArray(S)&&S.map(t=>s.jsx(u,{value:t.id.toString(),children:t.name},t.id))]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Per칤odo"}),s.jsxs($,{value:f,onValueChange:J,children:[s.jsx(O,{children:s.jsx(E,{placeholder:"Seleccionar per칤odo"})}),s.jsxs(U,{children:[s.jsx(u,{value:"7",children:"칔ltimos 7 d칤as"}),s.jsx(u,{value:"30",children:"칔ltimos 30 d칤as"}),s.jsx(u,{value:"90",children:"칔ltimos 90 d칤as"}),s.jsx(u,{value:"all",children:"Todo el tiempo"})]})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),s.jsx(ls,{placeholder:"Buscar en notas...",value:W,onChange:t=>Z(t.target.value)})]})]})})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(n,{children:s.jsx(d,{className:"p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Visitantes"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:((L=e==null?void 0:e.totalVisitors)==null?void 0:L.toLocaleString())||0})]}),s.jsx("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:s.jsx(is,{className:"w-6 h-6 text-green-600"})})]})})}),s.jsx(n,{children:s.jsx(d,{className:"p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Promedio Diario"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(e==null?void 0:e.avgDailyVisitors)||0})]}),s.jsx("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(rs,{className:"w-6 h-6 text-blue-600"})})]})})}),s.jsx(n,{children:s.jsx(d,{className:"p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Registros"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(e==null?void 0:e.totalRecords)||0})]}),s.jsx("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(ns,{className:"w-6 h-6 text-purple-600"})})]})})}),s.jsx(n,{children:s.jsx(d,{className:"p-6",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Parques Activos"}),s.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(e==null?void 0:e.uniqueParks)||0})]}),s.jsx("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:s.jsx(ds,{className:"w-6 h-6 text-orange-600"})})]})})})]}),s.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[s.jsx(n,{children:s.jsx(d,{className:"p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Adultos"}),s.jsx("p",{className:"text-xl font-bold text-gray-900",children:((R=e==null?void 0:e.totalAdults)==null?void 0:R.toLocaleString())||0}),s.jsxs("p",{className:"text-xs text-gray-500",children:[e!=null&&e.totalVisitors?Math.round(e.totalAdults/e.totalVisitors*100):0,"% del total"]})]})})}),s.jsx(n,{children:s.jsx(d,{className:"p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Ni침os"}),s.jsx("p",{className:"text-xl font-bold text-gray-900",children:((K=e==null?void 0:e.totalChildren)==null?void 0:K.toLocaleString())||0}),s.jsxs("p",{className:"text-xs text-gray-500",children:[e!=null&&e.totalVisitors?Math.round(e.totalChildren/e.totalVisitors*100):0,"% del total"]})]})})}),s.jsx(n,{children:s.jsx(d,{className:"p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Adultos Mayores"}),s.jsx("p",{className:"text-xl font-bold text-gray-900",children:((I=e==null?void 0:e.totalSeniors)==null?void 0:I.toLocaleString())||0}),s.jsxs("p",{className:"text-xs text-gray-500",children:[e!=null&&e.totalVisitors?Math.round(e.totalSeniors/e.totalVisitors*100):0,"% del total"]})]})})}),s.jsx(n,{children:s.jsx(d,{className:"p-4",children:s.jsxs("div",{className:"text-center",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Mascotas"}),s.jsx("p",{className:"text-xl font-bold text-gray-900",children:((q=e==null?void 0:e.totalPets)==null?void 0:q.toLocaleString())||0}),s.jsx("p",{className:"text-xs text-gray-500",children:"Acompa침antes"})]})})})]}),s.jsxs(cs,{defaultValue:"trends",className:"w-full",children:[s.jsxs(os,{className:"grid w-full grid-cols-4",children:[s.jsx(w,{value:"trends",children:"Tendencias"}),s.jsx(w,{value:"parks",children:"Por Parques"}),s.jsx(w,{value:"methods",children:"M칠todos"}),s.jsx(w,{value:"summary",children:"Resumen"})]}),s.jsxs(k,{value:"trends",className:"space-y-4",children:[s.jsxs(n,{children:[s.jsx(j,{children:s.jsx(m,{children:"Tendencia de Visitantes"})}),s.jsx(d,{children:s.jsx("div",{className:"h-80",children:s.jsx(g,{width:"100%",height:"100%",children:s.jsxs(xs,{data:h.daily,children:[s.jsx(M,{strokeDasharray:"3 3"}),s.jsx(P,{dataKey:"formattedDate"}),s.jsx(T,{}),s.jsx(y,{}),s.jsx(hs,{type:"monotone",dataKey:"visitors",stackId:"1",stroke:"#00a587",fill:"#00a587",fillOpacity:.6})]})})})})]}),s.jsxs(n,{children:[s.jsx(j,{children:s.jsx(m,{children:"Desglose Demogr치fico por D칤a"})}),s.jsx(d,{children:s.jsx("div",{className:"h-80",children:s.jsx(g,{width:"100%",height:"100%",children:s.jsxs(H,{data:h.daily,children:[s.jsx(M,{strokeDasharray:"3 3"}),s.jsx(P,{dataKey:"formattedDate"}),s.jsx(T,{}),s.jsx(y,{}),s.jsx(C,{dataKey:"adults",stackId:"a",fill:"#00a587",name:"Adultos"}),s.jsx(C,{dataKey:"children",stackId:"a",fill:"#bcd256",name:"Ni침os"}),s.jsx(C,{dataKey:"seniors",stackId:"a",fill:"#8498a5",name:"Adultos Mayores"})]})})})})]})]}),s.jsx(k,{value:"parks",children:s.jsxs(n,{children:[s.jsx(j,{children:s.jsx(m,{children:"Visitantes por Parque"})}),s.jsx(d,{children:s.jsx("div",{className:"h-80",children:s.jsx(g,{width:"100%",height:"100%",children:s.jsxs(H,{data:h.parks,layout:"horizontal",children:[s.jsx(M,{strokeDasharray:"3 3"}),s.jsx(P,{type:"number"}),s.jsx(T,{dataKey:"parkName",type:"category",width:150}),s.jsx(y,{}),s.jsx(C,{dataKey:"visitors",fill:"#00a587"})]})})})})]})}),s.jsx(k,{value:"methods",children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[s.jsxs(n,{children:[s.jsx(j,{children:s.jsx(m,{children:"M칠todos de Conteo"})}),s.jsx(d,{children:s.jsx("div",{className:"h-64",children:s.jsx(g,{width:"100%",height:"100%",children:s.jsxs(_,{children:[s.jsx(X,{data:h.methods,cx:"50%",cy:"50%",labelLine:!1,label:({method:t,percent:i})=>`${t} (${(i*100).toFixed(0)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:h.methods.map((t,i)=>s.jsx(Y,{fill:V[i%V.length]},`cell-${i}`))}),s.jsx(y,{})]})})})})]}),s.jsxs(n,{children:[s.jsx(j,{children:s.jsx(m,{children:"Condiciones Clim치ticas"})}),s.jsx(d,{children:s.jsx("div",{className:"h-64",children:s.jsx(g,{width:"100%",height:"100%",children:s.jsxs(_,{children:[s.jsx(X,{data:h.weather,cx:"50%",cy:"50%",labelLine:!1,label:({weather:t,percent:i})=>`${t} (${(i*100).toFixed(0)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:h.weather.map((t,i)=>s.jsx(Y,{fill:V[i%V.length]},`cell-${i}`))}),s.jsx(y,{})]})})})})]})]})}),s.jsx(k,{value:"summary",children:s.jsxs(n,{children:[s.jsx(j,{children:s.jsx(m,{children:"Resumen por Parques"})}),s.jsx(d,{children:s.jsx("div",{className:"space-y-4",children:es.map((t,i)=>s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsxs("div",{className:"flex items-center space-x-4",children:[s.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-sm font-bold text-green-600",children:i+1})}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium text-gray-900",children:t.parkName}),s.jsxs("p",{className:"text-sm text-gray-500",children:["칔ltimo conteo: ",A(Q(t.lastCountDate),"dd/MM/yyyy",{locale:z})]})]})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("p",{className:"text-lg font-bold text-gray-900",children:t.totalVisitors.toLocaleString()}),s.jsxs("p",{className:"text-sm text-gray-500",children:[t.avgDailyVisitors," promedio diario (",t.totalRecords," registros)"]})]})]},t.parkId))})})]})})]})]})})}export{Ns as default};
