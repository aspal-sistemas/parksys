import{a5 as r,d as J,am as _,e as X,R as P,a7 as Y,u as W,a8 as ee,Y as se,j as e,aI as z,cA as D,aB as ae,B as E,A as k,aa as ie,aO as re,aP as ne,aQ as w,aR as C,C as p,a as f,b as v,a3 as b,c as N,ab as n,ac as l,ad as c,ae as o,I as m,aA as t,af as d,z as A,H as M,J as O,K as H,N as h,bg as Z,az as le,ag as ce,O as R,bH as oe,bz as te,ah as de,bA as $}from"./index-Dzu3mJf5.js";import{H as me}from"./Helmet-BWphdh6I.js";const xe=r.object({commonName:r.string().min(2,{message:"El nombre común debe tener al menos 2 caracteres."}),scientificName:r.string().min(2,{message:"El nombre científico debe tener al menos 2 caracteres."}),family:r.string().min(2,{message:"La familia debe tener al menos 2 caracteres."}),origin:r.string({required_error:"Selecciona el origen de la especie."}),growthRate:r.string({required_error:"Selecciona la tasa de crecimiento."}),imageUrl:r.string().optional(),isEndangered:r.boolean().default(!1),description:r.string().min(10,{message:"La descripción debe tener al menos 10 caracteres."}).max(1e3,{message:"La descripción no debe exceder los 1000 caracteres."}),ecologicalBenefits:r.string().optional(),maintenanceRequirements:r.string().optional(),lifespan:r.string().optional(),climateZone:r.string().optional(),soilRequirements:r.string().optional(),waterRequirements:r.string().optional(),sunRequirements:r.string().optional(),ornamentalValue:r.string().optional(),commonUses:r.string().optional()});function he(){const{id:j}=J(),[,S]=_(),{toast:u}=X(),[U,T]=P.useState(null),[F,L]=P.useState(!1),i=Y({resolver:de(xe),defaultValues:{commonName:"",scientificName:"",family:"",origin:"Nativo",growthRate:"Medio",imageUrl:"",isEndangered:!1,description:"",ecologicalBenefits:"",maintenanceRequirements:"",lifespan:"",climateZone:"",soilRequirements:"",waterRequirements:"",sunRequirements:"",ornamentalValue:"",commonUses:""}}),{data:a,isLoading:G}=W({queryKey:[`/api/tree-species/${j}`],queryFn:async()=>{const s=await fetch(`/api/tree-species/${j}`);if(!s.ok)throw new Error("Error al cargar los detalles de la especie arbórea");return s.json()}}),y=ee({mutationFn:async s=>{const x=await fetch(`/api/tree-species/${j}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!x.ok){const g=await x.json();throw new Error(g.message||"Error al actualizar la especie arbórea")}return x.json()},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/tree-species"]}),$.invalidateQueries({queryKey:[`/api/tree-species/${j}`]}),u({title:"Especie actualizada",description:"La especie ha sido actualizada exitosamente en el catálogo."}),S(`/admin/trees/catalog/${j}`)},onError:s=>{u({title:"Error",description:s.message||"Ocurrió un error al actualizar la especie arbórea.",variant:"destructive"})}});se.useEffect(()=>{var s;a&&(i.reset({commonName:a.commonName||"",scientificName:a.scientificName||"",family:a.family||"",origin:a.origin||"Nativo",growthRate:a.growthRate||"Medio",imageUrl:a.imageUrl||a.photoUrl||"",isEndangered:a.isEndangered||!1,description:a.description||"",ecologicalBenefits:a.ecologicalBenefits||"",maintenanceRequirements:a.maintenanceRequirements||"",lifespan:((s=a.lifespan)==null?void 0:s.toString())||"",climateZone:a.climateZone||"",soilRequirements:a.soilRequirements||"",waterRequirements:a.waterRequirements||"",sunRequirements:a.sunRequirements||"",ornamentalValue:a.ornamentalValue||"",commonUses:a.commonUses||""}),a.photoUrl&&T(a.photoUrl))},[a,i]);const K=async s=>{var g;const x=(g=s.target.files)==null?void 0:g[0];if(x){if(!["image/jpeg","image/png","image/svg+xml"].includes(x.type)){u({title:"Formato no válido",description:"Solo se permiten archivos JPEG, PNG o SVG.",variant:"destructive"});return}if(x.size>5*1024*1024){u({title:"Archivo muy grande",description:"El tamaño máximo permitido es 5MB.",variant:"destructive"});return}L(!0);try{const q=new FormData;q.append("photo",x);const B=await fetch("/api/tree-species/upload-photo",{method:"POST",body:q});if(!B.ok)throw new Error("Error al subir la foto");const I=await B.json();i.setValue("imageUrl",I.photoUrl),T(I.photoUrl),u({title:"Foto subida exitosamente",description:"La foto se ha guardado y se usará como imagen de la especie."})}catch{u({title:"Error",description:"No se pudo subir la foto. Inténtalo de nuevo.",variant:"destructive"})}finally{L(!1)}}};function Q(s){y.mutate(s)}const V=()=>{S(`/admin/trees/catalog/${j}`)};return G?e.jsx(z,{children:e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsx("div",{className:"flex justify-center items-center min-h-[60vh]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"h-12 w-12 animate-spin text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"Cargando datos de la especie..."}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Por favor espere un momento"})]})})})}):e.jsxs(z,{children:[e.jsxs(me,{children:[e.jsx("title",{children:"Editar Especie Arbórea | ParquesMX"}),e.jsx("meta",{name:"description",content:"Formulario para editar una especie arbórea del catálogo"})]}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-green-800 flex items-center",children:[e.jsx(ae,{className:"mr-2 h-8 w-8"}),"Editar Especie Arbórea"]}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[a==null?void 0:a.commonName," ",e.jsxs("span",{className:"italic",children:["(",a==null?void 0:a.scientificName,")"]})]})]}),e.jsxs(E,{variant:"outline",onClick:V,className:"flex items-center",children:[e.jsx(k,{className:"mr-2 h-4 w-4"})," Volver a Detalles"]})]}),e.jsx(ie,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(Q),className:"space-y-6",children:[e.jsxs(re,{defaultValue:"informacion-basica",className:"w-full",children:[e.jsxs(ne,{className:"mb-4",children:[e.jsx(w,{value:"informacion-basica",children:"Información Básica"}),e.jsx(w,{value:"descripcion-detalles",children:"Descripción y Detalles"}),e.jsx(w,{value:"requisitos-cultivo",children:"Requisitos de Cultivo"})]}),e.jsx(C,{value:"informacion-basica",children:e.jsxs(p,{children:[e.jsxs(f,{children:[e.jsx(v,{children:"Información Básica"}),e.jsx(b,{children:"Información principal de la especie arbórea"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:i.control,name:"commonName",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Nombre Común *"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Ahuehuete",...s})}),e.jsx(t,{children:"Nombre por el que se conoce comúnmente a la especie."}),e.jsx(d,{})]})}),e.jsx(n,{control:i.control,name:"scientificName",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Nombre Científico *"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Taxodium mucronatum",className:"italic",...s})}),e.jsx(t,{children:"Nombre científico de la especie en formato latinizado."}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:i.control,name:"family",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Familia *"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Cupressaceae",...s})}),e.jsx(t,{children:"Familia taxonómica a la que pertenece la especie."}),e.jsx(d,{})]})}),e.jsx(n,{control:i.control,name:"origin",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Origen *"}),e.jsxs(A,{onValueChange:s.onChange,defaultValue:s.value,value:s.value,children:[e.jsx(o,{children:e.jsx(M,{children:e.jsx(O,{placeholder:"Selecciona el origen"})})}),e.jsxs(H,{children:[e.jsx(h,{value:"Nativo",children:"Nativo"}),e.jsx(h,{value:"Introducido",children:"Introducido"}),e.jsx(h,{value:"Híbrido",children:"Híbrido"})]})]}),e.jsx(t,{children:"Indica si es una especie nativa o introducida."}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:i.control,name:"growthRate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Tasa de Crecimiento *"}),e.jsxs(A,{onValueChange:s.onChange,defaultValue:s.value,value:s.value,children:[e.jsx(o,{children:e.jsx(M,{children:e.jsx(O,{placeholder:"Selecciona tasa de crecimiento"})})}),e.jsxs(H,{children:[e.jsx(h,{value:"Lento",children:"Lento"}),e.jsx(h,{value:"Medio",children:"Medio"}),e.jsx(h,{value:"Rápido",children:"Rápido"})]})]}),e.jsx(t,{children:"Velocidad promedio de crecimiento de la especie."}),e.jsx(d,{})]})}),e.jsx(n,{control:i.control,name:"lifespan",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Esperanza de Vida (años)"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. 100",...s,value:s.value||""})}),e.jsx(t,{children:"Tiempo de vida promedio de la especie en años."}),e.jsx(d,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsxs(p,{className:"p-4 border-dashed",children:[e.jsxs(f,{className:"pb-2",children:[e.jsxs(v,{className:"flex items-center text-lg",children:[e.jsx(Z,{className:"mr-2 h-5 w-5"}),"Fotografía de la Especie"]}),e.jsx(b,{children:"Sube una foto que se usará como icono en la lista y en la página pública"})]}),e.jsxs(N,{className:"space-y-4",children:[U&&e.jsxs("div",{className:"mb-4",children:[e.jsx("img",{src:U,alt:"Especie arbórea",className:"w-32 h-32 object-cover rounded-lg border-2 border-green-300"}),e.jsxs("p",{className:"text-sm text-green-600 mt-2 flex items-center",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Esta imagen se usará como icono en las amenidades"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"photo-upload",className:"block text-sm font-medium mb-2",children:"Opción 1: Subir fotografía desde tu dispositivo"}),e.jsx("input",{id:"photo-upload",type:"file",accept:"image/jpeg,image/png,image/svg+xml",onChange:K,disabled:F,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-green-50 file:text-green-700 hover:file:bg-green-100"}),F&&e.jsxs("p",{className:"text-sm text-blue-600 mt-2 flex items-center",children:[e.jsx(le,{className:"animate-spin h-4 w-4 mr-1"}),"Subiendo foto..."]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-background px-2 text-muted-foreground",children:"O"})})]}),e.jsx(n,{control:i.control,name:"imageUrl",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Opción 2: URL de imagen externa"}),e.jsx(o,{children:e.jsx(m,{placeholder:"https://ejemplo.com/imagen.jpg",...s,value:s.value||""})}),e.jsx(t,{children:"URL de una imagen externa representativa de la especie."}),e.jsx(d,{})]})})]})]})}),e.jsx(n,{control:i.control,name:"isEndangered",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(o,{children:e.jsx(ce,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(c,{children:"Especie en peligro de extinción"}),e.jsx(t,{children:"Marca esta casilla si la especie está clasificada como amenazada o en peligro."})]})]})})]})]})}),e.jsx(C,{value:"descripcion-detalles",children:e.jsxs(p,{children:[e.jsxs(f,{children:[e.jsx(v,{children:"Descripción y Detalles"}),e.jsx(b,{children:"Información detallada sobre la especie arbórea"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx(n,{control:i.control,name:"description",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Descripción General *"}),e.jsx(o,{children:e.jsx(R,{placeholder:"Describe las características principales de la especie...",className:"min-h-[100px]",...s})}),e.jsx(t,{children:"Descripción detallada de la especie, incluyendo características físicas, hábitat y distribución."}),e.jsx(d,{})]})}),e.jsx(n,{control:i.control,name:"ecologicalBenefits",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Beneficios Ecológicos"}),e.jsx(o,{children:e.jsx(R,{placeholder:"Beneficios ambientales que proporciona la especie...",className:"min-h-[80px]",...s,value:s.value||""})}),e.jsx(t,{children:"Beneficios que la especie aporta al ecosistema, como purificación del aire, control de erosión, etc."}),e.jsx(d,{})]})}),e.jsx(n,{control:i.control,name:"maintenanceRequirements",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Requisitos de Mantenimiento"}),e.jsx(o,{children:e.jsx(R,{placeholder:"Cuidados y mantenimiento que requiere la especie...",className:"min-h-[80px]",...s,value:s.value||""})}),e.jsx(t,{children:"Información sobre poda, fertilización, control de plagas y otros cuidados necesarios."}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:i.control,name:"ornamentalValue",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Valor Ornamental"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Alto - floración espectacular",...s,value:s.value||""})}),e.jsx(t,{children:"Valor decorativo de la especie."}),e.jsx(d,{})]})}),e.jsx(n,{control:i.control,name:"commonUses",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Usos Comunes"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Ornamental, sombra, madera",...s,value:s.value||""})}),e.jsx(t,{children:"Principales usos de la especie."}),e.jsx(d,{})]})})]})]})]})}),e.jsx(C,{value:"requisitos-cultivo",children:e.jsxs(p,{children:[e.jsxs(f,{children:[e.jsx(v,{children:"Requisitos de Cultivo"}),e.jsx(b,{children:"Condiciones ambientales ideales para el crecimiento"})]}),e.jsxs(N,{className:"space-y-4",children:[e.jsx(n,{control:i.control,name:"climateZone",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Zona Climática"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Templado a subtropical",...s,value:s.value||""})}),e.jsx(t,{children:"Tipo de clima donde mejor se desarrolla la especie."}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:i.control,name:"soilRequirements",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Requisitos de Suelo"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Bien drenado, fértil",...s,value:s.value||""})}),e.jsx(t,{children:"Tipo de suelo preferido para la especie."}),e.jsx(d,{})]})}),e.jsx(n,{control:i.control,name:"waterRequirements",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Requisitos de Agua"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Moderado, resistente a sequía",...s,value:s.value||""})}),e.jsx(t,{children:"Necesidades hídricas de la especie."}),e.jsx(d,{})]})})]}),e.jsx(n,{control:i.control,name:"sunRequirements",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Requisitos de Luz Solar"}),e.jsx(o,{children:e.jsx(m,{placeholder:"Ej. Pleno sol, sombra parcial",...s,value:s.value||""})}),e.jsx(t,{children:"Cantidad de luz solar que necesita la especie."}),e.jsx(d,{})]})})]})]})})]}),e.jsx(p,{children:e.jsxs(oe,{className:"flex justify-between",children:[e.jsxs(E,{type:"button",variant:"outline",onClick:V,className:"flex items-center",children:[e.jsx(k,{className:"mr-2 h-4 w-4"}),"Cancelar"]}),e.jsxs(E,{type:"submit",disabled:y.isPending,className:"flex items-center bg-green-600 hover:bg-green-700",children:[y.isPending?e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}):e.jsx(te,{className:"mr-2 h-4 w-4"}),"Guardar Cambios"]})]})})]})})]})]})}export{he as default};
