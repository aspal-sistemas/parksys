import{k as Z,az as ee,l as se,ae,a2 as v,u as A,ag as M,j as e,aX as O,B as d,A as ie,w as ne,x as re,bh as U,y as te,z as le,I as ce,J as de,N as u,Q as C,V as S,W as w,Y as I,_ as x,c8 as q,O as D,bC as oe,f as E,g as T,h as k,M as ue,ab as P,i as K,bH as me,bI as xe,bJ as V,bK as h,bL as he,bM as j,o as je,bq as pe,bn as ge,a$ as ve}from"./index-D5qLf1ib.js";function Ne(){var F,$;const H=Z(),n=Number(H.id),[,Q]=ee(),{toast:o}=se(),L=ae(),[B,m]=v.useState(!1),[fe,R]=v.useState(null),[t,G]=v.useState("todas"),f={todas:"Todas",deportivas:"Deportivas",recreativas:"Recreativas",culturales:"Culturales",servicios:"Servicios",naturaleza:"Naturaleza",infantiles:"Infantiles",accesibilidad:"Accesibilidad"},[i,l]=v.useState({amenityId:0,moduleName:"",surfaceArea:0,status:"activo",description:""}),{data:c}=A({queryKey:[`/api/parks/${n}`],enabled:!!n}),{data:r,isLoading:J}=A({queryKey:[`/api/parks/${n}/amenities`],enabled:!!n}),{data:b}=A({queryKey:["/api/amenities/dashboard"]}),W=a=>{const s=a.toLowerCase();return s.includes("cancha")||s.includes("campo")||s.includes("pista")||s.includes("deportivo")||s.includes("futbol")||s.includes("basquet")||s.includes("tenis")||s.includes("voley")||s.includes("gimnasio")||s.includes("atletismo")||s.includes("ciclismo")?"deportivas":s.includes("juego")||s.includes("infantil")||s.includes("niños")||s.includes("columpios")||s.includes("resbaladilla")||s.includes("sube y baja")?"infantiles":s.includes("teatro")||s.includes("auditorio")||s.includes("biblioteca")||s.includes("museo")||s.includes("cultural")||s.includes("exposicion")?"culturales":s.includes("baño")||s.includes("sanitario")||s.includes("estacionamiento")||s.includes("seguridad")||s.includes("informacion")||s.includes("wifi")||s.includes("agua")||s.includes("bebedero")||s.includes("basura")?"servicios":s.includes("jardin")||s.includes("arbol")||s.includes("flores")||s.includes("sendero")||s.includes("bosque")||s.includes("lago")||s.includes("naturaleza")||s.includes("ecologico")?"naturaleza":s.includes("accesible")||s.includes("discapacidad")||s.includes("rampa")||s.includes("braille")||s.includes("inclus")?"accesibilidad":"recreativas"},p=((F=b==null?void 0:b.allAmenities)==null?void 0:F.filter(a=>!(r!=null&&r.find(s=>s.amenityId===a.id))))||[],g=t==="todas"?r||[]:(r||[]).filter(a=>W(a.amenityName)===t),N=M({mutationFn:async a=>{const s=await fetch(`/api/parks/${n}/amenities`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!s.ok){const y=await s.json();throw new Error(y.message||"Error al asignar amenidad")}return s.json()},onSuccess:()=>{o({title:"Amenidad asignada",description:"La amenidad se ha asignado correctamente al parque."}),L.invalidateQueries({queryKey:[`/api/parks/${n}/amenities`]}),m(!1),X()},onError:a=>{o({title:"Error",description:a.message,variant:"destructive"})}}),z=M({mutationFn:async a=>{const s=await fetch(`/api/parks/${n}/amenities/${a}`,{method:"DELETE"});if(!s.ok){const y=await s.json();throw new Error(y.message||"Error al remover amenidad")}},onSuccess:()=>{o({title:"Amenidad removida",description:"La amenidad se ha removido correctamente del parque."}),L.invalidateQueries({queryKey:[`/api/parks/${n}/amenities`]})},onError:a=>{o({title:"Error",description:a.message,variant:"destructive"})}}),X=()=>{l({amenityId:0,moduleName:"",surfaceArea:0,status:"activo",description:""}),R(null)},Y=()=>{if(!i.amenityId){o({title:"Error",description:"Por favor selecciona una amenidad",variant:"destructive"});return}N.mutate(i)},_=a=>{confirm("¿Estás seguro de que quieres remover esta amenidad del parque?")&&z.mutate(a)};return J?e.jsx(O,{title:"Gestión de Amenidades",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando amenidades..."})]})})}):e.jsx(O,{title:"Gestión de Amenidades",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(d,{variant:"outline",onClick:()=>Q(`/admin/parks/${n}`),children:[e.jsx(ie,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900",children:["Amenidades de ",c==null?void 0:c.name]}),e.jsx("p",{className:"text-gray-600",children:"Gestiona las amenidades instaladas en este parque"})]})]}),e.jsxs(ne,{open:B,onOpenChange:m,children:[e.jsx(re,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Asignar Amenidad"]})}),e.jsxs(te,{className:"max-w-md",children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Asignar Nueva Amenidad"}),e.jsx(de,{children:"Selecciona una amenidad para agregar a este parque"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"amenity",children:"Amenidad"}),e.jsxs(C,{value:i.amenityId.toString(),onValueChange:a=>l({...i,amenityId:Number(a)}),children:[e.jsx(S,{children:e.jsx(w,{placeholder:"Selecciona una amenidad"})}),e.jsx(I,{children:p.map(a=>e.jsx(x,{value:a.id.toString(),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(q,{name:a.icon||"default",iconType:a.customIconUrl?"custom":"system",customIconUrl:a.customIconUrl,size:20}),e.jsx("span",{children:a.name})]})},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"moduleName",children:"Nombre del Módulo (Opcional)"}),e.jsx(D,{id:"moduleName",value:i.moduleName,onChange:a=>l({...i,moduleName:a.target.value}),placeholder:"Ej: Cancha Principal, Área Norte..."})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"surfaceArea",children:"Área (m²)"}),e.jsx(D,{id:"surfaceArea",type:"number",value:i.surfaceArea,onChange:a=>l({...i,surfaceArea:Number(a.target.value)}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"status",children:"Estado"}),e.jsxs(C,{value:i.status,onValueChange:a=>l({...i,status:a}),children:[e.jsx(S,{children:e.jsx(w,{})}),e.jsxs(I,{children:[e.jsx(x,{value:"activo",children:"Activo"}),e.jsx(x,{value:"mantenimiento",children:"En Mantenimiento"}),e.jsx(x,{value:"inactivo",children:"Inactivo"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"description",children:"Descripción (Opcional)"}),e.jsx(D,{id:"description",value:i.description,onChange:a=>l({...i,description:a.target.value}),placeholder:"Descripción adicional..."})]})]}),e.jsxs(oe,{children:[e.jsx(d,{variant:"outline",onClick:()=>m(!1),children:"Cancelar"}),e.jsx(d,{onClick:Y,disabled:N.isPending,children:N.isPending?"Asignando...":"Asignar"})]})]})]})]}),c&&e.jsx(E,{children:e.jsxs(T,{children:[e.jsxs(k,{className:"flex items-center space-x-2",children:[e.jsx(ue,{className:"w-5 h-5"}),e.jsx("span",{children:c.name})]}),e.jsxs(P,{children:[c.address," • ",($=c.area)==null?void 0:$.toLocaleString()," m²"]})]})}),e.jsxs(E,{children:[e.jsx(T,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Amenidades, Instalaciones y Servicios"}),e.jsxs(P,{children:[g.length," de ",(r==null?void 0:r.length)||0," total"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(u,{htmlFor:"category-filter",className:"text-sm font-medium",children:"Filtrar por:"}),e.jsxs(C,{value:t,onValueChange:G,children:[e.jsx(S,{id:"category-filter",className:"w-40",children:e.jsx(w,{})}),e.jsx(I,{children:Object.entries(f).map(([a,s])=>e.jsx(x,{value:a,children:s},a))})]})]})]})}),e.jsx(K,{children:g&&g.length>0?e.jsxs(me,{children:[e.jsx(xe,{children:e.jsxs(V,{children:[e.jsx(h,{children:"Amenidad"}),e.jsx(h,{children:"Módulo"}),e.jsx(h,{children:"Área (m²)"}),e.jsx(h,{children:"Estado"}),e.jsx(h,{children:"Acciones"})]})}),e.jsx(he,{children:g.map(a=>e.jsxs(V,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(q,{name:a.amenityIcon||"default",iconType:a.amenityIcon==="custom"?"custom":"system",customIconUrl:a.customIconUrl||null,size:30}),e.jsx("span",{className:"font-medium",children:a.amenityName})]})}),e.jsx(j,{children:a.moduleName||"Sin especificar"}),e.jsx(j,{children:a.surfaceArea?a.surfaceArea.toLocaleString():"—"}),e.jsx(j,{children:e.jsx(je,{variant:a.status==="activo"?"default":a.status==="mantenimiento"?"secondary":"destructive",children:a.status||"activo"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>{o({title:"Próximamente",description:"La función de editar estará disponible pronto"})},children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>_(a.id),className:"text-red-600 hover:text-red-700",disabled:z.isPending,children:e.jsx(ge,{className:"w-4 h-4"})})]})})]},a.id))})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:t==="todas"?"Sin amenidades":`Sin amenidades ${f[t].toLowerCase()}`}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t==="todas"?"Este parque no tiene amenidades asignadas aún.":`No hay amenidades de la categoría "${f[t]}" en este parque.`}),e.jsx("div",{className:"mt-6",children:e.jsxs(d,{onClick:()=>m(!0),children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Asignar Primera Amenidad"]})})]})})]}),p.length>0&&e.jsxs(E,{children:[e.jsxs(T,{children:[e.jsxs(k,{children:["Amenidades Disponibles (",p.length,")"]}),e.jsx(P,{children:"Amenidades que puedes agregar a este parque"})]}),e.jsx(K,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:p.map(a=>e.jsxs("div",{className:"flex items-center space-x-2 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>{l({...i,amenityId:a.id}),m(!0)},children:[e.jsx(q,{name:a.icon||"default",iconType:a.icon==="custom"?"custom":"system",customIconUrl:a.customIconUrl||null,size:24}),e.jsx("span",{className:"text-sm font-medium truncate",children:a.name})]},a.id))})})]})]})})}export{Ne as default};
