import{am as Ae,Y as c,a6 as Se,u as _,a7 as De,ah as we,a8 as K,j as e,aI as G,B as r,at as J,cg as Re,D as Q,p as Fe,b2 as X,r as $,t as W,v as Y,aa as Oe,ab as j,ac as b,ad as g,ae as f,I as u,af as N,O as Ee,z as v,H as y,J as C,K as T,N as o,C as Z,a as ee,b as se,ak as Ve,c as ae,Z as Ie,az as Le,W as Ue,f as A,b7 as ke,au as Me,a5 as l,bG as I,ai as te}from"./index-Dzu3mJf5.js";const Pe=l.object({date:l.string().min(1,"La fecha es requerida"),description:l.string().min(1,"La descripción es requerida"),reference:l.string().optional(),type:l.enum(["manual","automatic"]),entries:l.array(l.object({account_id:l.number().min(1,"La cuenta es requerida"),debit:l.number().optional(),credit:l.number().optional(),description:l.string().optional()})).min(2,"Se requieren al menos 2 entradas")});function Be(){const[,ie]=Ae(),[h,ne]=c.useState(""),[S,re]=c.useState("all"),[D,ce]=c.useState("all"),[le,oe]=c.useState(""),[de,me]=c.useState(""),[ue,w]=c.useState(!1),[xe,L]=c.useState(!1),[d,he]=c.useState(null),[m,R]=c.useState(1);c.useState(!1);const F=15,U=c.useRef(null),k=Se(),{data:ze,isLoading:pe}=_({queryKey:["/api/accounting/journal-entries"],enabled:!0}),{data:M}=_({queryKey:["/api/accounting/categories"],enabled:!0}),i=De({resolver:we(Pe),defaultValues:{date:new Date().toISOString().split("T")[0],description:"",reference:"",type:"manual",entries:[{account_id:0,debit:0,credit:0,description:""},{account_id:0,debit:0,credit:0,description:""}]}}),P=K({mutationFn:s=>te("/api/accounting/journal-entries",{method:"POST",body:JSON.stringify(s)}),onSuccess:()=>{I({title:"Asiento contable creado",description:"El asiento contable ha sido registrado exitosamente."}),k.invalidateQueries({queryKey:["/api/accounting/journal-entries"]}),w(!1),i.reset()}}),O=K({mutationFn:()=>te("/api/accounting/journal-entries/generate-automatic",{method:"POST"}),onSuccess:()=>{I({title:"Asientos automáticos generados",description:"Los asientos contables automáticos han sido generados exitosamente."}),k.invalidateQueries({queryKey:["/api/accounting/journal-entries"]})}}),je=s=>{P.mutate(s)},be=()=>{O.mutate()},ge=()=>{ie("/admin/accounting/dashboard")},fe=s=>{he(s),L(!0)},Ne=()=>{const s=[["Número","Fecha","Descripción","Referencia","Tipo","Debe","Haber","Estado"],...z.map(a=>[a.number,a.date,a.description,a.reference,a.type,a.totalDebit.toFixed(2),a.totalCredit.toFixed(2),a.status])].map(a=>a.join(",")).join(`
`),n=new Blob([s],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(n),t.download=`asientos-contables-${new Date().toISOString().split("T")[0]}.csv`,t.click()},ve=()=>{var s;(s=U.current)==null||s.click()},ye=s=>{var t;const n=(t=s.target.files)==null?void 0:t[0];if(n){const a=new FileReader;a.onload=Te=>{var H;(H=Te.target)==null||H.result,I({title:"Archivo importado",description:"Los datos han sido procesados correctamente."})},a.readAsText(n)}},z=[{id:1,number:"AUTO-1751387935240",date:"30/6/2025",description:"Transacción automática: Pago de servicios básicos",reference:"TRANS-85",type:"automatico",totalDebit:13e3,totalCredit:13e3,status:"aprobado"},{id:2,number:"AUTO-1750978310917",date:"25/6/2025",description:"Transacción automática: Compra de materiales oficina",reference:"TRANS-64",type:"automatico",totalDebit:6700,totalCredit:6700,status:"aprobado"},{id:3,number:"AUTO-1750978160215",date:"25/6/2025",description:"Transacción automática: Mantenimiento de equipos",reference:"TRANS-63",type:"automatico",totalDebit:5e3,totalCredit:5e3,status:"aprobado"},{id:4,number:"AUTO-1750878717940",date:"24/6/2025",description:"Transacción automática: Ingreso por concesiones",reference:"TRANS-61",type:"automatico",totalDebit:6e3,totalCredit:6e3,status:"aprobado"},{id:5,number:"AUTO-1750681809469",date:"19/6/2025",description:"Transacción automática: Reposición Caja Chica",reference:"TRANS-51",type:"automatico",totalDebit:3500,totalCredit:3500,status:"aprobado"},{id:6,number:"AUTO-1750681808864",date:"19/6/2025",description:"Transacción automática: Gasto en combustible",reference:"TRANS-50",type:"automatico",totalDebit:2800,totalCredit:2800,status:"aprobado"},{id:7,number:"AUTO-1750681808262",date:"19/6/2025",description:"Transacción automática: Caja Chica: Autobuses",reference:"TRANS-47",type:"automatico",totalDebit:1200,totalCredit:1200,status:"aprobado"},{id:8,number:"MAN-1750681808263",date:"18/6/2025",description:"Registro manual: Ajuste de inventario",reference:"TRANS-46",type:"manual",totalDebit:4500,totalCredit:4500,status:"aprobado"},{id:9,number:"AUTO-1750681808264",date:"17/6/2025",description:"Transacción automática: Pago de nómina",reference:"TRANS-45",type:"automatico",totalDebit:28e3,totalCredit:28e3,status:"aprobado"},{id:10,number:"AUTO-1750681808265",date:"16/6/2025",description:"Transacción automática: Ingreso por eventos",reference:"TRANS-44",type:"automatico",totalDebit:15e3,totalCredit:15e3,status:"aprobado"},{id:11,number:"MAN-1750681808266",date:"15/6/2025",description:"Registro manual: Depreciación mensual",reference:"TRANS-43",type:"manual",totalDebit:3200,totalCredit:3200,status:"aprobado"},{id:12,number:"AUTO-1750681808267",date:"14/6/2025",description:"Transacción automática: Compra de herramientas",reference:"TRANS-42",type:"automatico",totalDebit:8500,totalCredit:8500,status:"aprobado"},{id:13,number:"AUTO-1750681808268",date:"13/6/2025",description:"Transacción automática: Pago de proveedores",reference:"TRANS-41",type:"automatico",totalDebit:12e3,totalCredit:12e3,status:"aprobado"},{id:14,number:"AUTO-1750681808269",date:"12/6/2025",description:"Transacción automática: Recibo de agua",reference:"TRANS-40",type:"automatico",totalDebit:5600,totalCredit:5600,status:"aprobado"},{id:15,number:"AUTO-1750681808270",date:"11/6/2025",description:"Transacción automática: Recibo de luz",reference:"TRANS-39",type:"automatico",totalDebit:9800,totalCredit:9800,status:"aprobado"},{id:16,number:"MAN-1750681808271",date:"10/6/2025",description:"Registro manual: Ajuste por diferencia cambiaria",reference:"TRANS-38",type:"manual",totalDebit:2300,totalCredit:2300,status:"aprobado"},{id:17,number:"AUTO-1750681808272",date:"09/6/2025",description:"Transacción automática: Venta de boletos",reference:"TRANS-37",type:"automatico",totalDebit:7500,totalCredit:7500,status:"aprobado"},{id:18,number:"AUTO-1750681808273",date:"08/6/2025",description:"Transacción automática: Ingreso por donaciones",reference:"TRANS-36",type:"automatico",totalDebit:4800,totalCredit:4800,status:"aprobado"}],q=z.filter(s=>{const n=s.description.toLowerCase().includes(h.toLowerCase())||s.reference.toLowerCase().includes(h.toLowerCase())||s.number.toLowerCase().includes(h.toLowerCase()),t=D==="all"||s.type===D,a=S==="all"||s.status===S;return n&&t&&a}),E=q.length,x=Math.ceil(E/F),V=(m-1)*F,B=V+F,Ce=q.slice(V,B),p=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:2}).format(s);return pe?e.jsx(G,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 w-64 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-96 bg-gray-200 rounded animate-pulse"})]})}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-16 bg-gray-200 rounded animate-pulse"},s))})]})}):e.jsx(G,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:ge,className:"flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:"Regresar"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Asientos Contables"}),e.jsx("p",{className:"text-gray-600",children:"Registro de movimientos contables con partida doble"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",onClick:be,disabled:O.isPending,className:"flex items-center space-x-2",children:[e.jsx(Re,{className:`h-4 w-4 ${O.isPending?"animate-spin":""}`}),e.jsx("span",{children:"Generar Automáticos"})]}),e.jsxs(Q,{open:ue,onOpenChange:w,children:[e.jsx(Fe,{asChild:!0,children:e.jsxs(r,{className:"bg-[#00a587] hover:bg-[#067f5f] flex items-center space-x-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Nuevo Asiento"})]})}),e.jsxs($,{className:"max-w-4xl",children:[e.jsx(W,{children:e.jsx(Y,{children:"Nuevo Asiento Contable"})}),e.jsx(Oe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(je),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{control:i.control,name:"date",render:({field:s})=>e.jsxs(b,{children:[e.jsx(g,{children:"Fecha"}),e.jsx(f,{children:e.jsx(u,{type:"date",...s})}),e.jsx(N,{})]})}),e.jsx(j,{control:i.control,name:"reference",render:({field:s})=>e.jsxs(b,{children:[e.jsx(g,{children:"Referencia"}),e.jsx(f,{children:e.jsx(u,{placeholder:"Número de referencia",...s})}),e.jsx(N,{})]})})]}),e.jsx(j,{control:i.control,name:"description",render:({field:s})=>e.jsxs(b,{children:[e.jsx(g,{children:"Descripción"}),e.jsx(f,{children:e.jsx(Ee,{placeholder:"Descripción del asiento contable",...s})}),e.jsx(N,{})]})}),e.jsx(j,{control:i.control,name:"type",render:({field:s})=>e.jsxs(b,{children:[e.jsx(g,{children:"Tipo"}),e.jsxs(v,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(f,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Seleccionar tipo"})})}),e.jsxs(T,{children:[e.jsx(o,{value:"manual",children:"Manual"}),e.jsx(o,{value:"automatic",children:"Automático"})]})]}),e.jsx(N,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Entradas del Asiento"}),e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>{const s=i.getValues("entries");i.setValue("entries",[...s,{account_id:0,debit:0,credit:0,description:""}])},children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Agregar Entrada"]})]}),e.jsx("div",{className:"space-y-2",children:i.watch("entries").map((s,n)=>e.jsxs("div",{className:"grid grid-cols-5 gap-2 p-3 border rounded",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Cuenta"}),e.jsxs(v,{onValueChange:t=>{const a=i.getValues("entries");a[n].account_id=parseInt(t),i.setValue("entries",a)},children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Seleccionar"})}),e.jsx(T,{children:Array.isArray(M)?M.map(t=>e.jsxs(o,{value:t.id.toString(),children:[t.code," - ",t.name]},t.id)):null})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Debe"}),e.jsx(u,{type:"number",step:"0.01",placeholder:"0.00",onChange:t=>{const a=i.getValues("entries");a[n].debit=parseFloat(t.target.value)||0,i.setValue("entries",a)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Haber"}),e.jsx(u,{type:"number",step:"0.01",placeholder:"0.00",onChange:t=>{const a=i.getValues("entries");a[n].credit=parseFloat(t.target.value)||0,i.setValue("entries",a)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Descripción"}),e.jsx(u,{placeholder:"Opcional",onChange:t=>{const a=i.getValues("entries");a[n].description=t.target.value,i.setValue("entries",a)}})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=i.getValues("entries");t.length>2&&(t.splice(n,1),i.setValue("entries",t))},disabled:i.watch("entries").length<=2,children:"Eliminar"})})]},n))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",disabled:P.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:"Crear Asiento"})]})]})})]})]})]})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(se,{className:"flex items-center",children:[e.jsx(Ve,{className:"h-5 w-5 mr-2"}),"Filtros de Búsqueda"]})}),e.jsx(ae,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ie,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{placeholder:"Buscar por número, descripción o referencia...",value:h,onChange:s=>ne(s.target.value),className:"pl-9"})]})}),e.jsx("div",{children:e.jsxs(v,{value:S,onValueChange:re,children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(T,{children:[e.jsx(o,{value:"all",children:"Todos los estados"}),e.jsx(o,{value:"draft",children:"Borrador"}),e.jsx(o,{value:"approved",children:"Aprobado"}),e.jsx(o,{value:"rejected",children:"Rechazado"})]})]})}),e.jsx("div",{children:e.jsxs(v,{value:D,onValueChange:ce,children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(T,{children:[e.jsx(o,{value:"all",children:"Todos los tipos"}),e.jsx(o,{value:"manual",children:"Manual"}),e.jsx(o,{value:"automatic",children:"Automático"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(u,{type:"date",value:le,onChange:s=>oe(s.target.value),placeholder:"dd/mm/yyyy"}),e.jsx(u,{type:"date",value:de,onChange:s=>me(s.target.value),placeholder:"dd/mm/yyyy"})]})]})})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(se,{children:"Asientos Contables Registrados"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Mostrando ",V+1,"-",Math.min(B,E)," de ",E," registros"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:ve,className:"flex items-center space-x-2",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{children:"Importar"})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:Ne,className:"flex items-center space-x-2",children:[e.jsx(Ue,{className:"h-4 w-4"}),e.jsx("span",{children:"Exportar"})]})]})]})}),e.jsxs(ae,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Número"}),e.jsx("th",{className:"text-left p-2",children:"Fecha"}),e.jsx("th",{className:"text-left p-2",children:"Descripción"}),e.jsx("th",{className:"text-left p-2",children:"Referencia"}),e.jsx("th",{className:"text-left p-2",children:"Tipo"}),e.jsx("th",{className:"text-left p-2",children:"Total Debe"}),e.jsx("th",{className:"text-left p-2",children:"Total Haber"}),e.jsx("th",{className:"text-left p-2",children:"Estado"}),e.jsx("th",{className:"text-left p-2",children:"Acciones"})]})}),e.jsx("tbody",{children:Ce.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 font-mono text-sm",children:s.number}),e.jsx("td",{className:"p-2",children:s.date}),e.jsx("td",{className:"p-2 max-w-xs truncate",children:s.description}),e.jsx("td",{className:"p-2",children:s.reference}),e.jsx("td",{className:"p-2",children:e.jsx(A,{variant:"outline",className:"bg-blue-50 text-blue-700",children:s.type})}),e.jsx("td",{className:"p-2 text-right",children:p(s.totalDebit)}),e.jsx("td",{className:"p-2 text-right",children:p(s.totalCredit)}),e.jsx("td",{className:"p-2",children:e.jsx(A,{variant:"default",className:"bg-green-100 text-green-800",children:s.status})}),e.jsx("td",{className:"p-2",children:e.jsx(r,{variant:"ghost",size:"sm",title:"Ver detalles",onClick:()=>fe(s),children:e.jsx(ke,{className:"h-4 w-4"})})})]},s.id))})]})}),x>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Página ",m," de ",x]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>R(Math.max(1,m-1)),disabled:m===1,children:[e.jsx(J,{className:"h-4 w-4"}),"Anterior"]}),Array.from({length:x},(s,n)=>n+1).map(s=>e.jsx(r,{variant:m===s?"default":"outline",size:"sm",onClick:()=>R(s),className:m===s?"bg-[#00a587] hover:bg-[#067f5f]":"",children:s},s)),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>R(Math.min(x,m+1)),disabled:m===x,children:["Siguiente",e.jsx(Me,{className:"h-4 w-4"})]})]})]})]})]}),e.jsx("input",{ref:U,type:"file",accept:".csv",style:{display:"none"},onChange:ye}),e.jsx(Q,{open:xe,onOpenChange:L,children:e.jsxs($,{className:"max-w-2xl",children:[e.jsx(W,{children:e.jsx(Y,{children:"Detalles del Asiento Contable"})}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Número"}),e.jsx("p",{className:"font-mono text-sm",children:d.number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Fecha"}),e.jsx("p",{children:d.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Referencia"}),e.jsx("p",{children:d.reference})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Tipo"}),e.jsx(A,{variant:"outline",className:"bg-blue-50 text-blue-700",children:d.type})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Descripción"}),e.jsx("p",{className:"text-sm",children:d.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Debe"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:p(d.totalDebit)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Haber"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:p(d.totalCredit)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Estado"}),e.jsx(A,{variant:"default",className:"bg-green-100 text-green-800 ml-2",children:d.status})]})]})]})})]})})}export{Be as default};
