import{az as Z,l as ee,ae as ne,aC as se,a2 as b,af as ae,u as O,ag as re,j as e,aX as Q,B as k,A as le,bq as te,ai as ie,f as E,g as I,h as S,ab as w,i as P,aj as l,ak as t,al as i,am as o,O as p,an as x,Q as A,V,W as z,Y as M,_ as m,aR as oe,X as ce,$ as J,ao as j,bG as de,ad as r,aq as K,ap as xe}from"./index-D5qLf1ib.js";import{C as me}from"./camera-CeZ3mmMV.js";const ue=r.object({firstName:r.string().min(1,"El nombre es requerido"),lastName:r.string().min(1,"El apellido es requerido"),email:r.string().email("Email inv√°lido"),phone:r.string().min(10,"El tel√©fono debe tener al menos 10 d√≠gitos"),gender:r.enum(["masculino","femenino","no_especificar"]),birthDate:r.string().optional(),address:r.string().optional(),emergencyContactName:r.string().min(1,"El nombre del contacto de emergencia es requerido"),emergencyContactPhone:r.string().min(10,"El tel√©fono de emergencia debe tener al menos 10 d√≠gitos"),preferredParkId:r.string().optional(),volunteerExperience:r.string().optional(),skills:r.string().optional(),availability:r.enum(["weekdays","weekends","evenings","mornings","flexible"]),interestNature:r.boolean().optional(),interestEvents:r.boolean().optional(),interestEducation:r.boolean().optional(),interestMaintenance:r.boolean().optional(),interestSports:r.boolean().optional(),interestCultural:r.boolean().optional(),legalConsent:r.boolean().refine(h=>h===!0,"Debe aceptar los t√©rminos legales"),ageConsent:r.boolean().refine(h=>h===!0,"Debe confirmar ser mayor de edad"),conductConsent:r.boolean().refine(h=>h===!0,"Debe aceptar el c√≥digo de conducta"),profileImage:r.any().optional(),municipalityId:r.number().optional()});function fe(){const[,h]=Z(),{toast:y}=ee(),$=ne(),[he,q]=se("/admin/volunteers/edit/:id"),N=q==null?void 0:q.id,[L,D]=b.useState(null),[je,T]=b.useState(null),[U,B]=b.useState(!1),a=ae({resolver:xe(ue),defaultValues:{firstName:"",lastName:"",email:"",phone:"",gender:"no_especificar",birthDate:"",address:"",emergencyContactName:"",emergencyContactPhone:"",preferredParkId:"",volunteerExperience:"",skills:"",availability:"flexible",interestNature:!1,interestEvents:!1,interestEducation:!1,interestMaintenance:!1,interestSports:!1,interestCultural:!1,legalConsent:!1,ageConsent:!1,conductConsent:!1,municipalityId:2,profileImage:null}}),H=async n=>{B(!0);try{const c=new FormData;c.append("file",n),c.append("volunteerId",N);const u=await K("/api/upload/volunteer-profile",{method:"POST",data:c,headers:{}});u.url&&(D(u.url),T(n),a.setValue("profileImage",n),y({title:"Imagen actualizada",description:"La fotograf√≠a del voluntario se ha actualizado correctamente"}))}catch(c){console.error("Error subiendo imagen:",c),y({title:"Error",description:"No se pudo subir la imagen. Intente nuevamente.",variant:"destructive"})}finally{B(!1)}},W=()=>{D(null),T(null),a.setValue("profileImage",null),y({title:"Imagen removida",description:"La fotograf√≠a del voluntario ha sido removida"})},{data:s,isLoading:X}=O({queryKey:["/api/volunteers",N],queryFn:async()=>{const n=await fetch(`/api/volunteers/${N}`,{headers:{Authorization:"Bearer direct-token","Content-Type":"application/json"}});if(!n.ok)throw new Error("Error al obtener datos del voluntario");return n.json()},enabled:!!N}),{data:g,isLoading:_,error:C}=O({queryKey:["/api/parks"],queryFn:async()=>{const n=await fetch("/api/parks",{headers:{Authorization:"Bearer direct-token","Content-Type":"application/json"}});if(!n.ok)throw new Error("Error al obtener parques");return n.json()}}),v=Array.isArray(g)?g:(g==null?void 0:g.data)||[];b.useEffect(()=>{console.log("Parques procesados:",{parksResponse:g,parks:v,parksCount:v.length,isLoadingParks:_,parksError:C==null?void 0:C.message})},[g,v,_,C]),b.useEffect(()=>{var n;if(s){console.log("Datos del voluntario recibidos:",s);const c=s.profileImageUrl||s.profile_image_url;c&&D(c);let u=s.firstName||"",f=s.lastName||"";if(!u&&!f&&s.full_name){const R=s.full_name.split(" ");u=R[0]||"",f=R.slice(1).join(" ")||""}console.log("Nombres procesados:",{firstName:u,lastName:f,full_name:s.full_name}),console.log("PreferredParkId actual:",s.preferredParkId,"tipo:",typeof s.preferredParkId),console.log("√Åreas de inter√©s del voluntario:",{interestNature:s.interestNature,interestEvents:s.interestEvents,interestEducation:s.interestEducation,interestMaintenance:s.interestMaintenance,interestSports:s.interestSports,interestCultural:s.interestCultural});let d=[];try{s.interest_areas&&(typeof s.interest_areas=="string"?d=JSON.parse(s.interest_areas):Array.isArray(s.interest_areas)&&(d=s.interest_areas))}catch(G){console.error("Error parsing interest areas:",G),d=[]}a.reset({firstName:u,lastName:f,email:s.email||"",phone:s.phone||"",gender:s.gender||"no_especificar",birthDate:s.birth_date||"",address:s.address||"",emergencyContactName:s.emergencyContactName||s.emergency_contact||"",emergencyContactPhone:s.emergencyContactPhone||s.emergency_phone||"",preferredParkId:s.preferredParkId||((n=s.preferred_park_id)==null?void 0:n.toString())||"",volunteerExperience:s.volunteerExperience||s.previous_experience||"",skills:s.skills||"",availability:s.available_hours||"flexible",interestNature:s.interestNature||d.includes("naturaleza")||d.includes("nature")||!1,interestEvents:s.interestEvents||d.includes("eventos")||d.includes("events")||!1,interestEducation:s.interestEducation||d.includes("educacion")||d.includes("education")||!1,interestMaintenance:s.interestMaintenance||d.includes("mantenimiento")||d.includes("maintenance")||!1,interestSports:s.interestSports||d.includes("deportes")||d.includes("sports")||!1,interestCultural:s.interestCultural||d.includes("cultural")||d.includes("culture")||!1,legalConsent:s.legal_consent!==!1,ageConsent:!0,conductConsent:!0,municipalityId:2,profileImage:s.profile_image_url||null})}},[s,a]);const F=re({mutationFn:async n=>(console.log("üöÄ Enviando datos al servidor:",n),await K(`/api/volunteers/${N}`,{method:"PUT",data:n})),onSuccess:()=>{y({title:"Voluntario actualizado",description:"Los datos del voluntario han sido actualizados exitosamente"}),$.invalidateQueries({queryKey:["/api/volunteers"]}),h("/admin/volunteers")},onError:n=>{y({title:"Error",description:"No se pudo actualizar el voluntario",variant:"destructive"}),console.error("Error actualizando voluntario:",n)}}),Y=n=>{F.mutate(n)};return X?e.jsx(Q,{children:e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{children:"Cargando datos del voluntario..."})})})}):e.jsx(Q,{children:e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(k,{variant:"ghost",onClick:()=>h("/admin/volunteers"),className:"mb-4",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Volver a Voluntarios"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(te,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Editar Voluntario"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Actualice la informaci√≥n del voluntario"})]}),e.jsx(ie,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(Y),className:"space-y-6",children:[e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(S,{children:"Informaci√≥n Personal"}),e.jsx(w,{children:"Datos b√°sicos del voluntario"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:a.control,name:"firstName",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Nombre"}),e.jsx(o,{children:e.jsx(p,{placeholder:"Ingrese el nombre",...n})}),e.jsx(x,{})]})}),e.jsx(l,{control:a.control,name:"lastName",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Apellido"}),e.jsx(o,{children:e.jsx(p,{placeholder:"Ingrese el apellido",...n})}),e.jsx(x,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:a.control,name:"email",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Email"}),e.jsx(o,{children:e.jsx(p,{type:"email",placeholder:"ejemplo@email.com",...n})}),e.jsx(x,{})]})}),e.jsx(l,{control:a.control,name:"phone",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Tel√©fono"}),e.jsx(o,{children:e.jsx(p,{placeholder:"N√∫mero de tel√©fono",...n})}),e.jsx(x,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(l,{control:a.control,name:"gender",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"G√©nero"}),e.jsxs(A,{onValueChange:n.onChange,value:n.value,children:[e.jsx(o,{children:e.jsx(V,{children:e.jsx(z,{placeholder:"Seleccione"})})}),e.jsxs(M,{children:[e.jsx(m,{value:"masculino",children:"Masculino"}),e.jsx(m,{value:"femenino",children:"Femenino"}),e.jsx(m,{value:"no_especificar",children:"No especificar"})]})]}),e.jsx(x,{})]})}),e.jsx(l,{control:a.control,name:"birthDate",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Fecha de Nacimiento"}),e.jsx(o,{children:e.jsx(p,{type:"date",...n})}),e.jsx(x,{})]})}),e.jsx(l,{control:a.control,name:"availability",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Disponibilidad"}),e.jsxs(A,{onValueChange:n.onChange,value:n.value,children:[e.jsx(o,{children:e.jsx(V,{children:e.jsx(z,{placeholder:"Seleccione"})})}),e.jsxs(M,{children:[e.jsx(m,{value:"weekdays",children:"D√≠as de semana"}),e.jsx(m,{value:"weekends",children:"Fines de semana"}),e.jsx(m,{value:"evenings",children:"Tardes"}),e.jsx(m,{value:"mornings",children:"Ma√±anas"}),e.jsx(m,{value:"flexible",children:"Flexible"})]})]}),e.jsx(x,{})]})})]}),e.jsx(l,{control:a.control,name:"address",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Direcci√≥n"}),e.jsx(o,{children:e.jsx(p,{placeholder:"Direcci√≥n completa",...n})}),e.jsx(x,{})]})}),e.jsx("div",{className:"mt-6",children:e.jsx(l,{control:a.control,name:"profileImage",render:({field:n})=>e.jsxs(t,{children:[e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Fotograf√≠a del Voluntario (Opcional)"]}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:L?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:L,alt:"Foto del voluntario",className:"w-32 h-32 object-cover rounded-lg border"}),e.jsx(k,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 p-0",onClick:W,children:e.jsx(ce,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(oe,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Subir o cambiar fotograf√≠a del voluntario"}),e.jsx("p",{className:"text-xs text-gray-500",children:"JPG, PNG o WEBP (m√°x. 5MB)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:c=>{var f;const u=(f=c.target.files)==null?void 0:f[0];u&&H(u)},className:"hidden",id:"volunteer-image-upload-edit"}),e.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:()=>{var c;return(c=document.getElementById("volunteer-image-upload-edit"))==null?void 0:c.click()},disabled:U,children:U?"Subiendo...":"Seleccionar Imagen"})]})})})}),e.jsx(x,{})]})})})]})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(S,{children:"Contacto de Emergencia"}),e.jsx(w,{children:"Informaci√≥n de contacto en caso de emergencia"})]}),e.jsx(P,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:a.control,name:"emergencyContactName",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Nombre del contacto"}),e.jsx(o,{children:e.jsx(p,{placeholder:"Nombre completo",...n})}),e.jsx(x,{})]})}),e.jsx(l,{control:a.control,name:"emergencyContactPhone",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Tel√©fono de emergencia"}),e.jsx(o,{children:e.jsx(p,{placeholder:"N√∫mero de tel√©fono",...n})}),e.jsx(x,{})]})})]})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(S,{children:"Informaci√≥n de Voluntariado"}),e.jsx(w,{children:"Preferencias y experiencia del voluntario"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsx(l,{control:a.control,name:"preferredParkId",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Parque Preferido"}),e.jsxs(A,{onValueChange:n.onChange,value:n.value,children:[e.jsx(o,{children:e.jsx(V,{children:e.jsx(z,{placeholder:_?"Cargando parques...":C?"Error al cargar parques":"Seleccione un parque"})})}),e.jsxs(M,{children:[e.jsx(m,{value:"none",children:"Sin preferencia"}),v&&v.length>0?v.map(c=>e.jsx(m,{value:c.id.toString(),children:c.name},c.id)):_?e.jsx(m,{value:"loading",disabled:!0,children:"Cargando parques..."}):e.jsx(m,{value:"no_parks",disabled:!0,children:"No hay parques disponibles"})]})]}),e.jsx(x,{})]})}),e.jsx(l,{control:a.control,name:"volunteerExperience",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Experiencia Previa"}),e.jsx(o,{children:e.jsx(J,{placeholder:"Describa su experiencia previa como voluntario...",className:"resize-none",...n})}),e.jsx(x,{})]})}),e.jsx(l,{control:a.control,name:"skills",render:({field:n})=>e.jsxs(t,{children:[e.jsx(i,{children:"Habilidades y Talentos"}),e.jsx(o,{children:e.jsx(J,{placeholder:"Describa sus habilidades y talentos...",className:"resize-none",...n})}),e.jsx(x,{})]})})]})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(S,{children:"√Åreas de Inter√©s"}),e.jsx(w,{children:"Seleccione las √°reas en las que le gustar√≠a participar"})]}),e.jsx(P,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:a.control,name:"interestNature",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Naturaleza y Medio Ambiente"})})]})}),e.jsx(l,{control:a.control,name:"interestEvents",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Eventos y Actividades"})})]})}),e.jsx(l,{control:a.control,name:"interestEducation",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Educaci√≥n Ambiental"})})]})}),e.jsx(l,{control:a.control,name:"interestMaintenance",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Mantenimiento y Jardiner√≠a"})})]})}),e.jsx(l,{control:a.control,name:"interestSports",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Deportes y Recreaci√≥n"})})]})}),e.jsx(l,{control:a.control,name:"interestCultural",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Actividades Culturales"})})]})})]})})]}),e.jsxs(E,{children:[e.jsxs(I,{children:[e.jsx(S,{children:"Consentimientos Legales"}),e.jsx(w,{children:"Aceptaci√≥n de t√©rminos y condiciones"})]}),e.jsxs(P,{className:"space-y-4",children:[e.jsx(l,{control:a.control,name:"legalConsent",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Acepto los t√©rminos y condiciones legales"})})]})}),e.jsx(l,{control:a.control,name:"ageConsent",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Confirmo que soy mayor de edad"})})]})}),e.jsx(l,{control:a.control,name:"conductConsent",render:({field:n})=>e.jsxs(t,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(j,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(i,{children:"Acepto el c√≥digo de conducta del voluntario"})})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>h("/admin/volunteers"),children:"Cancelar"}),e.jsxs(k,{type:"submit",disabled:F.isPending,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),F.isPending?"Guardando...":"Guardar Cambios"]})]})]})})]})})}export{fe as default};
