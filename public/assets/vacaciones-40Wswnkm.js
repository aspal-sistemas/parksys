import{a2 as n,ae as de,l as me,af as xe,u as V,ag as _,j as e,aX as he,w as pe,x as ue,B as h,bh as je,y as ge,z as ve,I as be,J as fe,ai as ye,aj as p,ak as u,al as j,Q as g,am as v,V as b,W as f,Y as y,_ as l,an as N,O as M,$ as Ne,a7 as K,f as Y,g as J,h as U,i as G,N as k,X as Se,b1 as we,b2 as Ce,b3 as X,b0 as De,n as A,b4 as H,m as W,ab as Te,o as m,t as Fe,ah as ee,bo as q,ad as c,ap as Ee}from"./index-D5qLf1ib.js";const Pe=c.object({employeeId:c.string().min(1,"Selecciona un empleado"),requestType:c.string().min(1,"Selecciona el tipo de solicitud"),startDate:c.string().min(1,"Fecha de inicio requerida"),endDate:c.string().min(1,"Fecha de fin requerida"),reason:c.string().min(1,"Motivo requerido"),description:c.string().optional()}),Z=[{value:"vacation",label:"Vacaciones",color:"bg-blue-500"},{value:"personal",label:"Permiso Personal",color:"bg-green-500"},{value:"sick",label:"Incapacidad Médica",color:"bg-red-500"},{value:"maternity",label:"Licencia de Maternidad",color:"bg-purple-500"},{value:"emergency",label:"Emergencia Familiar",color:"bg-orange-500"}],Le={pending:{label:"Pendiente",color:"bg-yellow-500",icon:A},approved:{label:"Aprobada",color:"bg-green-500",icon:ee},rejected:{label:"Rechazada",color:"bg-red-500",icon:q},cancelled:{label:"Cancelada",color:"bg-gray-500",icon:q}},Ve=I=>Z.find(F=>F.value===I)||Z[0];function ke(){n.useState(null);const[I,F]=n.useState(!1),[r,se]=n.useState(new Date().getFullYear()),[R,ae]=n.useState("balances"),[x,O]=n.useState(""),[o,z]=n.useState("all"),[d,$]=n.useState("all"),S=de(),{toast:w}=me(),le=new Date().getFullYear(),re=Array.from({length:6},(s,a)=>le-3+a),ie=[{value:"all",label:"Todos los meses"},{value:"1",label:"Enero"},{value:"2",label:"Febrero"},{value:"3",label:"Marzo"},{value:"4",label:"Abril"},{value:"5",label:"Mayo"},{value:"6",label:"Junio"},{value:"7",label:"Julio"},{value:"8",label:"Agosto"},{value:"9",label:"Septiembre"},{value:"10",label:"Octubre"},{value:"11",label:"Noviembre"},{value:"12",label:"Diciembre"}],i=xe({resolver:Ee(Pe),defaultValues:{employeeId:"",requestType:"",startDate:"",endDate:"",reason:"",description:""}}),B=()=>{const s=new URLSearchParams;return s.append("year",r.toString()),d&&d!=="all"&&s.append("month",d),x&&s.append("name",x),o&&o!=="all"&&s.append("department",o),s.toString()},{data:E=[],isLoading:te}=V({queryKey:["/api/time-off/time-off-requests",r,d,x,o],queryFn:async()=>{const s=await fetch(`/api/time-off/time-off-requests?${B()}`);if(!s.ok)throw new Error("Error al cargar solicitudes");return s.json()}}),{data:Q=[]}=V({queryKey:["/api/hr/employees"],queryFn:async()=>{const s=await fetch("/api/hr/employees");if(!s.ok)throw new Error("Error al cargar empleados");return s.json()}}),{data:P=[],isLoading:ne}=V({queryKey:["/api/time-off/vacation-balances",r,d,x,o],queryFn:async()=>{const s=await fetch(`/api/time-off/vacation-balances?${B()}`);if(!s.ok)throw new Error("Error al cargar balances");return s.json()}}),ce=Q.map(s=>s.department).filter(s=>s&&s.toString().trim()!=="").filter((s,a,t)=>t.indexOf(s)===a).sort(),L=_({mutationFn:async s=>{const a=await fetch("/api/time-off/time-off-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw new Error("Error al crear solicitud");return a.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/time-off/time-off-requests"]}),S.invalidateQueries({queryKey:["/api/time-off/vacation-balances"]}),F(!1),i.reset(),w({title:"Solicitud creada",description:"La solicitud de tiempo libre ha sido creada exitosamente"})},onError:()=>{w({title:"Error",description:"No se pudo crear la solicitud",variant:"destructive"})}}),C=_({mutationFn:async({id:s,action:a,rejectionReason:t})=>{const T=await fetch(`/api/time-off/time-off-requests/${s}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:a,rejectionReason:t})});if(!T.ok)throw new Error("Error al procesar solicitud");return T.json()},onSuccess:()=>{S.invalidateQueries({queryKey:["/api/time-off/time-off-requests"]}),S.invalidateQueries({queryKey:["/api/time-off/vacation-balances"]}),w({title:"Solicitud procesada",description:"La solicitud ha sido procesada exitosamente"})},onError:()=>{w({title:"Error",description:"No se pudo procesar la solicitud",variant:"destructive"})}}),oe=s=>{L.mutate(s)},D=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return e.jsx(he,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestión de Vacaciones y Permisos"}),e.jsx("p",{className:"text-gray-600",children:"Administra solicitudes de tiempo libre y balances de vacaciones"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(pe,{children:[e.jsx(ue,{asChild:!0,children:e.jsxs(h,{className:"bg-green-600 hover:bg-green-700",children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Nueva Solicitud"]})}),e.jsxs(ge,{className:"max-w-md",children:[e.jsxs(ve,{children:[e.jsx(be,{children:"Nueva Solicitud de Tiempo Libre"}),e.jsx(fe,{children:"Completa el formulario para crear una nueva solicitud"})]}),e.jsx(ye,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(oe),className:"space-y-4",children:[e.jsx(p,{control:i.control,name:"employeeId",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"Empleado"}),e.jsxs(g,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(b,{children:e.jsx(f,{placeholder:"Selecciona un empleado"})})}),e.jsx(y,{children:Q.map(a=>e.jsx(l,{value:a.id.toString(),children:`${a.firstName} ${a.lastName}`},a.id))})]}),e.jsx(N,{})]})}),e.jsx(p,{control:i.control,name:"requestType",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"Tipo de Solicitud"}),e.jsxs(g,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(v,{children:e.jsx(b,{children:e.jsx(f,{placeholder:"Selecciona el tipo"})})}),e.jsxs(y,{children:[e.jsx(l,{value:"vacation",children:"Vacaciones"}),e.jsx(l,{value:"sick_leave",children:"Permiso por Enfermedad"}),e.jsx(l,{value:"personal_leave",children:"Permiso Personal"}),e.jsx(l,{value:"maternity_leave",children:"Permiso de Maternidad"}),e.jsx(l,{value:"paternity_leave",children:"Permiso de Paternidad"})]})]}),e.jsx(N,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(p,{control:i.control,name:"startDate",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"Fecha de Inicio"}),e.jsx(v,{children:e.jsx(M,{type:"date",...s})}),e.jsx(N,{})]})}),e.jsx(p,{control:i.control,name:"endDate",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"Fecha de Fin"}),e.jsx(v,{children:e.jsx(M,{type:"date",...s})}),e.jsx(N,{})]})})]}),e.jsx(p,{control:i.control,name:"reason",render:({field:s})=>e.jsxs(u,{children:[e.jsx(j,{children:"Motivo"}),e.jsx(v,{children:e.jsx(Ne,{placeholder:"Describe el motivo de la solicitud...",...s})}),e.jsx(N,{})]})}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(h,{type:"submit",disabled:L.isPending,children:L.isPending?"Creando...":"Crear Solicitud"})})]})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4 text-gray-500"}),e.jsxs(g,{value:r.toString(),onValueChange:s=>se(parseInt(s)),children:[e.jsx(b,{className:"w-32",children:e.jsx(f,{})}),e.jsx(y,{children:re.map(s=>e.jsx(l,{value:s.toString(),children:s},s))})]})]})]})]}),e.jsxs(Y,{children:[e.jsx(J,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Filtros de Búsqueda"]})}),e.jsxs(G,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"month-filter",children:"Mes"}),e.jsxs(g,{value:d,onValueChange:$,children:[e.jsx(b,{children:e.jsx(f,{placeholder:"Todos los meses"})}),e.jsx(y,{children:ie.map(s=>e.jsx(l,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"search-name",children:"Nombre del Empleado"}),e.jsx(M,{id:"search-name",placeholder:"Buscar por nombre...",value:x,onChange:s=>O(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"department-filter",children:"Departamento"}),e.jsxs(g,{value:o,onValueChange:z,children:[e.jsx(b,{children:e.jsx(f,{placeholder:"Todos los departamentos"})}),e.jsxs(y,{children:[e.jsx(l,{value:"all",children:"Todos los departamentos"}),ce.map(s=>e.jsx(l,{value:s||"unknown",children:s||"Sin departamento"},s))]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>{O(""),z("all"),$("all")},children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Limpiar Filtros"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:R==="balances"?`${P.length} balances encontrados`:`${E.length} solicitudes encontradas`})]})]})]}),e.jsxs(we,{value:R,onValueChange:ae,className:"w-full",children:[e.jsxs(Ce,{className:"grid w-full grid-cols-2",children:[e.jsxs(X,{value:"balances",className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Balances de Vacaciones"]}),e.jsxs(X,{value:"requests",className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Solicitudes de Tiempo Libre"]})]}),e.jsx(H,{value:"balances",className:"space-y-6",children:ne?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs(Y,{children:[e.jsxs(J,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Balances de Vacaciones ",r]}),e.jsxs(Te,{children:["Días de vacaciones disponibles por empleado para el año ",r]})]}),e.jsxs(G,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-3 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-medium text-lg",children:s.employeeName}),e.jsx(m,{variant:"outline",className:"text-xs",children:s.employeePosition})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[e.jsx("p",{className:"text-blue-600 font-bold text-xl",children:s.totalDays}),e.jsx("p",{className:"text-gray-600 text-xs",children:"Total Asignados"})]}),e.jsxs("div",{className:"text-center p-2 bg-red-50 rounded",children:[e.jsx("p",{className:"text-red-600 font-bold text-xl",children:s.usedDays}),e.jsx("p",{className:"text-gray-600 text-xs",children:"Días Usados"})]}),e.jsxs("div",{className:"text-center p-2 bg-green-50 rounded",children:[e.jsx("p",{className:"text-green-600 font-bold text-xl",children:s.availableDays}),e.jsx("p",{className:"text-gray-600 text-xs",children:"Disponibles"})]})]}),s.availableDays<=5&&s.availableDays>0&&e.jsx("div",{className:"text-center",children:e.jsx(m,{variant:"outline",className:"text-orange-600 border-orange-600",children:"Días limitados"})}),s.availableDays===0&&e.jsx("div",{className:"text-center",children:e.jsx(m,{variant:"destructive",children:"Sin días disponibles"})})]},s.id))}),P.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(W,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsxs("p",{children:["No hay balances de vacaciones registrados para ",r]})]})]})]})}),e.jsxs(H,{value:"requests",className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold",children:["Solicitudes de Tiempo Libre ",r]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Gestiona todas las solicitudes de vacaciones, permisos e incapacidades"})]}),te?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-4",children:[E.map(s=>{const a=Ve(s.requestType),t=Le[s.status],T=t.icon;return e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Fe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:s.employeeName}),e.jsx(m,{variant:"outline",children:s.employeePosition})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{className:`${a.color} text-white`,children:a.label}),e.jsxs(m,{className:`${t.color} text-white`,children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),t.label]})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Período"}),e.jsxs("p",{className:"font-medium",children:[D(s.startDate)," - ",D(s.endDate)]}),e.jsxs("p",{className:"text-gray-500",children:["(",s.requestedDays," días)"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Motivo"}),e.jsx("p",{className:"font-medium",children:s.reason})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Enviada"}),e.jsx("p",{className:"font-medium",children:D(s.submittedAt)})]})]}),s.description&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-gray-500 text-sm",children:"Descripción"}),e.jsx("p",{className:"text-sm",children:s.description})]}),s.status==="pending"&&e.jsxs("div",{className:"mt-4 flex space-x-2",children:[e.jsxs(h,{size:"sm",onClick:()=>C.mutate({id:s.id,action:"approve"}),disabled:C.isPending,children:[e.jsx(ee,{className:"h-4 w-4 mr-1"}),"Aprobar"]}),e.jsxs(h,{size:"sm",variant:"destructive",onClick:()=>C.mutate({id:s.id,action:"reject",rejectionReason:"Rechazada por administrador"}),disabled:C.isPending,children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Rechazar"]})]}),s.status==="approved"&&s.approvedAt&&e.jsxs("div",{className:"mt-3 text-sm text-green-600",children:["Aprobada el ",D(s.approvedAt)," por ",s.approverName]}),s.status==="rejected"&&s.rejectionReason&&e.jsxs("div",{className:"mt-3 text-sm text-red-600",children:["Rechazada: ",s.rejectionReason]})]},s.id)}),E.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsxs("p",{children:["No hay solicitudes de tiempo libre registradas para ",r]})]})]})]})]})]})})}export{ke as default};
