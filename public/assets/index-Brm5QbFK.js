import{a2 as f,j as e,aX as F,B as y,bQ as z,f as u,i as x,b1 as L,b2 as M,b3 as w,b4 as C,g as N,h as S,ar as T,ab as A,o,bp as k,Q as B,V as H,W as I,Y as O,_ as J,au as R,bH as Q,bI as W,bJ as E,bK as h,bL as X,bM as j,aW as K,bo as Y,ah as _,b as Z,a3 as $}from"./index-D5qLf1ib.js";import{P as ee}from"./play-B_ipEGUr.js";import{C as se,G as ae}from"./gem-dXiyKzl3.js";const n=[{id:"super-admin",name:"Admin Sistema",role:"Super Administrador",level:10},{id:"director",name:"Carlos Martínez",role:"Director General",level:9},{id:"coord-parques",name:"Ana García",role:"Coordinador de Parques",level:8},{id:"operador",name:"Juan Rodríguez",role:"Operador de Parque",level:4},{id:"consultor",name:"Roberto Sánchez",role:"Consultor/Auditor",level:1}],re=[{id:"scenario-1",name:"Acceso Completo - Super Admin",description:"Verificar que el Super Admin tiene acceso a todas las funciones",user:n[0],actions:["Acceder a Dashboard Financiero","Gestionar Usuarios","Modificar Roles","Ver Logs de Auditoría","Configurar Sistema"]},{id:"scenario-2",name:"Restricciones Operador",description:"Verificar que el Operador no puede acceder a funciones administrativas",user:n[3],actions:["Ver Dashboard de Parques","Registrar Mantenimiento","Acceder a Configuración Financiera","Gestionar Usuarios","Modificar Roles"]},{id:"scenario-3",name:"Herencia de Permisos - Director",description:"Verificar que el Director hereda permisos de roles inferiores",user:n[1],actions:["Ver Dashboards Operativos","Acceder a Reportes Financieros","Gestionar Actividades","Configurar Notificaciones","Administrar Usuarios"]},{id:"scenario-4",name:"Solo Lectura - Consultor",description:"Verificar que el Consultor solo tiene acceso de lectura",user:n[4],actions:["Ver Dashboards","Leer Reportes","Crear Nueva Actividad","Modificar Parque","Eliminar Usuario"]}];function ce(){const[c,D]=f.useState(n[0]);f.useState(null);const[t,p]=f.useState([]),[b,g]=f.useState(!1),P=(s,a)=>{let r=!1,i=!1,l="fail",d="";return s.role==="Super Administrador"?(r=!0,i=!0,l="success",d="Super Admin tiene acceso completo"):a.includes("Dashboard")||a.includes("Ver")||a.includes("Leer")?(r=s.level>=1,i=r,l=i?"success":"fail",d=i?"Permiso de lectura concedido":"Nivel insuficiente para lectura"):a.includes("Gestionar")||a.includes("Crear")||a.includes("Registrar")?(r=s.level>=4,i=r,l=i?"success":"fail",d=i?"Permiso de escritura concedido":"Nivel insuficiente para escritura"):(a.includes("Modificar")||a.includes("Eliminar")||a.includes("Administrar")||a.includes("Configurar"))&&(r=s.level>=8,i=r,l=i?"success":"fail",d=i?"Permiso administrativo concedido":"Nivel insuficiente para administración"),a.includes("Financiero")&&s.role!=="Super Administrador"&&s.role!=="Director General"&&s.role!=="Administrador Financiero"&&(r=!1,i=!1,l="fail",d="Acceso a finanzas restringido por rol"),{action:a,expected:r,result:i,status:l,details:d}},V=async s=>{g(!0),p([]);for(let a=0;a<s.actions.length;a++){await new Promise(i=>setTimeout(i,500));const r=P(s.user,s.actions[a]);p(i=>[...i,r])}g(!1)},G=async(s,a)=>{g(!0),p([]);for(let r=0;r<a.length;r++){await new Promise(l=>setTimeout(l,300));const i=P(s,a[r]);p(l=>[...l,i])}g(!1)},U=s=>{switch(s){case"success":return e.jsx(_,{className:"h-4 w-4 text-green-500"});case"fail":return e.jsx(Y,{className:"h-4 w-4 text-red-500"});case"warning":return e.jsx(K,{className:"h-4 w-4 text-yellow-500"});default:return e.jsx(R,{className:"h-4 w-4 text-gray-500"})}},q=s=>{switch(s){case"success":return"bg-green-100 text-green-700";case"fail":return"bg-red-100 text-red-700";case"warning":return"bg-yellow-100 text-yellow-700";default:return"bg-gray-100 text-gray-700"}},v=s=>s.includes("Super")?e.jsx(se,{className:"w-4 h-4"}):s.includes("Director")?e.jsx(Z,{className:"w-4 h-4"}):s.includes("Coordinador")?e.jsx(ae,{className:"w-4 h-4"}):s.includes("Operador")?e.jsx($,{className:"w-4 h-4"}):e.jsx(R,{className:"w-4 h-4"}),m=(()=>{if(t.length===0)return null;const s=t.length,a=t.filter(l=>l.status==="success").length,r=t.filter(l=>l.status==="fail").length,i=t.filter(l=>l.status==="warning").length;return{total:s,passed:a,failed:r,warnings:i}})();return e.jsx(F,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Testing y Simulación"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Probar configuraciones de roles y simular escenarios de acceso"})]}),e.jsxs(y,{variant:"outline",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Limpiar Resultados"]})]}),m&&e.jsx(u,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-4 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:m.total}),e.jsx("p",{className:"text-sm text-gray-600",children:"Total Pruebas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:m.passed}),e.jsx("p",{className:"text-sm text-gray-600",children:"Exitosas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:m.failed}),e.jsx("p",{className:"text-sm text-gray-600",children:"Fallidas"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:m.warnings}),e.jsx("p",{className:"text-sm text-gray-600",children:"Advertencias"})]})]})})}),e.jsxs(L,{defaultValue:"scenarios",className:"space-y-4",children:[e.jsxs(M,{children:[e.jsx(w,{value:"scenarios",children:"Escenarios Predefinidos"}),e.jsx(w,{value:"custom",children:"Pruebas Personalizadas"}),e.jsx(w,{value:"results",children:"Resultados"})]}),e.jsx(C,{value:"scenarios",className:"space-y-4",children:e.jsxs(u,{children:[e.jsxs(N,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Escenarios de Prueba"]}),e.jsx(A,{children:"Ejecutar escenarios predefinidos para validar el sistema de roles"})]}),e.jsx(x,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:re.map(s=>e.jsxs(u,{className:"cursor-pointer hover:shadow-md transition-shadow",children:[e.jsxs(N,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.user.role),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs(o,{variant:"outline",children:["Nivel ",s.user.level]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("p",{className:"text-sm font-medium text-blue-600",children:["Usuario: ",s.user.name," (",s.user.role,")"]})]}),e.jsxs(x,{children:[e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Acciones a probar:"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1",children:[s.actions.slice(0,3).map((a,r)=>e.jsxs("li",{children:["• ",a]},r)),s.actions.length>3&&e.jsxs("li",{className:"text-gray-500",children:["+ ",s.actions.length-3," más..."]})]})]}),e.jsx(y,{onClick:()=>V(s),disabled:b,className:"w-full",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Ejecutando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2"}),"Ejecutar Escenario"]})})]})]},s.id))})})]})}),e.jsx(C,{value:"custom",className:"space-y-4",children:e.jsxs(u,{children:[e.jsxs(N,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5"}),"Pruebas Personalizadas"]}),e.jsx(A,{children:"Crear y ejecutar pruebas personalizadas con usuarios y acciones específicas"})]}),e.jsxs(x,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Seleccionar Usuario de Prueba"}),e.jsxs(B,{value:c.id,onValueChange:s=>{const a=n.find(r=>r.id===s);a&&D(a)},children:[e.jsx(H,{children:e.jsx(I,{})}),e.jsx(O,{children:n.map(s=>e.jsx(J,{value:s.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.role),e.jsxs("span",{children:[s.name," - ",s.role]}),e.jsxs(o,{variant:"outline",className:"ml-auto",children:["Nivel ",s.level]})]})},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Acciones Rápidas"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:["Ver Dashboard General","Gestionar Parques","Configurar Sistema","Ver Reportes Financieros","Administrar Usuarios","Modificar Roles","Eliminar Registros","Acceder a Logs","Configurar Notificaciones"].map(s=>e.jsx(y,{variant:"outline",size:"sm",onClick:()=>G(c,[s]),disabled:b,children:s},s))})]}),e.jsxs("div",{className:"p-4 bg-blue-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Usuario Seleccionado"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:v(c.role)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:c.name}),e.jsx("p",{className:"text-sm text-blue-700",children:c.role}),e.jsxs(o,{variant:"outline",className:"bg-white text-blue-700",children:["Nivel de Autoridad: ",c.level]})]})]})]})]})]})}),e.jsx(C,{value:"results",className:"space-y-4",children:e.jsxs(u,{children:[e.jsxs(N,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Resultados de Simulación"]}),e.jsx(A,{children:"Resultados detallados de las pruebas ejecutadas"})]}),e.jsx(x,{children:t.length>0?e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(E,{children:[e.jsx(h,{children:"Acción"}),e.jsx(h,{children:"Esperado"}),e.jsx(h,{children:"Resultado"}),e.jsx(h,{children:"Estado"}),e.jsx(h,{children:"Detalles"})]})}),e.jsx(X,{children:t.map((s,a)=>e.jsxs(E,{children:[e.jsx(j,{children:e.jsx("p",{className:"font-medium text-gray-900",children:s.action})}),e.jsx(j,{children:e.jsx(o,{variant:s.expected?"default":"secondary",children:s.expected?"Permitido":"Denegado"})}),e.jsx(j,{children:e.jsx(o,{variant:s.result?"default":"secondary",children:s.result?"Permitido":"Denegado"})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[U(s.status),e.jsx(o,{className:q(s.status),children:s.status==="success"?"Éxito":s.status==="fail"?"Fallo":"Advertencia"})]})}),e.jsx(j,{children:e.jsx("p",{className:"text-sm text-gray-600",children:s.details})})]},a))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay resultados de simulación. Ejecuta un escenario o prueba personalizada para ver los resultados."})]})})]})})]})]})})}export{ce as default};
