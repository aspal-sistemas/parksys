import{a5 as r,al as V,e as B,a6 as I,Y as L,a7 as M,a8 as T,j as e,aB as D,aa as k,ab as n,ac as o,ad as i,ae as l,I as t,af as c,z as E,H as S,J as R,K as w,N as m,O as g,bt as v,b9 as O,B as b,aX as P,ag as J}from"./index-BBGHPKhn.js";import{C as z}from"./checkbox-DK4Ni3Jp.js";const A=r.object({commonName:r.string().min(2,{message:"El nombre común debe tener al menos 2 caracteres."}),scientificName:r.string().min(2,{message:"El nombre científico debe tener al menos 2 caracteres."}),family:r.string().min(2,{message:"La familia debe tener al menos 2 caracteres."}),origin:r.string({required_error:"Selecciona el origen de la especie."}),growthRate:r.string({required_error:"Selecciona la tasa de crecimiento."}),description:r.string().min(10,{message:"La descripción debe tener al menos 10 caracteres."}).max(1e3,{message:"La descripción no debe exceder los 1000 caracteres."}),isEndangered:r.boolean().default(!1),imageUrl:r.string().optional(),climateZone:r.string().optional(),heightMature:r.string().optional(),canopyDiameter:r.string().optional(),lifespan:r.string().optional(),maintenanceRequirements:r.string().optional(),waterRequirements:r.string().optional(),sunRequirements:r.string().optional(),soilRequirements:r.string().optional(),ecologicalBenefits:r.string().optional(),ornamentalValue:r.string().optional(),commonUses:r.string().optional(),iconType:r.string().optional(),customIconUrl:r.string().optional()});function K(){const[,N]=V(),{toast:x}=B(),C=I(),[f,q]=L.useState(""),a=M({resolver:J(A),defaultValues:{commonName:"",scientificName:"",family:"",origin:"Nativo",growthRate:"Medio",description:"",isEndangered:!1,imageUrl:"",climateZone:"",heightMature:"",canopyDiameter:"",lifespan:"",maintenanceRequirements:"",waterRequirements:"",sunRequirements:"",soilRequirements:"",ecologicalBenefits:"",ornamentalValue:"",commonUses:""}}),u=T({mutationFn:async s=>{console.log("Enviando datos:",s);const d=await fetch("/api/tree-species",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!d.ok){const j=await d.json();throw new Error(j.message||"Error al crear la especie arbórea")}return d.json()},onSuccess:()=>{C.invalidateQueries({queryKey:["/api/tree-species"]}),x({title:"Especie arbórea creada",description:"La especie ha sido registrada exitosamente en el catálogo."}),N("/admin/trees/catalog")},onError:s=>{console.error("Error:",s),x({title:"Error",description:s.message||"Ocurrió un error al crear la especie arbórea.",variant:"destructive"})}}),U=async s=>{var y;const d=(y=s.target.files)==null?void 0:y[0];if(!d)return;const j=new FormData;j.append("photo",d);try{const h=await fetch("/api/tree-species/upload-photo",{method:"POST",body:j});if(h.ok){const p=await h.json();q(p.url),a.setValue("imageUrl",p.url),a.setValue("customIconUrl",p.url),a.setValue("iconType","custom"),x({title:"Foto subida",description:"La foto se ha subido correctamente."})}else throw new Error("Error al subir la foto")}catch(h){console.error("Error al subir foto:",h),x({title:"Error",description:"No se pudo subir la foto. Intenta de nuevo.",variant:"destructive"})}};function F(s){console.log("Datos del formulario:",s),console.log("Errores del formulario:",a.formState.errors),u.mutate(s)}return e.jsx(D,{children:e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-6 text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-green-800",children:"Nueva Especie Arbórea"}),e.jsx("p",{className:"text-muted-foreground",children:"Registra una nueva especie en el catálogo de árboles."})]}),e.jsx(k,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(F),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:a.control,name:"commonName",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Nombre Común *"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Jacaranda",...s})}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"scientificName",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Nombre Científico *"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Jacaranda mimosifolia",...s})}),e.jsx(c,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{control:a.control,name:"family",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Familia *"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Bignoniaceae",...s})}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"origin",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Origen *"}),e.jsxs(E,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(l,{children:e.jsx(S,{children:e.jsx(R,{placeholder:"Selecciona el origen"})})}),e.jsxs(w,{children:[e.jsx(m,{value:"Nativo",children:"Nativo"}),e.jsx(m,{value:"Introducido",children:"Introducido"}),e.jsx(m,{value:"Naturalizado",children:"Naturalizado"})]})]}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"growthRate",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Tasa de Crecimiento *"}),e.jsxs(E,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(l,{children:e.jsx(S,{children:e.jsx(R,{placeholder:"Selecciona la tasa"})})}),e.jsxs(w,{children:[e.jsx(m,{value:"Lento",children:"Lento"}),e.jsx(m,{value:"Medio",children:"Medio"}),e.jsx(m,{value:"Rápido",children:"Rápido"})]})]}),e.jsx(c,{})]})})]}),e.jsx(n,{control:a.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Descripción *"}),e.jsx(l,{children:e.jsx(g,{placeholder:"Descripción general de la especie...",className:"min-h-[120px]",...s})}),e.jsx(v,{children:"Descripción general de la especie, incluyendo características distintivas."}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"isEndangered",render:({field:s})=>e.jsxs(o,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(l,{children:e.jsx(z,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(i,{children:"Especie en peligro de extinción"}),e.jsx(v,{children:"Marca esta casilla si la especie está en peligro de extinción."})]})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto h-12 w-12 text-gray-400",children:e.jsx(O,{className:"h-12 w-12"})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("label",{htmlFor:"photo-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"mt-2 block text-sm font-medium text-gray-900",children:"Subir fotografía de la especie"}),e.jsx("span",{className:"mt-1 block text-sm text-gray-500",children:"PNG, JPG, JPEG hasta 5MB"})]}),e.jsx("input",{id:"photo-upload",type:"file",className:"sr-only",accept:"image/*",onChange:U}),e.jsxs(b,{type:"button",variant:"outline",className:"mt-3",onClick:()=>{var s;return(s=document.getElementById("photo-upload"))==null?void 0:s.click()},children:[e.jsx(P,{className:"mr-2 h-4 w-4"}),"Seleccionar Foto"]})]}),f&&e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm text-green-600 mb-2",children:"✓ Foto subida correctamente"}),e.jsx("img",{src:f,alt:"Vista previa",className:"mx-auto h-24 w-24 object-cover rounded-lg border"})]})]}),e.jsxs("div",{className:"flex items-center my-4",children:[e.jsx("div",{className:"flex-grow border-t border-gray-300"}),e.jsx("span",{className:"px-3 text-sm text-gray-500",children:"o"}),e.jsx("div",{className:"flex-grow border-t border-gray-300"})]}),e.jsx(n,{control:a.control,name:"imageUrl",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"URL de imagen externa"}),e.jsx(l,{children:e.jsx(t,{placeholder:"https://ejemplo.com/imagen.jpg",...s,value:s.value||""})}),e.jsx(v,{children:"URL de una imagen externa representativa de la especie."}),e.jsx(c,{})]})})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:a.control,name:"climateZone",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Zona Climática (Opcional)"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Tropical, Templada...",...s,value:s.value||""})}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"ornamentalValue",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Valor Ornamental (Opcional)"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Alto, Medio, Bajo...",...s,value:s.value||""})}),e.jsx(c,{})]})})]}),e.jsx(n,{control:a.control,name:"ecologicalBenefits",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Beneficios Ecológicos (Opcional)"}),e.jsx(l,{children:e.jsx(g,{placeholder:"Beneficios ecológicos que ofrece...",className:"min-h-[100px]",...s,value:s.value||""})}),e.jsx(c,{})]})}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-green-700",children:"Requerimientos de Cultivo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{control:a.control,name:"soilRequirements",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Requerimientos de Suelo"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Bien drenado, arcilloso...",...s,value:s.value||""})}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"waterRequirements",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Requerimientos de Agua"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Bajo, Moderado, Alto...",...s,value:s.value||""})}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"sunRequirements",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Requerimientos de Sol"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Pleno sol, Semi-sombra...",...s,value:s.value||""})}),e.jsx(c,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsx(n,{control:a.control,name:"lifespan",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Esperanza de Vida"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. 50-100 años, +200 años...",...s,value:s.value||""})}),e.jsx(c,{})]})}),e.jsx(n,{control:a.control,name:"commonUses",render:({field:s})=>e.jsxs(o,{children:[e.jsx(i,{children:"Usos Comunes"}),e.jsx(l,{children:e.jsx(t,{placeholder:"Ej. Sombra, ornamental, madera...",...s,value:s.value||""})}),e.jsx(c,{})]})})]}),e.jsx(n,{control:a.control,name:"maintenanceRequirements",render:({field:s})=>e.jsxs(o,{className:"mt-4",children:[e.jsx(i,{children:"Requisitos de Mantenimiento"}),e.jsx(l,{children:e.jsx(g,{placeholder:"Describe los cuidados y mantenimiento necesarios...",className:"min-h-[100px]",...s,value:s.value||""})}),e.jsx(c,{})]})})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>N("/admin/trees/catalog"),children:"Cancelar"}),e.jsx(b,{type:"submit",disabled:u.isPending,className:"bg-green-600 hover:bg-green-700",children:u.isPending?"Guardando...":"Guardar Especie"})]})]})})]})})})}export{K as default};
