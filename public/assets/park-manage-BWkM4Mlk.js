import{e as Ne,a6 as ve,Y as x,u as V,a8 as z,j as e,aH as Ge,aI as Ze,aJ as G,b9 as as,F as Ae,aK as Z,D as te,p as ke,B as d,aW as le,r as ce,t as oe,v as de,I as b,O as pe,b7 as ge,C as w,f as v,S as Se,c as E,b0 as He,b4 as me,W as rs,ah as J,a as T,b as F,aG as De,bq as ye,M as ie,b3 as Je,a7 as Pe,aC as be,ax as is,a3 as H,Z as We,br as Te,au as ne,w as Fe,aa as ze,ab as M,ac as R,ad as O,ae as Q,af as K,z as Ie,H as $e,J as Ue,K as Le,N as ae,a5 as ee,ag as Me,al as ns,E as Re,h as je,l as ts,i as ls,U as W,X as cs,aj as os,n as Oe,P as Qe,m as ds,d as ms,aB as fe,L as Ke,A as xs,aE as us}from"./index-BBGHPKhn.js";import{T as Ve}from"./tree-species-icon-BCm4a_z4.js";import{I as Xe}from"./images-UHLIx5DH.js";import"./flower-RP4clIJv.js";function hs({parkId:i}){const{toast:l}=Ne(),c=ve(),[N,g]=x.useState(!1),[y,C]=x.useState(!1),[u,t]=x.useState(null),[P,A]=x.useState(""),[k,f]=x.useState(""),[p,$]=x.useState(!1),[S,I]=x.useState(null),[q,U]=x.useState(""),[r,o]=x.useState(""),[j,L]=x.useState(""),[X,se]=x.useState("general"),re=()=>{t(null),A(""),f(""),$(!1)},n=()=>{I(null),U(""),o(""),L(""),se("general")},{data:h=[],isLoading:B,error:xe}=V({queryKey:[`/api/parks/${i}/images`],queryFn:async()=>{console.log(`üîç FRONTEND: Cargando im√°genes para parque ${i}`);const a=await fetch(`/api/parks/${i}/images`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!a.ok)throw new Error("Error cargando im√°genes");const m=await a.json();return console.log("‚úÖ FRONTEND: Im√°genes cargadas:",m),m},staleTime:0,gcTime:0}),{data:_=[],isLoading:s,error:D}=V({queryKey:[`/api/parks/${i}/documents`],queryFn:async()=>{console.log(`üîç FRONTEND: Cargando documentos para parque ${i}`);const a=await fetch(`/api/parks/${i}/documents`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!a.ok)throw new Error("Error cargando documentos");const m=await a.json();return console.log("‚úÖ FRONTEND: Documentos cargados:",m),m},staleTime:0,gcTime:0}),ue=z({mutationFn:async a=>{if(a instanceof FormData){const m=await fetch(`/api/parks/${i}/images`,{method:"POST",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:a});if(!m.ok)throw new Error("Error subiendo imagen");return m.json()}else return(await J(`/api/parks/${i}/images`,{method:"POST",data:a})).json()},onSuccess:()=>{l({title:"Imagen subida",description:"La imagen se ha agregado exitosamente al parque."}),c.invalidateQueries({queryKey:[`/api/parks/${i}/images`]}),c.invalidateQueries({queryKey:[`/api/parks/${i}`]}),re(),g(!1)},onError:a=>{l({title:"Error",description:"No se pudo subir la imagen. Intente nuevamente.",variant:"destructive"})}}),we=z({mutationFn:async a=>(await J(`/api/park-images/${a}/set-primary`,{method:"POST",data:{}})).json(),onSuccess:()=>{l({title:"Imagen principal actualizada",description:"Se ha establecido la nueva imagen principal del parque."}),c.invalidateQueries({queryKey:[`/api/parks/${i}/images`]}),c.invalidateQueries({queryKey:[`/api/parks/${i}`]})},onError:()=>{l({title:"Error",description:"No se pudo establecer la imagen principal.",variant:"destructive"})}}),Ee=z({mutationFn:async a=>await J(`/api/park-images/${a}`,{method:"DELETE"}),onSuccess:()=>{l({title:"Imagen eliminada",description:"La imagen se ha eliminado correctamente."}),c.invalidateQueries({queryKey:[`/api/parks/${i}/images`]}),c.invalidateQueries({queryKey:[`/api/parks/${i}`]}),c.removeQueries({queryKey:[`/api/parks/${i}/images`]}),c.refetchQueries({queryKey:[`/api/parks/${i}/images`]}),setTimeout(()=>{c.invalidateQueries({queryKey:[`/api/parks/${i}/images`]})},100)},onError:()=>{l({title:"Error",description:"No se pudo eliminar la imagen.",variant:"destructive"})}}),he=z({mutationFn:async a=>{if(a instanceof FormData){const m=await fetch(`/api/parks/${i}/documents`,{method:"POST",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:a});if(!m.ok)throw new Error("Error subiendo documento");return m.json()}else return(await J(`/api/parks/${i}/documents`,{method:"POST",data:a})).json()},onSuccess:()=>{l({title:"Documento subido",description:"El documento se ha agregado exitosamente al parque."}),c.invalidateQueries({queryKey:[`/api/parks/${i}/documents`]}),c.invalidateQueries({queryKey:[`/api/parks/${i}`]}),n(),C(!1)},onError:a=>{l({title:"Error",description:"No se pudo subir el documento. Intente nuevamente.",variant:"destructive"})}}),Ce=z({mutationFn:async a=>await J(`/api/park-documents/${a}`,{method:"DELETE"}),onSuccess:()=>{l({title:"Documento eliminado",description:"El documento se ha eliminado correctamente."}),c.invalidateQueries({queryKey:[`/api/parks/${i}/documents`]}),c.invalidateQueries({queryKey:[`/api/parks/${i}`]})},onError:()=>{l({title:"Error",description:"No se pudo eliminar el documento.",variant:"destructive"})}}),Ye=()=>{if(u){const a=new FormData;a.append("image",u),a.append("caption",k),a.append("isPrimary",p.toString()),ue.mutate(a)}else P&&ue.mutate({imageUrl:P,caption:k,isPrimary:p})},es=()=>{if(S){const a=new FormData;a.append("document",S),a.append("title",r),a.append("description",j),a.append("category",X),he.mutate(a)}else q&&he.mutate({title:r,description:j,category:X,fileUrl:q})},ss=a=>{if(a===0)return"0 Bytes";const m=1024,Y=["Bytes","KB","MB","GB"],qe=Math.floor(Math.log(a)/Math.log(m));return parseFloat((a/Math.pow(m,qe)).toFixed(2))+" "+Y[qe]};return console.log("üîç MULTIMEDIA MANAGER - Renderizando con:",{parkId:i,images:h.length,documents:_.length,imagesLoading:B,documentsLoading:s,imagesError:xe,documentsError:D}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border",children:[e.jsx("h4",{className:"font-semibold text-blue-800",children:"Estado del Componente Multimedia"}),e.jsxs("p",{className:"text-sm text-blue-600",children:["Parque ID: ",i," | Im√°genes: ",h.length," | Documentos: ",_.length]}),e.jsxs("p",{className:"text-sm text-blue-600",children:["Cargando im√°genes: ",B?"S√≠":"No"," | Error: ",xe?"S√≠":"No"]})]}),e.jsxs(Ge,{defaultValue:"images",className:"w-full",children:[e.jsxs(Ze,{className:"grid w-full grid-cols-2",children:[e.jsxs(G,{value:"images",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Im√°genes (",h.length,")"]}),e.jsxs(G,{value:"documents",className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"Documentos (",_.length,")"]})]}),e.jsxs(Z,{value:"images",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Galer√≠a de Im√°genes"}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(te,{open:N,onOpenChange:g,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(d,{className:"bg-green-600 hover:bg-green-700 text-white flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Agregar Imagen"]})}),e.jsxs(ce,{className:"max-w-md","aria-describedby":"multimedia-description",children:[e.jsx(oe,{children:e.jsx(de,{children:"Agregar Nueva Imagen"})}),e.jsx("div",{id:"multimedia-description",className:"sr-only",children:"Formulario para subir una nueva imagen al sistema multimedia del parque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Subir archivo"}),e.jsx(b,{type:"file",accept:"image/*",onChange:a=>{var Y;const m=(Y=a.target.files)==null?void 0:Y[0];m&&(t(m),A(""))}})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:"- O -"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"URL de imagen"}),e.jsx(b,{value:P,onChange:a=>{A(a.target.value),a.target.value&&t(null)},placeholder:"https://ejemplo.com/imagen.jpg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Descripci√≥n"}),e.jsx(pe,{value:k,onChange:a=>f(a.target.value),placeholder:"Descripci√≥n de la imagen...",rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",checked:p,onChange:a=>$(a.target.checked)}),e.jsx("label",{htmlFor:"isPrimary",className:"text-sm",children:"Establecer como imagen principal"})]})]}),e.jsx(ge,{children:e.jsx(d,{onClick:Ye,disabled:!u&&!P||ue.isPending,children:ue.isPending?"Subiendo...":"Agregar Imagen"})})]})]})})]}),B?e.jsx("div",{className:"text-center py-8",children:"Cargando im√°genes..."}):h.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay im√°genes para este parque"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(a=>e.jsxs(w,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.imageUrl,alt:a.caption,className:"w-full h-48 object-cover"}),a.isPrimary&&e.jsxs(v,{className:"absolute top-2 left-2 bg-yellow-500",children:[e.jsx(Se,{className:"h-3 w-3 mr-1"}),"Principal"]})]}),e.jsxs(E,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.caption}),e.jsxs("div",{className:"flex gap-2",children:[!a.isPrimary&&e.jsx(d,{size:"sm",variant:"outline",onClick:()=>we.mutate(a.id),disabled:we.isPending,children:e.jsx(Se,{className:"h-3 w-3"})}),e.jsx(d,{size:"sm",variant:"outline",onClick:()=>window.open(a.imageUrl,"_blank"),children:e.jsx(He,{className:"h-3 w-3"})}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>Ee.mutate(a.id),disabled:Ee.isPending,children:e.jsx(me,{className:"h-3 w-3"})})]})]})]},a.id))})]}),e.jsxs(Z,{value:"documents",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Documentos del Parque"}),e.jsxs(te,{open:y,onOpenChange:C,children:[e.jsx(ke,{asChild:!0,children:e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),"Agregar Documento"]})}),e.jsxs(ce,{className:"max-w-md","aria-describedby":"document-description",children:[e.jsx(oe,{children:e.jsx(de,{children:"Agregar Nuevo Documento"})}),e.jsx("div",{id:"document-description",className:"sr-only",children:"Formulario para agregar un nuevo documento al sistema multimedia del parque"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"T√≠tulo"}),e.jsx(b,{value:r,onChange:a=>o(a.target.value),placeholder:"T√≠tulo del documento"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Subir archivo"}),e.jsx(b,{type:"file",accept:".pdf,.doc,.docx,.txt",onChange:a=>{var Y;const m=(Y=a.target.files)==null?void 0:Y[0];m&&(I(m),U(""))}})]}),e.jsx("div",{className:"text-center text-sm text-gray-500",children:"- O -"}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"URL del documento"}),e.jsx(b,{value:q,onChange:a=>{U(a.target.value),a.target.value&&I(null)},placeholder:"https://ejemplo.com/documento.pdf"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Categor√≠a"}),e.jsxs("select",{value:X,onChange:a=>se(a.target.value),className:"w-full p-2 border border-gray-300 rounded-md",children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"reglamento",children:"Reglamento"}),e.jsx("option",{value:"mantenimiento",children:"Mantenimiento"}),e.jsx("option",{value:"eventos",children:"Eventos"}),e.jsx("option",{value:"legal",children:"Legal"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Descripci√≥n"}),e.jsx(pe,{value:j,onChange:a=>L(a.target.value),placeholder:"Descripci√≥n del documento...",rows:3})]})]}),e.jsx(ge,{children:e.jsx(d,{onClick:es,disabled:!S&&!q||!r.trim()||he.isPending,children:he.isPending?"Subiendo...":"Agregar Documento"})})]})]})]}),s?e.jsx("div",{className:"text-center py-8",children:"Cargando documentos..."}):_.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay documentos para este parque"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:_.map(a=>e.jsx(w,{children:e.jsxs(E,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.title}),e.jsx("p",{className:"text-xs text-gray-500 capitalize",children:a.category})]})]}),e.jsx(v,{variant:"outline",children:ss(a.fileSize)})]}),a.description&&e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:a.description}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{size:"sm",variant:"outline",onClick:()=>window.open(a.fileUrl,"_blank"),children:[e.jsx(rs,{className:"h-3 w-3 mr-1"}),"Ver"]}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>Ce.mutate(a.id),disabled:Ce.isPending,children:e.jsx(me,{className:"h-3 w-3"})})]})]})},a.id))})]})]})]})}const ps={activo:"Activo",inactivo:"Inactivo",mantenimiento:"En Mantenimiento"};function gs({parkId:i}){const{toast:l}=Ne(),c=ve(),[N,g]=x.useState(!1),[y,C]=x.useState(null),[u,t]=x.useState(null),[P,A]=x.useState(""),[k,f]=x.useState(""),[p,$]=x.useState(""),{data:S=[],isLoading:I,error:q}=V({queryKey:[`/api/parks/${i}/amenities`],queryFn:async()=>{console.log("üîç FRONTEND: Cargando amenidades para parque",i);const n=await fetch(`/api/parks/${i}/amenities`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!n.ok)throw new Error("Error cargando amenidades");const h=await n.json();return console.log("‚úÖ FRONTEND: Amenidades cargadas:",h),h},enabled:!!i}),{data:U=[]}=V({queryKey:["/api/amenities"],queryFn:async()=>{const n=await fetch("/api/amenities",{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!n.ok)throw new Error("Error cargando amenidades disponibles");return n.json()}}),r=z({mutationFn:async n=>{const h=await fetch(`/api/parks/${i}/amenities`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:JSON.stringify(n)});if(!h.ok)throw new Error("Error agregando amenidad");return h.json()},onSuccess:()=>{c.invalidateQueries({queryKey:[`/api/parks/${i}/amenities`]}),l({title:"Amenidad agregada",description:"La amenidad se agreg√≥ correctamente al parque"}),t(null),A(""),f(""),$("")},onError:n=>{l({title:"Error",description:"No se pudo agregar la amenidad",variant:"destructive"})}}),o=z({mutationFn:async({parkAmenityId:n,data:h})=>{const B=await fetch(`/api/park-amenities/${n}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:JSON.stringify(h)});if(!B.ok)throw new Error("Error actualizando amenidad");return B.json()},onSuccess:()=>{c.invalidateQueries({queryKey:[`/api/parks/${i}/amenities`]}),g(!1),C(null),l({title:"Amenidad actualizada",description:"La amenidad se actualiz√≥ correctamente"})}}),j=z({mutationFn:async n=>{if(!(await fetch(`/api/parks/${i}/amenities/${n}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}})).ok)throw new Error("Error eliminando amenidad")},onSuccess:()=>{c.invalidateQueries({queryKey:[`/api/parks/${i}/amenities`]}),l({title:"Amenidad eliminada",description:"La amenidad se elimin√≥ correctamente del parque"})}}),L=n=>{C(n),A(n.moduleName||""),f(n.surfaceArea||""),$(n.description||""),g(!0)},X=()=>{if(!y)return;const n={moduleName:P||null,surfaceArea:k||null,description:p||null};o.mutate({parkAmenityId:y.id,data:n})},se=n=>{confirm("¬øEst√°s seguro de que deseas eliminar esta amenidad del parque?")&&j.mutate(n)},re=n=>{const h={amenityId:n,moduleName:"",surfaceArea:null,description:null};r.mutate(h)};return console.log("üîç AMENITIES MANAGER - Renderizando con:",{parkId:i,amenitiesCount:S.length,amenitiesLoading:I,amenitiesError:(q==null?void 0:q.message)||null,availableCount:U.length}),I?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando amenidades..."})]}):q?e.jsx("div",{className:"text-center py-8",children:e.jsxs("p",{className:"text-red-600",children:["Error cargando amenidades: ",q.message]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Gesti√≥n de Amenidades del Parque"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Selecciona amenidades de la lista disponible para agregarlas al parque"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Amenidades Disponibles"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Haz clic en una amenidad para agregarla al parque"})]}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:[U.filter(n=>!S.some(h=>h.amenityId===n.id)).map(n=>e.jsxs("div",{onClick:()=>re(n.id),className:"flex items-center gap-3 p-3 border rounded-lg hover:bg-blue-50 hover:border-blue-200 cursor-pointer transition-colors",children:[e.jsx(ye,{name:n.name,iconType:n.icon==="custom"?"custom":"system",customIconUrl:n.icon==="custom"?`/uploads/amenity-icon-${n.id}.png`:void 0,size:32}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:n.name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Click para agregar"})]}),e.jsx(le,{className:"h-4 w-4 text-gray-400"})]},n.id)),U.filter(n=>!S.some(h=>h.amenityId===n.id)).length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(De,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"Todas las amenidades disponibles ya est√°n asignadas"})]})]})})]}),e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5"}),"Amenidades del Parque (",S.length,")"]}),e.jsx("p",{className:"text-sm text-gray-600",children:"Amenidades actualmente asignadas a este parque"})]}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2 max-h-[600px] overflow-y-auto",children:S.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ie,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm",children:"No hay amenidades asignadas"}),e.jsx("p",{className:"text-xs mt-1",children:"Agrega amenidades desde la lista de la izquierda"})]}):S.map(n=>e.jsxs("div",{className:"flex items-center gap-3 p-3 border rounded-lg bg-green-50 border-green-200",children:[e.jsx(ye,{name:n.amenityName,iconType:n.amenityIcon==="custom"?"custom":"system",customIconUrl:n.customIconUrl,size:32}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:"font-medium text-gray-900",children:n.amenityName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(v,{variant:"outline",className:"text-xs",children:ps[n.status]||n.status}),n.moduleName&&e.jsxs("span",{className:"text-xs text-gray-500",children:["üìç ",n.moduleName]})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(d,{size:"sm",variant:"outline",onClick:()=>L(n),children:e.jsx(Je,{className:"h-3 w-3"})}),e.jsx(d,{size:"sm",variant:"destructive",onClick:()=>se(n.id),disabled:j.isPending,children:e.jsx(me,{className:"h-3 w-3"})})]})]},n.id))})})]})]}),e.jsx(te,{open:N,onOpenChange:g,children:e.jsxs(ce,{className:"max-w-md","aria-describedby":"add-amenity-description",children:[e.jsx(oe,{children:e.jsx(de,{children:"Editar Amenidad"})}),e.jsx("div",{id:"add-amenity-description",className:"sr-only",children:"Formulario para editar la configuraci√≥n de la amenidad del parque"}),y&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx(ye,{name:y.amenityName,iconType:y.amenityIcon==="custom"?"custom":"system",customIconUrl:y.customIconUrl,size:32}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium",children:y.amenityName}),e.jsx("p",{className:"text-sm text-gray-600 capitalize",children:"General"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"M√≥dulo/Ubicaci√≥n"}),e.jsx(b,{value:P,onChange:n=>A(n.target.value),placeholder:"Ej: Zona Norte, Entrada Principal..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Superficie (m¬≤)"}),e.jsx(b,{value:k,onChange:n=>f(n.target.value),placeholder:"Ej: 150.5",type:"number",step:"0.1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Descripci√≥n"}),e.jsx(b,{value:p,onChange:n=>$(n.target.value),placeholder:"Descripci√≥n adicional..."})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(d,{onClick:X,disabled:o.isPending,className:"flex-1",children:o.isPending?"Actualizando...":"Actualizar"}),e.jsx(d,{variant:"outline",onClick:()=>g(!1),className:"flex-1",children:"Cancelar"})]})]})]})})]})}const Be=ee.object({speciesId:ee.number().min(1,"Debe seleccionar una especie"),recommendedQuantity:ee.number().min(1,"Cantidad debe ser mayor a 0").optional(),currentQuantity:ee.number().min(0,"Cantidad actual no puede ser negativa").default(0),plantingZone:ee.string().optional(),notes:ee.string().optional(),status:ee.string().default("planificado")});function js({parkId:i}){var _;const[l,c]=x.useState(""),[N,g]=x.useState(null),[y,C]=x.useState(!1),[u,t]=x.useState(null),[P,A]=x.useState(!1),{toast:k}=Ne(),f=ve(),{data:p,isLoading:$,error:S}=V({queryKey:[`/api/parks/${i}/tree-species`],queryFn:async()=>{const s=await fetch(`/api/parks/${i}/tree-species`);if(!s.ok)throw new Error("Error al cargar especies asignadas");return s.json()}}),{data:I,isLoading:q}=V({queryKey:["/api/tree-species",l],queryFn:async()=>{const s=new URLSearchParams({page:"1",limit:"50",...l&&{search:l}}),D=await fetch(`/api/tree-species?${s}`);if(!D.ok)throw new Error("Error al cargar especies disponibles");return D.json()}}),U=(p==null?void 0:p.map(s=>s.speciesId))||[],r=((_=I==null?void 0:I.data)==null?void 0:_.filter(s=>!U.includes(s.id)))||[],o=Pe({resolver:Me(Be),defaultValues:{currentQuantity:0,status:"planificado"}}),j=Pe({resolver:Me(Be)}),L=z({mutationFn:async s=>J(`/api/parks/${i}/tree-species`,{method:"POST",data:s}),onSuccess:()=>{f.invalidateQueries({queryKey:[`/api/parks/${i}/tree-species`]}),f.invalidateQueries({queryKey:["/api/tree-species"]}),C(!1),g(null),o.reset(),k({title:"√âxito",description:"Especie asignada al parque correctamente"})},onError:s=>{k({title:"Error",description:s.message||"Error al asignar la especie",variant:"destructive"})}}),X=z({mutationFn:async s=>J(`/api/park-tree-species/${u==null?void 0:u.id}`,{method:"PUT",data:s}),onSuccess:()=>{f.invalidateQueries({queryKey:[`/api/parks/${i}/tree-species`]}),A(!1),t(null),j.reset(),k({title:"√âxito",description:"Asignaci√≥n actualizada correctamente"})},onError:s=>{k({title:"Error",description:s.message||"Error al actualizar la asignaci√≥n",variant:"destructive"})}}),se=z({mutationFn:async s=>J(`/api/park-tree-species/${s}`,{method:"DELETE"}),onSuccess:()=>{f.invalidateQueries({queryKey:[`/api/parks/${i}/tree-species`]}),f.invalidateQueries({queryKey:["/api/tree-species"]}),k({title:"√âxito",description:"Especie removida del parque correctamente"})},onError:s=>{k({title:"Error",description:s.message||"Error al remover la especie",variant:"destructive"})}}),re=s=>{g(s),o.setValue("speciesId",s.id),C(!0)},n=s=>{t(s),j.reset({speciesId:s.speciesId,recommendedQuantity:s.recommendedQuantity||void 0,currentQuantity:s.currentQuantity,plantingZone:s.plantingZone||"",notes:s.notes||"",status:s.status}),A(!0)},h=s=>{confirm("¬øEst√° seguro de que desea remover esta especie del parque?")&&se.mutate(s)},B=s=>{switch(s){case"planificado":return"bg-yellow-100 text-yellow-800";case"en_desarrollo":return"bg-blue-100 text-blue-800";case"establecido":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},xe=s=>{switch(s){case"planificado":return"Planificado";case"en_desarrollo":return"En Desarrollo";case"establecido":return"Establecido";default:return s}};return $||q?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):S?e.jsxs("div",{className:"text-center py-8 text-red-600",children:[e.jsx(be,{className:"h-12 w-12 mx-auto mb-4"}),e.jsx("p",{children:"Error al cargar las especies del parque"})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 h-[600px]",children:[e.jsxs(w,{className:"flex flex-col",children:[e.jsxs(T,{children:[e.jsxs(F,{className:"flex items-center gap-2 text-green-700",children:[e.jsx(is,{className:"h-5 w-5"}),"Especies Disponibles (",r.length,")"]}),e.jsx(H,{children:"Especies arb√≥reas que pueden ser asignadas a este parque"}),e.jsxs("div",{className:"relative",children:[e.jsx(We,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(b,{placeholder:"Buscar especies...",value:l,onChange:s=>c(s.target.value),className:"pl-10"})]})]}),e.jsx(E,{className:"flex-1 p-0",children:e.jsx(Te,{className:"h-full px-6 pb-6",children:e.jsxs("div",{className:"space-y-2",children:[r.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border hover:bg-gray-50 cursor-pointer transition-colors",onClick:()=>re(s),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{iconType:s.iconType,customIconUrl:s.customIconUrl,size:32}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium truncate",children:s.commonName}),e.jsx("p",{className:"text-sm text-gray-600 italic truncate",children:s.scientificName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(v,{variant:"outline",className:"text-xs",children:s.family}),e.jsx(v,{variant:s.origin==="Nativo"?"default":"secondary",className:"text-xs",children:s.origin}),s.isEndangered&&e.jsx(v,{variant:"destructive",className:"text-xs",children:"Amenazada"})]})]})]}),e.jsxs(d,{variant:"outline",size:"sm",className:"shrink-0",children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Asignar"]})]},s.id)),r.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No hay especies disponibles"}),l&&e.jsx("p",{className:"text-sm",children:"Intenta con otros t√©rminos de b√∫squeda"})]})]})})})]}),e.jsxs(w,{className:"flex flex-col",children:[e.jsxs(T,{children:[e.jsxs(F,{className:"flex items-center gap-2 text-green-700",children:[e.jsx(ne,{className:"h-5 w-5"}),"Especies del Parque (",(p==null?void 0:p.length)||0,")"]}),e.jsx(H,{children:"Especies arb√≥reas asignadas a este parque"})]}),e.jsx(E,{className:"flex-1 p-0",children:e.jsx(Te,{className:"h-full px-6 pb-6",children:e.jsxs("div",{className:"space-y-2",children:[p==null?void 0:p.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-green-50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ve,{iconType:s.iconType,customIconUrl:s.customIconUrl,size:32}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium truncate",children:s.commonName}),e.jsx("p",{className:"text-sm text-gray-600 italic truncate",children:s.scientificName}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(v,{className:B(s.status),children:xe(s.status)}),s.currentQuantity>0&&e.jsxs(v,{variant:"outline",className:"text-xs",children:[s.currentQuantity," plantados"]}),s.recommendedQuantity&&e.jsxs(v,{variant:"secondary",className:"text-xs",children:["Meta: ",s.recommendedQuantity]}),s.isEndangered&&e.jsx(v,{variant:"destructive",className:"text-xs",children:"Amenazada"})]}),s.plantingZone&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Zona: ",s.plantingZone]})]})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>n(s),children:e.jsx(Je,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>h(s.id),className:"text-red-600 hover:text-red-700",children:e.jsx(me,{className:"h-4 w-4"})})]})]},s.id)),(!p||p.length===0)&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No hay especies asignadas a este parque"}),e.jsx("p",{className:"text-sm",children:"Selecciona especies de la columna izquierda"})]})]})})})]}),e.jsx(te,{open:y,onOpenChange:C,children:e.jsxs(ce,{className:"sm:max-w-[500px]","aria-describedby":"assign-species-description",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Asignar Especie al Parque"}),e.jsxs(Fe,{children:["Configura los detalles de la asignaci√≥n de ",N==null?void 0:N.commonName]})]}),e.jsx("div",{id:"assign-species-description",className:"sr-only",children:"Formulario para asignar una especie arb√≥rea al parque con cantidades y notas"}),e.jsx(ze,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(s=>L.mutate(s)),className:"space-y-4",children:[e.jsx(M,{control:o.control,name:"recommendedQuantity",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Cantidad Recomendada"}),e.jsx(Q,{children:e.jsx(b,{type:"number",placeholder:"Cantidad objetivo a plantar",...s,value:s.value||"",onChange:D=>s.onChange(D.target.value?parseInt(D.target.value):void 0)})}),e.jsx(K,{})]})}),e.jsx(M,{control:o.control,name:"currentQuantity",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Cantidad Actual Plantada"}),e.jsx(Q,{children:e.jsx(b,{type:"number",...s,onChange:D=>s.onChange(parseInt(D.target.value)||0)})}),e.jsx(K,{})]})}),e.jsx(M,{control:o.control,name:"plantingZone",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Zona de Plantaci√≥n (Opcional)"}),e.jsx(Q,{children:e.jsx(b,{placeholder:"Ej. √Årea norte, Sendero principal...",...s})}),e.jsx(K,{})]})}),e.jsx(M,{control:o.control,name:"status",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Estado"}),e.jsxs(Ie,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(Q,{children:e.jsx($e,{children:e.jsx(Ue,{placeholder:"Selecciona el estado"})})}),e.jsxs(Le,{children:[e.jsx(ae,{value:"planificado",children:"Planificado"}),e.jsx(ae,{value:"en_desarrollo",children:"En Desarrollo"}),e.jsx(ae,{value:"establecido",children:"Establecido"})]})]}),e.jsx(K,{})]})}),e.jsx(M,{control:o.control,name:"notes",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Notas (Opcional)"}),e.jsx(Q,{children:e.jsx(pe,{placeholder:"Observaciones sobre la plantaci√≥n...",...s})}),e.jsx(K,{})]})}),e.jsxs(ge,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:L.isPending,className:"bg-green-600 hover:bg-green-700",children:L.isPending?"Asignando...":"Asignar Especie"})]})]})})]})}),e.jsx(te,{open:P,onOpenChange:A,children:e.jsxs(ce,{className:"sm:max-w-[500px]","aria-describedby":"edit-species-description",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Editar Asignaci√≥n de Especie"}),e.jsxs(Fe,{children:["Modifica los detalles de la asignaci√≥n de ",u==null?void 0:u.commonName]})]}),e.jsx("div",{id:"edit-species-description",className:"sr-only",children:"Formulario para editar la asignaci√≥n existente de la especie arb√≥rea"}),e.jsx(ze,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(s=>X.mutate(s)),className:"space-y-4",children:[e.jsx(M,{control:j.control,name:"recommendedQuantity",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Cantidad Recomendada"}),e.jsx(Q,{children:e.jsx(b,{type:"number",placeholder:"Cantidad objetivo a plantar",...s,value:s.value||"",onChange:D=>s.onChange(D.target.value?parseInt(D.target.value):void 0)})}),e.jsx(K,{})]})}),e.jsx(M,{control:j.control,name:"currentQuantity",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Cantidad Actual Plantada"}),e.jsx(Q,{children:e.jsx(b,{type:"number",...s,onChange:D=>s.onChange(parseInt(D.target.value)||0)})}),e.jsx(K,{})]})}),e.jsx(M,{control:j.control,name:"plantingZone",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Zona de Plantaci√≥n"}),e.jsx(Q,{children:e.jsx(b,{placeholder:"Ej. √Årea norte, Sendero principal...",...s})}),e.jsx(K,{})]})}),e.jsx(M,{control:j.control,name:"status",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Estado"}),e.jsxs(Ie,{onValueChange:s.onChange,value:s.value,children:[e.jsx(Q,{children:e.jsx($e,{children:e.jsx(Ue,{placeholder:"Selecciona el estado"})})}),e.jsxs(Le,{children:[e.jsx(ae,{value:"planificado",children:"Planificado"}),e.jsx(ae,{value:"en_desarrollo",children:"En Desarrollo"}),e.jsx(ae,{value:"establecido",children:"Establecido"})]})]}),e.jsx(K,{})]})}),e.jsx(M,{control:j.control,name:"notes",render:({field:s})=>e.jsxs(R,{children:[e.jsx(O,{children:"Notas"}),e.jsx(Q,{children:e.jsx(pe,{placeholder:"Observaciones sobre la plantaci√≥n...",...s})}),e.jsx(K,{})]})}),e.jsxs(ge,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:X.isPending,className:"bg-green-600 hover:bg-green-700",children:X.isPending?"Guardando...":"Guardar Cambios"})]})]})})]})})]})}const Ns={"Arte y Cultura":"bg-pink-100 text-pink-800","Recreaci√≥n y Bienestar":"bg-green-100 text-green-800","Eventos de Temporada":"bg-amber-100 text-amber-800",Deportivo:"bg-red-100 text-red-800",Comunidad:"bg-purple-100 text-purple-800","Naturaleza y Ciencia":"bg-blue-100 text-blue-800","Fitness y Ejercicio":"bg-indigo-100 text-indigo-800","Actividades Familiares":"bg-teal-100 text-teal-800"};function vs({parkId:i}){const[,l]=ns(),{data:c,isLoading:N,error:g}=V({queryKey:[`/api/parks/${i}/activities`],queryFn:async()=>{const t=await fetch(`/api/parks/${i}/activities`);if(!t.ok)throw new Error("Error cargando actividades");return t.json()}}),y=t=>{l(`/admin/organizador/catalogo/${t}`)},C=()=>{l("/admin/activities")};if(N)return e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando actividades..."})]});if(g)return e.jsx("div",{className:"text-center py-8 text-red-500",children:e.jsx("p",{children:"Error cargando actividades del parque"})});const u=Array.isArray(c)?c:[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Actividades del Parque"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[u.length," actividad",u.length!==1?"es":""," programada",u.length!==1?"s":""]})]}),e.jsxs(d,{onClick:C,variant:"outline",className:"border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Gestionar en Actividades"]})]}),u.length===0?e.jsx(w,{children:e.jsx(E,{className:"py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(je,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay actividades programadas"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Comienza agregando la primera actividad para este parque."}),e.jsxs(d,{onClick:C,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Ir al M√≥dulo de Actividades"]})]})})}):e.jsx("div",{className:"grid gap-4",children:u.map(t=>{const P=Ns[t.category]||"bg-gray-100 text-gray-800";return e.jsxs(w,{className:"hover:shadow-md transition-shadow",children:[e.jsx(T,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(F,{className:"text-lg",children:t.title}),e.jsx(v,{className:P,children:t.category})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.description})]}),e.jsx("div",{className:"flex gap-1 ml-4",children:e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>y(t.id),className:"text-green-600 border-green-600 hover:bg-green-50",children:[e.jsx(He,{className:"h-4 w-4 mr-1"}),"Ver detalle"]})})]})}),e.jsxs(E,{className:"pt-0",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Inicio"}),e.jsx("p",{className:"text-gray-600",children:t.startDate?ts(new Date(t.startDate),"dd/MM/yyyy",{locale:cs}):"Sin fecha"})]})]}),t.startTime&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Horario"}),e.jsx("p",{className:"text-gray-600",children:t.startTime})]})]}),t.capacity&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Capacidad"}),e.jsxs("p",{className:"text-gray-600",children:[t.capacity," personas"]})]})]}),t.instructorName&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-gray-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Instructor"}),e.jsx("p",{className:"text-gray-600",children:t.instructorName})]})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[t.isFree&&e.jsx(v,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Gratuita"}),t.price&&e.jsxs(v,{variant:"outline",className:"bg-yellow-50 text-yellow-700 border-yellow-200",children:["$",t.price," MXN"]}),t.isRecurring&&e.jsx(v,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"Recurrente"}),t.duration&&e.jsxs(v,{variant:"outline",className:"bg-gray-50 text-gray-700 border-gray-200",children:[t.duration," min"]})]})]})]},t.id)})})]})}const _e={active:"Activo",inactive:"Inactivo",pending:"Pendiente",suspended:"Suspendido"};function ys({parkId:i}){const{toast:l}=Ne(),c=ve(),[N,g]=x.useState(""),[y,C]=x.useState("all"),{data:u=[],isLoading:t}=V({queryKey:[`/api/parks/${i}/volunteers`],queryFn:async()=>{console.log("üîç FRONTEND: Cargando voluntarios asignados para parque",i);const r=await fetch(`/api/parks/${i}/volunteers`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!r.ok)throw new Error("Error cargando voluntarios asignados");const o=await r.json();return console.log("‚úÖ FRONTEND: Voluntarios asignados cargados:",o),o},enabled:!!i}),{data:P=[]}=V({queryKey:["/api/volunteers"],queryFn:async()=>{const r=await fetch("/api/volunteers",{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!r.ok)throw new Error("Error cargando voluntarios disponibles");return r.json()}}),A=u.map(r=>r.id),f=P.filter(r=>!A.includes(r.id)&&r.status==="active").filter(r=>{var L;const o=N===""||r.fullName.toLowerCase().includes(N.toLowerCase())||r.email.toLowerCase().includes(N.toLowerCase())||((L=r.skills)==null?void 0:L.toLowerCase().includes(N.toLowerCase())),j=y==="all"||r.status===y;return o&&j}),p=z({mutationFn:async r=>{const o=await fetch(`/api/parks/${i}/volunteers`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"},body:JSON.stringify({volunteerId:r})});if(!o.ok)throw new Error("Error asignando voluntario");return o.json()},onSuccess:()=>{c.invalidateQueries({queryKey:[`/api/parks/${i}/volunteers`]}),c.invalidateQueries({queryKey:["/api/volunteers"]}),l({title:"Voluntario asignado",description:"El voluntario ha sido asignado correctamente al parque"})},onError:r=>{l({title:"Error",description:"Error al asignar voluntario al parque",variant:"destructive"})}}),$=z({mutationFn:async r=>{const o=await fetch(`/api/parks/${i}/volunteers/${r}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!o.ok)throw new Error("Error removiendo voluntario");return o.json()},onSuccess:()=>{c.invalidateQueries({queryKey:[`/api/parks/${i}/volunteers`]}),c.invalidateQueries({queryKey:["/api/volunteers"]}),l({title:"Voluntario removido",description:"El voluntario ha sido removido correctamente del parque"})},onError:r=>{l({title:"Error",description:"Error al remover voluntario del parque",variant:"destructive"})}}),S=r=>{p.mutate(r)},I=r=>{$.mutate(r)},q=r=>({active:"default",inactive:"secondary",pending:"outline",suspended:"destructive"})[r]||"secondary",U=r=>new Date(r).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"});return e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Voluntarios Disponibles (",f.length,")"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(We,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(b,{placeholder:"Buscar voluntarios...",value:N,onChange:r=>g(r.target.value),className:"pl-10"})]}),e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>{g(""),C("all")},children:[e.jsx(os,{className:"h-4 w-4 mr-1"}),"Limpiar"]})]})]}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:[f.map(r=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:r.fullName}),e.jsx(v,{variant:q(r.status),children:_e[r.status]||r.status})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:r.email})]}),r.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:r.phone})]}),r.skills&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Habilidades:"}),e.jsx("span",{className:"text-gray-600",children:r.skills})]}),r.age&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ds,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:[r.age," a√±os"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Registrado:"}),e.jsx("span",{className:"text-gray-600",children:U(r.createdAt)})]})]})]}),e.jsxs(d,{size:"sm",onClick:()=>S(r.id),disabled:p.isPending,children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Asignar"]})]})},r.id)),f.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(W,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay voluntarios disponibles"}),e.jsx("p",{className:"text-sm",children:"Todos los voluntarios activos ya est√°n asignados a parques."})]})]})})]}),e.jsxs(w,{children:[e.jsx(T,{children:e.jsxs(F,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Voluntarios Asignados (",u.length,")"]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-3 max-h-[600px] overflow-y-auto",children:[u.map(r=>e.jsx("div",{className:"border rounded-lg p-4 bg-green-50 hover:bg-green-100 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("h4",{className:"font-semibold",children:r.fullName}),e.jsx(v,{variant:q(r.status),children:_e[r.status]||r.status})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:r.email})]}),r.phone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Qe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:r.phone})]}),r.skills&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Habilidades:"}),e.jsx("span",{className:"text-gray-600",children:r.skills})]}),r.interestAreas&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Intereses:"}),e.jsx("span",{className:"text-gray-600",children:r.interestAreas})]})]})]}),e.jsxs(d,{size:"sm",variant:"destructive",onClick:()=>I(r.id),disabled:$.isPending,children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Remover"]})]})},r.id)),u.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(W,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay voluntarios asignados"}),e.jsx("p",{className:"text-sm",children:"Selecciona voluntarios de la columna izquierda para asignarlos a este parque."})]})]})})]})]})}function Cs(){const{id:i}=ms(),{data:l,isLoading:c,error:N}=V({queryKey:[`/api/parks/${i}`],queryFn:async()=>{const g=await fetch(`/api/parks/${i}`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!g.ok)throw new Error("Error cargando parque");return g.json()},enabled:!!i});return c?e.jsx(fe,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando parque..."})]})})}):N||!l?e.jsx(fe,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600",children:"Error cargando el parque"}),e.jsx(Ke,{href:"/admin/parks",children:e.jsx(d,{className:"mt-4",children:"Volver a parques"})})]})})}):e.jsx(fe,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ke,{href:"/admin/parks",children:e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(xs,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:l.name}),e.jsxs("div",{className:"flex items-center text-gray-600 mt-1",children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:l.address})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(us,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-600",children:"Modo Gesti√≥n"})]})]}),e.jsxs(Ge,{defaultValue:"multimedia",className:"space-y-4",children:[e.jsxs(Ze,{className:"grid w-full grid-cols-6",children:[e.jsxs(G,{value:"multimedia",className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),"Multimedia"]}),e.jsxs(G,{value:"amenidades",className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4"}),"Amenidades"]}),e.jsxs(G,{value:"actividades",className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Actividades"]}),e.jsxs(G,{value:"arboles",className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"√Årboles"]}),e.jsxs(G,{value:"voluntarios",className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Voluntarios"]}),e.jsxs(G,{value:"incidencias",className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Incidencias"]})]}),e.jsx(Z,{value:"multimedia",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(F,{className:"text-2xl text-blue-600 flex items-center gap-2",children:[e.jsx(Xe,{className:"h-6 w-6"}),"Gesti√≥n de Multimedia del Parque"]}),e.jsx(H,{children:"Administra im√°genes y documentos del parque. Puedes subir archivos o usar URLs externas."})]}),e.jsx(E,{children:e.jsx(hs,{parkId:parseInt(i||"0")})})]})}),e.jsx(Z,{value:"amenidades",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(F,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(ie,{className:"h-6 w-6"}),"Gesti√≥n de Amenidades del Parque"]}),e.jsx(H,{children:"Administra las amenidades y servicios disponibles en el parque. Puedes agregar nuevas amenidades o editar las existentes."})]}),e.jsx(E,{children:e.jsx(gs,{parkId:parseInt(i)})})]})}),e.jsx(Z,{value:"actividades",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(F,{className:"text-2xl text-blue-600 flex items-center gap-2",children:[e.jsx(je,{className:"h-6 w-6"}),"Actividades del Parque"]}),e.jsx(H,{children:"Visualiza las actividades programadas en este parque. Para gestionar actividades, utiliza el m√≥dulo de Actividades."})]}),e.jsx(E,{children:e.jsx(vs,{parkId:parseInt(i)})})]})}),e.jsx(Z,{value:"arboles",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(F,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(ne,{className:"h-6 w-6"}),"Gesti√≥n de Especies Arb√≥reas del Parque"]}),e.jsx(H,{children:"Administra las especies arb√≥reas asignadas al parque. Puedes seleccionar especies del cat√°logo y configurar detalles de plantaci√≥n."})]}),e.jsx(E,{children:e.jsx(js,{parkId:parseInt(i)})})]})}),e.jsx(Z,{value:"voluntarios",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsxs(F,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(W,{className:"h-6 w-6"}),"Gesti√≥n de Voluntarios del Parque"]}),e.jsx(H,{children:"Administra los voluntarios asignados al parque. Selecciona voluntarios disponibles de la columna izquierda para asignarlos a este parque."})]}),e.jsx(E,{children:e.jsx(ys,{parkId:parseInt(i)})})]})}),e.jsx(Z,{value:"incidencias",className:"space-y-4",children:e.jsxs(w,{children:[e.jsxs(T,{children:[e.jsx(F,{children:"Gesti√≥n de Incidencias"}),e.jsx(H,{children:"Administra las incidencias reportadas en el parque."})]}),e.jsx(E,{children:e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(be,{className:"h-12 w-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Funcionalidad de gesti√≥n de incidencias pr√≥ximamente"})]})})]})})]})]})})}export{Cs as default};
