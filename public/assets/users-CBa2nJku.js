import{aw as R,e as P,a6 as q,Y as j,u as B,a8 as F,j as e,aB as I,bg as L,B as f,aW as A,Z as M,I as m,b3 as z,b4 as G,D as O,r as K,t as Q,v as V,w as $,ap as J,aX as W,z as D,H as U,J as E,K as T,N as c,O as H,b7 as X}from"./index-BBGHPKhn.js";import{C as _}from"./camera-B2fB-hXh.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=R("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]),Z=a=>{switch(a){case"admin":return"bg-red-500 text-white";case"manager":return"bg-purple-500 text-white";case"supervisor":return"bg-orange-500 text-white";case"instructor":return"bg-blue-500 text-white";case"voluntario":return"bg-green-500 text-white";case"concesionario":return"bg-yellow-600 text-white";default:return"bg-gray-500 text-white"}},ee=a=>{switch(a){case"admin":return"Administrador";case"manager":return"Gestor";case"supervisor":return"Supervisor";case"instructor":return"Instructor";case"voluntario":return"Voluntario";case"concesionario":return"Concesionario";default:return a}},ae=({user:a,isNew:d,onClose:t,onSave:h,isSaving:u})=>{const{toast:g}=P(),[l,p]=j.useState({role:(a==null?void 0:a.role)||"instructor",username:(a==null?void 0:a.username)||"",email:(a==null?void 0:a.email)||"",fullName:(a==null?void 0:a.fullName)||"",password:"",phone:(a==null?void 0:a.phone)||"",gender:(a==null?void 0:a.gender)||"no_especificar",birthDate:(a==null?void 0:a.birthDate)||"",bio:(a==null?void 0:a.bio)||"",municipalityId:(a==null?void 0:a.municipalityId)||null,profileImageFile:null}),[v,N]=j.useState((a==null?void 0:a.profileImageUrl)||null),i=(s,o)=>{p(n=>({...n,[s]:o}))},C=s=>{var n;const o=(n=s.target.files)==null?void 0:n[0];if(o){if(o.size>5*1024*1024){g({title:"Archivo muy grande",description:"La imagen debe ser menor a 5MB",variant:"destructive"});return}const y=new FileReader;y.onload=w=>{var x;N((x=w.target)==null?void 0:x.result)},y.readAsDataURL(o),p(w=>({...w,profileImageFile:o}))}},S=()=>{N(null),p(s=>({...s,profileImageFile:null}))},r=s=>{s.preventDefault(),h(l)};return e.jsx(O,{open:!0,onOpenChange:t,children:e.jsxs(K,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Q,{children:[e.jsx(V,{className:"text-xl font-bold",children:d?"👤 Crear Nuevo Usuario":"✏️ Editar Usuario"}),e.jsx($,{children:d?"Agrega un nuevo usuario al sistema":"Modifica la información del usuario"})]}),e.jsxs("form",{onSubmit:r,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 p-6 rounded-lg border-2 border-blue-200",children:[e.jsx("h4",{className:"font-semibold text-blue-800 mb-4",children:"📸 Fotografía de Perfil"}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"flex-shrink-0",children:v?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:v,alt:"Preview",className:"w-24 h-24 rounded-full object-cover border-4 border-blue-300 shadow-lg"}),e.jsx("button",{type:"button",onClick:S,className:"absolute -top-1 -right-1 bg-red-500 text-white rounded-full p-1 hover:bg-red-600 transition-colors",children:e.jsx(J,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"w-24 h-24 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 flex items-center justify-center",children:e.jsx(_,{className:"h-8 w-8 text-gray-600"})})}),e.jsx("div",{className:"flex-1",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("div",{className:"bg-white border-2 border-dashed border-blue-300 rounded-lg p-4 text-center hover:border-blue-400 transition-colors",children:[e.jsx(W,{className:"h-8 w-8 text-blue-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Subir fotografía"}),e.jsx("p",{className:"text-xs text-blue-600",children:"JPG, PNG o WEBP (máx. 5MB)"})]}),e.jsx("input",{type:"file",accept:"image/*",onChange:C,className:"hidden"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:"Información Básica"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fullName",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Nombre Completo *"}),e.jsx(m,{id:"fullName",value:l.fullName,onChange:s=>i("fullName",s.target.value),placeholder:"Nombre completo del usuario",className:"border-2 focus:border-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"username",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Usuario *"}),e.jsx(m,{id:"username",value:l.username,onChange:s=>i("username",s.target.value),placeholder:"Nombre de usuario único",className:"border-2 focus:border-blue-500",required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"role",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Rol *"}),e.jsxs(D,{value:l.role,onValueChange:s=>i("role",s),children:[e.jsx(U,{className:"border-2 focus:border-blue-500",children:e.jsx(E,{placeholder:"Seleccionar rol"})}),e.jsxs(T,{children:[e.jsx(c,{value:"admin",children:"🔴 Administrador"}),e.jsx(c,{value:"manager",children:"🟣 Gestor"}),e.jsx(c,{value:"supervisor",children:"🟠 Supervisor"}),e.jsx(c,{value:"instructor",children:"🔵 Instructor"}),e.jsx(c,{value:"voluntario",children:"🟢 Voluntario"}),e.jsx(c,{value:"concesionario",children:"🟡 Concesionario"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Correo Electrónico *"}),e.jsx(m,{id:"email",type:"email",value:l.email,onChange:s=>i("email",s.target.value),placeholder:"usuario@ejemplo.com",className:"border-2 focus:border-blue-500",required:!0})]})]}),d&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"password",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Contraseña *"}),e.jsx(m,{id:"password",type:"password",value:l.password,onChange:s=>i("password",s.target.value),placeholder:"Contraseña segura",className:"border-2 focus:border-blue-500",required:!0})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-gray-700",children:"Información Personal"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Teléfono"}),e.jsx(m,{id:"phone",value:l.phone,onChange:s=>i("phone",s.target.value),placeholder:"Número de teléfono",className:"border-2 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"birthDate",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Fecha de Nacimiento"}),e.jsx(m,{id:"birthDate",type:"date",value:l.birthDate,onChange:s=>i("birthDate",s.target.value),className:"border-2 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Género"}),e.jsxs(D,{value:l.gender,onValueChange:s=>i("gender",s),children:[e.jsx(U,{className:"border-2 focus:border-blue-500",children:e.jsx(E,{placeholder:"Seleccionar género"})}),e.jsxs(T,{children:[e.jsx(c,{value:"masculino",children:"Masculino"}),e.jsx(c,{value:"femenino",children:"Femenino"}),e.jsx(c,{value:"no_especificar",children:"Prefiero no especificar"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bio",className:"text-sm font-medium text-gray-700 mb-1 block",children:"Biografía"}),e.jsx(H,{id:"bio",value:l.bio,onChange:s=>i("bio",s.target.value),placeholder:"Breve descripción personal o profesional",rows:3,className:"border-2 focus:border-blue-500"})]})]}),e.jsxs(X,{className:"pt-6 border-t",children:[e.jsx(f,{type:"button",variant:"outline",onClick:t,disabled:u,className:"px-6",children:"Cancelar"}),e.jsxs(f,{type:"submit",disabled:u,className:"px-6 bg-green-600 hover:bg-green-700",children:[u&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),d?"✅ Crear Usuario":"💾 Guardar Cambios"]})]})]})]})})};function le(){const{toast:a}=P(),d=q(),[t,h]=j.useState(null),[u,g]=j.useState(!1),[l,p]=j.useState(""),{data:v=[],isLoading:N}=B({queryKey:["/api/users",Date.now()],staleTime:0,refetchOnWindowFocus:!0,refetchOnMount:!0}),i=F({mutationFn:async r=>{const s=t!==null;let o=null;if(r.profileImageFile){const b=new FormData;b.append("image",r.profileImageFile),s&&(t!=null&&t.id)&&b.append("userId",t.id.toString());const k=await fetch("/api/upload/user-profile",{method:"POST",body:b});k.ok&&(o=(await k.json()).url)}const n={...r,profileImageUrl:o||(s?t==null?void 0:t.profileImageUrl:null)};delete n.profileImageFile;const y=s?`/api/users/${t==null?void 0:t.id}`:"/api/users",x=await fetch(y,{method:s?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!x.ok){const b=await x.text();throw new Error(b||"Error al guardar usuario")}return x.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/users"]}),d.refetchQueries({queryKey:["/api/users"]}),a({title:"¡Éxito!",description:t?"Usuario actualizado correctamente":"Usuario creado correctamente"}),h(null),g(!1),setTimeout(()=>{window.location.reload()},1e3)},onError:r=>{a({title:"Error",description:r.message,variant:"destructive"})}}),C=F({mutationFn:async r=>{if(!(await fetch(`/api/users/${r}`,{method:"DELETE"})).ok)throw new Error("Error al eliminar usuario")},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/users"]}),a({title:"Usuario eliminado",description:"El usuario ha sido eliminado correctamente"})},onError:()=>{a({title:"Error",description:"No se pudo eliminar el usuario",variant:"destructive"})}}),S=v.filter(r=>{var s,o,n;return((s=r.fullName)==null?void 0:s.toLowerCase().includes(l.toLowerCase()))||((o=r.email)==null?void 0:o.toLowerCase().includes(l.toLowerCase()))||((n=r.username)==null?void 0:n.toLowerCase().includes(l.toLowerCase()))});return N?e.jsx(I,{children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(L,{className:"mx-auto h-8 w-8 animate-spin"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando usuarios..."})]})}):e.jsx(I,{children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"👥 Gestión de Usuarios"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Administración de personal y usuarios del sistema ParkSys"})]}),e.jsxs(f,{onClick:()=>g(!0),className:"bg-green-600 hover:bg-green-700 shadow-lg",size:"lg",children:[e.jsx(A,{className:"h-5 w-5 mr-2"}),"Nuevo Usuario"]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx(m,{placeholder:"🔍 Buscar usuarios por nombre, email o usuario...",value:l,onChange:r=>p(r.target.value),className:"pl-10 py-3 text-lg"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"👤 Usuario"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"🏷️ Rol"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"📞 Contacto"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"📅 Registro"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-bold text-gray-700 uppercase tracking-wider",children:"⚙️ Acciones"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:S.map(r=>e.jsxs("tr",{className:"hover:bg-blue-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-12 w-12",children:r.profileImageUrl?e.jsx("img",{className:"h-12 w-12 rounded-full object-cover border-2 border-blue-300 shadow-sm",src:`${r.profileImageUrl}?t=${Date.now()}`,alt:r.fullName}):e.jsx("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 flex items-center justify-center",children:e.jsx(Y,{className:"h-6 w-6 text-gray-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:r.fullName}),e.jsxs("div",{className:"text-sm text-gray-500",children:["@",r.username]})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex px-3 py-1 text-xs font-bold rounded-full ${Z(r.role)}`,children:ee(r.role)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900",children:r.email}),e.jsx("div",{className:"text-sm text-gray-500",children:r.phone||"Sin teléfono"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(r.createdAt).toLocaleDateString("es-ES")}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsxs(f,{onClick:()=>h(r),variant:"outline",size:"sm",className:"hover:bg-blue-50",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Editar"]}),e.jsxs(f,{onClick:()=>C.mutate(r.id),variant:"outline",size:"sm",className:"hover:bg-red-50 text-red-600 border-red-200",children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]},r.id))})]})})}),(u||t)&&e.jsx(ae,{user:t,isNew:u,onClose:()=>{h(null),g(!1)},onSave:r=>i.mutate(r),isSaving:i.isPending})]})})}export{le as default};
