import{ad as r,az as W,l as Y,ae as _,a2 as V,af as $,u as U,j as e,aX as Z,B as h,A as ee,dx as ae,ai as se,b1 as ne,b2 as re,b3 as D,b4 as w,f as k,g as P,h as I,ab as F,i as q,aj as l,ak as c,al as i,am as o,O as u,aF as t,an as d,Q as p,V as b,W as v,Y as C,aB as L,_ as y,M as O,$ as T,cc as A,ao as f,ap as le,aq as ce}from"./index-D5qLf1ib.js";import{H as ie}from"./Helmet-BNepwt1P.js";import{D as M}from"./date-picker-BGQBE3iK.js";import{S as oe}from"./separator-Bek7HtsH.js";import{R as te}from"./ruler-CydzKUS0.js";const de=r.object({code:r.string().optional(),speciesId:r.string().min(1,{message:"Debe seleccionar una especie"}),parkId:r.string().min(1,{message:"Debe seleccionar un parque"}),latitude:r.string().min(1,{message:"La latitud es obligatoria"}),longitude:r.string().min(1,{message:"La longitud es obligatoria"}),plantingDate:r.date().nullable(),developmentStage:r.string().nullable(),ageEstimate:r.coerce.number().int().nullable(),height:r.coerce.number().positive().nullable(),diameter:r.coerce.number().positive().nullable(),canopyCoverage:r.coerce.number().positive().nullable(),healthStatus:r.string(),physicalCondition:r.string().nullable(),hasHollows:r.boolean().default(!1),hasExposedRoots:r.boolean().default(!1),hasPests:r.boolean().default(!1),observations:r.string().nullable(),lastInspectionDate:r.date().nullable(),isProtected:r.boolean().default(!1),locationDescription:r.string().nullable(),imageUrl:r.string().nullable()});function ge(){const[,g]=W(),{toast:j}=Y(),z=_(),[H,m]=V.useState("location"),[R,N]=V.useState(!1),n=$({resolver:le(de),defaultValues:{code:"",speciesId:"",parkId:"",latitude:"",longitude:"",plantingDate:null,developmentStage:"Juvenil",ageEstimate:null,height:null,diameter:null,canopyCoverage:null,healthStatus:"Bueno",physicalCondition:"",hasHollows:!1,hasExposedRoots:!1,hasPests:!1,observations:"",lastInspectionDate:null,isProtected:!1,locationDescription:"",imageUrl:""}}),{data:E,isLoading:B}=U({queryKey:["/api/tree-species"],queryFn:async()=>{const a=await fetch("/api/tree-species");if(!a.ok)throw new Error("Error al cargar las especies arbóreas");return a.json()}}),{data:S,isLoading:Q}=U({queryKey:["/api/parks"],queryFn:async()=>{const a=await fetch("/api/parks");if(!a.ok)throw new Error("Error al cargar los parques");return a.json()}}),G=async a=>{try{const s={...a,speciesId:parseInt(a.speciesId),parkId:parseInt(a.parkId)};(!s.code||s.code.trim()==="")&&delete s.code,await ce("/api/trees",{method:"POST",body:JSON.stringify(s)}),j({title:"Árbol registrado",description:"El árbol ha sido agregado correctamente al inventario.",variant:"success"}),z.invalidateQueries({queryKey:["/api/trees"]}),g("/admin/trees/inventory")}catch(s){console.error("Error al crear el árbol:",s),j({title:"Error",description:"No se pudo registrar el árbol. Por favor, intenta nuevamente.",variant:"destructive"})}},J=()=>{navigator.geolocation?(N(!0),navigator.geolocation.getCurrentPosition(a=>{n.setValue("latitude",a.coords.latitude.toString()),n.setValue("longitude",a.coords.longitude.toString()),N(!1),j({title:"Ubicación obtenida",description:"Las coordenadas de tu ubicación actual han sido capturadas.",variant:"success"})},a=>{console.error("Error al obtener la ubicación:",a),N(!1),j({title:"Error de geolocalización",description:"No se pudo obtener tu ubicación actual. Por favor, ingresa las coordenadas manualmente.",variant:"destructive"})})):j({title:"Geolocalización no soportada",description:"Tu navegador no soporta la geolocalización. Por favor, ingresa las coordenadas manualmente.",variant:"destructive"})},K=[{value:"Juvenil",label:"Juvenil"},{value:"Maduro",label:"Maduro"},{value:"Senescente",label:"Senescente"}],X=[{value:"Bueno",label:"Bueno"},{value:"Regular",label:"Regular"},{value:"Malo",label:"Malo"},{value:"Crítico",label:"Crítico"}];return e.jsxs(Z,{children:[e.jsxs(ie,{children:[e.jsx("title",{children:"Agregar Árbol | Inventario Arbóreo | ParquesMX"}),e.jsx("meta",{name:"description",content:"Agregar un nuevo árbol al inventario de parques municipales"})]}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>g("/admin/trees/inventory"),className:"mr-2",children:e.jsx(ee,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-green-800 flex items-center",children:[e.jsx(ae,{className:"mr-2 h-8 w-8"}),"Agregar Árbol al Inventario"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Registra un nuevo árbol en el sistema con todos sus detalles"})]})]}),e.jsx(se,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(G),className:"space-y-6",children:e.jsxs(ne,{defaultValue:"location",value:H,onValueChange:m,children:[e.jsxs(re,{className:"grid grid-cols-3 mb-4",children:[e.jsx(D,{value:"location",children:"Ubicación"}),e.jsx(D,{value:"characteristics",children:"Características"}),e.jsx(D,{value:"health",children:"Estado y Observaciones"})]}),e.jsx(w,{value:"location",children:e.jsxs(k,{children:[e.jsxs(P,{children:[e.jsx(I,{children:"Datos de Ubicación"}),e.jsx(F,{children:"Información sobre la ubicación del árbol en el parque"})]}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:n.control,name:"code",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Código Identificador"}),e.jsx(o,{children:e.jsx(u,{placeholder:"Se genera automáticamente",...a,disabled:!0,className:"bg-gray-50 text-gray-500"})}),e.jsx(t,{children:"El código único se genera automáticamente usando el formato ESPECIE-PARQUE-NÚMERO"}),e.jsx(d,{})]})}),e.jsx(l,{control:n.control,name:"parkId",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Parque*"}),e.jsxs(p,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(o,{children:e.jsx(b,{children:e.jsx(v,{placeholder:"Selecciona un parque"})})}),e.jsx(C,{children:Q?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx(L,{className:"h-6 w-6 animate-spin text-gray-500"})}):S==null?void 0:S.map(s=>e.jsx(y,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(t,{children:"Parque donde se encuentra el árbol"}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:n.control,name:"speciesId",render:({field:a})=>{var s;return e.jsxs(c,{children:[e.jsx(i,{children:"Especie*"}),e.jsxs(p,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(o,{children:e.jsx(b,{children:e.jsx(v,{placeholder:"Selecciona una especie"})})}),e.jsx(C,{children:B?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx(L,{className:"h-6 w-6 animate-spin text-gray-500"})}):(s=E==null?void 0:E.data)==null?void 0:s.map(x=>e.jsxs(y,{value:x.id.toString(),children:[x.commonName," (",x.scientificName,")"]},x.id))})]}),e.jsx(t,{children:"Especie a la que pertenece el árbol"}),e.jsx(d,{})]})}}),e.jsx(l,{control:n.control,name:"plantingDate",render:({field:a})=>e.jsxs(c,{className:"flex flex-col",children:[e.jsx(i,{children:"Fecha de Plantación"}),e.jsx(o,{children:e.jsx(M,{date:a.value,setDate:a.onChange,placeholder:"Selecciona una fecha"})}),e.jsx(t,{children:"Fecha en que se plantó el árbol (si se conoce)"}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center",children:[e.jsx(O,{className:"h-5 w-5 mr-2 text-green-600"}),"Geolocalización"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Coordenadas exactas donde se encuentra el árbol"})]}),e.jsx(h,{type:"button",variant:"outline",onClick:J,disabled:R,children:R?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 mr-2 animate-spin"}),"Obteniendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Usar mi ubicación"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:n.control,name:"latitude",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Latitud*"}),e.jsx(o,{children:e.jsx(u,{placeholder:"Ej: 20.6736",...a})}),e.jsx(d,{})]})}),e.jsx(l,{control:n.control,name:"longitude",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Longitud*"}),e.jsx(o,{children:e.jsx(u,{placeholder:"Ej: -103.3456",...a})}),e.jsx(d,{})]})})]})]}),e.jsx(l,{control:n.control,name:"locationDescription",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Descripción de la Ubicación"}),e.jsx(o,{children:e.jsx(T,{placeholder:"Describe la ubicación del árbol dentro del parque...",...a,value:a.value||""})}),e.jsx(t,{children:'Descripción que ayude a ubicar el árbol (ej: "Cerca de la entrada principal")'}),e.jsx(d,{})]})})]})]}),e.jsxs(A,{className:"flex justify-between",children:[e.jsx(h,{variant:"outline",onClick:()=>g("/admin/trees/inventory"),children:"Cancelar"}),e.jsx(h,{type:"button",onClick:()=>m("characteristics"),children:"Siguiente"})]})]})}),e.jsx(w,{value:"characteristics",children:e.jsxs(k,{children:[e.jsxs(P,{children:[e.jsx(I,{children:"Características Físicas"}),e.jsx(F,{children:"Información sobre las características físicas y dimensiones del árbol"})]}),e.jsxs(q,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(l,{control:n.control,name:"developmentStage",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Etapa de Desarrollo"}),e.jsxs(p,{onValueChange:a.onChange,defaultValue:a.value||"",children:[e.jsx(o,{children:e.jsx(b,{children:e.jsx(v,{placeholder:"Selecciona una etapa"})})}),e.jsx(C,{children:K.map(s=>e.jsx(y,{value:s.value,children:s.label},s.value))})]}),e.jsx(t,{children:"Etapa actual de desarrollo del árbol"}),e.jsx(d,{})]})}),e.jsx(l,{control:n.control,name:"ageEstimate",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Edad Estimada (años)"}),e.jsx(o,{children:e.jsx(u,{type:"number",min:"0",placeholder:"Ej: 15",...a,value:a.value===null?"":a.value,onChange:s=>{const x=s.target.value===""?null:parseInt(s.target.value);a.onChange(x)}})}),e.jsx(t,{children:"Edad aproximada del árbol en años"}),e.jsx(d,{})]})}),e.jsx(l,{control:n.control,name:"imageUrl",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"URL de Imagen"}),e.jsx(o,{children:e.jsx(u,{placeholder:"https://ejemplo.com/imagen.jpg",...a,value:a.value||""})}),e.jsx(t,{children:"URL de una fotografía del árbol"}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center mb-4",children:[e.jsx(te,{className:"h-5 w-5 mr-2 text-green-600"}),"Dimensiones"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(l,{control:n.control,name:"height",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Altura (metros)"}),e.jsx(o,{children:e.jsx(u,{type:"number",step:"0.1",min:"0",placeholder:"Ej: 12.5",...a,value:a.value===null?"":a.value,onChange:s=>{const x=s.target.value===""?null:parseFloat(s.target.value);a.onChange(x)}})}),e.jsx(t,{children:"Altura aproximada en metros"}),e.jsx(d,{})]})}),e.jsx(l,{control:n.control,name:"diameter",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Diámetro del Tronco (cm)"}),e.jsx(o,{children:e.jsx(u,{type:"number",step:"0.1",min:"0",placeholder:"Ej: 45.2",...a,value:a.value===null?"":a.value,onChange:s=>{const x=s.target.value===""?null:parseFloat(s.target.value);a.onChange(x)}})}),e.jsx(t,{children:"Diámetro a la altura del pecho (DAP)"}),e.jsx(d,{})]})}),e.jsx(l,{control:n.control,name:"canopyCoverage",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Cobertura de Copa (m²)"}),e.jsx(o,{children:e.jsx(u,{type:"number",step:"0.1",min:"0",placeholder:"Ej: 28.3",...a,value:a.value===null?"":a.value,onChange:s=>{const x=s.target.value===""?null:parseFloat(s.target.value);a.onChange(x)}})}),e.jsx(t,{children:"Área que cubre la copa en metros cuadrados"}),e.jsx(d,{})]})})]})]})]}),e.jsxs(A,{className:"flex justify-between",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>m("location"),children:"Anterior"}),e.jsx(h,{type:"button",onClick:()=>m("health"),children:"Siguiente"})]})]})}),e.jsx(w,{value:"health",children:e.jsxs(k,{children:[e.jsxs(P,{children:[e.jsx(I,{children:"Estado y Observaciones"}),e.jsx(F,{children:"Información sobre el estado de salud del árbol y observaciones adicionales"})]}),e.jsxs(q,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(l,{control:n.control,name:"healthStatus",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Estado de Salud"}),e.jsxs(p,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(o,{children:e.jsx(b,{children:e.jsx(v,{placeholder:"Selecciona un estado"})})}),e.jsx(C,{children:X.map(s=>e.jsx(y,{value:s.value,children:s.label},s.value))})]}),e.jsx(t,{children:"Evaluación general del estado del árbol"}),e.jsx(d,{})]})}),e.jsx(l,{control:n.control,name:"lastInspectionDate",render:({field:a})=>e.jsxs(c,{className:"flex flex-col",children:[e.jsx(i,{children:"Fecha de Última Inspección"}),e.jsx(o,{children:e.jsx(M,{date:a.value,setDate:a.onChange,placeholder:"Selecciona una fecha"})}),e.jsx(t,{children:"Fecha de la última inspección realizada"}),e.jsx(d,{})]})})]}),e.jsx(l,{control:n.control,name:"physicalCondition",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Condición Física"}),e.jsx(o,{children:e.jsx(T,{placeholder:"Describe la condición física del árbol...",...a,value:a.value||""})}),e.jsx(t,{children:"Detalles sobre la condición física (inclinación, vigor, etc.)"}),e.jsx(d,{})]})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Condiciones Específicas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(l,{control:n.control,name:"hasHollows",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 p-4",children:[e.jsx(o,{children:e.jsx(f,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(i,{children:"Presencia de Huecos"}),e.jsx(t,{children:"El árbol tiene cavidades o huecos"})]})]})}),e.jsx(l,{control:n.control,name:"hasExposedRoots",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 p-4",children:[e.jsx(o,{children:e.jsx(f,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(i,{children:"Raíces Expuestas"}),e.jsx(t,{children:"El árbol tiene raíces visibles en superficie"})]})]})}),e.jsx(l,{control:n.control,name:"hasPests",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 p-4",children:[e.jsx(o,{children:e.jsx(f,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(i,{children:"Presencia de Plagas"}),e.jsx(t,{children:"El árbol tiene signos de plagas o enfermedades"})]})]})})]})]}),e.jsx(oe,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(l,{control:n.control,name:"observations",render:({field:a})=>e.jsxs(c,{children:[e.jsx(i,{children:"Observaciones Adicionales"}),e.jsx(o,{children:e.jsx(T,{placeholder:"Observaciones adicionales sobre el árbol...",className:"min-h-[100px]",...a,value:a.value||""})}),e.jsx(t,{children:"Cualquier información adicional relevante"}),e.jsx(d,{})]})}),e.jsx(l,{control:n.control,name:"isProtected",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 p-4 border border-green-200 bg-green-50 rounded-lg",children:[e.jsx(o,{children:e.jsx(f,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(i,{className:"text-green-800",children:"Árbol con Protección Especial"}),e.jsx(t,{className:"text-green-700",children:"Marcar si el árbol tiene alguna designación especial de protección"})]})]})})]})]}),e.jsxs(A,{className:"flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>g("/admin/trees/inventory"),children:"Cancelar"}),e.jsx(h,{type:"button",variant:"outline",onClick:()=>m("characteristics"),children:"Anterior"})]}),e.jsx(h,{type:"submit",className:"bg-green-600 hover:bg-green-700",children:"Guardar Árbol"})]})]})})]})})})]})]})}export{ge as default};
