import{c as ge,l as fe,ae as ve,a2 as g,u as N,ag as U,af as K,ap as Q,j as e,aX as be,f as j,g as C,h as S,bp as ye,ab as w,i as u,Q as B,V as R,W as J,Y as W,_ as v,b1 as Ne,b2 as Ce,b3 as D,b4 as P,w as X,x as Y,B as d,bh as Z,y as ee,z as se,I as ae,J as ne,ai as re,aj as n,ak as r,al as i,am as t,O as o,an as l,aF as I,br as $,o as b,bq as ie,au as Se,bn as we,c$ as Me,ad as a,as as te,M as Te,a$ as Ae,aq as ce}from"./index-D5qLf1ib.js";import{H as Fe}from"./Helmet-BNepwt1P.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=ge("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),Pe=a.object({contractId:a.number(),configName:a.string().min(1,"Nombre requerido"),description:a.string().optional(),isActive:a.boolean().default(!0),hasMinimumGuarantee:a.boolean().default(!1),minimumGuaranteeAmount:a.string().optional(),effectiveFrom:a.string(),effectiveTo:a.string().optional()}),Ie=a.object({paymentConfigId:a.number().optional(),name:a.string().min(1,"Nombre requerido"),description:a.string().optional(),chargeType:a.enum(["fixed","percentage","per_unit","per_m2"]),fixedAmount:a.string().optional(),percentage:a.string().optional(),perUnitAmount:a.string().optional(),unitType:a.string().optional(),perM2Amount:a.string().optional(),spaceM2:a.string().optional(),isActive:a.boolean().default(!0),appliesFromDay:a.number().min(1).max(31).optional(),appliesFromMonth:a.number().min(1).max(12).optional()});function Ee(){var V,_,z,O,H;const{toast:y}=fe(),k=ve(),[x,le]=g.useState(null),[m,E]=g.useState(null),[oe,M]=g.useState(!1),[de,T]=g.useState(!1);g.useState(null),g.useState(null);const{data:xe=[]}=N({queryKey:["/api/concession-contracts"]}),{data:G=[]}=N({queryKey:["/api/hybrid-payments/configs",x],enabled:!!x}),{data:q=[]}=N({queryKey:["/api/hybrid-payments/charges",m],enabled:!!m}),{data:p,refetch:me}=N({queryKey:["/api/hybrid-payments/calculate",x,m],enabled:!!x&&!!m}),A=U({mutationFn:s=>ce("/api/hybrid-payments/configs",{method:"POST",data:s}),onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hybrid-payments/configs"]}),M(!1),y({title:"Configuración creada exitosamente"})},onError:s=>{y({title:"Error",description:s.message||"Error al crear configuración",variant:"destructive"})}}),F=U({mutationFn:s=>ce("/api/hybrid-payments/charges",{method:"POST",data:{...s,paymentConfigId:m}}),onSuccess:()=>{k.invalidateQueries({queryKey:["/api/hybrid-payments/charges"]}),T(!1),y({title:"Cargo creado exitosamente"})},onError:s=>{y({title:"Error",description:s.message||"Error al crear cargo",variant:"destructive"})}}),h=K({resolver:Q(Pe),defaultValues:{contractId:x||0,configName:"",description:"",isActive:!0,hasMinimumGuarantee:!1,effectiveFrom:new Date().toISOString().split("T")[0]}}),c=K({resolver:Q(Ie),defaultValues:{name:"",description:"",chargeType:"fixed",isActive:!0}}),he=s=>{A.mutate({...s,contractId:x})},je=s=>{F.mutate(s)},ue=s=>{switch(s){case"fixed":return e.jsx(te,{className:"h-4 w-4"});case"percentage":return e.jsx(De,{className:"h-4 w-4"});case"per_unit":return e.jsx(Ae,{className:"h-4 w-4"});case"per_m2":return e.jsx(Te,{className:"h-4 w-4"});default:return e.jsx(te,{className:"h-4 w-4"})}},pe=s=>{switch(s){case"fixed":return"Monto Fijo";case"percentage":return"Porcentaje";case"per_unit":return"Por Unidad";case"per_m2":return"Por M²";default:return s}};return e.jsxs(be,{children:[e.jsxs(Fe,{children:[e.jsx("title",{children:"Sistema de Cobro Híbrido - ParkSys"}),e.jsx("meta",{name:"description",content:"Configure métodos de cobro flexibles y combinables para contratos de concesión"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Sistema de Cobro Híbrido"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure métodos de cobro flexibles y combinables para contratos de concesión"})]})}),e.jsxs(j,{children:[e.jsxs(C,{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Selección de Contrato"]}),e.jsx(w,{children:"Seleccione el contrato para configurar el sistema de cobro híbrido"})]}),e.jsx(u,{children:e.jsxs(B,{value:x==null?void 0:x.toString(),onValueChange:s=>{le(parseInt(s)),E(null)},children:[e.jsx(R,{children:e.jsx(J,{placeholder:"Seleccionar contrato..."})}),e.jsx(W,{children:xe.map(s=>e.jsxs(v,{value:s.id.toString(),children:[s.contractNumber," - ",s.concessionaireName," (",s.serviceName,")"]},s.id))})]})})]}),x&&e.jsxs(Ne,{defaultValue:"configurations",className:"space-y-6",children:[e.jsxs(Ce,{children:[e.jsx(D,{value:"configurations",children:"Configuraciones"}),e.jsx(D,{value:"charges",children:"Cargos"}),e.jsx(D,{value:"calculation",children:"Calculadora"})]}),e.jsx(P,{value:"configurations",children:e.jsxs(j,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Configuraciones de Cobro"}),e.jsx(w,{children:"Gestione las configuraciones de cobro para este contrato"})]}),e.jsxs(X,{open:oe,onOpenChange:M,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(d,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Nueva Configuración"]})}),e.jsxs(ee,{className:"max-w-2xl",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Nueva Configuración de Cobro"}),e.jsx(ne,{children:"Configure los parámetros básicos del sistema de cobro"})]}),e.jsx(re,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(he),className:"space-y-4",children:[e.jsx(n,{control:h.control,name:"configName",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Nombre de la Configuración"}),e.jsx(t,{children:e.jsx(o,{placeholder:"Ej: Configuración Principal 2024",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"description",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Descripción"}),e.jsx(t,{children:e.jsx(o,{placeholder:"Descripción opcional...",...s})}),e.jsx(l,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:h.control,name:"effectiveFrom",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Vigente Desde"}),e.jsx(t,{children:e.jsx(o,{type:"date",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"effectiveTo",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Vigente Hasta"}),e.jsx(t,{children:e.jsx(o,{type:"date",...s})}),e.jsx(l,{})]})})]}),e.jsx(n,{control:h.control,name:"hasMinimumGuarantee",render:({field:s})=>e.jsxs(r,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"Garantía Mínima"}),e.jsx(I,{children:"Establece un monto mínimo garantizado por período"})]}),e.jsx(t,{children:e.jsx($,{checked:s.value,onCheckedChange:s.onChange})})]})}),h.watch("hasMinimumGuarantee")&&e.jsx(n,{control:h.control,name:"minimumGuaranteeAmount",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Monto Mínimo Garantizado"}),e.jsx(t,{children:e.jsx(o,{type:"number",step:"0.01",placeholder:"0.00",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"isActive",render:({field:s})=>e.jsxs(r,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"Configuración Activa"}),e.jsx(I,{children:"La configuración estará activa y aplicable"})]}),e.jsx(t,{children:e.jsx($,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>M(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:A.isPending,children:A.isPending?"Creando...":"Crear Configuración"})]})]})})]})]})]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-4",children:[G.map(s=>e.jsx(j,{className:`cursor-pointer transition-colors ${m===s.id?"ring-2 ring-[#00a587]":""}`,onClick:()=>E(s.id),children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:s.configName}),e.jsx(b,{variant:s.isActive?"default":"secondary",children:s.isActive?"Activa":"Inactiva"}),s.hasMinimumGuarantee&&e.jsx(b,{variant:"outline",className:"text-[#00a587]",children:"Garantía Mínima"})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Vigente desde ",new Date(s.effectiveFrom).toLocaleDateString(),s.effectiveTo&&` hasta ${new Date(s.effectiveTo).toLocaleDateString()}`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(Se,{className:"h-4 w-4"})})]})]})})},s.id)),G.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No hay configuraciones de cobro para este contrato.",e.jsx("br",{}),"Cree una nueva configuración para comenzar."]})]})})]})}),e.jsx(P,{value:"charges",children:e.jsxs(j,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(S,{children:"Cargos de Cobro"}),e.jsx(w,{children:"Configure los diferentes tipos de cargos para la configuración seleccionada"})]}),e.jsxs(X,{open:de,onOpenChange:T,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(d,{disabled:!m,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Nuevo Cargo"]})}),e.jsxs(ee,{className:"max-w-2xl",children:[e.jsxs(se,{children:[e.jsx(ae,{children:"Nuevo Cargo de Cobro"}),e.jsx(ne,{children:"Configure un nuevo método de cobro para esta configuración"})]}),e.jsx(re,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(je),className:"space-y-4",children:[e.jsx(n,{control:c.control,name:"name",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Nombre del Cargo"}),e.jsx(t,{children:e.jsx(o,{placeholder:"Ej: Renta Base Mensual",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"description",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Descripción"}),e.jsx(t,{children:e.jsx(o,{placeholder:"Descripción del cargo...",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"chargeType",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Tipo de Cargo"}),e.jsxs(B,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(t,{children:e.jsx(R,{children:e.jsx(J,{placeholder:"Seleccionar tipo de cargo..."})})}),e.jsxs(W,{children:[e.jsx(v,{value:"fixed",children:"Monto Fijo"}),e.jsx(v,{value:"percentage",children:"Porcentaje de Ventas"}),e.jsx(v,{value:"per_unit",children:"Por Unidad Vendida"}),e.jsx(v,{value:"per_m2",children:"Renta por M²"})]})]}),e.jsx(l,{})]})}),c.watch("chargeType")==="fixed"&&e.jsx(n,{control:c.control,name:"fixedAmount",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Monto Fijo"}),e.jsx(t,{children:e.jsx(o,{type:"number",step:"0.01",placeholder:"0.00",...s})}),e.jsx(l,{})]})}),c.watch("chargeType")==="percentage"&&e.jsx(n,{control:c.control,name:"percentage",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Porcentaje (%)"}),e.jsx(t,{children:e.jsx(o,{type:"number",step:"0.01",placeholder:"0.00",...s})}),e.jsx(l,{})]})}),c.watch("chargeType")==="per_unit"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:c.control,name:"perUnitAmount",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Monto por Unidad"}),e.jsx(t,{children:e.jsx(o,{type:"number",step:"0.01",placeholder:"0.00",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"unitType",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Tipo de Unidad"}),e.jsx(t,{children:e.jsx(o,{placeholder:"productos, servicios, etc.",...s})}),e.jsx(l,{})]})})]}),c.watch("chargeType")==="per_m2"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:c.control,name:"perM2Amount",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Monto por M²"}),e.jsx(t,{children:e.jsx(o,{type:"number",step:"0.01",placeholder:"0.00",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"spaceM2",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Espacio en M²"}),e.jsx(t,{children:e.jsx(o,{type:"number",step:"0.01",placeholder:"0.00",...s})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(n,{control:c.control,name:"appliesFromDay",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Aplica desde el día"}),e.jsx(t,{children:e.jsx(o,{type:"number",min:"1",max:"31",placeholder:"1",...s,onChange:f=>s.onChange(parseInt(f.target.value))})}),e.jsx(l,{})]})}),e.jsx(n,{control:c.control,name:"appliesFromMonth",render:({field:s})=>e.jsxs(r,{children:[e.jsx(i,{children:"Aplica desde el mes"}),e.jsx(t,{children:e.jsx(o,{type:"number",min:"1",max:"12",placeholder:"1",...s,onChange:f=>s.onChange(parseInt(f.target.value))})}),e.jsx(l,{})]})})]}),e.jsx(n,{control:c.control,name:"isActive",render:({field:s})=>e.jsxs(r,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(i,{className:"text-base",children:"Cargo Activo"}),e.jsx(I,{children:"El cargo estará activo y se aplicará en los cálculos"})]}),e.jsx(t,{children:e.jsx($,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>T(!1),children:"Cancelar"}),e.jsx(d,{type:"submit",disabled:F.isPending,children:F.isPending?"Creando...":"Crear Cargo"})]})]})})]})]})]})}),e.jsx(u,{children:m?e.jsxs("div",{className:"space-y-4",children:[q.map(s=>e.jsx(j,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[ue(s.chargeType),e.jsx("h3",{className:"font-semibold",children:s.name}),e.jsx(b,{variant:"outline",children:pe(s.chargeType)}),e.jsx(b,{variant:s.isActive?"default":"secondary",children:s.isActive?"Activo":"Inactivo"})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[s.chargeType==="fixed"&&`Monto: $${s.fixedAmount}`,s.chargeType==="percentage"&&`Porcentaje: ${s.percentage}%`,s.chargeType==="per_unit"&&`Por ${s.unitType}: $${s.perUnitAmount}`,s.chargeType==="per_m2"&&`Por M²: $${s.perM2Amount} (${s.spaceM2} M²)`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"sm",children:e.jsx(we,{className:"h-4 w-4"})})]})]})})},s.id)),q.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:["No hay cargos configurados para esta configuración.",e.jsx("br",{}),"Cree un nuevo cargo para comenzar."]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Seleccione una configuración de cobro para ver y gestionar sus cargos."})})]})}),e.jsx(P,{value:"calculation",children:e.jsxs(j,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),"Calculadora de Pagos"]}),e.jsx(w,{children:"Calcule el monto a pagar basado en la configuración y cargos seleccionados"})]}),e.jsx(d,{onClick:()=>me(),disabled:!m,children:"Calcular Pago"})]})}),e.jsx(u,{children:m&&p?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(j,{children:e.jsxs(u,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-[#00a587]",children:["$",((V=p.finalAmount)==null?void 0:V.toFixed(2))||"0.00"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Monto Final"})]})}),e.jsx(j,{children:e.jsxs(u,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((_=p.subtotal)==null?void 0:_.toFixed(2))||"0.00"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Subtotal"})]})}),e.jsx(j,{children:e.jsxs(u,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:["$",((z=p.minimumGuaranteeAdjustment)==null?void 0:z.toFixed(2))||"0.00"]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Ajuste Garantía"})]})})]}),p.calculationDetails&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Desglose del Cálculo"}),e.jsx("div",{className:"space-y-2",children:(O=p.calculationDetails.charges)==null?void 0:O.map((s,f)=>{var L;return e.jsxs("div",{className:"flex justify-between items-center p-3 bg-muted rounded",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.type})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"font-medium",children:["$",((L=s.amount)==null?void 0:L.toFixed(2))||"0.00"]})})]},f)})})]}),p.minimumGuaranteeApplied&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{variant:"outline",className:"text-orange-600",children:"Garantía Mínima Aplicada"})}),e.jsxs("p",{className:"text-sm text-orange-700 mt-2",children:["El subtotal está por debajo de la garantía mínima. Se aplicó un ajuste de $",(H=p.minimumGuaranteeAdjustment)==null?void 0:H.toFixed(2),"."]})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Seleccione una configuración de cobro para calcular el pago."})})]})})]})]})]})}export{Ee as default};
