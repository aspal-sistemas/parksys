import{az as te,a2 as c,ae as ne,l as ce,u as V,ag as de,j as e,aX as A,f as d,M as D,B as r,bh as oe,g as j,h as p,i as u,ah as B,n as P,U as K,a4 as me,O as xe,Q as q,V as T,W as R,Y as F,_ as l,ab as he,o as Q,bo as je,as as pe,au as ue,bq as H,m as G,b$ as ve,c0 as ge,bn as Ne,c1 as fe,c2 as be,c3 as ye,c4 as we,c5 as Ce,c6 as _e,c7 as J,w as Ee,y as Se,z as ke,I as Ae}from"./index-D5qLf1ib.js";const O={playground:"Área de Juegos",kiosk:"Kiosco",picnic_area:"Área de Picnic",open_area:"Área Abierta",pavilion:"Pabellón"},De={playground:"bg-green-100 text-green-800",kiosk:"bg-blue-100 text-blue-800",picnic_area:"bg-yellow-100 text-yellow-800",open_area:"bg-purple-100 text-purple-800",pavilion:"bg-red-100 text-red-800"};function Te(){const[Pe,w]=te(),[v,U]=c.useState(""),[C,X]=c.useState("all"),[_,W]=c.useState("all"),[g,Y]=c.useState("all"),[a,L]=c.useState(null),[t,E]=c.useState(1),[N]=c.useState(9),Z=ne(),{toast:z}=ce(),{data:o=[],isLoading:ee,error:se}=V({queryKey:["/api/reservable-spaces"],queryFn:async()=>{const s=await fetch("/api/reservable-spaces");if(!s.ok)throw new Error("Error al cargar los espacios reservables");return s.json()}}),{data:m}=V({queryKey:["/api/parks?simple=true"],queryFn:async()=>{const s=await fetch("/api/parks?simple=true");if(!s.ok)throw new Error("Error al cargar los parques");return s.json()}}),ae=Array.isArray(m)?m:(m==null?void 0:m.data)||[],f=o.filter(s=>{const i=s.name.toLowerCase().includes(v.toLowerCase())||s.description.toLowerCase().includes(v.toLowerCase())||s.park_name.toLowerCase().includes(v.toLowerCase()),n=C==="all"||s.park_id.toString()===C,x=_==="all"||s.space_type===_,h=g==="all"||g==="active"&&s.is_active||g==="inactive"&&!s.is_active;return i&&n&&x&&h}),S=Math.ceil(f.length/N),b=(t-1)*N,ie=f.slice(b,b+N),le=s=>{L(s)},$=s=>{w(`/admin/space-reservations/spaces/edit/${s.id}`)},re=()=>{w("/admin/space-reservations/spaces/new")},I=s=>{w(`/admin/space-reservations/new?space_id=${s.id}`)},y=de({mutationFn:async({spaceId:s,force:i=!1})=>{const n=`/api/reservable-spaces/${s}${i?"?force=true":""}`,x=await fetch(n,{method:"DELETE"});if(!x.ok){const h=await x.json().catch(()=>({})),k=new Error(h.error||"Error al eliminar el espacio");throw k.hasActiveReservations=h.hasActiveReservations,k.activeReservationsCount=h.activeReservationsCount,k}return x.json()},onSuccess:()=>{Z.invalidateQueries({queryKey:["/api/reservable-spaces"]}),z({title:"Espacio eliminado",description:"El espacio reservable ha sido eliminado correctamente."})},onError:s=>{const i=s.hasActiveReservations,n=s.activeReservationsCount||0;z({title:"No se puede eliminar",description:i?`El espacio tiene ${n} reserva${n>1?"s":""} activa${n>1?"s":""}. Elimina las reservas primero o usa la opción de eliminación forzada.`:"No se pudo eliminar el espacio. Inténtalo de nuevo.",variant:"destructive"})}}),M=(s,i=!1)=>{y.mutate({spaceId:s,force:i})};return ee?e.jsx(A,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}):se?e.jsx(A,{children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-600",children:"Error al cargar los espacios reservables"})})}):e.jsx(A,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(d,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Espacios Disponibles"})]}),e.jsxs(r,{onClick:re,className:"bg-[#00a587] hover:bg-[#067f5f] text-white",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Nuevo Espacio"]})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestiona los espacios reservables en los parques"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(d,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Total Espacios"}),e.jsx(D,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold",children:o.length})})]}),e.jsxs(d,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Activos"}),e.jsx(B,{className:"h-4 w-4 text-green-600"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:o.filter(s=>s.is_active).length})})]}),e.jsxs(d,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Requieren Aprobación"}),e.jsx(P,{className:"h-4 w-4 text-yellow-600"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:o.filter(s=>s.requires_approval).length})})]}),e.jsxs(d,{children:[e.jsxs(j,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(p,{className:"text-sm font-medium",children:"Capacidad Total"}),e.jsx(K,{className:"h-4 w-4 text-[#00a587]"})]}),e.jsx(u,{children:e.jsx("div",{className:"text-2xl font-bold text-[#00a587]",children:o.reduce((s,i)=>s+i.capacity,0)})})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(me,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(xe,{placeholder:"Buscar por nombre, descripción o parque...",value:v,onChange:s=>U(s.target.value),className:"pl-10"})]})}),e.jsxs(q,{value:C,onValueChange:X,children:[e.jsx(T,{className:"w-full lg:w-[200px]",children:e.jsx(R,{placeholder:"Filtrar por parque"})}),e.jsxs(F,{children:[e.jsx(l,{value:"all",children:"Todos los parques"}),ae.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))]})]}),e.jsxs(q,{value:_,onValueChange:W,children:[e.jsx(T,{className:"w-full lg:w-[180px]",children:e.jsx(R,{placeholder:"Filtrar por tipo"})}),e.jsxs(F,{children:[e.jsx(l,{value:"all",children:"Todos los tipos"}),e.jsx(l,{value:"playground",children:"Área de Juegos"}),e.jsx(l,{value:"kiosk",children:"Kiosco"}),e.jsx(l,{value:"picnic_area",children:"Área de Picnic"}),e.jsx(l,{value:"open_area",children:"Área Abierta"}),e.jsx(l,{value:"pavilion",children:"Pabellón"})]})]}),e.jsxs(q,{value:g,onValueChange:Y,children:[e.jsx(T,{className:"w-full lg:w-[150px]",children:e.jsx(R,{placeholder:"Estado"})}),e.jsxs(F,{children:[e.jsx(l,{value:"all",children:"Todos"}),e.jsx(l,{value:"active",children:"Activos"}),e.jsx(l,{value:"inactive",children:"Inactivos"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ie.map(s=>e.jsxs(d,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(p,{className:"text-lg",children:s.name}),e.jsx(he,{className:"mt-1",children:e.jsxs("div",{className:"flex items-center gap-1 text-sm",children:[e.jsx(D,{className:"h-3 w-3"}),s.park_name]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:De[s.space_type],children:O[s.space_type]}),s.is_active?e.jsx(B,{className:"h-4 w-4 text-green-500"}):e.jsx(je,{className:"h-4 w-4 text-red-500"})]})]})}),e.jsxs(u,{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4 line-clamp-2",children:s.description}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),"Capacidad:"]}),e.jsxs("span",{className:"font-medium",children:[s.capacity," personas"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),"Precio/hora:"]}),e.jsxs("span",{className:"font-medium",children:["$",s.hourly_rate]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"Duración:"]}),e.jsxs("span",{className:"font-medium",children:[s.minimum_hours,"-",s.maximum_hours,"h"]})]}),s.requires_approval&&e.jsxs("div",{className:"flex items-center gap-1 text-amber-600",children:[e.jsx(P,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:"Requiere aprobación"})]})]}),e.jsxs("div",{className:"flex space-x-2 mt-4",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>le(s),className:"flex-1",children:[e.jsx(ue,{className:"h-3 w-3 mr-1"}),"Ver"]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>$(s),className:"flex-1",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Editar"]}),e.jsxs(r,{size:"sm",onClick:()=>I(s),className:"bg-[#00a587] hover:bg-[#067f5f] text-white flex-1",disabled:!s.is_active,children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Reservar"]}),e.jsxs(ve,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(r,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-800 hover:bg-red-50 border-red-200",children:e.jsx(Ne,{className:"h-3 w-3"})})}),e.jsxs(fe,{children:[e.jsxs(be,{children:[e.jsx(ye,{children:"¿Eliminar espacio?"}),e.jsxs(we,{children:['Esta acción no se puede deshacer. El espacio "',s.name,'" será eliminado permanentemente del sistema.',s.is_active&&e.jsx("div",{className:"mt-2 p-2 bg-amber-50 border border-amber-200 rounded text-amber-800 text-sm",children:"⚠️ Este espacio está activo. Asegúrate de que no tenga reservas pendientes."})]})]}),e.jsxs(Ce,{children:[e.jsx(_e,{children:"Cancelar"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(J,{onClick:()=>M(s.id,!1),className:"bg-amber-600 hover:bg-amber-700",disabled:y.isPending,children:"Intentar Eliminar"}),e.jsx(J,{onClick:()=>M(s.id,!0),className:"bg-red-600 hover:bg-red-700",disabled:y.isPending,children:y.isPending?"Eliminando...":"Forzar Eliminación"})]})]})]})]})]})]})]},s.id))}),S>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Mostrando ",b+1," a ",Math.min(b+N,f.length)," de ",f.length," espacios"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>E(t-1),disabled:t===1,children:"Anterior"}),Array.from({length:S},(s,i)=>i+1).map(s=>e.jsx(r,{variant:t===s?"default":"outline",size:"sm",onClick:()=>E(s),className:t===s?"bg-[#00a587] hover:bg-[#067f5f]":"",children:s},s)),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>E(t+1),disabled:t===S,children:"Siguiente"})]})]}),e.jsx(Ee,{open:!!a,onOpenChange:s=>!s&&L(null),children:e.jsxs(Se,{className:"max-w-2xl",children:[e.jsx(ke,{children:e.jsx(Ae,{children:"Detalles del Espacio"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Información General"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Parque:"})," ",a.park_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",O[a.space_type]]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Estado:"}),e.jsx(Q,{className:`ml-2 ${a.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.is_active?"Activo":"Inactivo"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Capacidad y Precios"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Capacidad:"})," ",a.capacity," personas"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Precio por hora:"})," $",a.hourly_rate]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duración mínima:"})," ",a.minimum_hours," horas"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Duración máxima:"})," ",a.maximum_hours," horas"]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Descripción"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.description})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Amenidades"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.amenities})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Reglas y Condiciones"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.rules})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Requiere aprobación:"}),e.jsx("span",{className:"ml-2",children:a.requires_approval?"Sí":"No"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Reserva anticipada:"}),e.jsxs("span",{className:"ml-2",children:[a.advance_booking_days," días"]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsxs(r,{variant:"outline",onClick:()=>$(a),children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(r,{onClick:()=>I(a),className:"bg-[#00a587] hover:bg-[#067f5f]",disabled:!a.is_active,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Reservar Espacio"]})]})]})]})})]})})}export{Te as default};
