import{e as P,a6 as T,u as w,a8 as I,j as e,B as L,C as i,a as l,b as c,F as M,c as r,a9 as t,ak as $,cM as k,aH as q,aI as F,aJ as o,aK as x,x as g,f as d,a$ as R,a3 as z,M as E,aD as A,at as B}from"./index-BBGHPKhn.js";import{R as C}from"./refresh-cw-DS5oknip.js";function H(){var f,v,b;const{toast:u}=P(),p=T(),{data:n,isLoading:_}=w({queryKey:["/api/concessions-finance-integration/dashboard"],refetchInterval:3e4}),{data:m,isLoading:S}=w({queryKey:["/api/concession-payments"]}),h=I({mutationFn:async()=>{const s=await fetch("/api/concessions-finance-integration/sync-all",{method:"POST",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("Error en sincronización");return s.json()},onSuccess:s=>{u({title:"✅ Sincronización Completada",description:`${s.synchronized} pagos sincronizados, ${s.errors} errores`}),p.invalidateQueries({queryKey:["/api/concessions-finance-integration/dashboard"]}),p.invalidateQueries({queryKey:["/api/concession-payments"]})},onError:()=>{u({title:"❌ Error en Sincronización",description:"No se pudo completar la sincronización",variant:"destructive"})}});if(_||S)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Cargando datos de integración..."})]})});const a=n==null?void 0:n.stats,N=a&&a.paid_payments>0?Math.round((n==null?void 0:n.syncStatus.synchronized_payments)/a.paid_payments*100):0;return e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"🏢 Integración Concesiones → Finanzas"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Sistema automático de sincronización de ingresos por concesiones"})]}),e.jsx("div",{className:"flex gap-3",children:e.jsxs(L,{onClick:()=>h.mutate(),disabled:h.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),h.isPending?"Sincronizando...":"Sincronizar Manual"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(i,{className:"border-l-4 border-l-blue-500",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Pagos"}),e.jsx(M,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(a==null?void 0:a.total_payments)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pagos registrados este año"})]})]}),e.jsxs(i,{className:"border-l-4 border-l-green-500",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Pagos Confirmados"}),e.jsx(t,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(r,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(a==null?void 0:a.paid_payments)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Listos para sincronización"})]})]}),e.jsxs(i,{className:"border-l-4 border-l-purple-500",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Ingresos Totales"}),e.jsx($,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs(r,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:["$",((f=a==null?void 0:a.total_income)==null?void 0:f.toLocaleString())||"0"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Ingresos por concesiones"})]})]}),e.jsxs(i,{className:"border-l-4 border-l-orange-500",children:[e.jsxs(l,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Sincronización"}),e.jsx(C,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(r,{children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[N,"%"]}),e.jsx("div",{className:"mt-2",children:e.jsx(k,{value:N,className:"h-2"})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(n==null?void 0:n.syncStatus.synchronized_payments)||0," de ",(a==null?void 0:a.paid_payments)||0," sincronizados"]})]})]})]}),e.jsxs(q,{defaultValue:"overview",className:"space-y-6",children:[e.jsxs(F,{className:"grid w-full grid-cols-4",children:[e.jsx(o,{value:"overview",children:"Resumen"}),e.jsx(o,{value:"payments",children:"Pagos"}),e.jsx(o,{value:"parks",children:"Por Parque"}),e.jsx(o,{value:"integration",children:"Integración"})]}),e.jsx(x,{value:"overview",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-5 h-5 text-yellow-500"}),"Estado del Sistema"]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Integración Activa"})]}),e.jsx(d,{variant:"secondary",className:"bg-green-100 text-green-700",children:"Operativo"})]}),a!=null&&a.pending_payments?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-yellow-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Pagos Pendientes"})]}),e.jsx(d,{variant:"secondary",className:"bg-yellow-100 text-yellow-700",children:a.pending_payments})]}):null,a!=null&&a.late_payments?e.jsxs("div",{className:"flex items-center justify-between p-3 bg-red-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(g,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium",children:"Pagos Atrasados"})]}),e.jsx(d,{variant:"secondary",className:"bg-red-100 text-red-700",children:a.late_payments})]}):null]})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5 text-blue-500"}),"Ingresos por Tipo"]})}),e.jsx(r,{children:e.jsx("div",{className:"space-y-3",children:(v=n==null?void 0:n.typeIncome)==null?void 0:v.slice(0,5).map((s,j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-blue-500"}),e.jsx("span",{className:"text-sm font-medium",children:s.concession_type})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-bold",children:["$",s.total_income.toLocaleString()]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.payment_count," pagos"]})]})]},j))})})]})]})}),e.jsx(x,{value:"payments",className:"space-y-6",children:e.jsxs(i,{children:[e.jsxs(l,{children:[e.jsx(c,{children:"Historial de Pagos"}),e.jsx(z,{children:"Pagos de concesiones con estado de sincronización financiera"})]}),e.jsx(r,{children:e.jsx("div",{className:"space-y-4",children:m==null?void 0:m.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.concessionaire_name}),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.park_name})]})}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-bold",children:["$",s.amount.toLocaleString()]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(s.payment_date).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:s.status==="paid"?"default":"secondary",className:s.status==="paid"?"bg-green-100 text-green-700":s.status==="pending"?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700",children:s.status==="paid"?"Pagado":s.status==="pending"?"Pendiente":"Atrasado"}),s.status==="paid"&&e.jsx(d,{variant:"secondary",className:s.finance_income_id?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700",children:s.finance_income_id?"🔗 Sincronizado":"⏳ Por Sincronizar"})]})]})]},s.id))})})]})}),e.jsx(x,{value:"parks",className:"space-y-6",children:e.jsxs(i,{children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5 text-green-500"}),"Ingresos por Parque"]}),e.jsx(z,{children:"Distribución de ingresos de concesiones por ubicación"})]}),e.jsx(r,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:(b=n==null?void 0:n.parkIncome)==null?void 0:b.map((s,j)=>{var y;return e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-medium",children:s.park_name}),e.jsxs(d,{variant:"secondary",children:[s.payment_count," pagos"]})]}),e.jsxs("div",{className:"text-2xl font-bold text-green-600 mb-2",children:["$",s.total_income.toLocaleString()]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${Math.min(s.total_income/(((y=n.parkIncome[0])==null?void 0:y.total_income)||1)*100,100)}%`}})})]},j)})})})]})}),e.jsx(x,{value:"integration",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-purple-500"}),"Flujo de Integración"]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white font-bold",children:"1"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Registro de Pago"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Concesionario realiza pago"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white font-bold",children:"2"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Confirmación"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:'Status cambia a "Pagado"'})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold",children:"3"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Sincronización Automática"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Se crea ingreso en Finanzas"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white font-bold",children:"4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Trazabilidad"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Referencias cruzadas mantenidas"})]})]})]})]}),e.jsxs(i,{children:[e.jsx(l,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-green-500"}),"Características del Sistema"]})}),e.jsxs(r,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Sincronización automática en tiempo real"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Categorización inteligente por tipo de concesión"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Trazabilidad completa de origen de datos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Sincronización manual de respaldo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Dashboard en tiempo real"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm",children:"Manejo robusto de errores"})]})]})]})]})})]})]})}export{H as default};
