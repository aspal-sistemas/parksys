import{a5 as P,e as Re,a6 as Ge,Y as o,a7 as _e,u as me,a8 as he,j as e,aB as He,B as l,aH as Je,aI as Ue,aJ as ue,aj as Se,aK as ge,cK as V,ar as v,C as h,c as p,f as j,aW as ae,b4 as M,Z as ke,I as Ee,ap as Ie,z as B,H as O,J as $,K as Q,N as f,db as Me,am as L,dc as We,$ as Xe,aq as Pe,au as Te,D as Ye,r as Ze,t as es,v as ss,w as as,aa as ls,ab as R,ac as G,ad as _,ae as H,af as J,O as rs,b7 as ts,at as is,aE as ns,dd as cs,b8 as ds,de as os,b5 as xs,ag as ms,ah as je}from"./index-BBGHPKhn.js";import{F as hs}from"./folder-plus-tDpdSMK9.js";import{P as T}from"./pen-BW4wfSc2.js";import{C as us}from"./camera-B2fB-hXh.js";const gs=P.object({name:P.string().min(2,"El nombre debe tener al menos 2 caracteres"),description:P.string().optional(),icon:P.string().min(1,"Selecciona un ícono"),color:P.string().min(4,"Selecciona un color"),parentId:P.number().nullable().optional()}),le=[{value:"building2",label:"Infraestructura",icon:is},{value:"wrench",label:"Herramientas",icon:ns},{value:"car",label:"Vehículos",icon:cs},{value:"lightbulb",label:"Iluminación",icon:ds},{value:"camera",label:"Seguridad",icon:us},{value:"wifi",label:"Tecnología",icon:os},{value:"tag",label:"General",icon:L},{value:"settings",label:"Equipos",icon:xs},{value:"treePine",label:"Jardinería",icon:Te},{value:"folderOpen",label:"Categoría",icon:Me}],js=[{value:"#3B82F6",label:"Azul",bg:"bg-blue-500"},{value:"#10B981",label:"Verde",bg:"bg-emerald-500"},{value:"#F59E0B",label:"Naranja",bg:"bg-amber-500"},{value:"#6366F1",label:"Índigo",bg:"bg-indigo-500"},{value:"#EC4899",label:"Rosa",bg:"bg-pink-500"},{value:"#8B5CF6",label:"Púrpura",bg:"bg-violet-500"},{value:"#EF4444",label:"Rojo",bg:"bg-red-500"},{value:"#14B8A6",label:"Teal",bg:"bg-teal-500"},{value:"#067f5f",label:"Verde Parques",bg:"bg-green-700"},{value:"#00a587",label:"Verde Principal",bg:"bg-green-600"}],fs=()=>{const{toast:z}=Re(),u=Ge(),[F,U]=o.useState(!1),[Le,W]=o.useState(!1),[ve,re]=o.useState(null),[X,Fe]=o.useState(null),[qe,De]=o.useState("list"),[te,ie]=o.useState(new Set),[c,Ae]=o.useState(!0),[x,Y]=o.useState(1),[C,ne]=o.useState(""),[w,pe]=o.useState("all"),[q,be]=o.useState("all"),[Z,Ne]=o.useState("compact"),[b,D]=o.useState(1),d=10,g=_e({resolver:ms(gs),defaultValues:{name:"",description:"",icon:"tag",color:"#3B82F6",parentId:null}}),{data:n=[],isLoading:Ke}=me({queryKey:["/api/asset-categories"]}),{data:A=[]}=me({queryKey:["/api/asset-categories/parents"]}),{data:m=[]}=me({queryKey:["/api/asset-categories/tree/structure"]}),Ve=o.useMemo(()=>Array.from(new Set(n.map(a=>a.icon))).sort(),[n]),N=o.useMemo(()=>{let s=n;return C&&(s=s.filter(a=>{var t,r;return a.name.toLowerCase().includes(C.toLowerCase())||((t=a.description)==null?void 0:t.toLowerCase().includes(C.toLowerCase()))||((r=a.parentName)==null?void 0:r.toLowerCase().includes(C.toLowerCase()))})),w!=="all"&&(s=s.filter(a=>w==="principal"?a.parentId===null:w==="subcategoria"?a.parentId!==null:!0)),q!=="all"&&(s=s.filter(a=>a.icon===q)),s},[n,C,w,q]),S=Math.ceil(N.length/d),ee=(b-1)*d,ce=ee+d,de=N.slice(ee,ce),se=()=>{D(1)},oe=he({mutationFn:async s=>await(await je("/api/asset-categories",{method:"POST",data:s})).json(),onSuccess:s=>{console.log("Categoría creada exitosamente:",s),u.refetchQueries({queryKey:["/api/asset-categories"]}),u.refetchQueries({queryKey:["/api/asset-categories/parents"]}),u.refetchQueries({queryKey:["/api/asset-categories/tree/structure"]}),setTimeout(()=>{u.invalidateQueries({queryKey:["/api/asset-categories"]}),u.invalidateQueries({queryKey:["/api/asset-categories/parents"]}),u.invalidateQueries({queryKey:["/api/asset-categories/tree/structure"]})},100),U(!1),g.reset(),z({title:"✅ Categoría creada",description:"La categoría se ha creado correctamente."})},onError:s=>{z({title:"❌ Error",description:s.message||"Error al crear la categoría",variant:"destructive"})}}),xe=he({mutationFn:async({id:s,data:a})=>await(await je(`/api/asset-categories/${s}`,{method:"PUT",data:a})).json(),onSuccess:()=>{u.refetchQueries({queryKey:["/api/asset-categories"]}),u.refetchQueries({queryKey:["/api/asset-categories/parents"]}),u.refetchQueries({queryKey:["/api/asset-categories/tree/structure"]}),W(!1),re(null),g.reset(),z({title:"✅ Categoría actualizada",description:"La categoría se ha actualizado correctamente."})},onError:s=>{z({title:"❌ Error",description:s.message||"Error al actualizar la categoría",variant:"destructive"})}}),Be=he({mutationFn:async s=>await(await je(`/api/asset-categories/${s}`,{method:"DELETE"})).json(),onSuccess:()=>{u.refetchQueries({queryKey:["/api/asset-categories"]}),u.refetchQueries({queryKey:["/api/asset-categories/parents"]}),u.refetchQueries({queryKey:["/api/asset-categories/tree/structure"]}),z({title:"✅ Categoría eliminada",description:"La categoría se ha eliminado correctamente."})},onError:s=>{z({title:"❌ Error",description:s.message||"Error al eliminar la categoría",variant:"destructive"})}}),Oe=s=>{const a={...s,parentId:X||s.parentId||null};oe.mutate(a)},k=s=>{re(s),g.reset({name:s.name,description:s.description||"",icon:s.icon,color:s.color,parentId:s.parentId}),W(!0)},$e=s=>{ve&&xe.mutate({id:ve.id,data:s})},E=s=>{window.confirm(`¿Estás seguro de eliminar la categoría "${s.name}"?`)&&Be.mutate(s.id)},K=(s=null)=>{Fe(s),g.reset({name:"",description:"",icon:"tag",color:"#3B82F6",parentId:s}),U(!0)},fe=s=>{const a=new Set(te);a.has(s)?a.delete(s):a.add(s),ie(a)},Ce=()=>{const s=A.filter(a=>n.filter(r=>r.parentId===a.id).length>0).map(a=>a.id);ie(new Set(s))},ye=()=>{ie(new Set)},y=(s,a=20)=>{var r;const t=((r=le.find(i=>i.value===s))==null?void 0:r.icon)||L;return e.jsx(t,{size:a})},ze=({category:s,isSubcategory:a=!1})=>e.jsx(h,{className:`transition-all hover:shadow-md ${a?"ml-6 border-l-4":""}`,style:a?{borderLeftColor:s.color}:{},children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${s.color}20`,color:s.color},children:y(s.icon,24)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[s.parentName&&e.jsxs(j,{variant:"outline",className:"text-xs",children:["📁 ",s.parentName]}),s.hasChildren&&e.jsxs(j,{variant:"secondary",className:"text-xs",children:[s.childrenCount," subcategoría(s)"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[!a&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>K(s.id),children:e.jsx(ae,{size:16})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>k(s),children:e.jsx(T,{size:16})}),e.jsx(l,{size:"sm",variant:"destructive",onClick:()=>E(s),children:e.jsx(M,{size:16})})]})]})})}),we=({category:s})=>{const a=n.filter(i=>i.parentId===s.id),t=a.length>0,r=te.has(s.id);return s.parentId?e.jsx(h,{className:"transition-all hover:shadow-md ml-8 border-l-4",style:{borderLeftColor:s.color},children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${s.color}20`,color:s.color},children:y(s.icon,20)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("h4",{className:"text-base font-medium text-gray-900",children:s.name}),e.jsx(j,{variant:"secondary",className:"text-xs",children:"Subcategoría"})]}),s.description&&e.jsx("p",{className:"text-gray-600 text-sm",children:s.description})]})]}),e.jsx("div",{className:"flex items-center gap-4 text-xs text-gray-500 ml-11",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(L,{size:12}),e.jsxs("span",{children:["ID: ",s.id]})]})})]}),e.jsxs("div",{className:"flex gap-1 ml-4",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>k(s),className:"text-green-600 hover:bg-green-50 h-8 w-8 p-0",children:e.jsx(T,{size:14})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>E(s),className:"text-red-600 hover:bg-red-50 h-8 w-8 p-0",children:e.jsx(M,{size:14})})]})]})})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"transition-all hover:shadow-md border-l-4",style:{borderLeftColor:s.color},children:e.jsx(p,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[t&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>fe(s.id),className:"p-1 h-8 w-8 hover:bg-gray-100 self-start",children:r?e.jsx(V,{size:16,className:"text-blue-600"}):e.jsx(v,{size:16,className:"text-gray-600"})}),!t&&e.jsx("div",{className:"w-8"}),e.jsx("div",{className:"p-3 rounded-lg",style:{backgroundColor:`${s.color}20`,color:s.color},children:y(s.icon,24)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsx(j,{variant:"default",className:"text-xs",children:"Principal"}),t&&e.jsxs(j,{variant:"outline",className:"text-xs",children:[a.length," subcategoría(s)"]})]}),s.description&&e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-500 ml-12",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:14}),e.jsxs("span",{children:["ID: ",s.id]})]}),t&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:14}),e.jsxs("span",{children:[a.length," subcategorías"]})]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>K(s.id),className:"text-blue-600 hover:bg-blue-50",children:[e.jsx(ae,{size:16,className:"mr-1"}),"Subcategoría"]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>k(s),className:"text-green-600 hover:bg-green-50",children:e.jsx(T,{size:16})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>E(s),className:"text-red-600 hover:bg-red-50",children:e.jsx(M,{size:16})})]})]})})}),t&&r&&e.jsx("div",{className:"space-y-2 border-l-2 border-gray-200 pl-4 ml-4",children:a.map(i=>e.jsx(we,{category:i},i.id))})]})};return Ke?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando categorías..."})]})}):e.jsx(He,{children:e.jsxs("div",{className:"p-6 max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Categorías de Activos"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gestiona las categorías jerárquicas para organizar tus activos"})]}),e.jsxs(l,{onClick:()=>K(),className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(hs,{className:"mr-2",size:20}),"Nueva Categoría Principal"]})]}),e.jsxs(Je,{value:qe,onValueChange:De,className:"w-full",children:[e.jsxs(Ue,{className:"grid w-full grid-cols-3",children:[e.jsx(ue,{value:"list",children:e.jsxs("div",{className:"flex items-center gap-2",children:["Lista Completa",e.jsx(Se,{size:14,className:"text-blue-500"})]})}),e.jsx(ue,{value:"hierarchy",children:"Vista Jerárquica"}),e.jsx(ue,{value:"tree",children:"Estructura de Árbol"})]}),e.jsxs(ge,{value:"hierarchy",className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:Ce,className:"text-blue-600 hover:bg-blue-50",children:[e.jsx(V,{size:16,className:"mr-2"}),"Expandir Todo"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:ye,className:"text-gray-600 hover:bg-gray-50",children:[e.jsx(v,{size:16,className:"mr-2"}),"Contraer Todo"]})]}),A.map(s=>{const a=n.filter(i=>i.parentId===s.id),t=a.length>0,r=te.has(s.id);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(h,{className:"transition-all hover:shadow-md border-l-4",style:{borderLeftColor:s.color},children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>fe(s.id),className:"p-1 h-8 w-8 hover:bg-gray-100",children:r?e.jsx(V,{size:16,className:"text-blue-600"}):e.jsx(v,{size:16,className:"text-gray-600"})}),!t&&e.jsx("div",{className:"w-8"}),e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${s.color}20`,color:s.color},children:y(s.icon,24)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx(j,{variant:"secondary",className:"text-xs",children:"Principal"}),t&&e.jsxs(j,{variant:"outline",className:"text-xs",children:[a.length," subcategoría(s)"]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>K(s.id),className:"text-blue-600 hover:bg-blue-50",children:[e.jsx(ae,{size:16,className:"mr-1"}),"Subcategoría"]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>k(s),className:"text-green-600 hover:bg-green-50",children:e.jsx(T,{size:16})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>E(s),className:"text-red-600 hover:bg-red-50",children:e.jsx(M,{size:16})})]})]})})}),t&&r&&e.jsx("div",{className:"ml-8 space-y-2 border-l-2 border-gray-200 pl-4",children:a.map(i=>e.jsx(h,{className:"transition-all hover:shadow-sm border-l-4",style:{borderLeftColor:i.color},children:e.jsx(p,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1.5 rounded-lg",style:{backgroundColor:`${i.color}20`,color:i.color},children:y(i.icon,20)}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-base",children:i.name}),i.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:i.description}),e.jsx(j,{variant:"outline",className:"text-xs mt-1",children:"Subcategoría"})]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>k(i),className:"text-green-600 hover:bg-green-50 h-8 w-8 p-0",children:e.jsx(T,{size:14})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>E(i),className:"text-red-600 hover:bg-red-50 h-8 w-8 p-0",children:e.jsx(M,{size:14})})]})]})})},i.id))})]},s.id)}),n.filter(s=>!s.parentId&&!A.find(a=>a.id===s.id)).map(s=>e.jsx(ze,{category:s},s.id))]}),e.jsxs(ge,{value:"list",className:"space-y-6",children:[e.jsxs(h,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400",size:16}),e.jsx(Ee,{placeholder:"Buscar por nombre, descripción o categoría padre...",value:C,onChange:s=>{ne(s.target.value),se()},className:"pl-10"}),C&&e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{ne(""),se()},className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-6 w-6 p-0",children:e.jsx(Ie,{size:14})})]})}),e.jsx("div",{children:e.jsxs(B,{value:w,onValueChange:s=>{pe(s),se()},children:[e.jsx(O,{children:e.jsx($,{})}),e.jsxs(Q,{children:[e.jsx(f,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{size:16}),"Todos los tipos"]})}),e.jsx(f,{value:"principal",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{size:16}),"Principales"]})}),e.jsx(f,{value:"subcategoria",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{size:16}),"Subcategorías"]})})]})]})}),e.jsx("div",{children:e.jsxs(B,{value:q,onValueChange:s=>{be(s),se()},children:[e.jsx(O,{children:e.jsx($,{})}),e.jsxs(Q,{children:[e.jsx(f,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{size:16}),"Todos los iconos"]})}),Ve.map(s=>{var t,r;const a=((t=le.find(i=>i.value===s))==null?void 0:t.icon)||L;return e.jsx(f,{value:s,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{size:16}),((r=le.find(i=>i.value===s))==null?void 0:r.label)||s]})},s)})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",de.length," de ",N.length," categorías",N.length!==n.length&&` (${n.length} en total)`]}),(C||w!=="all"||q!=="all")&&e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{ne(""),pe("all"),be("all"),D(1)},className:"text-gray-600",children:[e.jsx(Ie,{size:14,className:"mr-1"}),"Limpiar filtros"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",ee+1,"-",Math.min(ce,N.length)," de ",N.length," categorías"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[Z==="extended"&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:Ce,className:"text-blue-600 hover:bg-blue-50",children:[e.jsx(V,{size:14,className:"mr-1"}),"Expandir Todo"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:ye,className:"text-gray-600 hover:bg-gray-50",children:[e.jsx(v,{size:14,className:"mr-1"}),"Contraer Todo"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Vista:"}),e.jsxs("div",{className:"flex border rounded-md",children:[e.jsxs(l,{variant:Z==="compact"?"default":"ghost",size:"sm",onClick:()=>Ne("compact"),className:"rounded-r-none border-r-0",children:[e.jsx(We,{size:16,className:"mr-1"}),"Compacta"]}),e.jsxs(l,{variant:Z==="extended"?"default":"ghost",size:"sm",onClick:()=>Ne("extended"),className:"rounded-l-none",children:[e.jsx(Xe,{size:16,className:"mr-1"}),"Extendida"]})]})]})]})]}),Z==="compact"?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:de.map(s=>e.jsx(ze,{category:s},s.id))}):e.jsx("div",{className:"space-y-4",children:de.filter(s=>!s.parentId).map(s=>e.jsx(we,{category:s},s.id))}),N.length===0&&e.jsx(h,{className:"p-8 text-center",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx(ke,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No se encontraron categorías"}),e.jsx("p",{children:"Prueba ajustando los filtros o términos de búsqueda"})]})}),S>1&&e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Página ",b," de ",S," - Mostrando ",ee+1,"-",Math.min(ce,N.length)," de ",N.length," categorías"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>D(b-1),disabled:b===1,className:"flex items-center gap-1",children:[e.jsx(Pe,{size:16}),"Anterior"]}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,S)},(s,a)=>{const t=Math.max(1,Math.min(S-4,b-2))+a;return t>S?null:e.jsx(l,{variant:b===t?"default":"outline",size:"sm",onClick:()=>D(t),className:b===t?"bg-green-600 hover:bg-green-700":"",children:t},t)})}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>D(b+1),disabled:b===S,className:"flex items-center gap-1",children:["Siguiente",e.jsx(v,{size:16})]})]})]})})]}),e.jsxs(ge,{value:"tree",className:"space-y-2",children:[e.jsx("div",{className:"mb-4 p-4 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Estructura de Árbol de Categorías"}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ae(!c),Y(1)},className:"flex items-center gap-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx(V,{size:16}),"Contraer Todo"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:16}),"Expandir Todo"]})})]})}),e.jsx("div",{className:"mb-4 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:["Mostrando: ",Math.min(d,m.filter(s=>c||s.level===0).length-(x-1)*d)," de ",m.filter(s=>c||s.level===0).length," categorías"]}),e.jsxs("span",{children:["Estado: ",c?"EXPANDIDO":"CONTRAÍDO"," | Página ",x," de ",Math.ceil(m.filter(s=>c||s.level===0).length/d)]})]})}),m.filter(s=>c||s.level===0).slice((x-1)*d,x*d).map(s=>{var a,t;return e.jsx(h,{className:"transition-all hover:shadow-md border-l-4",style:{borderLeftColor:s.color},children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{style:{marginLeft:`${(s.level||0)*32}px`},className:"flex items-center gap-3",children:[s.level&&s.level>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:s.level},(r,i)=>e.jsx("div",{className:"w-1 h-4 bg-gray-300 rounded"},i)),e.jsx(v,{size:16,className:"text-gray-500"})]}),e.jsx("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${s.color}20`,color:s.color},children:y(s.icon,20)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"font-semibold text-lg",children:s.name}),e.jsx(j,{variant:s.level===0?"default":"secondary",className:"text-xs",children:s.level===0?"Principal":`Nivel ${s.level}`}),s.pathNames&&e.jsxs(j,{variant:"outline",className:"text-xs",children:["📁 ",s.pathNames]})]}),((a=n.find(r=>r.id===s.id))==null?void 0:a.description)&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:(t=n.find(r=>r.id===s.id))==null?void 0:t.description})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[s.level===0&&e.jsxs(l,{size:"sm",variant:"outline",onClick:()=>K(s.id),className:"text-blue-600 hover:bg-blue-50",children:[e.jsx(ae,{size:14,className:"mr-1"}),"Sub"]}),s.level===0&&!c&&n.filter(r=>r.parentId===s.id).length>0&&e.jsxs(j,{variant:"outline",className:"text-xs bg-yellow-50 border-yellow-300 text-yellow-700",children:["+",n.filter(r=>r.parentId===s.id).length," sub"]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>k(n.find(r=>r.id===s.id)),className:"text-green-600 hover:bg-green-50",children:e.jsx(T,{size:14})}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>E(n.find(r=>r.id===s.id)),className:"text-red-600 hover:bg-red-50",children:e.jsx(M,{size:14})})]})]})})},s.id)}),m.filter(s=>c||s.level===0).length>d&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Página ",x," de ",Math.ceil(m.filter(s=>c||s.level===0).length/d)," - Mostrando ",(x-1)*d+1,"-",Math.min(x*d,m.filter(s=>c||s.level===0).length)," de ",m.filter(s=>c||s.level===0).length," categorías"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>Y(Math.max(1,x-1)),disabled:x===1,className:"flex items-center gap-1",children:[e.jsx(Pe,{size:16}),"Anterior"]}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:Math.min(5,Math.ceil(m.filter(s=>c||s.level===0).length/d))},(s,a)=>{const t=Math.ceil(m.filter(Qe=>c||Qe.level===0).length/d);let r=Math.max(1,x-2),i=Math.min(t,r+4);i-r<4&&(r=Math.max(1,i-4));const I=r+a;return I<=t?e.jsx(l,{variant:I===x?"default":"outline",size:"sm",onClick:()=>Y(I),className:I===x?"bg-green-600 hover:bg-green-700":"",children:I},I):null})}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>Y(Math.min(Math.ceil(m.filter(s=>c||s.level===0).length/d),x+1)),disabled:x>=Math.ceil(m.filter(s=>c||s.level===0).length/d),className:"flex items-center gap-1",children:["Siguiente",e.jsx(v,{size:16})]})]})]}),m.length===0&&e.jsx(h,{className:"p-8 text-center",children:e.jsxs("div",{className:"text-gray-500",children:[e.jsx(Te,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No hay estructura de árbol disponible"}),e.jsx("p",{children:"Crea algunas categorías principales y subcategorías para ver la estructura"})]})})]})]}),e.jsxs("div",{className:"mt-8 grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(h,{children:e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:n.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Categorías"})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:A.length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Categorías Principales"})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:n.filter(s=>s.parentId).length}),e.jsx("div",{className:"text-sm text-gray-600",children:"Subcategorías"})]})}),e.jsx(h,{children:e.jsxs(p,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:Math.max(...m.map(s=>s.level||0))+1}),e.jsx("div",{className:"text-sm text-gray-600",children:"Niveles Máximos"})]})})]}),e.jsx(Ye,{open:F||Le,onOpenChange:s=>{s||(U(!1),W(!1),re(null),g.reset())},children:e.jsxs(Ze,{className:"sm:max-w-md","aria-describedby":"asset-category-form-description",children:[e.jsxs(es,{children:[e.jsx(ss,{children:F?"Nueva Categoría":"Editar Categoría"}),e.jsx(as,{children:F?"Crea una nueva categoría para organizar tus activos":"Modifica los datos de la categoría seleccionada"})]}),e.jsx("div",{id:"asset-category-form-description",className:"sr-only",children:"Formulario para crear o editar categorías de activos con iconos y colores"}),e.jsx(ls,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(F?Oe:$e),className:"space-y-4",children:[e.jsx(R,{control:g.control,name:"name",render:({field:s})=>e.jsxs(G,{children:[e.jsx(_,{children:"Nombre *"}),e.jsx(H,{children:e.jsx(Ee,{placeholder:"Ej: Mobiliario Urbano",...s})}),e.jsx(J,{})]})}),e.jsx(R,{control:g.control,name:"description",render:({field:s})=>e.jsxs(G,{children:[e.jsx(_,{children:"Descripción"}),e.jsx(H,{children:e.jsx(rs,{placeholder:"Describe brevemente esta categoría...",className:"resize-none",rows:3,...s})}),e.jsx(J,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(R,{control:g.control,name:"icon",render:({field:s})=>e.jsxs(G,{children:[e.jsx(_,{children:"Ícono *"}),e.jsxs(B,{onValueChange:s.onChange,value:s.value,children:[e.jsx(H,{children:e.jsx(O,{children:e.jsx($,{placeholder:"Seleccionar ícono"})})}),e.jsx(Q,{children:le.map(a=>e.jsx(f,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a.icon,{size:16}),a.label]})},a.value))})]}),e.jsx(J,{})]})}),e.jsx(R,{control:g.control,name:"color",render:({field:s})=>e.jsxs(G,{children:[e.jsx(_,{children:"Color *"}),e.jsxs(B,{onValueChange:s.onChange,value:s.value,children:[e.jsx(H,{children:e.jsx(O,{children:e.jsx($,{placeholder:"Seleccionar color"})})}),e.jsx(Q,{children:js.map(a=>e.jsx(f,{value:a.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${a.bg}`}),a.label]})},a.value))})]}),e.jsx(J,{})]})})]}),F&&e.jsx(R,{control:g.control,name:"parentId",render:({field:s})=>e.jsxs(G,{children:[e.jsx(_,{children:"Categoría Padre (opcional)"}),e.jsxs(B,{onValueChange:a=>s.onChange(a==="null"?null:parseInt(a)),value:s.value?s.value.toString():(X==null?void 0:X.toString())||"null",children:[e.jsx(H,{children:e.jsx(O,{children:e.jsx($,{placeholder:"Seleccionar categoría padre"})})}),e.jsxs(Q,{children:[e.jsx(f,{value:"null",children:"Sin categoría padre (Principal)"}),A.map(a=>e.jsx(f,{value:a.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[y(a.icon,16),a.name]})},a.id))]})]}),e.jsx(J,{})]})}),e.jsxs(ts,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{U(!1),W(!1)},children:"Cancelar"}),e.jsx(l,{type:"submit",disabled:oe.isPending||xe.isPending,children:oe.isPending||xe.isPending?"Guardando...":"Guardar"})]})]})})]})})]})})};export{fs as default};
