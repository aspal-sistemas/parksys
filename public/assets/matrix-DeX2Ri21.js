import{a2 as n,cb as o,j as e,aX as F,Q as E,V as M,W as k,Y as A,_ as j,B as z,bF as G,L as Y,e as H,f as m,i as x,a5 as L,ah as J,au as U,bp as $,g as I,h as Q,ab as X,ao as C,o as u}from"./index-D5qLf1ib.js";import{S as R,a as T,R as q}from"./RoleBadge-D5voYAx-.js";import{D as O,u as K,S as y}from"./RoleGuard-BpTshTfO.js";import"./gem-dXiyKzl3.js";const ie=()=>{const[p,B]=n.useState("all"),[g,D]=n.useState("all"),[c,f]=n.useState(O),[N,b]=n.useState(!1),l=K();n.useEffect(()=>{const s=localStorage.getItem("rolePermissions");if(s)try{f(JSON.parse(s))}catch(a){console.error("Error al cargar permisos:",a)}},[]),n.useEffect(()=>{N&&(localStorage.setItem("rolePermissions",JSON.stringify(c)),o({title:"Cambios guardados",description:"Los permisos se han sincronizado automáticamente"}),b(!1))},[c,N]);const v=(s,a,i,r)=>{if(s==="super-admin"){o({title:"Protección de Super Admin",description:"Los permisos de Super Admin no pueden modificarse",variant:"destructive"});return}if(!l.canAdmin("Seguridad")){o({title:"Sin permisos",description:"No tienes permisos para modificar la matriz",variant:"destructive"});return}f(h=>{const t={...h};t[s]||(t[s]={}),t[s][a]||(t[s][a]=[]);const d=[...t[s][a]];if(r)d.includes(i)||d.push(i);else{const P=d.indexOf(i);P>-1&&d.splice(P,1)}return t[s][a]=d,t}),b(!0)},S=(s,a,i)=>{var r,h;return((h=(r=c[s])==null?void 0:r[a])==null?void 0:h.includes(i))||!1},V=s=>{let a=0;return y.forEach(i=>{var r;(r=c[s])!=null&&r[i]&&(a+=c[s][i].length)}),a},W=()=>{if(!l.canAdmin("Seguridad")){o({title:"Sin permisos",description:"No tienes permisos para resetear la matriz",variant:"destructive"});return}f(O),b(!0),o({title:"Matriz restablecida",description:"Se han restaurado los permisos por defecto"})},_=p==="all"?R:R.filter(s=>s.id===p),w=g==="all"?y:[g];return e.jsxs(F,{title:"Matriz de Permisos",subtitle:"Configuración granular de permisos por rol y módulo",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Filtrar por Rol"}),e.jsxs(E,{value:p,onValueChange:B,children:[e.jsx(M,{className:"w-48",children:e.jsx(k,{placeholder:"Seleccionar rol"})}),e.jsxs(A,{children:[e.jsx(j,{value:"all",children:"Todos los roles"}),R.map(s=>e.jsx(j,{value:s.id,children:e.jsx(T,{roleId:s.id,size:"sm"})},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-1 block",children:"Filtrar por Módulo"}),e.jsxs(E,{value:g,onValueChange:D,children:[e.jsx(M,{className:"w-48",children:e.jsx(k,{placeholder:"Seleccionar módulo"})}),e.jsxs(A,{children:[e.jsx(j,{value:"all",children:"Todos los módulos"}),y.map(s=>e.jsx(j,{value:s,children:s},s))]})]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(z,{variant:"outline",onClick:W,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Restaurar Defaults"]}),e.jsx(Y,{href:"/admin/roles",children:e.jsxs(z,{variant:"outline",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Ver Roles"]})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4 mb-6",children:[e.jsx(m,{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-blue-800",children:"Matriz Activa"}),e.jsx("div",{className:"text-2xl font-bold text-blue-900",children:"7x7"})]})]})})}),e.jsx(m,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-green-800",children:"Sincronizado"}),e.jsx("div",{className:"text-xs text-green-700",children:"localStorage"})]})]})})}),e.jsx(m,{className:"bg-gradient-to-br from-purple-50 to-pink-50 border-purple-200",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-purple-800",children:"Mi Rol"}),e.jsx(q,{roleId:l.userRole,size:"sm"})]})]})})}),e.jsx(m,{className:"bg-gradient-to-br from-amber-50 to-orange-50 border-amber-200",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5 text-amber-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-amber-800",children:"Cambios"}),e.jsx("div",{className:"text-xs text-amber-700",children:N?"Guardando...":"Sincronizado"})]})]})})})]}),e.jsxs(m,{children:[e.jsxs(I,{children:[e.jsxs(Q,{className:"flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),"Matriz de Permisos Granulares"]}),e.jsx(X,{children:"Configura permisos específicos para cada rol y módulo del sistema. Los cambios se sincronizan automáticamente."})]}),e.jsxs(x,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 border-b font-semibold",children:"Rol"}),w.map(s=>e.jsx("th",{className:"text-center p-3 border-b font-semibold min-w-32",children:s},s)),e.jsx("th",{className:"text-center p-3 border-b font-semibold",children:"Total"})]})}),e.jsx("tbody",{children:_.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-b",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(T,{roleId:s.id}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Nivel ",s.level]})]})}),w.map(a=>e.jsx("td",{className:"p-3 border-b text-center",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(C,{checked:S(s.id,a,"read"),onCheckedChange:i=>v(s.id,a,"read",!!i),disabled:!l.canAdmin("Seguridad")||s.id==="super-admin"}),e.jsx("span",{className:"text-xs text-gray-600",children:"R"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(C,{checked:S(s.id,a,"write"),onCheckedChange:i=>v(s.id,a,"write",!!i),disabled:!l.canAdmin("Seguridad")||s.id==="super-admin"}),e.jsx("span",{className:"text-xs text-gray-600",children:"W"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(C,{checked:S(s.id,a,"admin"),onCheckedChange:i=>v(s.id,a,"admin",!!i),disabled:!l.canAdmin("Seguridad")||s.id==="super-admin"}),e.jsx("span",{className:"text-xs text-gray-600",children:"A"})]})]})},`${s.id}-${a}`)),e.jsx("td",{className:"p-3 border-b text-center",children:e.jsx(u,{variant:"outline",className:"font-mono",children:V(s.id)})})]},s.id))})]})}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Leyenda de Permisos:"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"outline",className:"text-green-600",children:"R"}),e.jsx("span",{children:"Read - Solo lectura"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"outline",className:"text-blue-600",children:"W"}),e.jsx("span",{children:"Write - Lectura y escritura"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{variant:"outline",className:"text-red-600",children:"A"}),e.jsx("span",{children:"Admin - Control total"})]})]})]})]})]})]})};export{ie as default};
