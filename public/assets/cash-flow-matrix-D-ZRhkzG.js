import{Y as h,e as Xe,a6 as He,u as T,a8 as We,j as e,aI as ue,cg as je,B as w,c$ as Ze,bc as ye,W as ge,D as Me,p as es,az as ss,r as as,t as rs,v as ts,w as ns,y as g,z as A,H as D,J as F,K as P,N as u,F as ls,C as b,a as f,b as N,aK as _,a3 as k,c as v,f as B,I as U,aS as be,b4 as is,aU as fe,aV as Ne,aW as ve,aX as we,cz as Se,b5 as cs,aZ as Ce}from"./index-VG22aPDC.js";import{B as os}from"./BarChart-DH8XXsDW.js";import{T as Te}from"./trending-down-CpXUJmlr.js";function js(){var ae,re,te,ne,le,ie,ce,oe,de,me;const[p,Ae]=h.useState(new Date().getFullYear()),[S,De]=h.useState("all"),[V,Fe]=h.useState("monthly"),[J,Q]=h.useState(!1),[y,Pe]=h.useState(!1),[q,Ee]=h.useState(3),[C,$e]=h.useState("realistic"),[K,Re]=h.useState(4.5),[X,ds]=h.useState({}),[I,ke]=h.useState(!1),[H,W]=h.useState({}),[Ie,Z]=h.useState(!1),[G,Ge]=h.useState("historical"),[O,Ve]=h.useState("income"),[M,L]=h.useState(!1),ee=h.useRef(null),{toast:E}=Xe(),z=He(),{data:qe,isLoading:Ke}=T({queryKey:["/api/cash-flow-matrix",p,S],queryFn:async()=>{const s=new URLSearchParams({year:p.toString(),...S!=="all"&&{parkId:S}});return(await fetch(`/api/cash-flow-matrix?${s}`)).json()}}),{data:r}=T({queryKey:["budget-projections",p],queryFn:async()=>{const s=await fetch(`/api/budget-projections/${p}`);if(!s.ok)throw new Error("Error al cargar proyecciones");return s.json()}}),{data:Y}=T({queryKey:["/api/parks"]});T({queryKey:["/api/income-categories/active"]}),T({queryKey:["/api/expense-categories/active"]}),T({queryKey:["/api/cash-flow-historical",S],enabled:y});const Oe=We({mutationFn:async({file:s,type:t,dataType:a})=>{const n=new FormData;n.append("csvFile",s),n.append("type",a),S!=="all"&&n.append("parkId",S);const d=await fetch(t==="historical"?"/api/import/historical-data":"/api/import/projections",{method:"POST",body:n});if(!d.ok)throw new Error("Error al importar archivo CSV");return d.json()},onSuccess:s=>{E({title:"Importación exitosa",description:`${s.message}. ${s.successCount} registros procesados.`}),z.invalidateQueries({queryKey:["/api/cash-flow-matrix"]}),z.invalidateQueries({queryKey:["/api/cash-flow-historical"]}),Z(!1),L(!1)},onError:s=>{E({title:"Error en la importación",description:s.message,variant:"destructive"}),L(!1)}}),c=qe||{year:p,months:["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"],categories:[],summaries:{monthly:{income:new Array(12).fill(0),expenses:new Array(12).fill(0),net:new Array(12).fill(0)},annual:{income:0,expenses:0,net:0}}},Le=s=>{if(s.length<2)return 0;let t=0,a=0;for(let n=1;n<s.length;n++)if(s[n-1]!==0){const o=(s[n]-s[n-1])/s[n-1]*100;t+=o,a++}return a>0?t/a:0},ze=s=>{switch(s){case"optimistic":return 1.2;case"pessimistic":return .8;default:return 1}},$=y?(s=>{if(!s)return null;const t=[],a=new Date().getFullYear();for(let n=a+1;n<=a+q;n++){const o={year:n,categories:s.categories.map(i=>{var pe;const x=(pe=H[i.name])==null?void 0:pe[n];let j;x!==void 0?j=x:X[i.name]!==void 0?j=X[i.name]:j=Le(i.monthlyValues);const R=j*ze(C),Je=i.type==="expense"?K:0,xe=(R+Je)/100,he=i.total*Math.pow(1+xe,n-a),Qe=he/12;return{...i,total:he,monthlyValues:Array(12).fill(Qe),growthRate:xe*100}}),summaries:{annual:{income:0,expenses:0,net:0},monthly:{income:Array(12).fill(0),expenses:Array(12).fill(0),net:Array(12).fill(0)}}},d=o.categories.filter(i=>i.type==="income").reduce((i,x)=>i+x.total,0),m=o.categories.filter(i=>i.type==="expense").reduce((i,x)=>i+x.total,0);o.summaries={annual:{income:d,expenses:m,net:d-m},monthly:{income:Array(12).fill(d/12),expenses:Array(12).fill(m/12),net:Array(12).fill((d-m)/12)}},t.push(o)}return t})(c):null,se=()=>{if(!c)return[];const s=[{year:p,ingresos:c.summaries.annual.income,gastos:c.summaries.annual.expenses,flujoNeto:c.summaries.annual.net,tipo:"histórico"}];return $&&$.forEach(t=>{s.push({year:t.year,ingresos:t.summaries.annual.income,gastos:t.summaries.annual.expenses,flujoNeto:t.summaries.annual.net,tipo:"proyectado"})}),s},Ye=()=>{E({title:"Exportación iniciada",description:"Los datos se están preparando para descargar."})},_e=async()=>{Q(!0);try{await z.invalidateQueries({queryKey:["/api/cash-flow"]}),E({title:"Datos actualizados",description:"La matriz de flujo de efectivo se ha actualizado correctamente."})}catch{E({title:"Error al actualizar",description:"No se pudieron cargar los datos más recientes.",variant:"destructive"})}finally{Q(!1)}},l=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),Be=s=>{var a;const t=(a=s.target.files)==null?void 0:a[0];t&&(L(!0),Oe.mutate({file:t,type:G,dataType:O}))},Ue=(s,t)=>{const a=`/api/import/template/${s}?type=${t}`,n=document.createElement("a");n.href=a,n.download=`plantilla_${t==="income"?"ingresos":"egresos"}_${s==="historical"?"historicos":"proyecciones"}.csv`,document.body.appendChild(n),n.click(),document.body.removeChild(n)};return Ke?e.jsx(ue,{children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex justify-center items-center h-64",children:[e.jsx(je,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Cargando matriz de flujo de efectivo..."})]})})}):e.jsx(ue,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Matriz de Flujo de Efectivo"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Seguimiento financiero mensual con datos reales de ingresos y gastos"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(w,{onClick:()=>Pe(!y),variant:y?"default":"outline",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),y?"Ocultar":"Mostrar"," Proyecciones"]}),y&&e.jsxs(w,{onClick:()=>ke(!I),variant:I?"default":"outline",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),I?"Ocultar":"Configurar"," Factores"]}),e.jsxs(w,{onClick:_e,disabled:J,variant:"outline",children:[e.jsx(je,{className:`h-4 w-4 mr-2 ${J?"animate-spin":""}`}),"Actualizar"]}),e.jsxs(w,{onClick:Ye,variant:"outline",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Exportar"]}),e.jsxs(Me,{open:Ie,onOpenChange:Z,children:[e.jsx(es,{asChild:!0,children:e.jsxs(w,{variant:"outline",children:[e.jsx(ss,{className:"h-4 w-4 mr-2"}),"Importar CSV"]})}),e.jsxs(as,{className:"max-w-md",children:[e.jsxs(rs,{children:[e.jsx(ts,{children:"Importar Datos desde CSV"}),e.jsx(ns,{children:"Importe datos históricos o proyecciones financieras desde archivos CSV"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Tipo de importación"}),e.jsxs(A,{value:G,onValueChange:s=>Ge(s),children:[e.jsx(D,{children:e.jsx(F,{})}),e.jsxs(P,{children:[e.jsx(u,{value:"historical",children:"Datos históricos"}),e.jsx(u,{value:"projections",children:"Proyecciones"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Tipo de datos"}),e.jsxs(A,{value:O,onValueChange:s=>Ve(s),children:[e.jsx(D,{children:e.jsx(F,{})}),e.jsxs(P,{children:[e.jsx(u,{value:"income",children:"Ingresos"}),e.jsx(u,{value:"expense",children:"Egresos"})]})]})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ls,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsx("div",{className:"text-sm text-gray-600 mb-4",children:"Seleccione un archivo CSV para importar"}),e.jsx("input",{ref:ee,type:"file",accept:".csv",onChange:Be,className:"hidden"}),e.jsx(w,{onClick:()=>{var s;return(s=ee.current)==null?void 0:s.click()},disabled:M,className:"mb-2",children:M?"Subiendo...":"Seleccionar archivo"}),e.jsx("div",{className:"flex gap-2 justify-center",children:e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>Ue(G,O),children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Plantilla"]})})]})}),e.jsxs("div",{className:"text-xs text-gray-500 bg-gray-50 p-3 rounded",children:[e.jsx("strong",{children:"Formato esperado:"}),G==="historical"?e.jsx("div",{children:"fecha, categoria, monto, descripcion, parque_id"}):e.jsx("div",{children:"categoria, año, mes, monto, escenario, parque_id"})]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"year-select",children:"Año"}),e.jsxs(A,{value:p.toString(),onValueChange:s=>Ae(parseInt(s)),children:[e.jsx(D,{children:e.jsx(F,{})}),e.jsx(P,{children:Array.from({length:5},(s,t)=>new Date().getFullYear()-2+t).map(s=>e.jsx(u,{value:s.toString(),children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"park-select",children:"Parque"}),e.jsxs(A,{value:S,onValueChange:De,children:[e.jsx(D,{children:e.jsx(F,{})}),e.jsxs(P,{children:[e.jsx(u,{value:"all",children:"Todos los parques"}),Y&&Array.isArray(Y)&&Y.map(s=>e.jsx(u,{value:s.id.toString(),children:s.name||`Parque ${s.id}`},`park-${s.id}`))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"view-mode",children:"Vista"}),e.jsxs(A,{value:V,onValueChange:s=>Fe(s),children:[e.jsx(D,{children:e.jsx(F,{})}),e.jsxs(P,{children:[e.jsx(u,{value:"monthly",children:"Mensual"}),e.jsx(u,{value:"quarterly",children:"Trimestral"}),e.jsx(u,{value:"annual",children:"Anual"})]})]})]}),y&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"scenario-select",children:"Escenario"}),e.jsxs(A,{value:C,onValueChange:s=>$e(s),children:[e.jsx(D,{children:e.jsx(F,{})}),e.jsxs(P,{children:[e.jsx(u,{value:"optimistic",children:"Optimista"}),e.jsx(u,{value:"realistic",children:"Realista"}),e.jsx(u,{value:"pessimistic",children:"Pesimista"})]})]})]})]}),I&&c&&e.jsxs(b,{className:"mb-6",children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Factores de Crecimiento Personalizados"]}),e.jsx(k,{children:"Configure factores específicos por categoría y año para proyecciones más precisas"})]}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-6",children:[c.categories.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-medium text-sm",children:[s.name," (",s.type==="income"?"Ingreso":"Egreso",")"]}),e.jsx(B,{variant:s.type==="income"?"default":"destructive",children:l(s.total)})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:Array.from({length:q},(t,a)=>{var d;const n=new Date().getFullYear()+1+a,o=((d=H[s.name])==null?void 0:d[n])||0;return e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{className:"text-xs",children:n}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{type:"number",step:"0.1",placeholder:"0.0",value:o||"",onChange:m=>{const i=parseFloat(m.target.value)||0;W(x=>({...x,[s.name]:{...x[s.name],[n]:i}}))},className:"text-xs"}),e.jsx("span",{className:"text-xs text-gray-500",children:"%"})]})]},n)})})]},s.name)),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Los valores negativos representan decrementos. Si no se especifica un valor, se usará la tendencia histórica."}),e.jsx(w,{variant:"outline",onClick:()=>W({}),children:"Limpiar Todo"})]})]})})]}),y&&e.jsxs(b,{className:"mb-6",children:[e.jsx(f,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5"}),"Configuración de Proyecciones"]})}),e.jsx(v,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"projection-years",children:"Años a proyectar"}),e.jsx(U,{id:"projection-years",type:"number",min:"1",max:"10",value:q,onChange:s=>Ee(parseInt(s.target.value)||3)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"inflation-rate",children:"Tasa de inflación (%)"}),e.jsx(U,{id:"inflation-rate",type:"number",step:"0.1",value:K,onChange:s=>Re(parseFloat(s.target.value)||4.5)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{children:"Escenario seleccionado"}),e.jsx("div",{className:"flex items-center gap-2 pt-2",children:e.jsxs(B,{variant:C==="optimistic"?"default":"secondary",children:[C==="optimistic"&&"Optimista (+20%)",C==="realistic"&&"Realista (Base)",C==="pessimistic"&&"Pesimista (-20%)"]})})]})]})})]}),y&&$&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(b,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"Proyección de Flujo Neto"}),e.jsx(k,{children:"Comparación histórica vs proyectada"})]}),e.jsx(v,{children:e.jsx(be,{width:"100%",height:300,children:e.jsxs(is,{data:se(),children:[e.jsx(fe,{strokeDasharray:"3 3"}),e.jsx(Ne,{dataKey:"year"}),e.jsx(ve,{tickFormatter:l}),e.jsx(we,{formatter:s=>l(s)}),e.jsx(Se,{}),e.jsx(cs,{type:"monotone",dataKey:"flujoNeto",stroke:"#8884d8",strokeWidth:2,dot:{fill:"#8884d8"}})]})})})]}),e.jsxs(b,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"Ingresos vs Gastos Proyectados"}),e.jsx(k,{children:"Evolución esperada por año"})]}),e.jsx(v,{children:e.jsx(be,{width:"100%",height:300,children:e.jsxs(os,{data:se(),children:[e.jsx(fe,{strokeDasharray:"3 3"}),e.jsx(Ne,{dataKey:"year"}),e.jsx(ve,{tickFormatter:l}),e.jsx(we,{formatter:s=>l(s)}),e.jsx(Se,{}),e.jsx(Ce,{dataKey:"ingresos",fill:"#10b981",name:"Ingresos"}),e.jsx(Ce,{dataKey:"gastos",fill:"#ef4444",name:"Gastos"})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs(b,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Ingresos"}),e.jsx(_,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l(c.summaries.annual.income)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:V==="annual"?"Año completo":`Acumulado ${p}`})]})]}),e.jsxs(b,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Total Gastos"}),e.jsx(Te,{className:"h-4 w-4 text-red-600"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:l(c.summaries.annual.expenses)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:V==="annual"?"Año completo":`Acumulado ${p}`})]})]}),e.jsxs(b,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium",children:"Flujo Neto"}),e.jsx("div",{className:`h-4 w-4 ${c.summaries.annual.net>=0?"text-green-600":"text-red-600"}`,children:c.summaries.annual.net>=0?e.jsx(_,{}):e.jsx(Te,{})})]}),e.jsxs(v,{children:[e.jsx("div",{className:`text-2xl font-bold ${c.summaries.annual.net>=0?"text-green-600":"text-red-600"}`,children:l(c.summaries.annual.net)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[c.summaries.annual.net>=0?"Superávit":"Déficit"," ",p]})]})]})]}),c&&e.jsx("div",{className:"space-y-6",children:e.jsxs(b,{children:[e.jsxs(f,{children:[e.jsxs(N,{className:"text-blue-700",children:["📊 MATRIZ DE FLUJO DE EFECTIVO - ",p]}),e.jsx(k,{children:"Análisis comparativo proyectado vs real por categorías"})]}),e.jsx(v,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{className:"sticky top-0 z-10 bg-blue-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border border-gray-300 p-3 text-left font-semibold bg-blue-50",children:"Categoría"}),["Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"].map(s=>e.jsxs("th",{className:"border border-gray-300 p-2 text-center font-semibold min-w-[120px] bg-blue-50",children:[e.jsx("div",{className:"text-sm font-bold mb-2",children:s}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{className:"text-blue-600 py-1",children:"Proyec"}),e.jsx("div",{className:"text-gray-600 py-1",children:"Real"}),e.jsx("div",{className:"text-orange-600 py-1",children:"Var"})]})]},s)),e.jsx("th",{className:"border border-gray-300 p-3 text-center font-semibold bg-blue-50",children:"Total Anual"})]})}),e.jsxs("tbody",{children:[e.jsx("tr",{className:"bg-green-200",children:e.jsxs("td",{colSpan:14,className:"border border-gray-300 p-3 text-center font-bold text-green-800 text-lg",children:["💰 INGRESOS - ",p]})}),c.categories.filter(s=>s.type==="income").map((s,t)=>{var n;const a=(n=r==null?void 0:r.incomeCategories)==null?void 0:n.find(o=>o.categoryName===s.name);return e.jsxs("tr",{className:t%2===0?"bg-white":"bg-green-50",children:[e.jsx("td",{className:"border border-gray-300 p-3 font-medium",children:s.name}),Array.from({length:12},(o,d)=>{const m=(a==null?void 0:a.months[d+1])||0,i=s.monthlyValues[d]||0,x=i-m,j=x>=0;return e.jsx("td",{className:"border border-gray-300 p-2",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{className:"text-center text-blue-700 bg-blue-50 rounded px-2 py-1",children:m>0?l(m):"-"}),e.jsx("div",{className:"text-center text-gray-700 bg-gray-50 rounded px-2 py-1",children:i>0?l(i):"-"}),e.jsx("div",{className:`text-center rounded px-2 py-1 ${j?"text-green-600 bg-green-50":"text-red-600 bg-red-50"}`,children:x!==0?(x>0?"+":"")+l(x):"-"})]})},d)}),e.jsx("td",{className:"border border-gray-300 p-3 text-center",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"text-blue-700 font-semibold bg-blue-50 rounded px-2 py-1",children:l((a==null?void 0:a.total)||0)}),e.jsx("div",{className:"text-gray-700 font-semibold bg-gray-50 rounded px-2 py-1",children:l(s.total)}),e.jsx("div",{className:`font-semibold rounded px-2 py-1 ${s.total-((a==null?void 0:a.total)||0)>=0?"text-green-600 bg-green-50":"text-red-600 bg-red-50"}`,children:l(s.total-((a==null?void 0:a.total)||0))})]})})]},s.name)}),e.jsxs("tr",{className:"bg-green-100 border-t-2 border-green-300",children:[e.jsx("td",{className:"border border-gray-300 p-3 font-bold text-green-800",children:"TOTAL INGRESOS"}),Array.from({length:12},(s,t)=>{var d;const a=((d=r==null?void 0:r.incomeCategories)==null?void 0:d.reduce((m,i)=>m+(i.months[t+1]||0),0))||0,n=c.summaries.monthly.income[t]||0,o=n-a;return e.jsx("td",{className:"border border-gray-300 p-2",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{className:"text-center text-blue-700 bg-blue-100 rounded px-2 py-1 font-semibold",children:l(a)}),e.jsx("div",{className:"text-center text-gray-700 bg-gray-100 rounded px-2 py-1 font-semibold",children:l(n)}),e.jsx("div",{className:`text-center rounded px-2 py-1 font-semibold ${o>=0?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:o!==0?(o>0?"+":"")+l(o):"-"})]})},t)}),e.jsx("td",{className:"border border-gray-300 p-3 text-center",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"text-blue-700 font-bold bg-blue-100 rounded px-2 py-1",children:l(((ae=r==null?void 0:r.yearlyTotals)==null?void 0:ae.income)||0)}),e.jsx("div",{className:"text-gray-700 font-bold bg-gray-100 rounded px-2 py-1",children:l(c.summaries.annual.income)}),e.jsx("div",{className:`font-bold rounded px-2 py-1 ${c.summaries.annual.income-(((re=r==null?void 0:r.yearlyTotals)==null?void 0:re.income)||0)>=0?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:l(c.summaries.annual.income-(((te=r==null?void 0:r.yearlyTotals)==null?void 0:te.income)||0))})]})})]}),e.jsx("tr",{className:"bg-red-200",children:e.jsxs("td",{colSpan:14,className:"border border-gray-300 p-3 text-center font-bold text-red-800 text-lg",children:["💸 EGRESOS - ",p]})}),c.categories.filter(s=>s.type==="expense").map((s,t)=>{var n;const a=(n=r==null?void 0:r.expenseCategories)==null?void 0:n.find(o=>o.categoryName===s.name);return e.jsxs("tr",{className:t%2===0?"bg-white":"bg-red-50",children:[e.jsx("td",{className:"border border-gray-300 p-3 font-medium",children:s.name}),Array.from({length:12},(o,d)=>{const m=(a==null?void 0:a.months[d+1])||0,i=s.monthlyValues[d]||0,x=i-m,j=x>=0;return e.jsx("td",{className:"border border-gray-300 p-2",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{className:"text-center text-blue-700 bg-blue-50 rounded px-2 py-1",children:m>0?l(m):"-"}),e.jsx("div",{className:"text-center text-gray-700 bg-gray-50 rounded px-2 py-1",children:i>0?l(i):"-"}),e.jsx("div",{className:`text-center rounded px-2 py-1 ${j?"text-red-600 bg-red-50":"text-green-600 bg-green-50"}`,children:x!==0?(x>0?"+":"")+l(x):"-"})]})},d)}),e.jsx("td",{className:"border border-gray-300 p-3 text-center",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"text-blue-700 font-semibold bg-blue-50 rounded px-2 py-1",children:l((a==null?void 0:a.total)||0)}),e.jsx("div",{className:"text-gray-700 font-semibold bg-gray-50 rounded px-2 py-1",children:l(s.total)}),e.jsx("div",{className:`font-semibold rounded px-2 py-1 ${s.total-((a==null?void 0:a.total)||0)>=0?"text-red-600 bg-red-50":"text-green-600 bg-green-50"}`,children:l(s.total-((a==null?void 0:a.total)||0))})]})})]},s.name)}),e.jsxs("tr",{className:"bg-red-100 border-t-2 border-red-300",children:[e.jsx("td",{className:"border border-gray-300 p-3 font-bold text-red-800",children:"TOTAL EGRESOS"}),Array.from({length:12},(s,t)=>{var d;const a=((d=r==null?void 0:r.expenseCategories)==null?void 0:d.reduce((m,i)=>m+(i.months[t+1]||0),0))||0,n=c.summaries.monthly.expenses[t]||0,o=n-a;return e.jsx("td",{className:"border border-gray-300 p-2",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{className:"text-center text-blue-700 bg-blue-100 rounded px-2 py-1 font-semibold",children:l(a)}),e.jsx("div",{className:"text-center text-gray-700 bg-gray-100 rounded px-2 py-1 font-semibold",children:l(n)}),e.jsx("div",{className:`text-center rounded px-2 py-1 font-semibold ${o>=0?"text-red-600 bg-red-100":"text-green-600 bg-green-100"}`,children:o!==0?(o>0?"+":"")+l(o):"-"})]})},t)}),e.jsx("td",{className:"border border-gray-300 p-3 text-center",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:"text-blue-700 font-bold bg-blue-100 rounded px-2 py-1",children:l(((ne=r==null?void 0:r.yearlyTotals)==null?void 0:ne.expense)||0)}),e.jsx("div",{className:"text-gray-700 font-bold bg-gray-100 rounded px-2 py-1",children:l(c.summaries.annual.expenses)}),e.jsx("div",{className:`font-bold rounded px-2 py-1 ${c.summaries.annual.expenses-(((le=r==null?void 0:r.yearlyTotals)==null?void 0:le.expense)||0)>=0?"text-red-600 bg-red-100":"text-green-600 bg-green-100"}`,children:l(c.summaries.annual.expenses-(((ie=r==null?void 0:r.yearlyTotals)==null?void 0:ie.expense)||0))})]})})]}),e.jsxs("tr",{className:"bg-purple-100 border-t-2 border-purple-300",children:[e.jsx("td",{className:"border border-gray-300 p-3 font-bold text-purple-800",children:"UTILIDAD / PÉRDIDA"}),Array.from({length:12},(s,t)=>{var i,x;const a=((i=r==null?void 0:r.incomeCategories)==null?void 0:i.reduce((j,R)=>j+(R.months[t+1]||0),0))||0,n=((x=r==null?void 0:r.expenseCategories)==null?void 0:x.reduce((j,R)=>j+(R.months[t+1]||0),0))||0,o=a-n,d=c.summaries.monthly.net[t]||0,m=d-o;return e.jsx("td",{className:"border border-gray-300 p-2",children:e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsx("div",{className:`text-center rounded px-2 py-1 font-semibold ${o>=0?"text-blue-700 bg-blue-100":"text-red-700 bg-red-100"}`,children:l(o)}),e.jsx("div",{className:`text-center rounded px-2 py-1 font-semibold ${d>=0?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:l(d)}),e.jsx("div",{className:`text-center rounded px-2 py-1 font-semibold ${m>=0?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:m!==0?(m>0?"+":"")+l(m):"-"})]})},t)}),e.jsx("td",{className:"border border-gray-300 p-3 text-center",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsx("div",{className:`font-bold rounded px-2 py-1 ${(((ce=r==null?void 0:r.yearlyTotals)==null?void 0:ce.net)||0)>=0?"text-blue-700 bg-blue-100":"text-red-700 bg-red-100"}`,children:l(((oe=r==null?void 0:r.yearlyTotals)==null?void 0:oe.net)||0)}),e.jsx("div",{className:`font-bold rounded px-2 py-1 text-lg ${c.summaries.annual.net>=0?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:l(c.summaries.annual.net)}),e.jsx("div",{className:`font-bold rounded px-2 py-1 ${c.summaries.annual.net-(((de=r==null?void 0:r.yearlyTotals)==null?void 0:de.net)||0)>=0?"text-green-600 bg-green-100":"text-red-600 bg-red-100"}`,children:l(c.summaries.annual.net-(((me=r==null?void 0:r.yearlyTotals)==null?void 0:me.net)||0))})]})})]})]})]})})})]})}),y&&$&&e.jsxs(b,{className:"mt-6",children:[e.jsxs(f,{children:[e.jsx(N,{children:"Proyecciones Financieras"}),e.jsxs(k,{children:["Proyecciones basadas en escenario ",C," con inflación del ",K,"%"]})]}),e.jsx(v,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse border border-gray-300",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50",children:[e.jsx("th",{className:"border border-gray-300 p-3 text-left font-semibold",children:"Año"}),e.jsx("th",{className:"border border-gray-300 p-3 text-center font-semibold",children:"Ingresos Proyectados"}),e.jsx("th",{className:"border border-gray-300 p-3 text-center font-semibold",children:"Gastos Proyectados"}),e.jsx("th",{className:"border border-gray-300 p-3 text-center font-semibold",children:"Flujo Neto"}),e.jsx("th",{className:"border border-gray-300 p-3 text-center font-semibold",children:"Estado"})]})}),e.jsx("tbody",{children:$.map((s,t)=>e.jsxs("tr",{className:t%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"border border-gray-300 p-3 font-medium",children:s.year}),e.jsx("td",{className:"border border-gray-300 p-3 text-right text-green-600",children:l(s.summaries.annual.income)}),e.jsx("td",{className:"border border-gray-300 p-3 text-right text-red-600",children:l(s.summaries.annual.expenses)}),e.jsx("td",{className:`border border-gray-300 p-3 text-right font-semibold ${s.summaries.annual.net>=0?"text-green-600":"text-red-600"}`,children:l(s.summaries.annual.net)}),e.jsx("td",{className:"border border-gray-300 p-3 text-center",children:e.jsx(B,{variant:s.summaries.annual.net>=0?"default":"destructive",children:s.summaries.annual.net>=0?"Superávit":"Déficit"})})]},t))})]})})})]})]})})}export{js as default};
