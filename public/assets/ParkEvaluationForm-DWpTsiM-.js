import{k as M,az as L,l as O,a2 as I,u as $,af as z,ag as G,j as e,f as v,i as p,M as H,B as y,A as P,ah as Q,ai as J,g as C,h as w,t as K,aj as r,ak as i,al as t,am as c,O as u,an as l,ao as R,n as U,Q as W,V as Y,W as _,Y as X,_ as g,b as V,$ as D,ad as a,N as Z,ap as ee,aq as F}from"./index-D5qLf1ib.js";import{M as se}from"./message-circle-jTu33GDb.js";import{S as ae}from"./send-Bxi1PaXf.js";const ne=a.object({parkId:a.number(),evaluatorName:a.string().min(2,"El nombre debe tener al menos 2 caracteres"),evaluatorEmail:a.string().email("Email inv谩lido").optional().or(a.literal("")),evaluatorPhone:a.string().optional(),evaluatorCity:a.string().optional(),evaluatorAge:a.number().min(13,"Edad m铆nima: 13 a帽os").max(120,"Edad m谩xima: 120 a帽os").optional(),isFrequentVisitor:a.boolean().optional(),cleanliness:a.number().min(0).max(5),safety:a.number().min(0).max(5),maintenance:a.number().min(0).max(5),accessibility:a.number().min(0).max(5),amenities:a.number().min(0).max(5),activities:a.number().min(0).max(5),staff:a.number().min(0).max(5),naturalBeauty:a.number().min(0).max(5),overallRating:a.number().min(0).max(5),comments:a.string().optional(),suggestions:a.string().optional(),wouldRecommend:a.boolean().optional(),visitDate:a.string().optional(),visitPurpose:a.string().optional(),visitDuration:a.number().min(1).optional()}),x=({value:d,onChange:j,label:b})=>{const[E,N]=I.useState(0);return e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{className:"text-sm font-medium",children:b}),e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(m=>e.jsx("button",{type:"button",className:"p-1 transition-colors hover:bg-gray-100 rounded",onMouseEnter:()=>N(m),onMouseLeave:()=>N(0),onClick:()=>j(m),children:e.jsx(V,{className:`h-6 w-6 ${m<=(E||d)?"text-yellow-500 fill-yellow-500":"text-gray-300"}`})},m)),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:d>0?`${d}/5`:"Sin calificar"})]})]})};function oe(){const{slug:d}=M(),[,j]=L(),{toast:b}=O(),[E,N]=I.useState(!1),m=d?d.split("-").pop():null,{data:f,isLoading:A}=$({queryKey:["/api/parks",m,"extended"],queryFn:()=>F(`/api/parks/${m}/extended`),enabled:!!m}),n=z({resolver:ee(ne),defaultValues:{parkId:m?parseInt(m):0,evaluatorName:"",evaluatorEmail:"",evaluatorPhone:"",evaluatorCity:"",isFrequentVisitor:!1,cleanliness:0,safety:0,maintenance:0,accessibility:0,amenities:0,activities:0,staff:0,naturalBeauty:0,overallRating:0,comments:"",suggestions:"",wouldRecommend:!0,visitDate:"",visitPurpose:""}}),k=G({mutationFn:s=>F("/api/park-evaluations",{method:"POST",body:s}),onSuccess:s=>{N(!0),b({title:"隆Evaluaci贸n enviada!",description:"Tu evaluaci贸n ha sido enviada exitosamente. Ser谩 revisada antes de publicarse."})},onError:s=>{b({title:"Error al enviar evaluaci贸n",description:"Hubo un problema al enviar tu evaluaci贸n. Int茅ntalo nuevamente.",variant:"destructive"})}}),T=s=>{if([s.cleanliness,s.safety,s.maintenance,s.accessibility,s.amenities,s.activities,s.staff,s.naturalBeauty,s.overallRating].every(S=>S===0)){b({title:"Calificaci贸n requerida",description:"Por favor, califica al menos un aspecto del parque.",variant:"destructive"});return}const o={parkId:s.parkId,evaluatorName:s.evaluatorName,isFrequentVisitor:s.isFrequentVisitor||!1,wouldRecommend:s.wouldRecommend!==void 0?s.wouldRecommend:!0},B={cleanliness:s.cleanliness,safety:s.safety,maintenance:s.maintenance,accessibility:s.accessibility,amenities:s.amenities,activities:s.activities,staff:s.staff,naturalBeauty:s.naturalBeauty,overallRating:s.overallRating};Object.entries(B).forEach(([S,q])=>{q>0&&(o[S]=q)}),s.evaluatorEmail&&s.evaluatorEmail.trim()!==""&&(o.evaluatorEmail=s.evaluatorEmail),s.evaluatorPhone&&s.evaluatorPhone.trim()!==""&&(o.evaluatorPhone=s.evaluatorPhone),s.evaluatorCity&&s.evaluatorCity.trim()!==""&&(o.evaluatorCity=s.evaluatorCity),s.evaluatorAge&&s.evaluatorAge>0&&(o.evaluatorAge=s.evaluatorAge),s.comments&&s.comments.trim()!==""&&(o.comments=s.comments),s.suggestions&&s.suggestions.trim()!==""&&(o.suggestions=s.suggestions),s.visitDate&&s.visitDate.trim()!==""&&(o.visitDate=s.visitDate),s.visitPurpose&&s.visitPurpose.trim()!==""&&(o.visitPurpose=s.visitPurpose),s.visitDuration&&s.visitDuration>0&&(o.visitDuration=s.visitDuration),console.log(" Datos procesados a enviar:",JSON.stringify(o,null,2)),k.mutate(o)};return A?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando informaci贸n del parque..."})]})}):f?E?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(v,{className:"max-w-md w-full",children:e.jsxs(p,{className:"pt-6 text-center",children:[e.jsx(Q,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"隆Evaluaci贸n enviada!"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Gracias por tu opini贸n sobre ",f.name,". Tu evaluaci贸n ser谩 revisada y publicada pronto."]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{onClick:()=>j(`/parque/${f.slug}`),children:"Ver parque"}),e.jsx(y,{variant:"outline",onClick:()=>j("/parks"),children:"Otros parques"})]})]})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"container mx-auto px-4 max-w-4xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs(y,{variant:"ghost",onClick:()=>j(`/parque/${f.slug}`),className:"mb-4",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Volver al parque"]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Eval煤a ",f.name]}),e.jsx("p",{className:"text-gray-600",children:"Tu opini贸n es importante para mejorar nuestros parques. Califica tu experiencia."})]})]}),e.jsx(J,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(T),className:"space-y-8",children:[e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"Informaci贸n Personal"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:n.control,name:"evaluatorName",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Nombre completo *"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Tu nombre completo",...s})}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"evaluatorEmail",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Email (opcional)"}),e.jsx(c,{children:e.jsx(u,{type:"email",placeholder:"tu@email.com",...s})}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(r,{control:n.control,name:"evaluatorPhone",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Tel茅fono (opcional)"}),e.jsx(c,{children:e.jsx(u,{placeholder:"333-123-4567",...s})}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"evaluatorCity",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Ciudad (opcional)"}),e.jsx(c,{children:e.jsx(u,{placeholder:"Guadalajara",...s})}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"evaluatorAge",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Edad (opcional)"}),e.jsx(c,{children:e.jsx(u,{type:"number",min:"13",max:"120",placeholder:"25",...s,onChange:h=>s.onChange(h.target.value?parseInt(h.target.value):void 0)})}),e.jsx(l,{})]})})]}),e.jsx(r,{control:n.control,name:"isFrequentVisitor",render:({field:s})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(c,{children:e.jsx(R,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(t,{children:"Soy visitante frecuente de este parque"})})]})})]})]}),e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Informaci贸n de tu Visita"]})}),e.jsx(p,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(r,{control:n.control,name:"visitDate",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Fecha de visita (opcional)"}),e.jsx(c,{children:e.jsx(u,{type:"date",...s})}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"visitPurpose",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Prop贸sito de la visita (opcional)"}),e.jsxs(W,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(Y,{children:e.jsx(_,{placeholder:"Selecciona..."})})}),e.jsxs(X,{children:[e.jsx(g,{value:"recreation",children:"Recreaci贸n"}),e.jsx(g,{value:"exercise",children:"Ejercicio"}),e.jsx(g,{value:"family",children:"Actividad familiar"}),e.jsx(g,{value:"work",children:"Trabajo"}),e.jsx(g,{value:"events",children:"Eventos"}),e.jsx(g,{value:"other",children:"Otro"})]})]}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"visitDuration",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Duraci贸n (minutos, opcional)"}),e.jsx(c,{children:e.jsx(u,{type:"number",min:"1",placeholder:"60",...s,onChange:h=>s.onChange(h.target.value?parseInt(h.target.value):void 0)})}),e.jsx(l,{})]})})]})})]}),e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5"}),"Calificaciones"]})}),e.jsxs(p,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(r,{control:n.control,name:"cleanliness",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Limpieza"}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"safety",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Seguridad"}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"maintenance",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Mantenimiento"}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"accessibility",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Accesibilidad"}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"amenities",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Amenidades"}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"activities",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Actividades"}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"staff",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Personal"}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"naturalBeauty",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Belleza Natural"}),e.jsx(l,{})]})})]}),e.jsx("div",{className:"mt-6 pt-6 border-t",children:e.jsx(r,{control:n.control,name:"overallRating",render:({field:s})=>e.jsxs(i,{children:[e.jsx(x,{value:s.value,onChange:s.onChange,label:"Calificaci贸n General"}),e.jsx(l,{})]})})})]})]}),e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Comentarios y Sugerencias"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsx(r,{control:n.control,name:"comments",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Comentarios sobre tu experiencia (opcional)"}),e.jsx(c,{children:e.jsx(D,{placeholder:"Cu茅ntanos sobre tu experiencia en el parque...",className:"min-h-[100px]",...s})}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"suggestions",render:({field:s})=>e.jsxs(i,{children:[e.jsx(t,{children:"Sugerencias de mejora (opcional)"}),e.jsx(c,{children:e.jsx(D,{placeholder:"驴Qu茅 podr铆amos mejorar en el parque?",className:"min-h-[100px]",...s})}),e.jsx(l,{})]})}),e.jsx(r,{control:n.control,name:"wouldRecommend",render:({field:s})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(c,{children:e.jsx(R,{checked:s.value,onCheckedChange:s.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(t,{children:"Recomendar铆a este parque a otros visitantes"})})]})})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(y,{type:"submit",size:"lg",className:"bg-green-600 hover:bg-green-700",disabled:k.isPending,children:k.isPending?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Enviando..."]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Enviar Evaluaci贸n"]})})})]})})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx(v,{className:"max-w-md w-full",children:e.jsxs(p,{className:"pt-6 text-center",children:[e.jsx(H,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Parque no encontrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No se pudo encontrar el parque especificado."}),e.jsxs(y,{onClick:()=>j("/parks"),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Volver a parques"]})]})})})}export{oe as default};
