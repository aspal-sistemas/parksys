import{az as Y,a2 as o,ae as G,l as W,u as A,ag as X,j as e,aX as Z,f as c,M as k,B as n,cY as q,g as m,h as x,i as h,m as C,as as M,a4 as ee,O as se,Q as ae,V as te,W as le,Y as re,_ as j,ab as ie,bH as ne,bI as ce,bJ as F,bK as t,bL as de,bM as l,ds as _,o as E,au as oe,bq as me,b$ as xe,c0 as he,bn as je,c1 as pe,c2 as ue,c3 as ge,c4 as Ne,c5 as ve,c6 as fe,c7 as be,w as ye,y as we,z as Ce,I as _e,p as Ee,P as De,U as Se}from"./index-D5qLf1ib.js";const I={pending:"bg-yellow-100 text-yellow-800",confirmed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800",completed:"bg-blue-100 text-blue-800"},D={pending:"Pendiente",confirmed:"Confirmada",cancelled:"Cancelada",completed:"Completada"},z={playground:"Área de Juegos",kiosk:"Kiosco",picnic_area:"Área de Picnic",open_area:"Área Abierta",pavilion:"Pabellón"};function Le(){const[Te,S]=Y(),[p,H]=o.useState(""),[v,$]=o.useState("all"),[a,T]=o.useState(null),[r,f]=o.useState(1),[u]=o.useState(10),P=G(),{toast:R}=W(),{data:K=[],isLoading:B,error:Q}=A({queryKey:["/api/space-reservations"],queryFn:async()=>{const s=await fetch("/api/space-reservations");if(!s.ok)throw new Error("Error al cargar las reservas");return s.json()}}),{data:g={},isLoading:Pe}=A({queryKey:["/api/space-reservations/stats"],queryFn:async()=>{const s=await fetch("/api/space-reservations/stats");if(!s.ok)throw new Error("Error al cargar las estadísticas");return s.json()}}),d=K.filter(s=>{const i=(s.customer_name||"").toLowerCase().includes(p.toLowerCase())||(s.space_name||"").toLowerCase().includes(p.toLowerCase())||(s.park_name||"").toLowerCase().includes(p.toLowerCase()),w=v==="all"||s.status===v;return i&&w}),b=Math.ceil(d.length/u),N=(r-1)*u,L=d.slice(N,N+u),V=s=>{T(s)},J=s=>{S(`/admin/space-reservations/edit/${s.id}`)},O=()=>{S("/admin/space-reservations/new")},y=X({mutationFn:async s=>{const i=await fetch(`/api/space-reservations/${s}`,{method:"DELETE"});if(!i.ok){const w=await i.json().catch(()=>({}));throw new Error(w.error||"Error al eliminar la reserva")}return i.json()},onSuccess:()=>{P.invalidateQueries({queryKey:["/api/space-reservations"]}),P.invalidateQueries({queryKey:["/api/space-reservations/stats"]}),R({title:"Reserva eliminada",description:"La reserva ha sido cancelada y eliminada correctamente."})},onError:s=>{R({title:"Error",description:"No se pudo eliminar la reserva. Inténtalo de nuevo.",variant:"destructive"})}}),U=s=>{y.mutate(s)};return B?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):Q?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-red-600",children:"Error al cargar las reservas de espacios"})}):e.jsx(Z,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(c,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Reservas de Espacios"})]}),e.jsxs(n,{onClick:O,className:"bg-[#00a587] hover:bg-[#067f5f] text-white",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"Nueva Reserva"]})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestiona las reservas de espacios recreativos en los parques"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(c,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total Reservas"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold",children:g.total_reservations||0})})]}),e.jsxs(c,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Confirmadas"}),e.jsx(C,{className:"h-4 w-4 text-green-600"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold text-green-600",children:g.confirmed||0})})]}),e.jsxs(c,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Pendientes"}),e.jsx(C,{className:"h-4 w-4 text-yellow-600"})]}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:g.pending||0})})]}),e.jsxs(c,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Ingresos del Mes"}),e.jsx(M,{className:"h-4 w-4 text-[#00a587]"})]}),e.jsx(h,{children:e.jsxs("div",{className:"text-2xl font-bold text-[#00a587]",children:["$",g.monthly_revenue||"0.00"]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ee,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(se,{placeholder:"Buscar por cliente, espacio o parque...",value:p,onChange:s=>H(s.target.value),className:"pl-10"})]})}),e.jsxs(ae,{value:v,onValueChange:$,children:[e.jsx(te,{className:"w-full sm:w-[180px]",children:e.jsx(le,{placeholder:"Filtrar por estado"})}),e.jsxs(re,{children:[e.jsx(j,{value:"all",children:"Todos los estados"}),e.jsx(j,{value:"pending",children:"Pendiente"}),e.jsx(j,{value:"confirmed",children:"Confirmada"}),e.jsx(j,{value:"cancelled",children:"Cancelada"}),e.jsx(j,{value:"completed",children:"Completada"})]})]})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(x,{children:"Reservas Activas"}),e.jsxs(ie,{children:["Mostrando ",L.length," de ",d.length," reservas"]})]}),e.jsxs(h,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ne,{children:[e.jsx(ce,{children:e.jsxs(F,{children:[e.jsx(t,{children:"Cliente"}),e.jsx(t,{children:"Espacio"}),e.jsx(t,{children:"Parque"}),e.jsx(t,{children:"Fecha"}),e.jsx(t,{children:"Horario"}),e.jsx(t,{children:"Estado"}),e.jsx(t,{children:"Total"}),e.jsx(t,{children:"Acciones"})]})}),e.jsx(de,{children:L.map(s=>e.jsxs(F,{children:[e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.customer_name}),e.jsx("div",{className:"text-sm text-gray-500",children:s.customer_email})]})}),e.jsx(l,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.space_name}),e.jsx("div",{className:"text-sm text-gray-500",children:z[s.space_type]})]})}),e.jsx(l,{children:s.park_name}),e.jsx(l,{children:_(s.reservation_date)}),e.jsxs(l,{children:[s.start_time," - ",s.end_time,e.jsxs("div",{className:"text-sm text-gray-500",children:[s.total_hours,"h"]})]}),e.jsx(l,{children:e.jsx(E,{className:I[s.status],children:D[s.status]})}),e.jsxs(l,{className:"font-medium",children:["$",s.total_cost]}),e.jsx(l,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>V(s),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>J(s),children:e.jsx(me,{className:"h-4 w-4"})}),(s.status==="pending"||s.status==="confirmed")&&e.jsxs(xe,{children:[e.jsx(he,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-800 hover:bg-red-50",children:e.jsx(je,{className:"h-4 w-4"})})}),e.jsxs(pe,{children:[e.jsxs(ue,{children:[e.jsx(ge,{children:"¿Eliminar reserva activa?"}),e.jsxs(Ne,{children:['Esta acción no se puede deshacer. La reserva de "',s.space_name,'" para ',s.customer_name," será cancelada y eliminada permanentemente.",e.jsxs("div",{className:"mt-3 p-3 bg-amber-50 border border-amber-200 rounded text-amber-800 text-sm",children:[e.jsx("strong",{children:"⚠️ Advertencia:"})," Esta reserva está ",e.jsx("strong",{children:D[s.status]}),". Considera notificar al cliente antes de eliminarla."]})]})]}),e.jsxs(ve,{children:[e.jsx(fe,{children:"Cancelar"}),e.jsx(be,{onClick:()=>U(s.id),className:"bg-red-600 hover:bg-red-700",disabled:y.isPending,children:y.isPending?"Eliminando...":"Eliminar Reserva"})]})]})]})]})})]},s.id))})]})}),b>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("p",{className:"text-sm text-gray-500",children:["Mostrando ",N+1," a ",Math.min(N+u,d.length)," de ",d.length," reservas"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>f(r-1),disabled:r===1,children:"Anterior"}),Array.from({length:b},(s,i)=>i+1).map(s=>e.jsx(n,{variant:r===s?"default":"outline",size:"sm",onClick:()=>f(s),className:r===s?"bg-[#00a587] hover:bg-[#067f5f]":"",children:s},s)),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>f(r+1),disabled:r===b,children:"Siguiente"})]})]})]})]}),e.jsx(ye,{open:!!a,onOpenChange:s=>!s&&T(null),children:e.jsxs(we,{className:"max-w-2xl",children:[e.jsx(Ce,{children:e.jsx(_e,{children:"Detalles de la Reserva"})}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Información del Cliente"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Nombre:"}),e.jsx("span",{children:a.customer_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:a.customer_email})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:a.customer_phone})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Información del Espacio"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{children:a.space_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Parque:"}),e.jsx("span",{children:a.park_name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"h-4 w-4 text-gray-400"}),e.jsxs("span",{children:["Capacidad: ",a.space_capacity," personas"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Tipo:"}),e.jsx("span",{children:z[a.space_type]})]})]})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Detalles de la Reserva"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(C,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"Fecha:"}),e.jsx("span",{children:_(a.reservation_date)})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Horario:"}),e.jsxs("span",{children:[a.start_time," - ",a.end_time]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Duración:"}),e.jsxs("span",{children:[a.total_hours," horas"]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(M,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:"Costo por hora:"}),e.jsxs("span",{children:["$",a.hourly_rate]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold text-[#00a587]",children:["$",a.total_cost]})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:"Depósito:"}),e.jsx(E,{className:a.deposit_paid?"bg-green-100 text-green-800":"bg-red-100 text-red-800",children:a.deposit_paid?"Pagado":"Pendiente"})]})]})]})]}),a.special_requests&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Solicitudes Especiales"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.special_requests})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Estado:"}),e.jsx(E,{className:`ml-2 ${I[a.status]}`,children:D[a.status]})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Creada: ",_(a.created_at)]})]})})]})]})})]})})}export{Le as default};
