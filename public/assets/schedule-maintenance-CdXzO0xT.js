import{am as W,d as Z,Y as s,u as k,j as e,aI as ee,B as c,A,C as T,a as q,b as w,c as D,y as t,z as d,H as m,J as u,K as h,dn as E,N as n,O as F,bF as ae,X as z,l as V,I as se,bz as ne,bG as o,bA as te}from"./index-Dzu3mJf5.js";const le=()=>{const[ie,r]=W(),{id:i}=Z(),[l,B]=s.useState(new Date),[y,L]=s.useState("preventivo"),[N,G]=s.useState("medium"),[p,J]=s.useState(""),[f,K]=s.useState(""),[x,O]=s.useState(""),[j,U]=s.useState(""),[v,C]=s.useState(i||""),[S,b]=s.useState(!1),{data:I=[]}=k({queryKey:["/api/assets"],retry:!1}),{data:H=[]}=k({queryKey:["/api/users"],retry:!1}),M=H.filter(a=>["admin","tecnico","supervisor"].includes(a.role)),Q=[{id:1,name:"Banca Modelo Colonial",parkId:1,parkName:"Parque Central"},{id:2,name:"Juego Infantil Múltiple",parkId:1,parkName:"Parque Central"},{id:3,name:"Fuente Central",parkId:2,parkName:"Parque Metropolitano"},{id:4,name:"Señalización Informativa",parkId:2,parkName:"Parque Metropolitano"}],X=[{id:1,fullName:"Juan Pérez",role:"admin"},{id:2,fullName:"María López",role:"tecnico"},{id:3,fullName:"Carlos Gómez",role:"supervisor"}],R=I.length>0?I:Q,Y=M.length>0?M:X;s.useEffect(()=>{i&&C(i)},[i]);const _=async a=>{if(a.preventDefault(),!l){o({title:"Error",description:"Debes seleccionar una fecha para el mantenimiento",variant:"destructive"});return}if(!v){o({title:"Error",description:"Debes seleccionar un activo para el mantenimiento",variant:"destructive"});return}if(!p.trim()){o({title:"Error",description:"Debes ingresar una descripción del mantenimiento",variant:"destructive"});return}b(!0);try{const g={assetId:parseInt(v),date:V(l,"yyyy-MM-dd"),maintenanceType:y,description:p,priority:N,notes:f.trim()||null,estimatedCost:x?parseFloat(x):null,assignedToId:j?parseInt(j):null,status:"pendiente"},P=await fetch("/api/maintenance/schedule",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(g)});if(!P.ok){const $=await P.json();throw new Error($.message||"Error al programar el mantenimiento")}te.invalidateQueries({queryKey:["/api/assets/maintenance/upcoming"]}),o({title:"Mantenimiento programado",description:"El mantenimiento ha sido programado correctamente"}),r(i?"/admin/assets/inventory":"/admin/assets/maintenance/calendar")}catch(g){console.error("Error al programar mantenimiento:",g),o({title:"Error",description:"No se pudo programar el mantenimiento. Por favor, intenta de nuevo.",variant:"destructive"})}finally{b(!1)}};return e.jsx(ee,{children:e.jsxs("div",{className:"container py-6",children:[e.jsx("div",{className:"mb-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(c,{variant:"outline",onClick:()=>r("/admin/assets/maintenance/calendar"),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Volver al Calendario"]}),i&&e.jsxs(c,{variant:"outline",onClick:()=>r("/admin/assets/inventory"),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Volver al Inventario"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Programar Mantenimiento"}),e.jsx("p",{className:"text-muted-foreground",children:"Programa un nuevo mantenimiento para un activo"})]})]})}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(T,{children:[e.jsx(q,{children:e.jsx(w,{className:"text-lg",children:"Información Básica"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"asset",children:"Activo*"}),e.jsxs(d,{value:v,onValueChange:C,required:!0,children:[e.jsx(m,{id:"asset",children:e.jsx(u,{placeholder:"Selecciona un activo"})}),e.jsx(h,{children:e.jsx(E,{children:R.map(a=>e.jsxs(n,{value:a.id.toString(),children:[a.name," (",a.parkName||"Sin parque asignado",")"]},a.id))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"maintenanceType",children:"Tipo de Mantenimiento*"}),e.jsxs(d,{value:y,onValueChange:L,required:!0,children:[e.jsx(m,{id:"maintenanceType",children:e.jsx(u,{placeholder:"Selecciona un tipo"})}),e.jsxs(h,{children:[e.jsx(n,{value:"preventivo",children:"Preventivo"}),e.jsx(n,{value:"correctivo",children:"Correctivo"}),e.jsx(n,{value:"predictivo",children:"Predictivo"}),e.jsx(n,{value:"inspeccion",children:"Inspección"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"priority",children:"Prioridad*"}),e.jsxs(d,{value:N,onValueChange:G,required:!0,children:[e.jsx(m,{id:"priority",children:e.jsx(u,{placeholder:"Selecciona la prioridad"})}),e.jsxs(h,{children:[e.jsx(n,{value:"low",children:"Baja"}),e.jsx(n,{value:"medium",children:"Media"}),e.jsx(n,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"description",children:"Descripción*"}),e.jsx(F,{id:"description",placeholder:"Describe el mantenimiento a realizar",value:p,onChange:a=>J(a.target.value),rows:3,required:!0})]})]})]}),e.jsxs(T,{children:[e.jsx(q,{children:e.jsx(w,{className:"text-lg",children:"Detalles Adicionales"})}),e.jsxs(D,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{children:"Fecha Programada*"}),e.jsx("div",{className:"border rounded-md p-3",children:e.jsx(ae,{mode:"single",selected:l,onSelect:B,locale:z,className:"mx-auto"})}),l&&e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fecha seleccionada: ",V(l,"dd 'de' MMMM 'de' yyyy",{locale:z})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"assignedTo",children:"Asignar a"}),e.jsxs(d,{value:j,onValueChange:U,children:[e.jsx(m,{id:"assignedTo",children:e.jsx(u,{placeholder:"Selecciona un responsable (opcional)"})}),e.jsx(h,{children:e.jsx(E,{children:Y.map(a=>e.jsxs(n,{value:a.id.toString(),children:[a.fullName," (",a.role,")"]},a.id))})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"estimatedCost",children:"Costo Estimado (MXN)"}),e.jsx(se,{id:"estimatedCost",type:"number",placeholder:"Ingresa el costo estimado",value:x,onChange:a=>O(a.target.value),min:0,step:.01})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"notes",children:"Notas Adicionales"}),e.jsx(F,{id:"notes",placeholder:"Información adicional relevante",value:f,onChange:a=>K(a.target.value),rows:3})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(c,{variant:"outline",type:"button",className:"mr-2",onClick:()=>r("/admin/assets/maintenance/calendar"),children:"Cancelar"}),e.jsxs(c,{type:"submit",disabled:S,children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),S?"Guardando...":"Programar Mantenimiento"]})]})]})]})})};export{le as default};
