import{k as Y,az as J,l as W,ae as X,a2 as f,af as Z,u as D,ag as ee,j as e,aX as T,B as b,f as x,A as M,ai as se,g as h,h as j,M as ae,i as p,aj as c,ak as l,al as d,Q as q,am as o,V as P,W as I,Y as L,_ as y,an as m,U as ne,O as g,cY as re,$ as ie,as as $,ah as z,ao as te,n as ce,bG as le,ab as de,o as oe,ad as t,ap as xe}from"./index-D5qLf1ib.js";import{S as V}from"./separator-Bek7HtsH.js";import{S as me}from"./SpaceMediaManager-BPIuC-1B.js";const he=t.object({space_id:t.string().min(1,"Selecciona un espacio"),customer_name:t.string().min(2,"El nombre debe tener al menos 2 caracteres"),customer_email:t.string().email("Email inválido"),customer_phone:t.string().min(10,"El teléfono debe tener al menos 10 dígitos"),reservation_date:t.string().min(1,"Selecciona una fecha"),start_time:t.string().min(1,"Selecciona hora de inicio"),end_time:t.string().min(1,"Selecciona hora de fin"),special_requests:t.string().optional(),status:t.enum(["pending","confirmed","cancelled","completed"]).default("pending"),deposit_paid:t.boolean().default(!1)});function fe(){const N=Y().id,[pe,_]=J(),{toast:w}=W(),A=X(),[n,F]=f.useState(null),[S,H]=f.useState(0),[v,B]=f.useState(0),r=Z({resolver:xe(he),defaultValues:{space_id:"",customer_name:"",customer_email:"",customer_phone:"",reservation_date:"",start_time:"",end_time:"",special_requests:"",status:"pending",deposit_paid:!1}}),{data:a,isLoading:Q}=D({queryKey:[`/api/space-reservations/${N}`],queryFn:async()=>{const s=await fetch(`/api/space-reservations/${N}`);if(!s.ok)throw new Error("Error al cargar la reserva");return s.json()},enabled:!!N}),{data:C=[],isLoading:U}=D({queryKey:["/api/reservable-spaces"],queryFn:async()=>{const s=await fetch("/api/reservable-spaces?active_only=true");if(!s.ok)throw new Error("Error al cargar los espacios");return s.json()}});f.useEffect(()=>{if(a){r.reset({space_id:a.space_id.toString(),customer_name:a.contact_name,customer_email:a.contact_email,customer_phone:a.contact_phone,reservation_date:a.reservation_date,start_time:a.start_time,end_time:a.end_time,special_requests:a.special_requests||"",status:a.status,deposit_paid:a.deposit_paid});const s=C.find(i=>i.id===a.space_id);s&&F(s)}},[a,C,r]),f.useEffect(()=>{if(n){const s=r.watch("start_time"),i=r.watch("end_time");if(s&&i){const u=new Date(`2000-01-01T${s}:00`),O=new Date(`2000-01-01T${i}:00`).getTime()-u.getTime(),k=Math.max(1,Math.ceil(O/(1e3*60*60)));B(k),H(k*parseFloat(n.hourly_rate))}}},[n,r.watch("start_time"),r.watch("end_time")]);const E=ee({mutationFn:async s=>{const i={spaceId:parseInt(s.space_id),contactName:s.customer_name,contactEmail:s.customer_email,contactPhone:s.customer_phone,reservationDate:s.reservation_date,startTime:s.start_time,endTime:s.end_time,specialRequests:s.special_requests||"",status:s.status,expectedAttendees:(n==null?void 0:n.capacity)||1,purpose:"Evento privado",totalCost:S,depositPaid:s.deposit_paid},u=await fetch(`/api/space-reservations/${N}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!u.ok){const R=await u.json();throw new Error(R.message||"Error al actualizar la reserva")}return u.json()},onSuccess:()=>{w({title:"Reserva actualizada",description:"La reserva se ha actualizado exitosamente"}),A.invalidateQueries({queryKey:["/api/space-reservations"]}),_("/admin/space-reservations")},onError:s=>{w({title:"Error",description:s.message,variant:"destructive"})}}),G=s=>{if(!n){w({title:"Error",description:"Por favor selecciona un espacio",variant:"destructive"});return}E.mutate(s)},K=s=>{const i=C.find(u=>u.id===parseInt(s));F(i||null)};return Q||U?e.jsx(T,{children:e.jsx("div",{className:"p-8 text-center",children:"Cargando reserva..."})}):a?e.jsx(T,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(x,{className:"p-4 bg-gray-50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(b,{variant:"ghost",size:"sm",onClick:()=>_("/admin/space-reservations"),children:[e.jsx(M,{className:"h-4 w-4"}),"Volver a Reservas"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Editar Reserva"}),e.jsxs("p",{className:"text-gray-600",children:["Modifica los detalles de la reserva #",a.id]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"xl:col-span-2",children:[e.jsx(se,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(G),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Selección de Espacio"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsx(c,{control:r.control,name:"space_id",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Espacio Reservable"}),e.jsxs(q,{onValueChange:i=>{s.onChange(i),K(i)},value:s.value,children:[e.jsx(o,{children:e.jsx(P,{children:e.jsx(I,{placeholder:"Selecciona un espacio"})})}),e.jsx(L,{children:C.map(i=>e.jsxs(y,{value:i.id.toString(),children:[i.name," - ",i.park_name]},i.id))})]}),e.jsx(m,{})]})}),n&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:n.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:n.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Capacidad:"})," ",n.capacity," personas"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tarifa:"})," $",n.hourly_rate,"/hora"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",n.space_type]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ubicación:"})," ",n.location]})]})]})]})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Información del Cliente"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsx(c,{control:r.control,name:"customer_name",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Nombre Completo"}),e.jsx(o,{children:e.jsx(g,{placeholder:"Nombre del responsable",...s})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"customer_email",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Email"}),e.jsx(o,{children:e.jsx(g,{type:"email",placeholder:"email@ejemplo.com",...s})}),e.jsx(m,{})]})}),e.jsx(c,{control:r.control,name:"customer_phone",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Teléfono"}),e.jsx(o,{children:e.jsx(g,{placeholder:"33 1234 5678",...s})}),e.jsx(m,{})]})})]})]})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Detalles de la Reserva"]})}),e.jsxs(p,{className:"space-y-4",children:[e.jsx(c,{control:r.control,name:"reservation_date",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Fecha de la Reserva"}),e.jsx(o,{children:e.jsx(g,{type:"date",...s})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:r.control,name:"start_time",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Hora de Inicio"}),e.jsx(o,{children:e.jsx(g,{type:"time",...s})}),e.jsx(m,{})]})}),e.jsx(c,{control:r.control,name:"end_time",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Hora de Fin"}),e.jsx(o,{children:e.jsx(g,{type:"time",...s})}),e.jsx(m,{})]})})]}),e.jsx(c,{control:r.control,name:"status",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Estado de la Reserva"}),e.jsxs(q,{onValueChange:s.onChange,value:s.value,children:[e.jsx(o,{children:e.jsx(P,{children:e.jsx(I,{placeholder:"Selecciona el estado"})})}),e.jsxs(L,{children:[e.jsx(y,{value:"pending",children:"Pendiente"}),e.jsx(y,{value:"confirmed",children:"Confirmada"}),e.jsx(y,{value:"cancelled",children:"Cancelada"}),e.jsx(y,{value:"completed",children:"Completada"})]})]}),e.jsx(m,{})]})}),e.jsx(c,{control:r.control,name:"special_requests",render:({field:s})=>e.jsxs(l,{children:[e.jsx(d,{children:"Solicitudes Especiales"}),e.jsx(o,{children:e.jsx(ie,{placeholder:"Detalles adicionales o solicitudes especiales...",rows:3,...s})}),e.jsx(m,{})]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Resumen de Costos"]})}),e.jsx(p,{children:n&&v>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tarifa por hora:"}),e.jsxs("span",{children:["$",n.hourly_rate]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Duración:"}),e.jsxs("span",{children:[v," ",v===1?"hora":"horas"]})]}),e.jsx(V,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",S.toFixed(2)]})]})]}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Selecciona un espacio y horarios para calcular el costo"})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Estado de Pago"]})}),e.jsx(p,{children:e.jsx(c,{control:r.control,name:"deposit_paid",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(te,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(d,{children:"Depósito pagado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Marcar si el cliente ya pagó el depósito"})]})]})})})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>_("/admin/space-reservations"),children:"Cancelar"}),e.jsx(b,{type:"submit",disabled:E.isPending,children:E.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2 animate-spin"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Actualizar Reserva"]})})]})]})}),e.jsxs(x,{className:"w-full mt-6",children:[e.jsxs(h,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Gestión Multimedia"]}),e.jsx(de,{children:"Gestiona las imágenes y documentos de esta reserva"})]}),e.jsx(p,{children:a?e.jsx(me,{spaceId:a.space_id,isEditMode:!0}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Cargando multimedia..."})})]})]}),e.jsx("div",{className:"xl:col-span-1",children:e.jsxs("div",{className:"sticky top-6 space-y-4",children:[e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Resumen de Costos"]})}),e.jsx(p,{children:n&&v>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tarifa por hora:"}),e.jsxs("span",{children:["$",n.hourly_rate]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Duración:"}),e.jsxs("span",{children:[v," ",v===1?"hora":"horas"]})]}),e.jsx(V,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",S.toFixed(2)]})]})]}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Selecciona un espacio y horarios para calcular el costo"})})]}),e.jsxs(x,{children:[e.jsx(h,{children:e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5"}),"Estado de la Reserva"]})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ID:"}),e.jsxs("span",{children:["#",a.id]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Fecha de creación:"}),e.jsx("span",{children:a.created_at?new Date(a.created_at).toLocaleDateString():"No disponible"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Estado actual:"}),e.jsx(oe,{variant:a.status==="confirmed"?"default":a.status==="pending"?"secondary":a.status==="cancelled"?"destructive":"outline",children:a.status==="pending"?"Pendiente":a.status==="confirmed"?"Confirmada":a.status==="cancelled"?"Cancelada":a.status==="completed"?"Completada":a.status})]})]})})]})]})})]})]})}):e.jsx(T,{children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-600",children:"Reserva no encontrada"}),e.jsx(b,{onClick:()=>_("/admin/space-reservations"),className:"mt-4",children:"Volver a Reservas"})]})})}export{fe as default};
