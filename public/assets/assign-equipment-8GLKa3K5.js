import{Y as i,u as q,j as e,aB as ae,B as S,A as se,C as F,a as z,b as B,a3 as M,c as L,y as t,z as x,H as h,J as j,K as g,dg as b,N as r,X as K,O as ie,bv as u,l as V,bs as te}from"./index-BBGHPKhn.js";import{C as re}from"./checkbox-DK4Ni3Jp.js";import{D as Y}from"./date-picker-Br9iC_5u.js";import{S as ne}from"./save-BO66L-dX.js";import"./calendar-CINRWzw_.js";import"./subDays-Dk5VivQJ.js";import"./isSameMonth-BMtjuyI-.js";import"./startOfMonth-Cxv5uHqS.js";import"./addMonths-FaidB020.js";import"./popover-D0eXtsNc.js";const ge=()=>{const[o,J]=i.useState(""),[c,O]=i.useState(""),[d,R]=i.useState(null),[f,H]=i.useState(null),[C,Q]=i.useState(""),[p,G]=i.useState(""),[E,U]=i.useState(""),[I,X]=i.useState(!1),[w,k]=i.useState(!1),{data:N=[]}=q({queryKey:["/api/assets"],retry:!1}),{data:v=[]}=q({queryKey:["/api/instructors"],retry:!1}),{data:y=[]}=q({queryKey:["/api/activities"],retry:!1}),$=[{id:1,name:"Equipo de Yoga (10 colchonetas)",condition:"good",categoryName:"Equipamiento Deportivo",parkName:"Parque Central"},{id:2,name:"Set de Balones de Fútbol (5)",condition:"good",categoryName:"Equipamiento Deportivo",parkName:"Parque Central"},{id:3,name:"Kit de Tenis (4 raquetas, 10 pelotas)",condition:"fair",categoryName:"Equipamiento Deportivo",parkName:"Parque Metropolitano"},{id:4,name:"Sistema de Sonido Portátil",condition:"good",categoryName:"Equipamiento Electrónico",parkName:"Parque Agua Azul"}],W=[{id:1,fullName:"Carlos Ramírez",specialties:"Yoga, Meditación"},{id:2,fullName:"Laura Sánchez",specialties:"Fútbol, Atletismo"},{id:3,fullName:"Miguel Torres",specialties:"Tenis, Badminton"},{id:4,fullName:"Ana López",specialties:"Baile, Aerobics"}],Z=[{id:1,title:"Clase de Yoga para Principiantes",parkId:1,parkName:"Parque Central"},{id:2,title:"Entrenamiento de Fútbol Juvenil",parkId:1,parkName:"Parque Central"},{id:3,title:"Torneo de Tenis Infantil",parkId:2,parkName:"Parque Metropolitano"},{id:4,title:"Clase de Baile Urbano",parkId:3,parkName:"Parque Agua Azul"}],A=Array.isArray(N)&&N.length>0?N.filter(a=>{var l,m;return((l=a.categoryName)==null?void 0:l.toLowerCase().includes("deport"))||((m=a.categoryName)==null?void 0:m.toLowerCase().includes("equip"))}):$,D=Array.isArray(v)&&v.length>0?v:W,P=Array.isArray(y)&&y.length>0?y:Z,s=A.find(a=>a.id.toString()===o),n=D.find(a=>a.id.toString()===c);P.find(a=>a.id.toString()===p);const T=!1,_=async a=>{if(a.preventDefault(),!o){u({title:"Error",description:"Debes seleccionar un equipamiento para asignar",variant:"destructive"});return}if(!c){u({title:"Error",description:"Debes seleccionar un instructor",variant:"destructive"});return}if(!d){u({title:"Error",description:"Debes seleccionar una fecha de inicio",variant:"destructive"});return}k(!0);try{const l={assetId:parseInt(o),instructorId:parseInt(c),startDate:d?V(d,"yyyy-MM-dd"):null,endDate:f?V(f,"yyyy-MM-dd"):null,purpose:C,activityId:p?parseInt(p):null,notes:E,requiresTraining:I,status:"active"},m=await fetch("/api/asset-assignments",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(l)});if(!m.ok){const ee=await m.json();throw new Error(ee.message||"Error al asignar equipamiento")}te.invalidateQueries({queryKey:["/api/assets"]}),u({title:"Equipamiento asignado",description:"El equipamiento ha sido asignado correctamente al instructor."}),window.location.href="/admin/assets"}catch(l){console.error("Error al asignar equipamiento:",l),u({title:"Error",description:"No se pudo asignar el equipamiento. Por favor, intenta de nuevo.",variant:"destructive"})}finally{k(!1)}};return e.jsx(ae,{children:e.jsxs("div",{className:"container py-6",children:[e.jsx("div",{className:"mb-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(S,{variant:"outline",onClick:()=>window.location.href="/admin/assets",children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Volver a Activos"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Asignar Equipamiento a Instructor"}),e.jsx("p",{className:"text-muted-foreground",children:"Asigna equipamiento deportivo a instructores para actividades programadas"})]})]})}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(F,{children:[e.jsxs(z,{children:[e.jsx(B,{className:"text-lg",children:"Información del Equipamiento"}),e.jsx(M,{children:"Selecciona el equipamiento deportivo que deseas asignar"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"asset",children:"Equipamiento*"}),e.jsxs(x,{value:o,onValueChange:J,required:!0,children:[e.jsx(h,{id:"asset",children:e.jsx(j,{placeholder:"Selecciona un equipamiento"})}),e.jsx(g,{children:e.jsx(b,{children:A.map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.name," (",a.parkName||"Sin parque asignado",")"]},a.id))})})]})]}),o&&e.jsxs("div",{className:"border rounded-md p-4 bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Información del equipamiento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nombre:"}),e.jsx("span",{className:"text-sm font-medium",children:s==null?void 0:s.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Condición:"}),e.jsx("span",{className:"text-sm font-medium capitalize",children:s==null?void 0:s.condition})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Parque:"}),e.jsx("span",{className:"text-sm font-medium",children:(s==null?void 0:s.parkName)||"No asignado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Categoría:"}),e.jsx("span",{className:"text-sm font-medium",children:s==null?void 0:s.categoryName})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"purpose",children:"Propósito de uso*"}),e.jsxs(x,{value:C,onValueChange:Q,required:!0,children:[e.jsx(h,{id:"purpose",children:e.jsx(j,{placeholder:"Selecciona el propósito"})}),e.jsxs(g,{children:[e.jsx(r,{value:"class",children:"Clase regular"}),e.jsx(r,{value:"event",children:"Evento especial"}),e.jsx(r,{value:"tournament",children:"Torneo"}),e.jsx(r,{value:"workshop",children:"Taller"}),e.jsx(r,{value:"training",children:"Entrenamiento"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"activity",children:"Actividad relacionada (opcional)"}),e.jsxs(x,{value:p,onValueChange:G,children:[e.jsx(h,{id:"activity",children:e.jsx(j,{placeholder:"Selecciona una actividad"})}),e.jsx(g,{children:e.jsx(b,{children:P.map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.title," (",a.parkName||"Sin parque asignado",")"]},a.id))})})]})]})]})]}),e.jsxs(F,{children:[e.jsxs(z,{children:[e.jsx(B,{className:"text-lg",children:"Información del Instructor"}),e.jsx(M,{children:"Selecciona el instructor y el periodo de asignación"})]}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"instructor",children:"Instructor*"}),e.jsxs(x,{value:c,onValueChange:O,required:!0,children:[e.jsx(h,{id:"instructor",children:e.jsx(j,{placeholder:"Selecciona un instructor"})}),e.jsx(g,{children:e.jsx(b,{children:D.map(a=>e.jsx(r,{value:a.id.toString(),children:a.fullName},a.id))})})]})]}),c&&e.jsxs("div",{className:"border rounded-md p-4 bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Información del instructor"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nombre:"}),e.jsx("span",{className:"text-sm font-medium",children:n==null?void 0:n.fullName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Especialidades:"}),e.jsx("span",{className:"text-sm font-medium",children:n==null?void 0:n.specialties})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"startDate",children:"Fecha de inicio*"}),e.jsx(Y,{selected:d,onSelect:R,locale:K,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"endDate",children:"Fecha de devolución"}),e.jsx(Y,{selected:f,onSelect:H,locale:K,className:"w-full",minDate:d||void 0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{htmlFor:"notes",children:"Notas adicionales"}),e.jsx(ie,{id:"notes",placeholder:"Instrucciones especiales o detalles adicionales",value:E,onChange:a=>U(a.target.value),rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[e.jsx(re,{id:"requiresTraining",checked:I,onCheckedChange:a=>X(a)}),e.jsx(t,{htmlFor:"requiresTraining",className:"text-sm font-normal",children:"El instructor requiere capacitación para usar este equipamiento"})]}),T]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(S,{variant:"outline",type:"button",className:"mr-2",onClick:()=>window.location.href="/admin/assets",children:"Cancelar"}),e.jsxs(S,{type:"submit",disabled:w||T,children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),w?"Asignando...":"Asignar Equipamiento"]})]})]})]})})};export{ge as default};
