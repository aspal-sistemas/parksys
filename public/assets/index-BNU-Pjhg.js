import{az as re,a2 as o,l as ce,ae as de,u as N,ag as K,R as oe,j as e,aX as z,f as D,a_ as me,w as I,x as xe,B as l,bh as ue,y as T,z as E,I as M,J as q,Q as m,V as x,W as u,Y as h,_ as d,O as j,$ as Q,i as $,a4 as he,g as je,h as ve,bH as ge,bI as pe,bJ as L,bK as c,bL as Ne,bM as n,r as f,o as b,au as fe,bq as be,bF as ye,n as Ce,ah as Se,aW as Ae,aq as _,a1 as y}from"./index-D5qLf1ib.js";const G=[{value:"excellent",label:"Excelente"},{value:"good",label:"Bueno"},{value:"fair",label:"Regular"},{value:"poor",label:"Malo"}],J=r=>({excellent:"Excelente",good:"Bueno",fair:"Regular",poor:"Malo",critical:"Crítico",excelente:"Excelente",bueno:"Bueno",regular:"Regular",malo:"Malo",crítico:"Crítico"})[r.toLowerCase()]||r,P=[{value:"active",label:"Activa",color:"bg-blue-100 text-blue-800",icon:Ce},{value:"returned",label:"Devuelto",color:"bg-green-100 text-green-800",icon:Se},{value:"overdue",label:"Vencida",color:"bg-red-100 text-red-800",icon:Ae}],De=()=>{re();const[r,F]=o.useState(""),[g,U]=o.useState("all"),[W,C]=o.useState(!1),[Y,S]=o.useState(!1),[X,p]=o.useState(!1),[t,V]=o.useState(null),{toast:v}=ce(),k=de(),{data:B=[],isLoading:Z}=N({queryKey:["/api/asset-assignments"],staleTime:6e4}),{data:ee=[]}=N({queryKey:["/api/assets"],staleTime:6e4}),{data:se=[]}=N({queryKey:["/api/instructors"],staleTime:6e4}),{data:ae=[]}=N({queryKey:["/api/activities"],staleTime:6e4}),A=K({mutationFn:async s=>_("/api/asset-assignments",{method:"POST",data:s}),onSuccess:()=>{k.invalidateQueries({queryKey:["/api/asset-assignments"]}),v({title:"Asignación creada",description:"La asignación de activo se ha creado correctamente."}),C(!1)},onError:()=>{v({title:"Error",description:"No se pudo crear la asignación.",variant:"destructive"})}}),te=K({mutationFn:async({id:s,condition:a,notes:i})=>_(`/api/asset-assignments/${s}/return`,{method:"POST",data:{condition:a,notes:i}}),onSuccess:()=>{k.invalidateQueries({queryKey:["/api/asset-assignments"]}),v({title:"Activo devuelto",description:"El activo se ha marcado como devuelto."})},onError:()=>{v({title:"Error",description:"No se pudo procesar la devolución.",variant:"destructive"})}}),R=oe.useMemo(()=>B.filter(s=>{var O,H;const a=((O=s.assetName)==null?void 0:O.toLowerCase().includes(r.toLowerCase()))||((H=s.instructorName)==null?void 0:H.toLowerCase().includes(r.toLowerCase()))||s.purpose.toLowerCase().includes(r.toLowerCase()),i=g==="all"||s.status===g;return a&&i}),[B,r,g]),ie=s=>{s.preventDefault();const a=new FormData(s.currentTarget),i={assetId:parseInt(a.get("assetId")),instructorId:a.get("instructorId")?parseInt(a.get("instructorId")):null,activityId:a.get("activityId")?parseInt(a.get("activityId")):null,assignmentDate:a.get("assignmentDate"),purpose:a.get("purpose"),condition:a.get("condition"),notes:a.get("notes")};A.mutate(i)},w=s=>P.find(a=>a.value===s)||P[0],le=s=>{V(s),S(!0)},ne=s=>{V(s),p(!0)};return Z?e.jsx(z,{children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"text-center",children:"Cargando asignaciones..."})})}):e.jsx(z,{children:e.jsxs("div",{className:"p-6",children:[e.jsx(D,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestión de Asignaciones"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Asigna activos a instructores para actividades específicas"})]}),e.jsxs(I,{open:W,onOpenChange:C,children:[e.jsx(xe,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Nueva Asignación"]})}),e.jsxs(T,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(E,{children:[e.jsx(M,{children:"Crear Nueva Asignación"}),e.jsx(q,{children:"Asigna un activo a un instructor o actividad"})]}),e.jsxs("form",{onSubmit:ie,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Activo"}),e.jsxs(m,{name:"assetId",required:!0,children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Seleccionar activo"})}),e.jsx(h,{children:ee.filter(s=>s.status==="active").map(s=>e.jsxs(d,{value:s.id.toString(),children:[s.name," - ",s.parkName]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Instructor (opcional)"}),e.jsxs(m,{name:"instructorId",children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Seleccionar instructor"})}),e.jsx(h,{children:se.map(s=>e.jsxs(d,{value:s.id.toString(),children:[s.firstName," ",s.lastName]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Actividad (opcional)"}),e.jsxs(m,{name:"activityId",children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Seleccionar actividad"})}),e.jsx(h,{children:ae.map(s=>e.jsx(d,{value:s.id.toString(),children:s.title},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha de Asignación"}),e.jsx(j,{name:"assignmentDate",type:"date",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Propósito"}),e.jsx(j,{name:"purpose",placeholder:"Propósito de la asignación",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Condición al Asignar"}),e.jsxs(m,{name:"condition",required:!0,children:[e.jsx(x,{children:e.jsx(u,{placeholder:"Seleccionar condición"})}),e.jsx(h,{children:G.map(s=>e.jsx(d,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notas"}),e.jsx(Q,{name:"notes",placeholder:"Notas adicionales"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(l,{type:"submit",disabled:A.isPending,children:A.isPending?"Creando...":"Crear Asignación"})]})]})]})]})]})}),e.jsx(D,{className:"mb-6",children:e.jsx($,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(j,{placeholder:"Buscar por activo, instructor o propósito...",value:r,onChange:s=>F(s.target.value),className:"pl-10"})]})}),e.jsxs(m,{value:g,onValueChange:U,children:[e.jsx(x,{className:"w-[180px]",children:e.jsx(u,{placeholder:"Estado"})}),e.jsxs(h,{children:[e.jsx(d,{value:"all",children:"Todos los estados"}),P.map(s=>e.jsx(d,{value:s.value,children:s.label},s.value))]})]})]})})}),e.jsxs(D,{children:[e.jsx(je,{children:e.jsx(ve,{children:"Lista de Asignaciones"})}),e.jsx($,{children:e.jsxs(ge,{children:[e.jsx(pe,{children:e.jsxs(L,{children:[e.jsx(c,{children:"Activo"}),e.jsx(c,{children:"Instructor"}),e.jsx(c,{children:"Actividad"}),e.jsx(c,{children:"Fecha Asignación"}),e.jsx(c,{children:"Propósito"}),e.jsx(c,{children:"Estado"}),e.jsx(c,{children:"Condición"}),e.jsx(c,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ne,{children:R.length===0?e.jsx(L,{children:e.jsx(n,{colSpan:8,className:"text-center py-6 text-muted-foreground",children:"No se encontraron asignaciones registradas"})}):R.map(s=>{const a=w(s.status),i=a.icon;return e.jsxs(L,{children:[e.jsx(n,{className:"font-medium",children:s.assetName||`Activo #${s.assetId}`}),e.jsx(n,{children:s.instructorName||"-"}),e.jsx(n,{children:s.activityName||"-"}),e.jsx(n,{children:f(new Date(s.assignmentDate),"dd/MM/yyyy",{locale:y})}),e.jsx(n,{className:"max-w-xs truncate",children:s.purpose}),e.jsx(n,{children:e.jsxs(b,{className:a.color,children:[e.jsx(i,{className:"w-3 h-3 mr-1"}),a.label]})}),e.jsx(n,{children:e.jsx(b,{variant:"outline",children:J(s.condition)})}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>le(s),title:"Ver detalles",children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>ne(s),title:"Editar asignación",children:e.jsx(be,{className:"h-4 w-4"})}),s.status==="active"&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>te.mutate({id:s.id,condition:s.condition}),title:"Devolver activo",children:e.jsx(ye,{className:"h-4 w-4"})})]})})]},s.id)})})]})})]}),e.jsx(I,{open:Y,onOpenChange:S,children:e.jsxs(T,{className:"max-w-2xl",children:[e.jsxs(E,{children:[e.jsx(M,{children:"Detalles de la Asignación"}),e.jsx(q,{children:"Información completa de la asignación de activo"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Activo"}),e.jsx("p",{className:"font-medium",children:t.assetName||`Activo #${t.assetId}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Instructor"}),e.jsx("p",{className:"font-medium",children:t.instructorName||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Actividad"}),e.jsx("p",{className:"font-medium",children:t.activityName||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Fecha de Asignación"}),e.jsx("p",{className:"font-medium",children:f(new Date(t.assignmentDate),"dd/MM/yyyy",{locale:y})})]}),t.returnDate&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Fecha de Devolución"}),e.jsx("p",{className:"font-medium",children:f(new Date(t.returnDate),"dd/MM/yyyy",{locale:y})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Estado"}),e.jsx("div",{className:"mt-1",children:e.jsx(b,{className:w(t.status).color,children:w(t.status).label})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Condición"}),e.jsx("div",{className:"mt-1",children:e.jsx(b,{variant:"outline",children:J(t.condition)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Creado"}),e.jsx("p",{className:"font-medium",children:f(new Date(t.createdAt),"dd/MM/yyyy HH:mm",{locale:y})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Propósito"}),e.jsx("p",{className:"mt-1 p-3 bg-gray-50 rounded-md",children:t.purpose})]}),t.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Notas"}),e.jsx("p",{className:"mt-1 p-3 bg-gray-50 rounded-md",children:t.notes})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(l,{variant:"outline",onClick:()=>S(!1),children:"Cerrar"})})]})}),e.jsx(I,{open:X,onOpenChange:p,children:e.jsxs(T,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(E,{children:[e.jsx(M,{children:"Editar Asignación"}),e.jsx(q,{children:"Modifica los datos de la asignación"})]}),t&&e.jsxs("form",{onSubmit:s=>{s.preventDefault();const a=new FormData(s.currentTarget),i={purpose:a.get("purpose"),condition:a.get("condition"),notes:a.get("notes")};console.log("Datos a actualizar:",i),v({title:"Función en desarrollo",description:"La edición de asignaciones estará disponible próximamente."}),p(!1)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Activo"}),e.jsx(j,{value:t.assetName||`Activo #${t.assetId}`,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Instructor"}),e.jsx(j,{value:t.instructorName||"Sin asignar",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Propósito"}),e.jsx(j,{name:"purpose",defaultValue:t.purpose,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Condición"}),e.jsxs(m,{name:"condition",defaultValue:t.condition,required:!0,children:[e.jsx(x,{children:e.jsx(u,{})}),e.jsx(h,{children:G.map(s=>e.jsx(d,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notas"}),e.jsx(Q,{name:"notes",defaultValue:t.notes||""})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>p(!1),children:"Cancelar"}),e.jsx(l,{type:"submit",children:"Guardar Cambios"})]})]})]})})]})})};export{De as default};
