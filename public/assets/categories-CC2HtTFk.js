import{aD as je,am as be,e as fe,a6 as ye,Y as l,u as Y,a8 as v,j as e,aI as F,B as n,A as ve,b2 as Z,Z as Ne,I as B,as as Ce,C as we,a as Se,b as Ee,bY as G,bb as W,a3 as ke,c as Le,bh as ze,bi as Fe,bj as _,bk as L,bl as Te,bm as z,D as T,r as A,t as I,v as P,w as q,y as N,O as ee,aJ as Ae,be as Ie,l as Pe,X as qe}from"./index-Dzu3mJf5.js";import{F as D}from"./folder-plus-DVC4xyQE.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=je("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Me=({mode:p,initialData:a,onClose:t,onSubmit:d,isSubmitting:o})=>{const[h,f]=l.useState((a==null?void 0:a.name)||""),[u,C]=l.useState((a==null?void 0:a.description)||""),[m,g]=l.useState((a==null?void 0:a.color)||"#3b82f6"),x=i=>{i.preventDefault(),d({id:a==null?void 0:a.id,name:h,description:u,color:m})};return e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Nombre de la categoría"}),e.jsx(B,{id:"name",value:h,onChange:i=>f(i.target.value),placeholder:"Ej: Daños, Mantenimiento, Seguridad",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Descripción"}),e.jsx(ee,{id:"description",value:u,onChange:i=>C(i.target.value),placeholder:"Describe el propósito de esta categoría...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"color",children:"Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"color",id:"color",value:m,onChange:i=>g(i.target.value),className:"w-12 h-8 rounded border"}),e.jsx("span",{className:"text-sm text-gray-500",children:m})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:t,children:"Cancelar"}),e.jsx(n,{type:"submit",disabled:o||!h.trim(),children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),p==="create"?"Creando...":"Actualizando..."]}):p==="create"?"Crear categoría":"Actualizar categoría"})]})]})},Oe=({mode:p,initialData:a,parentCategoryId:t,categories:d,onClose:o,onSubmit:h,isSubmitting:f})=>{var k;const[u,C]=l.useState((a==null?void 0:a.name)||""),[m,g]=l.useState((a==null?void 0:a.description)||""),[x,i]=l.useState(((k=a==null?void 0:a.categoryId)==null?void 0:k.toString())||(t==null?void 0:t.toString())||""),j=c=>{c.preventDefault(),h({id:a==null?void 0:a.id,name:u,description:m,categoryId:parseInt(x)})};return e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"category",children:"Categoría principal"}),e.jsxs("select",{id:"category",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:x,onChange:c=>i(c.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),d.map(c=>e.jsx("option",{value:c.id.toString(),children:c.name},c.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Nombre de la subcategoría"}),e.jsx(B,{id:"name",value:u,onChange:c=>C(c.target.value),placeholder:"Ej: Juegos infantiles, Iluminación, Baños",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Descripción"}),e.jsx(ee,{id:"description",value:m,onChange:c=>g(c.target.value),placeholder:"Describe el propósito de esta subcategoría...",rows:3})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:o,children:"Cancelar"}),e.jsx(n,{type:"submit",disabled:f||!u.trim()||!x,children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),p==="create"?"Creando...":"Actualizando..."]}):p==="create"?"Crear subcategoría":"Actualizar subcategoría"})]})]})},Qe=({isOpen:p,onClose:a,onConfirm:t,isDeleting:d,itemType:o,itemName:h})=>e.jsx(T,{open:p,onOpenChange:a,children:e.jsxs(A,{children:[e.jsxs(I,{children:[e.jsx(P,{children:"Confirmar eliminación"}),e.jsx(q,{children:o==="category"?"Esta acción eliminará la categoría y todas sus subcategorías. Las incidencias asociadas se mantendrán pero perderán su categorización.":"Esta acción eliminará la subcategoría. Las incidencias asociadas se mantendrán pero perderán su subcategorización."})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex items-center p-4 bg-amber-50 text-amber-800 rounded-md",children:[e.jsx(Ae,{className:"h-5 w-5 mr-2 text-amber-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["¿Estás seguro de eliminar ",o==="category"?"la categoría":"la subcategoría",' "',h,'"?']}),e.jsx("p",{className:"text-sm",children:"Esta acción no se puede deshacer."})]})]})}),e.jsxs(Ie,{children:[e.jsx(n,{variant:"outline",onClick:a,children:"Cancelar"}),e.jsx(n,{variant:"destructive",onClick:t,disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Eliminando..."]}):"Eliminar"})]})]})}),Je=()=>{const[p,a]=be(),{toast:t}=fe(),d=ye(),[o,h]=l.useState(""),[f,u]=l.useState(!1),[C,m]=l.useState(!1),[g,x]=l.useState(null),[i,j]=l.useState(null),[k,c]=l.useState(void 0),[re,w]=l.useState(!1),[b,S]=l.useState(null),[E,M]=l.useState("category"),{data:O=[],isLoading:ae,isError:se,refetch:te}=Y({queryKey:["/api/incident-categories"],onError:r=>{console.error("Error al cargar categorías:",r),t({title:"Error",description:"No se pudieron cargar las categorías",variant:"destructive"})}}),{data:oe=[],isLoading:ie,refetch:Ue}=Y({queryKey:["/api/incident-subcategories"],onError:r=>{console.error("Error al cargar subcategorías:",r),t({title:"Error",description:"No se pudieron cargar las subcategorías",variant:"destructive"})}}),Q=v({mutationFn:async r=>{const s=await fetch("/api/incident-categories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify(r)});if(!s.ok)throw new Error("Error al crear la categoría");return await s.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/incident-categories"]}),u(!1),t({title:"Categoría creada",description:"La categoría ha sido creada correctamente"})},onError:r=>{console.error("Error al crear categoría:",r),t({title:"Error",description:"No se pudo crear la categoría",variant:"destructive"})}}),U=v({mutationFn:async r=>{const s=await fetch(`/api/incident-categories/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify({name:r.name,description:r.description,color:r.color})});if(!s.ok)throw new Error("Error al actualizar la categoría");return await s.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/incident-categories"]}),x(null),u(!1),t({title:"Categoría actualizada",description:"La categoría ha sido actualizada correctamente"})},onError:r=>{console.error("Error al actualizar categoría:",r),t({title:"Error",description:"No se pudo actualizar la categoría",variant:"destructive"})}}),K=v({mutationFn:async r=>{if(!(await fetch(`/api/incident-categories/${r}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-admin","X-User-Id":"1"}})).ok)throw new Error("Error al eliminar la categoría");return!0},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/incident-categories"]}),d.invalidateQueries({queryKey:["/api/incident-subcategories"]}),w(!1),S(null),t({title:"Categoría eliminada",description:"La categoría ha sido eliminada correctamente"})},onError:r=>{console.error("Error al eliminar categoría:",r),t({title:"Error",description:"No se pudo eliminar la categoría",variant:"destructive"})}}),X=v({mutationFn:async r=>{const s=await fetch("/api/incident-subcategories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify(r)});if(!s.ok)throw new Error("Error al crear la subcategoría");return await s.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/incident-subcategories"]}),m(!1),c(void 0),t({title:"Subcategoría creada",description:"La subcategoría ha sido creada correctamente"})},onError:r=>{console.error("Error al crear subcategoría:",r),t({title:"Error",description:"No se pudo crear la subcategoría",variant:"destructive"})}}),J=v({mutationFn:async r=>{const s=await fetch(`/api/incident-subcategories/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify({name:r.name,description:r.description,categoryId:r.categoryId})});if(!s.ok)throw new Error("Error al actualizar la subcategoría");return await s.json()},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/incident-subcategories"]}),j(null),m(!1),t({title:"Subcategoría actualizada",description:"La subcategoría ha sido actualizada correctamente"})},onError:r=>{console.error("Error al actualizar subcategoría:",r),t({title:"Error",description:"No se pudo actualizar la subcategoría",variant:"destructive"})}}),H=v({mutationFn:async r=>{if(!(await fetch(`/api/incident-subcategories/${r}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-admin","X-User-Id":"1"}})).ok)throw new Error("Error al eliminar la subcategoría");return!0},onSuccess:()=>{d.invalidateQueries({queryKey:["/api/incident-subcategories"]}),w(!1),S(null),t({title:"Subcategoría eliminada",description:"La subcategoría ha sido eliminada correctamente"})},onError:r=>{console.error("Error al eliminar subcategoría:",r),t({title:"Error",description:"No se pudo eliminar la subcategoría",variant:"destructive"})}}),$=O.filter(r=>r.name.toLowerCase().includes(o.toLowerCase())||r.description&&r.description.toLowerCase().includes(o.toLowerCase())),R=oe.reduce((r,s)=>(r[s.categoryId]||(r[s.categoryId]=[]),r[s.categoryId].push(s),r),{}),ne=r=>R[r]?R[r].filter(s=>s.name.toLowerCase().includes(o.toLowerCase())||s.description&&s.description.toLowerCase().includes(o.toLowerCase())):[],ce=r=>{Q.mutate(r)},le=r=>{U.mutate(r)},de=r=>{S(r),M("category"),w(!0)},ue=()=>{b&&E==="category"&&K.mutate(b.id)},me=r=>{X.mutate(r)},he=r=>{J.mutate(r)},ge=r=>{S(r),M("subcategory"),w(!0)},xe=()=>{b&&E==="subcategory"&&H.mutate(b.id)},pe=r=>Pe(new Date(r),"d MMM yyyy",{locale:qe});return ae||ie?e.jsx(F,{children:e.jsx("div",{className:"container mx-auto py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})})})}):se?e.jsx(F,{children:e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error al cargar categorías"}),e.jsx("p",{className:"mb-4",children:"No se pudieron cargar las categorías de incidencias."}),e.jsx(n,{onClick:()=>te(),children:"Reintentar"})]})})}):e.jsxs(F,{children:[e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(n,{variant:"ghost",className:"mb-4",onClick:()=>a("/admin/incidents"),children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Volver a incidencias"]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Categorías de incidencias"}),e.jsx("p",{className:"text-gray-500",children:"Gestiona las categorías y subcategorías para clasificar incidencias"})]}),e.jsxs("div",{className:"flex items-center mt-4 md:mt-0 space-x-2",children:[e.jsxs(n,{variant:"outline",onClick:()=>{j(null),m(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Nueva subcategoría"]}),e.jsxs(n,{onClick:()=>{x(null),u(!0)},children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Nueva categoría"]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ne,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(B,{type:"search",placeholder:"Buscar categorías y subcategorías...",className:"pl-8",value:o,onChange:r=>h(r.target.value)}),o&&e.jsx("button",{onClick:()=>h(""),className:"absolute right-2.5 top-2.5 text-gray-500 hover:text-gray-700",children:e.jsx(Ce,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-6",children:$.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4",children:e.jsx(Be,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No hay categorías"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No se encontraron categorías con los criterios de búsqueda."}),e.jsxs(n,{onClick:()=>u(!0),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Crear primera categoría"]})]}):$.map(r=>{var V;const s=ne(r.id);return o&&s.length===0&&!r.name.toLowerCase().includes(o.toLowerCase())&&!((V=r.description)!=null&&V.toLowerCase().includes(o.toLowerCase()))?null:e.jsxs(we,{className:"overflow-hidden",children:[e.jsxs(Se,{className:"bg-gray-50 pb-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:r.color||"#3b82f6"}}),e.jsx(Ee,{children:r.name})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 md:mt-0",children:[e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>{c(r.id),j(null),m(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Añadir subcategoría"]}),e.jsxs(n,{variant:"ghost",size:"sm",onClick:()=>{x(r),u(!0)},children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(n,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>de(r),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]}),r.description&&e.jsx(ke,{className:"mt-2",children:r.description})]}),e.jsx(Le,{children:s.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No hay subcategorías definidas"}):e.jsxs(ze,{children:[e.jsx(Fe,{children:e.jsxs(_,{children:[e.jsx(L,{children:"Nombre"}),e.jsx(L,{children:"Descripción"}),e.jsx(L,{children:"Creada"}),e.jsx(L,{className:"text-right",children:"Acciones"})]})}),e.jsx(Te,{children:s.map(y=>e.jsxs(_,{children:[e.jsx(z,{className:"font-medium",children:y.name}),e.jsx(z,{className:"max-w-md truncate",children:y.description||"-"}),e.jsx(z,{children:pe(y.createdAt)}),e.jsx(z,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(n,{variant:"ghost",size:"sm",onClick:()=>{j(y),m(!0)},children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(n,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>ge(y),children:e.jsx(W,{className:"h-4 w-4"})})]})})]},y.id))})]})})]},r.id)})})]}),e.jsx(T,{open:f,onOpenChange:u,children:e.jsxs(A,{children:[e.jsxs(I,{children:[e.jsx(P,{children:g?"Editar categoría":"Nueva categoría"}),e.jsx(q,{children:g?"Actualiza los detalles de esta categoría de incidencias":"Crea una nueva categoría para clasificar incidencias"})]}),e.jsx(Me,{mode:g?"edit":"create",initialData:g,onClose:()=>{u(!1),x(null)},onSubmit:g?le:ce,isSubmitting:g?U.isPending:Q.isPending})]})}),e.jsx(T,{open:C,onOpenChange:m,children:e.jsxs(A,{children:[e.jsxs(I,{children:[e.jsx(P,{children:i?"Editar subcategoría":"Nueva subcategoría"}),e.jsx(q,{children:i?"Actualiza los detalles de esta subcategoría":"Crea una nueva subcategoría para clasificar incidencias de forma más específica"})]}),e.jsx(Oe,{mode:i?"edit":"create",initialData:i,parentCategoryId:k,categories:O,onClose:()=>{m(!1),j(null),c(void 0)},onSubmit:i?he:me,isSubmitting:i?J.isPending:X.isPending})]})}),e.jsx(Qe,{isOpen:re,onClose:()=>{w(!1),S(null)},onConfirm:E==="category"?ue:xe,isDeleting:E==="category"?K.isPending:H.isPending,itemType:E,itemName:(b==null?void 0:b.name)||""})]})};export{Je as default};
