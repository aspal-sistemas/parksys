import{e as Pe,a6 as qe,Y as E,u as R,a8 as z,ai as K,j as e,C as M,c as T,x as Ge,a as J,b as Y,az as Xe,y as le,O as B,B as h,f as L,S as We,D as ge,p as Je,ba as Ie,r as ve,t as Ne,v as ye,w as fe,be,bo as Fe,bp as ke,bb as Le,bq as ze,br as $e,bs as Re,bt as Be,bu as Ke,bv as Oe,bw as Ue,bg as Ye,bT as He,bU as v,dg as Qe,cX as me,dh as Ve,d as Ze,am as es,R as ce,a7 as Ce,ah as we,aI as ss,A as as,aL as De,aJ as je,aO as ns,aP as is,aQ as oe,i as rs,aR as de,ch as ts,an as ls,a3 as Se,aa as Ee,ab as l,ac as c,ad as o,ae as d,I as b,af as m,z as V,H as _,J as G,K as X,N as W,aA as pe,dr as Me}from"./index-VG22aPDC.js";import{H as cs}from"./Helmet-CoO02W0T.js";import{S as I}from"./skeleton-BEdbCltD.js";import{C as _e}from"./camera-awBmfv_v.js";import{S as os}from"./star-off-BBW0EGAw.js";import{S as ds}from"./separator-D_IPDq0v.js";import{H as Te}from"./history-bKEChJ9K.js";const ms=({assetId:i,assetName:C})=>{const{toast:N}=Pe(),p=qe(),A=E.useRef(null),[Z,O]=E.useState(!1),[ee,$]=E.useState(""),[se,ae]=E.useState(!1),[n,f]=E.useState(null),[ne,P]=E.useState(""),[ie,q]=E.useState(!1),{data:F,isLoading:j,isError:k}=R({queryKey:[`/api/assets/${i}/images`]}),re=z({mutationFn:async a=>{const t=await fetch(`/api/assets/${i}/images`,{method:"POST",body:a});if(!t.ok){const D=await t.json();throw new Error(D.error||"Error al subir imagen")}return t.json()},onSuccess:()=>{p.invalidateQueries({queryKey:[`/api/assets/${i}/images`]}),p.invalidateQueries({queryKey:[`/api/assets/${i}`]}),$(""),ae(!1),A.current&&(A.current.value=""),N({title:"Imagen subida",description:"La imagen se ha subido correctamente."})},onError:a=>{N({title:"Error al subir imagen",description:a.message,variant:"destructive"})},onSettled:()=>{O(!1)}}),w=z({mutationFn:async({imageId:a,data:t})=>K(`/api/asset-images/${a}`,{method:"PUT",data:t}),onSuccess:()=>{p.invalidateQueries({queryKey:[`/api/assets/${i}/images`]}),p.invalidateQueries({queryKey:[`/api/assets/${i}`]}),f(null),N({title:"Imagen actualizada",description:"Los datos de la imagen se han actualizado correctamente."})},onError:a=>{N({title:"Error al actualizar imagen",description:a.message,variant:"destructive"})}}),U=z({mutationFn:async a=>K(`/api/asset-images/${a}`,{method:"DELETE"}),onSuccess:()=>{p.invalidateQueries({queryKey:[`/api/assets/${i}/images`]}),p.invalidateQueries({queryKey:[`/api/assets/${i}`]}),N({title:"Imagen eliminada",description:"La imagen se ha eliminado correctamente."})},onError:a=>{N({title:"Error al eliminar imagen",description:a.message,variant:"destructive"})}}),u=z({mutationFn:async a=>K(`/api/asset-images/${a}/set-primary`,{method:"POST"}),onSuccess:()=>{p.invalidateQueries({queryKey:[`/api/assets/${i}/images`]}),p.invalidateQueries({queryKey:[`/api/assets/${i}`]}),N({title:"Imagen principal establecida",description:"La imagen se ha marcado como principal."})},onError:a=>{N({title:"Error al establecer imagen principal",description:a.message,variant:"destructive"})}}),g=a=>{var y;const t=(y=a.target.files)==null?void 0:y[0];if(!t)return;if(!t.type.startsWith("image/")){N({title:"Archivo inválido",description:"Por favor selecciona un archivo de imagen válido.",variant:"destructive"});return}if(t.size>5*1024*1024){N({title:"Archivo muy grande",description:"La imagen no puede superar los 5MB.",variant:"destructive"});return}O(!0);const D=new FormData;D.append("image",t),D.append("caption",ee),D.append("isPrimary",se.toString()),re.mutate(D)},H=a=>{f(a),P(a.caption||""),q(a.isPrimary)},xe=()=>{n&&w.mutate({imageId:n.id,data:{caption:ne,isPrimary:ie}})},Q=a=>{if(a===0)return"0 Bytes";const t=1024,D=["Bytes","KB","MB","GB"],y=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,y)).toFixed(2))+" "+D[y]},te=a=>new Date(a).toLocaleDateString("es-MX",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return k?e.jsx(M,{children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center text-red-500",children:[e.jsx(Ge,{className:"h-5 w-5 mr-2"}),"Error al cargar las imágenes"]})})}):e.jsxs(M,{children:[e.jsx(J,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Gestión de Imágenes - ",C]})}),e.jsxs(T,{className:"space-y-6",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsx(Xe,{className:"h-6 w-6 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium",children:"Subir Nueva Imagen"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Selecciona una imagen para el activo (máximo 5MB)"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"caption",children:"Descripción (opcional)"}),e.jsx(B,{id:"caption",placeholder:"Descripción de la imagen...",value:ee,onChange:a=>$(a.target.value),rows:2})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"isPrimary",checked:se,onChange:a=>ae(a.target.checked),className:"rounded"}),e.jsx(le,{htmlFor:"isPrimary",className:"text-sm",children:"Marcar como imagen principal"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(h,{onClick:()=>{var a;return(a=A.current)==null?void 0:a.click()},disabled:Z,className:"flex-1",children:Z?"Subiendo...":"Seleccionar Imagen"})}),e.jsx("input",{ref:A,type:"file",accept:"image/*",onChange:g,className:"hidden"})]})]})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium mb-4",children:["Imágenes del Activo (",(F==null?void 0:F.length)||0,")"]}),j?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Array.from({length:3}).map((a,t)=>e.jsx(I,{className:"h-64 w-full"},t))}):F&&F.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:F.map(a=>e.jsxs(M,{className:"relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:a.imageUrl,alt:a.caption||a.fileName,className:"w-full h-48 object-cover rounded-t-lg"}),a.isPrimary&&e.jsxs(L,{className:"absolute top-2 left-2 bg-yellow-500",children:[e.jsx(We,{className:"h-3 w-3 mr-1"}),"Principal"]}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1",children:[!a.isPrimary&&e.jsx(h,{size:"sm",variant:"secondary",className:"h-8 w-8 p-0",onClick:()=>u.mutate(a.id),title:"Marcar como principal",children:e.jsx(os,{className:"h-4 w-4"})}),e.jsxs(ge,{open:(n==null?void 0:n.id)===a.id,onOpenChange:t=>{t||f(null)},children:[e.jsx(Je,{asChild:!0,children:e.jsx(h,{size:"sm",variant:"secondary",className:"h-8 w-8 p-0",onClick:()=>H(a),title:"Editar imagen",children:e.jsx(Ie,{className:"h-4 w-4"})})}),e.jsxs(ve,{children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Editar Imagen"}),e.jsx(fe,{children:"Modifica la información de la imagen"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(le,{htmlFor:"edit-caption",children:"Descripción"}),e.jsx(B,{id:"edit-caption",value:ne,onChange:t=>P(t.target.value),placeholder:"Descripción de la imagen...",rows:3})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit-isPrimary",checked:ie,onChange:t=>q(t.target.checked),className:"rounded"}),e.jsx(le,{htmlFor:"edit-isPrimary",children:"Marcar como imagen principal"})]})]}),e.jsxs(be,{children:[e.jsx(h,{variant:"outline",onClick:()=>f(null),children:"Cancelar"}),e.jsx(h,{onClick:xe,disabled:w.isPending,children:w.isPending?"Guardando...":"Guardar"})]})]})]}),e.jsxs(Fe,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(h,{size:"sm",variant:"destructive",className:"h-8 w-8 p-0",title:"Eliminar imagen",children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsxs(ze,{children:[e.jsxs($e,{children:[e.jsx(Re,{children:"¿Eliminar imagen?"}),e.jsx(Be,{children:"Esta acción no se puede deshacer. La imagen se eliminará permanentemente."})]}),e.jsxs(Ke,{children:[e.jsx(Oe,{children:"Cancelar"}),e.jsx(Ue,{onClick:()=>U.mutate(a.id),className:"bg-red-600 hover:bg-red-700",children:"Eliminar"})]})]})]})]})]}),e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[a.caption&&e.jsx("p",{className:"text-sm text-gray-600",children:a.caption}),e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-500",children:[e.jsx("span",{children:Q(a.fileSize)}),e.jsx("span",{children:te(a.createdAt)})]}),e.jsx("p",{className:"text-xs text-gray-400 truncate",children:a.fileName})]})})]},a.id))}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ye,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No hay imágenes para este activo"}),e.jsx("p",{className:"text-sm",children:"Sube la primera imagen usando el formulario de arriba"})]})]})]})]})},xs=["Activo","Mantenimiento","Almacenado","Retirado","Prestado","Reparación"],hs=["Excelente","Bueno","Regular","Malo","Crítico"],us=["Preventivo","Correctivo","Predictivo","Mejora"],S=i=>{if(!i)return"N/A";try{let C;return i.includes("T")||i.includes(" ")?C=new Date(i):C=new Date(i+"T00:00:00"),isNaN(C.getTime())?"Fecha inválida":C.toLocaleDateString("es-MX",{year:"numeric",month:"short",day:"numeric"})}catch{return"Fecha inválida"}},Ae=i=>i===null?"N/A":new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(i),js=i=>({active:"Activo",maintenance:"Mantenimiento",retired:"Retirado",damaged:"Dañado",storage:"Almacenado"})[i]||i,ps=i=>({excellent:"Excelente",good:"Bueno",fair:"Regular",poor:"Malo",critical:"Crítico"})[i]||i,gs=i=>{switch(i.toLowerCase()){case"active":case"activo":return"bg-green-100 text-green-800 hover:bg-green-100";case"maintenance":case"mantenimiento":return"bg-yellow-100 text-yellow-800 hover:bg-yellow-100";case"retired":case"retirado":return"bg-red-100 text-red-800 hover:bg-red-100";case"storage":case"almacenado":return"bg-blue-100 text-blue-800 hover:bg-blue-100";default:return"bg-gray-100 text-gray-800 hover:bg-gray-100"}},vs=i=>{switch(i.toLowerCase()){case"excellent":case"excelente":return"bg-green-100 text-green-800 hover:bg-green-100";case"good":case"bueno":return"bg-blue-100 text-blue-800 hover:bg-blue-100";case"fair":case"regular":return"bg-yellow-100 text-yellow-800 hover:bg-yellow-100";case"poor":case"malo":return"bg-orange-100 text-orange-800 hover:bg-orange-100";case"critical":case"crítico":return"bg-red-100 text-red-800 hover:bg-red-100";default:return"bg-gray-100 text-gray-800 hover:bg-gray-100"}},Ns=He({name:v().min(1,"El nombre es obligatorio"),description:v().nullable().optional(),serialNumber:v().nullable().optional(),acquisitionDate:v().nullable().optional(),acquisitionCost:Qe([me().positive(),Ve()]).transform(i=>isNaN(i)?null:i).nullable().optional(),parkId:me().min(1,"El parque es obligatorio"),categoryId:me().min(1,"La categoría es obligatoria"),status:v().min(1,"El estado es obligatorio"),condition:v().min(1,"La condición es obligatoria"),location:v().nullable().optional(),notes:v().nullable().optional()}),ys=He({date:v().min(1,"La fecha es obligatoria"),maintenanceType:v().min(1,"El tipo de mantenimiento es obligatorio"),description:v().min(1,"La descripción es obligatoria"),cost:Qe([me().nonnegative(),Ve()]).transform(i=>isNaN(i)?null:i).nullable().optional(),performedBy:v().nullable().optional(),nextMaintenanceDate:v().nullable().optional(),notes:v().nullable().optional()}),Ms=()=>{const{id:i}=Ze(),[C,N]=es(),{toast:p}=Pe(),A=qe(),[Z,O]=E.useState(!1),[ee,$]=E.useState(!1),[se,ae]=E.useState("details"),{data:n,isLoading:f,isError:ne}=R({queryKey:[`/api/assets/${i}`],enabled:!!i}),{data:P,isLoading:ie}=R({queryKey:["/api/asset-categories"]}),{data:q,isLoading:F}=R({queryKey:["/api/parks"]}),{data:j}=R({queryKey:[`/api/assets/${i}/maintenances`],enabled:!!i}),{data:k}=R({queryKey:[`/api/assets/${i}/history`],enabled:!!i}),re=ce.useMemo(()=>{if(!j||j.length===0)return null;const s=j.filter(x=>x.status==="completed");if(s.length===0)return null;const r=s.sort((x,ue)=>new Date(ue.date).getTime()-new Date(x.date).getTime())[0];return(r==null?void 0:r.date)||null},[j]),w=ce.useMemo(()=>{if(!j||j.length===0)return null;const s=j.filter(x=>x.nextMaintenanceDate);if(s.length===0)return null;const r=s.sort((x,ue)=>new Date(x.nextMaintenanceDate).getTime()-new Date(ue.nextMaintenanceDate).getTime())[0];return(r==null?void 0:r.nextMaintenanceDate)||null},[j]),U=w?new Date(w)<new Date:!1,u=Ce({resolver:we(Ns),defaultValues:{name:"",description:"",serialNumber:"",acquisitionDate:"",acquisitionCost:null,parkId:0,categoryId:0,status:"",condition:"",location:"",notes:""}}),g=Ce({resolver:we(ys),defaultValues:{date:new Date().toISOString().split("T")[0],maintenanceType:"",description:"",cost:null,performedBy:"",nextMaintenanceDate:"",notes:""}}),H=z({mutationFn:s=>K(`/api/assets/${i}`,"PUT"),onSuccess:()=>{A.invalidateQueries({queryKey:[`/api/assets/${i}`]}),O(!1),p({title:"Activo actualizado",description:"El activo se ha actualizado correctamente."})},onError:s=>{p({title:"Error",description:"Ha ocurrido un error al actualizar el activo.",variant:"destructive"}),console.error("Error al actualizar activo:",s)}}),xe=z({mutationFn:()=>K(`/api/assets/${i}`,{method:"DELETE"}),onSuccess:()=>{A.invalidateQueries({queryKey:["/api/assets"]}),p({title:"Activo eliminado",description:"El activo se ha eliminado correctamente."}),N("/admin/assets")},onError:s=>{p({title:"Error",description:"Ha ocurrido un error al eliminar el activo.",variant:"destructive"}),console.error("Error al eliminar activo:",s)}}),Q=z({mutationFn:s=>(console.log("Enviando mantenimiento:",s),K(`/api/assets/${i}/maintenances`,{method:"POST",data:s})),onSuccess:s=>{console.log("Mantenimiento creado exitosamente:",s),A.invalidateQueries({queryKey:[`/api/assets/${i}/maintenances`]}),A.invalidateQueries({queryKey:[`/api/assets/${i}`]}),$(!1),g.reset({date:new Date().toISOString().split("T")[0],maintenanceType:"",description:"",cost:null,performedBy:"",nextMaintenanceDate:"",notes:""}),p({title:"Mantenimiento registrado",description:"El mantenimiento se ha registrado correctamente."})},onError:s=>{console.error("Error al registrar mantenimiento:",s),p({title:"Error",description:`Ha ocurrido un error al registrar el mantenimiento: ${s.message||s}`,variant:"destructive"})}}),te=()=>{N("/admin/assets/inventory")},a=()=>{g.reset({date:new Date().toISOString().split("T")[0],maintenanceType:"",description:"",cost:null,performedBy:"",nextMaintenanceDate:"",notes:""}),$(!0)},t=s=>{H.mutate(s)},D=s=>{console.log("Datos del formulario de mantenimiento:",s),console.log("Estado del formulario:",g.formState.errors),Q.mutate(s)},y=ce.useMemo(()=>!n||!P?null:P.find(s=>s.id===n.categoryId),[n,P]),he=ce.useMemo(()=>!n||!q?null:q.find(s=>s.id===n.parkId),[n,q]);return e.jsxs(ss,{children:[e.jsxs(cs,{children:[e.jsx("title",{children:"Detalle de Activo | Bosques Urbanos"}),e.jsx("meta",{name:"description",content:"Información detallada y gestión del activo."})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs(h,{variant:"outline",onClick:te,className:"mr-4",children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:f?e.jsx(I,{className:"h-9 w-64"}):(n==null?void 0:n.name)||"Detalle de Activo"}),e.jsx("div",{className:"text-muted-foreground",children:f?e.jsx(I,{className:"h-5 w-96 mt-1"}):e.jsx("span",{children:`ID: ${n==null?void 0:n.id} • ${(y==null?void 0:y.name)||"Categoría sin especificar"}`})})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(h,{onClick:a,variant:"outline",children:[e.jsx(De,{className:"mr-2 h-4 w-4"}),"Registrar Mantenimiento"]}),e.jsxs(h,{onClick:()=>window.location.href=`/admin/assets/${i}/edit-enhanced`,variant:"outline",children:[e.jsx(Ie,{className:"mr-2 h-4 w-4"}),"Editar"]}),e.jsxs(Fe,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(h,{variant:"destructive",children:[e.jsx(Le,{className:"mr-2 h-4 w-4"}),"Eliminar"]})}),e.jsxs(ze,{children:[e.jsxs($e,{children:[e.jsx(Re,{children:"¿Eliminar este activo?"}),e.jsx(Be,{children:"Esta acción no se puede deshacer. El activo se eliminará permanentemente del sistema."})]}),e.jsxs(Ke,{children:[e.jsx(Oe,{children:"Cancelar"}),e.jsx(Ue,{onClick:()=>xe.mutate(),className:"bg-red-500 hover:bg-red-600 text-white",children:"Eliminar"})]})]})]})]})]}),ne?e.jsx(M,{children:e.jsxs(T,{className:"flex flex-col items-center justify-center p-6",children:[e.jsxs("div",{className:"text-center text-red-500 mb-4",children:[e.jsx(je,{className:"h-16 w-16 mx-auto mb-2"}),e.jsx("h3",{className:"text-lg font-medium",children:"Error al cargar los datos del activo"}),e.jsx("p",{children:"No se ha podido encontrar el activo o ha ocurrido un error en la carga."})]}),e.jsx(h,{onClick:te,children:"Volver a la lista de activos"})]})}):e.jsxs(ns,{defaultValue:"details",value:se,onValueChange:ae,children:[e.jsxs(is,{className:"mb-4",children:[e.jsx(oe,{value:"details",children:"Detalles"}),e.jsx(oe,{value:"maintenance",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(rs,{className:"mr-2 h-4 w-4"}),"Mantenimientos",j&&j.length>0&&e.jsx(L,{className:"ml-2",children:j.length})]})}),e.jsx(oe,{value:"history",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Historial",k&&k.length>0&&e.jsx(L,{className:"ml-2",children:k.length})]})}),e.jsx(oe,{value:"images",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"Imágenes"]})})]}),e.jsx(de,{value:"details",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(M,{className:"mb-4",children:[e.jsx(J,{children:e.jsx(Y,{children:"Información General"})}),e.jsx(T,{children:f?e.jsx("div",{className:"space-y-4",children:Array.from({length:8}).map((s,r)=>e.jsx(I,{className:"h-6 w-full"},r))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Estado:"}),e.jsx(L,{className:gs((n==null?void 0:n.status)||""),children:js((n==null?void 0:n.status)||"")})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Condición:"}),e.jsx(L,{className:vs((n==null?void 0:n.condition)||""),children:ps((n==null?void 0:n.condition)||"")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Categoría:"}),e.jsx("span",{children:ie?e.jsx(I,{className:"h-4 w-32 inline-block"}):(y==null?void 0:y.name)||"No especificada"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Parque:"}),e.jsx("span",{children:F?e.jsx(I,{className:"h-4 w-32 inline-block"}):(he==null?void 0:he.name)||"No especificado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Responsable:"}),e.jsx("span",{children:n!=null&&n.responsiblePerson?`${n.responsiblePerson.fullName} (${n.responsiblePerson.role})`:"No asignado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Ubicación:"}),e.jsx("span",{children:(n==null?void 0:n.locationDescription)||"No especificada"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Número de Serie:"}),e.jsx("span",{children:(n==null?void 0:n.serialNumber)||"No especificado"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Fecha de Adquisición:"}),e.jsx("span",{children:S(n==null?void 0:n.acquisitionDate)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Costo de Adquisición:"}),e.jsx("span",{children:Ae(n==null?void 0:n.acquisitionCost)})]}),e.jsx(ds,{}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Descripción:"}),e.jsx("p",{className:"mt-1",children:(n==null?void 0:n.description)||"Sin descripción"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Notas:"}),e.jsx("p",{className:"mt-1",children:(n==null?void 0:n.notes)||"Sin notas adicionales"})]})]})})]}),e.jsxs(M,{className:"mb-4",children:[e.jsx(J,{children:e.jsx(Y,{children:"Estado de Mantenimiento"})}),e.jsx(T,{children:f?e.jsx("div",{className:"space-y-4",children:Array.from({length:4}).map((s,r)=>e.jsx(I,{className:"h-6 w-full"},r))}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Último Mantenimiento:"}),e.jsx("span",{children:S(re)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Próximo Mantenimiento:"}),e.jsxs("div",{className:"flex items-center",children:[U&&e.jsx(je,{className:"h-4 w-4 mr-2 text-yellow-500"}),e.jsx("span",{children:S(w)})]})]}),U&&e.jsx("div",{className:"bg-yellow-50 p-4 rounded-md text-yellow-800 mt-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Mantenimiento pendiente"}),e.jsx("p",{className:"text-sm",children:"Este activo tiene un mantenimiento programado que ya ha pasado la fecha prevista."}),e.jsx(h,{className:"mt-2",size:"sm",onClick:a,children:"Registrar Mantenimiento"})]})]})}),!U&&w&&e.jsx("div",{className:"bg-green-50 p-4 rounded-md text-green-800 mt-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(ts,{className:"h-5 w-5 mr-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Mantenimiento al día"}),e.jsxs("p",{className:"text-sm",children:["El próximo mantenimiento está programado para ",S(w),"."]})]})]})}),!re&&!w&&e.jsx("div",{className:"bg-blue-50 p-4 rounded-md text-blue-800 mt-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(ls,{className:"h-5 w-5 mr-2"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Sin historial de mantenimiento"}),e.jsx("p",{className:"text-sm",children:"Este activo no tiene registros de mantenimiento ni fechas programadas."}),e.jsx(h,{className:"mt-2",size:"sm",onClick:a,children:"Programar Primer Mantenimiento"})]})]})})]})})]})]})}),e.jsx(de,{value:"maintenance",children:e.jsxs(M,{children:[e.jsxs(J,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(Y,{children:"Historial de Mantenimientos"}),e.jsx(Se,{children:"Registro de todas las actividades de mantenimiento realizadas"})]}),e.jsx(h,{onClick:a,children:"Registrar Mantenimiento"})]}),e.jsx(T,{children:f?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((s,r)=>e.jsx(I,{className:"h-24 w-full"},r))}):!j||j.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(De,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{children:"No hay registros de mantenimiento para este activo."}),e.jsx(h,{variant:"outline",className:"mt-4",onClick:a,children:"Registrar Primer Mantenimiento"})]}):e.jsx("div",{className:"space-y-6",children:j.map(s=>e.jsxs(M,{className:"mb-4 overflow-hidden",children:[e.jsx("div",{className:`h-2 w-full ${s.maintenanceType==="Preventivo"?"bg-blue-500":s.maintenanceType==="Correctivo"?"bg-yellow-500":s.maintenanceType==="Predictivo"?"bg-green-500":"bg-purple-500"}`}),e.jsx(T,{className:"pt-4",children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.maintenanceType}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Realizado el ",S(s.date)]}),s.performer?e.jsxs("p",{className:"text-muted-foreground text-sm flex items-center",children:["Por: ",e.jsx("span",{className:"font-medium ml-1",children:s.performer.fullName}),e.jsx(L,{className:"ml-2",variant:"outline",size:"sm",children:s.performer.role})]}):s.performedBy&&e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Por: ",s.performedBy]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("p",{className:"mb-3",children:s.description}),s.findings&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"font-medium text-gray-700 block mb-1",children:"Hallazgos:"}),e.jsx("p",{className:"text-gray-600 text-sm bg-gray-50 p-2 rounded",children:s.findings})]}),s.actions&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"font-medium text-gray-700 block mb-1",children:"Acciones realizadas:"}),e.jsx("p",{className:"text-gray-600 text-sm bg-blue-50 p-2 rounded",children:s.actions})]}),s.notes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"font-medium text-gray-700 block mb-1",children:"Notas adicionales:"}),e.jsx("p",{className:"text-gray-600 text-sm bg-yellow-50 p-2 rounded",children:s.notes})]}),e.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 text-sm",children:[s.cost!==null&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Costo:"}),e.jsx("span",{className:"ml-2 font-semibold text-green-600",children:Ae(s.cost)})]}),s.status&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Estado:"}),e.jsx(L,{className:"ml-2",variant:s.status==="completed"?"default":s.status==="scheduled"?"secondary":"outline",children:s.status==="completed"?"Completado":s.status==="scheduled"?"Programado":s.status==="in_progress"?"En progreso":s.status})]}),s.nextMaintenanceDate&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Próximo mantenimiento:"}),e.jsx("span",{className:"ml-2 font-medium text-blue-600",children:S(s.nextMaintenanceDate)})]})]}),e.jsxs("div",{className:"mt-4 pt-3 border-t text-xs text-gray-400 flex justify-between",children:[e.jsxs("span",{children:["Registrado: ",S(s.createdAt)]}),s.createdAt!==s.updatedAt&&e.jsxs("span",{children:["Actualizado: ",S(s.updatedAt)]})]})]})]})})]},s.id))})})]})}),e.jsx(de,{value:"history",children:e.jsxs(M,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:"Historial de Cambios"}),e.jsx(Se,{children:"Registro de todas las modificaciones y eventos relacionados con este activo"})]}),e.jsx(T,{children:f?e.jsx("div",{className:"space-y-4",children:Array.from({length:3}).map((s,r)=>e.jsx(I,{className:"h-24 w-full"},r))}):!k||k.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("p",{children:"No hay registros en el historial de este activo."})]}):e.jsx("div",{className:"space-y-6",children:k.map(s=>e.jsxs(M,{className:"mb-4 overflow-hidden",children:[e.jsx("div",{className:`h-2 w-full ${s.changeType==="acquisition"?"bg-green-500":s.changeType==="update"?"bg-blue-500":s.changeType==="maintenance"?"bg-yellow-500":s.changeType==="retirement"?"bg-red-500":"bg-gray-500"}`}),e.jsx(T,{className:"pt-4",children:e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:s.changeType==="acquisition"?"Adquisición":s.changeType==="update"?"Actualización":s.changeType==="maintenance"?"Mantenimiento":s.changeType==="retirement"?"Retiro":"Cambio"}),e.jsxs("p",{className:"text-muted-foreground text-sm",children:[S(s.date)," • ",S(s.createdAt)]})]}),e.jsx("p",{children:s.description}),s.notes&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-500",children:"Notas:"}),e.jsx("p",{className:"mt-1 text-sm",children:s.notes})]})]})})]},s.id))})})]})}),e.jsx(de,{value:"images",children:n&&e.jsx(ms,{assetId:n.id,assetName:n.name})})]}),e.jsx(ge,{open:Z,onOpenChange:O,children:e.jsxs(ve,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Editar Activo"}),e.jsx(fe,{children:"Actualice la información del activo. Los campos marcados con * son obligatorios."})]}),e.jsx(Ee,{...u,children:e.jsxs("form",{onSubmit:u.handleSubmit(t),className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(l,{control:u.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Nombre*"}),e.jsx(d,{children:e.jsx(b,{placeholder:"Nombre del activo",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:u.control,name:"serialNumber",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Número de Serie"}),e.jsx(d,{children:e.jsx(b,{placeholder:"Número de serie",...s,value:s.value||""})}),e.jsx(m,{})]})}),e.jsx(l,{control:u.control,name:"parkId",render:({field:s})=>{var r;return e.jsxs(c,{children:[e.jsx(o,{children:"Parque*"}),e.jsx(d,{children:e.jsxs(V,{value:(r=s.value)==null?void 0:r.toString(),onValueChange:x=>s.onChange(parseInt(x)),children:[e.jsx(_,{children:e.jsx(G,{placeholder:"Seleccione un parque"})}),e.jsx(X,{children:q==null?void 0:q.map(x=>e.jsx(W,{value:x.id.toString(),children:x.name},x.id))})]})}),e.jsx(m,{})]})}}),e.jsx(l,{control:u.control,name:"categoryId",render:({field:s})=>{var r;return e.jsxs(c,{children:[e.jsx(o,{children:"Categoría*"}),e.jsx(d,{children:e.jsxs(V,{value:(r=s.value)==null?void 0:r.toString(),onValueChange:x=>s.onChange(parseInt(x)),children:[e.jsx(_,{children:e.jsx(G,{placeholder:"Seleccione una categoría"})}),e.jsx(X,{children:P==null?void 0:P.map(x=>e.jsx(W,{value:x.id.toString(),children:x.name},x.id))})]})}),e.jsx(m,{})]})}}),e.jsx(l,{control:u.control,name:"status",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Estado*"}),e.jsx(d,{children:e.jsxs(V,{value:s.value,onValueChange:s.onChange,children:[e.jsx(_,{children:e.jsx(G,{placeholder:"Seleccione un estado"})}),e.jsx(X,{children:xs.map(r=>e.jsx(W,{value:r,children:r},r))})]})}),e.jsx(m,{})]})}),e.jsx(l,{control:u.control,name:"condition",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Condición*"}),e.jsx(d,{children:e.jsxs(V,{value:s.value,onValueChange:s.onChange,children:[e.jsx(_,{children:e.jsx(G,{placeholder:"Seleccione una condición"})}),e.jsx(X,{children:hs.map(r=>e.jsx(W,{value:r,children:r},r))})]})}),e.jsx(m,{})]})}),e.jsx(l,{control:u.control,name:"acquisitionDate",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Fecha de Adquisición"}),e.jsx(d,{children:e.jsx(b,{type:"date",...s,value:s.value||""})}),e.jsx(m,{})]})}),e.jsx(l,{control:u.control,name:"acquisitionCost",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Costo de Adquisición"}),e.jsx(d,{children:e.jsx(b,{type:"number",placeholder:"Costo en pesos",...s,value:s.value===null?"":s.value,onChange:r=>s.onChange(r.target.value===""?null:parseFloat(r.target.value))})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"space-y-4 border p-4 rounded-md bg-slate-50",children:[e.jsx("h3",{className:"font-medium text-sm",children:"Ubicación y Geolocalización"}),e.jsx(l,{control:u.control,name:"location",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Descripción de Ubicación"}),e.jsx(d,{children:e.jsx(b,{placeholder:"Ej: Cerca de la entrada principal",...s,value:s.value||""})}),e.jsx(pe,{children:"Describe dónde se encuentra este activo dentro del parque"}),e.jsx(m,{})]})}),e.jsx(l,{control:u.control,name:"latitude",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Latitud"}),e.jsx(d,{children:e.jsx(b,{placeholder:"Ej: 19.432608",...s,value:s.value||""})}),e.jsx(pe,{children:"Coordenada numérica (+ norte / - sur)"}),e.jsx(m,{})]})}),e.jsx(l,{control:u.control,name:"longitude",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Longitud"}),e.jsx(d,{children:e.jsx(b,{placeholder:"Ej: -99.133209",...s,value:s.value||""})}),e.jsx(pe,{children:"Coordenada numérica (+ este / - oeste)"}),e.jsx(m,{})]})})]})]}),e.jsx(l,{control:u.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Descripción"}),e.jsx(d,{children:e.jsx(B,{placeholder:"Descripción del activo",...s,value:s.value||""})}),e.jsx(m,{})]})}),e.jsx(l,{control:u.control,name:"notes",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Notas"}),e.jsx(d,{children:e.jsx(B,{placeholder:"Notas adicionales",...s,value:s.value||""})}),e.jsx(m,{})]})}),e.jsxs(be,{children:[e.jsx(Me,{asChild:!0,children:e.jsx(h,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(h,{type:"submit",disabled:H.isPending,children:H.isPending?"Actualizando...":"Actualizar Activo"})]})]})})]})}),e.jsx(ge,{open:ee,onOpenChange:$,children:e.jsxs(ve,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"Registrar Mantenimiento"}),e.jsx(fe,{children:"Complete el formulario para registrar un nuevo mantenimiento para este activo."})]}),e.jsx(Ee,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(D),className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsx(l,{control:g.control,name:"date",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Fecha*"}),e.jsx(d,{children:e.jsx(b,{type:"date",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:g.control,name:"maintenanceType",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Tipo de Mantenimiento*"}),e.jsx(d,{children:e.jsxs(V,{value:s.value,onValueChange:s.onChange,children:[e.jsx(_,{children:e.jsx(G,{placeholder:"Seleccione un tipo"})}),e.jsx(X,{children:us.map(r=>e.jsx(W,{value:r,children:r},r))})]})}),e.jsx(m,{})]})}),e.jsx(l,{control:g.control,name:"cost",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Costo"}),e.jsx(d,{children:e.jsx(b,{type:"number",placeholder:"Costo en pesos",...s,value:s.value===null?"":s.value,onChange:r=>s.onChange(r.target.value===""?null:parseFloat(r.target.value))})}),e.jsx(m,{})]})}),e.jsx(l,{control:g.control,name:"performedBy",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Realizado por"}),e.jsx(d,{children:e.jsx(b,{placeholder:"Persona o empresa",...s,value:s.value||""})}),e.jsx(m,{})]})}),e.jsx(l,{control:g.control,name:"nextMaintenanceDate",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Fecha del Próximo Mantenimiento"}),e.jsx(d,{children:e.jsx(b,{type:"date",...s,value:s.value||""})}),e.jsx(m,{})]})})]}),e.jsx(l,{control:g.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Descripción*"}),e.jsx(d,{children:e.jsx(B,{placeholder:"Descripción del mantenimiento realizado",...s})}),e.jsx(m,{})]})}),e.jsx(l,{control:g.control,name:"notes",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Notas Adicionales"}),e.jsx(d,{children:e.jsx(B,{placeholder:"Notas adicionales sobre el mantenimiento",...s,value:s.value||""})}),e.jsx(m,{})]})}),e.jsxs(be,{children:[e.jsx(Me,{asChild:!0,children:e.jsx(h,{type:"button",variant:"outline",children:"Cancelar"})}),e.jsx(h,{type:"submit",disabled:Q.isPending,children:Q.isPending?"Registrando...":"Registrar Mantenimiento"})]})]})})]})})]})};export{Ms as default};
