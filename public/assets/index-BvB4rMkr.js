import{a2 as E,l as Le,ae as Oe,u as de,af as xe,ap as he,ag as ee,j as e,aX as ke,w as se,x as Pe,B as w,bh as Re,y as ae,z as ne,I as ie,J as me,ai as je,b1 as ue,b2 as pe,b3 as T,b4 as L,aj as i,ak as c,al as r,Q as z,am as t,V,W as M,Y as $,_ as j,an as o,O as f,$ as O,aF as p,ao as B,bC as ge,f as b,g as S,h as C,i as N,a4 as ze,ab as Ve,bH as Me,bI as $e,bJ as H,bK as I,bL as Be,bM as y,o as k,F as fe,bq as He,bn as _e,K as Ue,cj as Ke,D as Xe,b$ as Qe,c1 as Ge,c2 as Je,c3 as Ye,c4 as We,c5 as Ze,c6 as es,c7 as ss,ad as g,r as as,a1 as ns}from"./index-D5qLf1ib.js";import{H as is}from"./Helmet-BNepwt1P.js";const ve=g.object({contractId:g.string().min(1,"Debes seleccionar un contrato"),evaluationDate:g.string().min(1,"La fecha de evaluación es obligatoria"),sanitaryScore:g.string().min(1,"La calificación sanitaria es obligatoria"),operationalScore:g.string().min(1,"La calificación operativa es obligatoria"),technicalScore:g.string().min(1,"La calificación técnica es obligatoria"),customerSatisfactionScore:g.string().min(1,"La calificación de satisfacción es obligatoria"),observations:g.string().optional(),hasIncidents:g.boolean().default(!1),incidentDescription:g.string().optional(),actionRequired:g.boolean().default(!1),actionDescription:g.string().optional(),status:g.enum(["completed","pending","in_progress"]).default("completed"),attachments:g.instanceof(FileList).optional().transform(P=>{if(!(!P||P.length===0))return Array.from(P)})});function ts(){const[P,ce]=E.useState(!1),[be,_]=E.useState(!1),[Ne,re]=E.useState(!1),[ye,U]=E.useState(!1),[n,K]=E.useState(null),[R,Se]=E.useState(""),[X,Ce]=E.useState("all"),{toast:q}=Le(),Q=Oe(),{data:te,isLoading:De}=de({queryKey:["/api/concession-evaluations"]}),{data:F,isLoading:G}=de({queryKey:["/api/concession-contracts"]}),m=xe({resolver:he(ve),defaultValues:{contractId:"",evaluationDate:new Date().toISOString().split("T")[0],sanitaryScore:"",operationalScore:"",technicalScore:"",customerSatisfactionScore:"",observations:"",hasIncidents:!1,incidentDescription:"",actionRequired:!1,actionDescription:"",status:"completed"}}),x=xe({resolver:he(ve),defaultValues:{contractId:"",evaluationDate:"",sanitaryScore:"",operationalScore:"",technicalScore:"",customerSatisfactionScore:"",observations:"",hasIncidents:!1,incidentDescription:"",actionRequired:!1,actionDescription:"",status:"completed"}}),J=ee({mutationFn:async s=>{const a=new FormData;Object.entries(s).forEach(([d,l])=>{d!=="attachments"&&(typeof l=="boolean"?a.append(d,l?"true":"false"):a.append(d,(l==null?void 0:l.toString())||""))}),s.attachments&&s.attachments.length>0&&Array.from(s.attachments).forEach((d,l)=>{a.append(`attachment_${l}`,d)});const h=await fetch("/api/concession-evaluations",{method:"POST",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:a});if(!h.ok){const d=await h.json();throw new Error(d.message||"Error al crear la evaluación")}return await h.json()},onSuccess:()=>{Q.invalidateQueries({queryKey:["/api/concession-evaluations"]}),q({title:"Evaluación creada",description:"La evaluación ha sido creada exitosamente."}),m.reset(),ce(!1)},onError:s=>{q({title:"Error",description:s.message,variant:"destructive"})}}),Y=ee({mutationFn:async s=>{const{id:a,...h}=s,d=new FormData;Object.entries(h).forEach(([u,D])=>{u!=="attachments"&&(typeof D=="boolean"?d.append(u,D?"true":"false"):d.append(u,(D==null?void 0:D.toString())||""))}),s.attachments&&s.attachments.length>0&&Array.from(s.attachments).forEach((u,D)=>{d.append(`attachment_${D}`,u)});const l=await fetch(`/api/concession-evaluations/${a}`,{method:"PUT",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:d});if(!l.ok){const u=await l.json();throw new Error(u.message||"Error al actualizar la evaluación")}return await l.json()},onSuccess:()=>{Q.invalidateQueries({queryKey:["/api/concession-evaluations"]}),q({title:"Evaluación actualizada",description:"La evaluación ha sido actualizada exitosamente."}),x.reset(),_(!1)},onError:s=>{q({title:"Error",description:s.message,variant:"destructive"})}}),W=ee({mutationFn:async s=>{const a=await fetch(`/api/concession-evaluations/${s}`,{method:"DELETE",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""}});if(!a.ok){const h=await a.json();throw new Error(h.message||"Error al eliminar la evaluación")}return await a.json()},onSuccess:()=>{Q.invalidateQueries({queryKey:["/api/concession-evaluations"]}),q({title:"Evaluación eliminada",description:"La evaluación ha sido eliminada exitosamente."}),U(!1)},onError:s=>{q({title:"Error",description:s.message,variant:"destructive"})}}),Ee=s=>{J.mutate(s)},we=s=>{n&&Y.mutate({...s,id:n.id})},Ie=s=>{K(s),x.reset({contractId:s.contractId.toString(),evaluationDate:s.evaluationDate,sanitaryScore:s.sanitaryScore.toString(),operationalScore:s.operationalScore.toString(),technicalScore:s.technicalScore.toString(),customerSatisfactionScore:s.customerSatisfactionScore.toString(),observations:s.observations||"",hasIncidents:s.hasIncidents,incidentDescription:s.incidentDescription||"",actionRequired:s.actionRequired,actionDescription:s.actionDescription||"",status:s.status}),_(!0)},qe=s=>{K(s),re(!0)},Fe=s=>{K(s),U(!0)},Ae=()=>{n&&W.mutate(n.id)},v=te?te.filter(s=>{var d,l,u;const a=R===""||((d=s.parkName)==null?void 0:d.toLowerCase().includes(R.toLowerCase()))||((l=s.concessionaireName)==null?void 0:l.toLowerCase().includes(R.toLowerCase()))||((u=s.evaluatorName)==null?void 0:u.toLowerCase().includes(R.toLowerCase())),h=X==="all"||s.status===X;return a&&h}):[],le=s=>{if(!s)return"N/A";try{return as(new Date(s),"dd 'de' MMMM 'de' yyyy",{locale:ns})}catch{return"Fecha inválida"}},oe=s=>{switch(s){case"completed":return e.jsx(k,{className:"bg-green-100 text-green-800",children:"Completada"});case"pending":return e.jsx(k,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"});case"in_progress":return e.jsx(k,{className:"bg-blue-100 text-blue-800",children:"En progreso"});default:return e.jsx(k,{children:s})}},A=s=>s>=8?"text-green-600":s>=6?"text-yellow-600":"text-red-600",Z=s=>{const h=[s.sanitaryScore,s.operationalScore,s.technicalScore,s.customerSatisfactionScore].filter(l=>!isNaN(Number(l)));return h.length===0?0:(h.reduce((l,u)=>l+Number(u),0)/h.length).toFixed(1)},Te=G;return e.jsxs(ke,{children:[e.jsxs(is,{children:[e.jsx("title",{children:"Evaluación y Cumplimiento | Bosques Urbanos"}),e.jsx("meta",{name:"description",content:"Gestiona la evaluación y cumplimiento de las concesiones en los parques"})]}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Evaluación y Cumplimiento"}),e.jsx("p",{className:"text-muted-foreground",children:"Administra las evaluaciones y el cumplimiento de las concesiones en los parques"})]}),e.jsxs(se,{open:P,onOpenChange:ce,children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(w,{className:"gap-2",children:[e.jsx(Re,{size:16}),"Nueva evaluación"]})}),e.jsxs(ae,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Crear nueva evaluación"}),e.jsx(me,{children:"Introduce la información de la evaluación de concesión"})]}),e.jsx(je,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(Ee),className:"space-y-4",children:[e.jsxs(ue,{defaultValue:"basic",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-3",children:[e.jsx(T,{value:"basic",children:"Información Básica"}),e.jsx(T,{value:"scores",children:"Calificaciones"}),e.jsx(T,{value:"incidents",children:"Incidencias"})]}),e.jsxs(L,{value:"basic",className:"space-y-4 py-4",children:[e.jsx(i,{control:m.control,name:"contractId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Contrato de Concesión"}),e.jsxs(z,{onValueChange:s.onChange,defaultValue:s.value,disabled:Te,children:[e.jsx(t,{children:e.jsx(V,{children:e.jsx(M,{placeholder:"Selecciona un contrato"})})}),e.jsx($,{children:G?e.jsx(j,{value:"loading",children:"Cargando contratos..."}):F&&F.length>0?F.map(a=>e.jsxs(j,{value:a.id.toString(),children:[a.parkName," - ",a.concessionaireName]},a.id)):e.jsx(j,{value:"empty",children:"No hay contratos disponibles"})})]}),e.jsx(o,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:m.control,name:"evaluationDate",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Fecha de Evaluación"}),e.jsx(t,{children:e.jsx(f,{type:"date",...s})}),e.jsx(o,{})]})}),e.jsx(i,{control:m.control,name:"status",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Estado"}),e.jsxs(z,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(t,{children:e.jsx(V,{children:e.jsx(M,{placeholder:"Selecciona un estado"})})}),e.jsxs($,{children:[e.jsx(j,{value:"completed",children:"Completada"}),e.jsx(j,{value:"pending",children:"Pendiente"}),e.jsx(j,{value:"in_progress",children:"En progreso"})]})]}),e.jsx(o,{})]})})]}),e.jsx(i,{control:m.control,name:"observations",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Observaciones"}),e.jsx(t,{children:e.jsx(O,{placeholder:"Observaciones generales sobre la evaluación",...s})}),e.jsx(o,{})]})}),e.jsx(i,{control:m.control,name:"attachments",render:({field:{value:s,onChange:a,...h}})=>e.jsxs(c,{children:[e.jsx(r,{children:"Archivos Adjuntos"}),e.jsx(t,{children:e.jsx(f,{...h,type:"file",multiple:!0,onChange:d=>{const l=d.target.files;l&&a(l)}})}),e.jsx(p,{children:"Puedes adjuntar imágenes, PDFs u otros documentos relevantes"}),e.jsx(o,{})]})})]}),e.jsxs(L,{value:"scores",className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:m.control,name:"sanitaryScore",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Calificación Sanitaria (1-10)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:"1",max:"10",step:"1",placeholder:"Ej. 8",...s})}),e.jsx(p,{children:"Evalúa la limpieza, higiene y condiciones sanitarias"}),e.jsx(o,{})]})}),e.jsx(i,{control:m.control,name:"operationalScore",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Calificación Operativa (1-10)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:"1",max:"10",step:"1",placeholder:"Ej. 8",...s})}),e.jsx(p,{children:"Evalúa la eficiencia, orden y gestión operativa"}),e.jsx(o,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:m.control,name:"technicalScore",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Calificación Técnica (1-10)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:"1",max:"10",step:"1",placeholder:"Ej. 8",...s})}),e.jsx(p,{children:"Evalúa el mantenimiento, equipos y aspectos técnicos"}),e.jsx(o,{})]})}),e.jsx(i,{control:m.control,name:"customerSatisfactionScore",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Satisfacción del Cliente (1-10)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:"1",max:"10",step:"1",placeholder:"Ej. 8",...s})}),e.jsx(p,{children:"Evalúa la calidad del servicio y satisfacción de usuarios"}),e.jsx(o,{})]})})]})]}),e.jsxs(L,{value:"incidents",className:"space-y-4 py-4",children:[e.jsx(i,{control:m.control,name:"hasIncidents",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(t,{children:e.jsx(B,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(r,{children:"¿Se detectaron incidencias?"}),e.jsx(p,{children:"Marca esta opción si se detectaron problemas o incumplimientos"})]})]})}),m.watch("hasIncidents")&&e.jsx(i,{control:m.control,name:"incidentDescription",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Descripción de Incidencias"}),e.jsx(t,{children:e.jsx(O,{placeholder:"Describe las incidencias detectadas",...s})}),e.jsx(o,{})]})}),e.jsx(i,{control:m.control,name:"actionRequired",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(t,{children:e.jsx(B,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(r,{children:"¿Se requiere acción?"}),e.jsx(p,{children:"Marca esta opción si se requieren acciones correctivas"})]})]})}),m.watch("actionRequired")&&e.jsx(i,{control:m.control,name:"actionDescription",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Descripción de Acciones Requeridas"}),e.jsx(t,{children:e.jsx(O,{placeholder:"Describe las acciones correctivas requeridas",...s})}),e.jsx(o,{})]})})]})]}),e.jsx(ge,{children:e.jsx(w,{type:"submit",disabled:J.isPending,children:J.isPending?"Guardando...":"Crear evaluación"})})]})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(b,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium",children:"Evaluaciones Totales"})}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(v==null?void 0:v.length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Evaluaciones registradas"})]})]}),e.jsxs(b,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium",children:"Incidencias Detectadas"})}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(v==null?void 0:v.filter(s=>s.hasIncidents).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Evaluaciones con incidencias"})]})]}),e.jsxs(b,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium",children:"Acciones Requeridas"})}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(v==null?void 0:v.filter(s=>s.actionRequired).length)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Evaluaciones que requieren acción"})]})]})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsxs("div",{className:"relative w-full max-w-sm",children:[e.jsx(ze,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(f,{placeholder:"Buscar evaluaciones...",className:"pl-8",value:R,onChange:s=>Se(s.target.value)})]}),e.jsxs(z,{value:X,onValueChange:Ce,children:[e.jsx(V,{className:"w-[180px]",children:e.jsx(M,{placeholder:"Filtrar por estado"})}),e.jsxs($,{children:[e.jsx(j,{value:"all",children:"Todos los estados"}),e.jsx(j,{value:"completed",children:"Completadas"}),e.jsx(j,{value:"pending",children:"Pendientes"}),e.jsx(j,{value:"in_progress",children:"En progreso"})]})]})]}),e.jsxs(b,{children:[e.jsxs(S,{className:"pb-3",children:[e.jsx(C,{children:"Evaluaciones de Concesiones"}),e.jsx(Ve,{children:"Historial de evaluaciones y cumplimiento de las concesiones"})]}),e.jsx(N,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(Me,{children:[e.jsx($e,{children:e.jsxs(H,{children:[e.jsx(I,{children:"Concesionario"}),e.jsx(I,{children:"Parque"}),e.jsx(I,{children:"Fecha"}),e.jsx(I,{children:"Promedio"}),e.jsx(I,{children:"Incidencias"}),e.jsx(I,{children:"Estado"}),e.jsx(I,{children:"Acciones"})]})}),e.jsx(Be,{children:De?e.jsx(H,{children:e.jsx(y,{colSpan:7,className:"text-center py-4",children:"Cargando evaluaciones..."})}):v&&v.length>0?v.map(s=>{const a=Z(s),h=A(Number(a));return e.jsxs(H,{children:[e.jsx(y,{children:s.concessionaireName}),e.jsx(y,{children:s.parkName}),e.jsx(y,{children:le(s.evaluationDate)}),e.jsx(y,{children:e.jsxs("span",{className:`font-bold ${h}`,children:[a,"/10"]})}),e.jsx(y,{children:s.hasIncidents?e.jsx(k,{className:"bg-red-100 text-red-800",children:"Sí"}):e.jsx(k,{className:"bg-green-100 text-green-800",children:"No"})}),e.jsx(y,{children:oe(s.status)}),e.jsx(y,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>qe(s),title:"Ver detalles",children:e.jsx(fe,{size:16})}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>Ie(s),title:"Editar",children:e.jsx(He,{size:16})}),e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>Fe(s),title:"Eliminar",className:"text-destructive",children:e.jsx(_e,{size:16})})]})})]},s.id)}):e.jsx(H,{children:e.jsx(y,{colSpan:7,className:"text-center py-4",children:'No hay evaluaciones registradas. Crea una evaluación usando el botón "Nueva evaluación".'})})})]})})})]})]}),e.jsx(se,{open:Ne,onOpenChange:re,children:e.jsxs(ae,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsx(ne,{children:e.jsx(ie,{children:"Detalles de la Evaluación"})}),n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Contrato"}),e.jsx("p",{className:"text-sm text-gray-500",children:n.contractName||"No disponible"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Parque"}),e.jsx("p",{className:"text-sm text-gray-500",children:n.parkName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Concesionario"}),e.jsx("p",{className:"text-sm text-gray-500",children:n.concessionaireName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Fecha de Evaluación"}),e.jsx("p",{className:"text-sm text-gray-500",children:le(n.evaluationDate)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Evaluador"}),e.jsx("p",{className:"text-sm text-gray-500",children:n.evaluatorName||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Estado"}),e.jsx("div",{className:"mt-1",children:oe(n.status)})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Calificaciones"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(b,{className:"bg-gray-50",children:[e.jsx(S,{className:"p-3 pb-0",children:e.jsx(C,{className:"text-sm font-medium",children:"Sanitaria"})}),e.jsx(N,{className:"p-3 pt-1",children:e.jsxs("p",{className:`text-xl font-bold ${A(n.sanitaryScore)}`,children:[n.sanitaryScore,"/10"]})})]}),e.jsxs(b,{className:"bg-gray-50",children:[e.jsx(S,{className:"p-3 pb-0",children:e.jsx(C,{className:"text-sm font-medium",children:"Operativa"})}),e.jsx(N,{className:"p-3 pt-1",children:e.jsxs("p",{className:`text-xl font-bold ${A(n.operationalScore)}`,children:[n.operationalScore,"/10"]})})]}),e.jsxs(b,{className:"bg-gray-50",children:[e.jsx(S,{className:"p-3 pb-0",children:e.jsx(C,{className:"text-sm font-medium",children:"Técnica"})}),e.jsx(N,{className:"p-3 pt-1",children:e.jsxs("p",{className:`text-xl font-bold ${A(n.technicalScore)}`,children:[n.technicalScore,"/10"]})})]}),e.jsxs(b,{className:"bg-gray-50",children:[e.jsx(S,{className:"p-3 pb-0",children:e.jsx(C,{className:"text-sm font-medium",children:"Satisfacción"})}),e.jsx(N,{className:"p-3 pt-1",children:e.jsxs("p",{className:`text-xl font-bold ${A(n.customerSatisfactionScore)}`,children:[n.customerSatisfactionScore,"/10"]})})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Promedio General"}),e.jsx(b,{className:"bg-gray-50",children:e.jsxs(N,{className:"p-4 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Calificación Promedio"}),e.jsxs("span",{className:`text-2xl font-bold ${A(Number(Z(n)))}`,children:[Z(n),"/10"]})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Observaciones"}),e.jsx("p",{className:"text-sm text-gray-700 p-3 bg-gray-50 rounded-md",children:n.observations||"Sin observaciones registradas"})]}),n.hasIncidents&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-2 text-red-600 flex items-center gap-2",children:[e.jsx(Ue,{size:16}),"Incidencias Detectadas"]}),e.jsx("p",{className:"text-sm text-gray-700 p-3 bg-red-50 rounded-md border border-red-100",children:n.incidentDescription||"No se especificaron detalles"})]}),n.actionRequired&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-medium mb-2 text-amber-600 flex items-center gap-2",children:[e.jsx(Ke,{size:16}),"Acciones Requeridas"]}),e.jsx("p",{className:"text-sm text-gray-700 p-3 bg-amber-50 rounded-md border border-amber-100",children:n.actionDescription||"No se especificaron detalles"})]}),n.attachments&&n.attachments.length>0&&e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium mb-2",children:"Archivos Adjuntos"}),e.jsx("div",{className:"space-y-2",children:n.attachments.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-md",children:[e.jsx(fe,{size:16,className:"text-gray-500"}),e.jsx("span",{className:"text-sm truncate",children:s.filename}),e.jsx(w,{variant:"outline",size:"sm",className:"ml-auto",asChild:!0,children:e.jsxs("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Xe,{size:14,className:"mr-1"}),"Descargar"]})})]},a))})]})]})]})}),e.jsx(se,{open:be,onOpenChange:_,children:e.jsxs(ae,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(ie,{children:"Editar Evaluación"}),e.jsx(me,{children:"Modifica la información de la evaluación"})]}),e.jsx(je,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(we),className:"space-y-4",children:[e.jsxs(ue,{defaultValue:"basic",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-3",children:[e.jsx(T,{value:"basic",children:"Información Básica"}),e.jsx(T,{value:"scores",children:"Calificaciones"}),e.jsx(T,{value:"incidents",children:"Incidencias"})]}),e.jsxs(L,{value:"basic",className:"space-y-4 py-4",children:[e.jsx(i,{control:x.control,name:"contractId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Contrato de Concesión"}),e.jsxs(z,{onValueChange:s.onChange,defaultValue:s.value,disabled:!0,children:[e.jsx(t,{children:e.jsx(V,{children:e.jsx(M,{placeholder:"Selecciona un contrato"})})}),e.jsx($,{children:G?e.jsx(j,{value:"loading",children:"Cargando contratos..."}):F&&F.length>0?F.map(a=>e.jsxs(j,{value:a.id.toString(),children:[a.parkName," - ",a.concessionaireName]},a.id)):e.jsx(j,{value:"empty",children:"No hay contratos disponibles"})})]}),e.jsx(o,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:x.control,name:"evaluationDate",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Fecha de Evaluación"}),e.jsx(t,{children:e.jsx(f,{type:"date",...s})}),e.jsx(o,{})]})}),e.jsx(i,{control:x.control,name:"status",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Estado"}),e.jsxs(z,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(t,{children:e.jsx(V,{children:e.jsx(M,{placeholder:"Selecciona un estado"})})}),e.jsxs($,{children:[e.jsx(j,{value:"completed",children:"Completada"}),e.jsx(j,{value:"pending",children:"Pendiente"}),e.jsx(j,{value:"in_progress",children:"En progreso"})]})]}),e.jsx(o,{})]})})]}),e.jsx(i,{control:x.control,name:"observations",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Observaciones"}),e.jsx(t,{children:e.jsx(O,{placeholder:"Observaciones generales sobre la evaluación",...s})}),e.jsx(o,{})]})}),e.jsx(i,{control:x.control,name:"attachments",render:({field:{value:s,onChange:a,...h}})=>{var d;return e.jsxs(c,{children:[e.jsx(r,{children:"Archivos Adjuntos Adicionales"}),e.jsx(t,{children:e.jsx(f,{...h,type:"file",multiple:!0,onChange:l=>{const u=l.target.files;u&&a(u)}})}),e.jsx(p,{children:((d=n==null?void 0:n.attachments)==null?void 0:d.length)>0?"Ya hay archivos adjuntos. Sube nuevos para añadirlos a los existentes.":"Puedes adjuntar imágenes, PDFs u otros documentos relevantes"}),e.jsx(o,{})]})}})]}),e.jsxs(L,{value:"scores",className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:x.control,name:"sanitaryScore",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Calificación Sanitaria (1-10)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:"1",max:"10",step:"1",placeholder:"Ej. 8",...s})}),e.jsx(p,{children:"Evalúa la limpieza, higiene y condiciones sanitarias"}),e.jsx(o,{})]})}),e.jsx(i,{control:x.control,name:"operationalScore",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Calificación Operativa (1-10)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:"1",max:"10",step:"1",placeholder:"Ej. 8",...s})}),e.jsx(p,{children:"Evalúa la eficiencia, orden y gestión operativa"}),e.jsx(o,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:x.control,name:"technicalScore",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Calificación Técnica (1-10)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:"1",max:"10",step:"1",placeholder:"Ej. 8",...s})}),e.jsx(p,{children:"Evalúa el mantenimiento, equipos y aspectos técnicos"}),e.jsx(o,{})]})}),e.jsx(i,{control:x.control,name:"customerSatisfactionScore",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Satisfacción del Cliente (1-10)"}),e.jsx(t,{children:e.jsx(f,{type:"number",min:"1",max:"10",step:"1",placeholder:"Ej. 8",...s})}),e.jsx(p,{children:"Evalúa la calidad del servicio y satisfacción de usuarios"}),e.jsx(o,{})]})})]})]}),e.jsxs(L,{value:"incidents",className:"space-y-4 py-4",children:[e.jsx(i,{control:x.control,name:"hasIncidents",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(t,{children:e.jsx(B,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(r,{children:"¿Se detectaron incidencias?"}),e.jsx(p,{children:"Marca esta opción si se detectaron problemas o incumplimientos"})]})]})}),x.watch("hasIncidents")&&e.jsx(i,{control:x.control,name:"incidentDescription",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Descripción de Incidencias"}),e.jsx(t,{children:e.jsx(O,{placeholder:"Describe las incidencias detectadas",...s})}),e.jsx(o,{})]})}),e.jsx(i,{control:x.control,name:"actionRequired",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(t,{children:e.jsx(B,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(r,{children:"¿Se requiere acción?"}),e.jsx(p,{children:"Marca esta opción si se requieren acciones correctivas"})]})]})}),x.watch("actionRequired")&&e.jsx(i,{control:x.control,name:"actionDescription",render:({field:s})=>e.jsxs(c,{children:[e.jsx(r,{children:"Descripción de Acciones Requeridas"}),e.jsx(t,{children:e.jsx(O,{placeholder:"Describe las acciones correctivas requeridas",...s})}),e.jsx(o,{})]})})]})]}),e.jsx(ge,{children:e.jsx(w,{type:"submit",disabled:Y.isPending,children:Y.isPending?"Guardando...":"Guardar cambios"})})]})})]})}),e.jsx(Qe,{open:ye,onOpenChange:U,children:e.jsxs(Ge,{children:[e.jsxs(Je,{children:[e.jsx(Ye,{children:"¿Estás seguro?"}),e.jsx(We,{children:"Esta acción eliminará permanentemente la evaluación y todos sus datos asociados."})]}),e.jsxs(Ze,{children:[e.jsx(es,{children:"Cancelar"}),e.jsx(ss,{onClick:Ae,disabled:W.isPending,children:W.isPending?"Eliminando...":"Eliminar"})]})]})})]})}export{ts as default};
