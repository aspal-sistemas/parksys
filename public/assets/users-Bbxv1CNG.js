import{aD as Ne,c1 as Ge,j as e,f as b,c2 as U,c3 as He,c4 as Je,c5 as Ke,x as te,c6 as Qe,c7 as Xe,c8 as We,c9 as Ye,ca as Ze,ao as ae,a9 as ea,a6 as aa,e as sa,Y as j,u as be,a8 as pe,cb as ge,aI as la,Z as ra,I as C,B as o,ak as ta,cc as ia,z as V,H as B,J as G,K as H,N as i,bn as ie,as as Z,bh as na,bi as ca,bj as je,bk as O,bl as oa,bm as R,cd as ye,ba as da,bb as ma,at as ha,au as xa,D as Ce,r as we,t as Ie,v as Fe,h as ua,O as _,aO as fe,aP as ve,aQ as Q,aR as X,a4 as pa,ag as T,be as ke,ce as ga,cf as ja,l as fa,X as va}from"./index-Dzu3mJf5.js";import{R as Na}from"./rotate-ccw-BcSbzPyE.js";import{U as Se}from"./user-round-CrP7QTjr.js";import{F as A}from"./file-symlink-DROl84aY.js";import{A as ba}from"./arrow-up-Dp9rquvy.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ya=Ne("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ca=Ne("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]),wa=({userData:s,role:d,additionalData:y,showDetails:L=!1})=>{const{getProfileCompletionState:g,getLevelColor:f,getLevelDescription:r}=Ge();if(!s||!d)return null;const z=g(s,d,y),{level:x,percentage:t,missingFields:w}=z,$=()=>{switch(x){case U.COMPLETE:return e.jsx(ea,{className:"h-5 w-5 text-green-500"});case U.INTERMEDIATE:return e.jsx(ae,{className:"h-5 w-5 text-blue-500"});case U.BASIC:return e.jsx(ae,{className:"h-5 w-5 text-yellow-500"});case U.INCOMPLETE:return e.jsx(te,{className:"h-5 w-5 text-red-500"});default:return e.jsx(ae,{className:"h-5 w-5 text-gray-500"})}},P=()=>{switch(x){case U.COMPLETE:return"Completo";case U.INTERMEDIATE:return"Intermedio";case U.BASIC:return"Básico";case U.INCOMPLETE:return"Incompleto";default:return"Desconocido"}};return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[$(),e.jsxs("span",{className:"font-medium",children:["Perfil ",P()]}),e.jsxs(b,{variant:x===U.COMPLETE?"default":"outline",className:`ml-2 ${f(x)}`,children:[t,"%"]})]}),w.length>0&&e.jsx(He,{children:e.jsxs(Je,{children:[e.jsx(Ke,{asChild:!0,children:e.jsxs("div",{className:"flex items-center text-sm text-muted-foreground cursor-pointer",children:[e.jsx(te,{className:"h-4 w-4 mr-1"}),e.jsxs("span",{children:[w.length," ",w.length===1?"campo":"campos"," faltante",w.length!==1?"s":""]})]})}),e.jsx(Qe,{className:"max-w-sm",children:e.jsxs("div",{className:"p-1",children:[e.jsx("p",{className:"font-medium mb-1",children:"Campos requeridos faltantes:"}),e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:w.map((F,I)=>e.jsx("li",{className:"text-sm",children:F.label},I))})]})})]})})]}),e.jsx(Xe,{value:t,className:"h-2"}),L&&w.length>0&&e.jsxs(We,{variant:"destructive",className:"mt-4",children:[e.jsx(te,{className:"h-4 w-4"}),e.jsx(Ye,{children:"Información requerida faltante"}),e.jsxs(Ze,{children:[e.jsx("p",{className:"mb-2",children:r(x)}),e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:w.map((F,I)=>e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:F.label}),": ",F.description]},I))})]})]})]})},Ia=({user:s,isNew:d,onClose:y,onSave:L,isSaving:g,editingUserId:f})=>{var F,I,W;const[r,z]=j.useState({role:(s==null?void 0:s.role)||"user",username:(s==null?void 0:s.username)||"",email:(s==null?void 0:s.email)||"",firstName:(s==null?void 0:s.firstName)||((F=s==null?void 0:s.fullName)==null?void 0:F.split(" ")[0])||"",lastName:(s==null?void 0:s.lastName)||((I=s==null?void 0:s.fullName)==null?void 0:I.split(" ").slice(1).join(" "))||"",password:"",municipalityId:(s==null?void 0:s.municipalityId)||null,phone:(s==null?void 0:s.phone)||"",gender:(s==null?void 0:s.gender)||"no_especificar",birthDate:(s==null?void 0:s.birthDate)||"",profileImageUrl:(s==null?void 0:s.profileImageUrl)||"",profileImageFile:null,bio:(s==null?void 0:s.bio)||"",experience:(s==null?void 0:s.experience)||"",specialties:(s==null?void 0:s.specialties)||[],curriculumFile:null,address:(s==null?void 0:s.address)||"",emergencyContactName:(s==null?void 0:s.emergencyContactName)||"",emergencyContactPhone:(s==null?void 0:s.emergencyContactPhone)||"",preferredParkId:(s==null?void 0:s.preferredParkId)!==void 0?s==null?void 0:s.preferredParkId:3,legalConsent:(s==null?void 0:s.legalConsent)!==void 0?s==null?void 0:s.legalConsent:!1});j.useEffect(()=>{s&&s.role==="voluntario"&&f&&(console.log("🔥 DATOS RECIBIDOS DEL USUARIO:",s),(async()=>{try{const u=await fetch(`/api/volunteers/by-user/${f}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(u.ok){const c=await u.json();console.log("✅ DATOS DE VOLUNTARIO CARGADOS:",c),z(k=>{var p,M,S,q,h,E;return{...k,address:c.address||"",emergencyContactName:c.emergency_contact||"",emergencyContactPhone:c.emergency_phone||"",preferredParkId:c.preferred_park_id||3,volunteerExperience:c.previous_experience||"",skills:c.skills||"",availability:c.available_hours||"flexible",interestNature:((p=c.interest_areas)==null?void 0:p.includes("nature"))||!1,interestEvents:((M=c.interest_areas)==null?void 0:M.includes("events"))||!1,interestEducation:((S=c.interest_areas)==null?void 0:S.includes("education"))||!1,interestMaintenance:((q=c.interest_areas)==null?void 0:q.includes("maintenance"))||!1,interestSports:((h=c.interest_areas)==null?void 0:h.includes("sports"))||!1,interestCultural:((E=c.interest_areas)==null?void 0:E.includes("cultural"))||!1,legalConsent:c.legal_consent===!0,ageConsent:c.age_consent===!0||!1,conductConsent:c.conduct_consent===!0||!1}})}else console.error("Error al cargar datos de voluntario:",await u.text())}catch(u){console.error("Error al obtener datos de voluntario:",u)}})())},[s,f]);const{data:x=[]}=be({queryKey:["/api/public/parks/list"],enabled:!0,refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:3});j.useEffect(()=>{s&&r.role==="voluntario"&&console.log("Datos del usuario cargados:",{userId:s.id,userPreferredParkId:s==null?void 0:s.preferredParkId,formPreferredParkId:r.preferredParkId,availableParks:(x==null?void 0:x.length)||0})},[s,r.role,r.preferredParkId,x]);const t=(a,u)=>{z(c=>({...c,[a]:u}))},w=async a=>{var c;const u=(c=a.target.files)==null?void 0:c[0];if(u)try{const k=new FormData;k.append("profileImage",u);const p=f||s&&s.id;p&&(k.append("userId",p.toString()),console.log(`Subiendo imagen para usuario ID: ${p}`));const M=await fetch("/api/upload/profile-image",{method:"POST",body:k,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!M.ok)throw new Error("Error al cargar la imagen");const S=await M.json();if(t("profileImageUrl",S.url),t("profileImageFile",null),p)try{await fetch(`/api/users/${p}/profile-image`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({imageUrl:S.url})}),console.log(`Imagen de perfil guardada en caché para el usuario ${p}`);const q=`profile_image_${p}`,h=`profile_image_cache_${p}`;localStorage.setItem(q,S.url),localStorage.setItem(h,Date.now().toString()),window.dispatchEvent(new CustomEvent("profileImageUpdated",{detail:{userId:p,imageUrl:S.url}})),toast({title:"Imagen actualizada",description:"La foto de perfil se ha actualizado correctamente.",variant:"default"})}catch(q){console.error("Error al guardar la URL en la caché:",q)}}catch(k){console.error("Error al cargar la imagen:",k);const p=URL.createObjectURL(u);t("profileImageUrl",p),t("profileImageFile",u)}},$=a=>{var c;const u=(c=a.target.files)==null?void 0:c[0];u&&t("curriculumFile",u)},P=a=>{a.preventDefault(),L(r)};return e.jsx(Ce,{open:!0,onOpenChange:y,children:e.jsxs(we,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ie,{children:e.jsx(Fe,{children:d?"Crear nuevo usuario":"Editar usuario"})}),e.jsxs("form",{onSubmit:P,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h3",{className:"font-medium text-lg text-primary-600",children:"Rol del Usuario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(V,{value:r.role,onValueChange:a=>t("role",a),children:[e.jsx(B,{className:"w-full",children:e.jsx(G,{placeholder:"Seleccionar rol"})}),e.jsxs(H,{children:[e.jsx(i,{value:"admin",children:"Administrador"}),e.jsx(i,{value:"director",children:"Director"}),e.jsx(i,{value:"manager",children:"Gestor"}),e.jsx(i,{value:"supervisor",children:"Supervisor"}),e.jsx(i,{value:"ciudadano",children:"Ciudadano"}),e.jsx(i,{value:"voluntario",children:"Voluntario"}),e.jsx(i,{value:"instructor",children:"Instructor"}),e.jsx(i,{value:"guardaparques",children:"Guardaparques"}),e.jsx(i,{value:"guardia",children:"Guardia"}),e.jsx(i,{value:"concesionario",children:"Concesionario"}),e.jsx(i,{value:"user",children:"Usuario"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"El rol determina los permisos y funciones disponibles para el usuario."})]})]}),e.jsxs("div",{className:"space-y-4 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Información de Cuenta"}),r.role&&e.jsx("div",{className:"max-w-md",children:e.jsx(wa,{userData:r,role:r.role,showDetails:!0})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"firstName",className:"text-sm font-medium",children:"Nombre"}),e.jsx(C,{id:"firstName",value:r.firstName,onChange:a=>t("firstName",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"lastName",className:"text-sm font-medium",children:"Apellido"}),e.jsx(C,{id:"lastName",value:r.lastName,onChange:a=>t("lastName",a.target.value),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"username",className:"text-sm font-medium",children:"Nombre de usuario"}),e.jsx(C,{id:"username",value:r.username,onChange:a=>t("username",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email"}),e.jsx(C,{id:"email",type:"email",value:r.email,onChange:a=>t("email",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"password",className:"text-sm font-medium",children:d?"Contraseña":"Contraseña (dejar en blanco para no cambiar)"}),e.jsx(C,{id:"password",type:"password",value:r.password,onChange:a=>t("password",a.target.value),required:d})]})]}),e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Información de Contacto y Perfil"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"profileImage",className:"text-sm font-medium",children:"Foto de perfil"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"relative mb-3",children:!d&&f?e.jsx(ye,{userId:f,role:r.role,name:`${r.firstName} ${r.lastName}`,size:"xl",className:"w-32 h-32 border border-gray-300"}):r.profileImageUrl?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r.profileImageUrl,alt:"Vista previa",className:"w-32 h-32 rounded-full object-cover border border-gray-300"}),e.jsx("button",{type:"button",className:"absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full",onClick:()=>{t("profileImageUrl",""),t("profileImageFile",null)},children:e.jsx(Z,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(Se,{className:"h-16 w-16 text-gray-400"})})}),e.jsxs("label",{htmlFor:"imageUpload",className:"cursor-pointer py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm text-center",children:["Subir imagen",e.jsx("input",{id:"imageUpload",type:"file",accept:"image/*",className:"hidden",onChange:w})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center",children:"Formatos: JPG, PNG. Máx: 5MB"})]})]})}),e.jsxs("div",{className:"space-y-4 col-span-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium",children:"Teléfono"}),e.jsx(C,{id:"phone",value:r.phone,onChange:a=>t("phone",a.target.value),placeholder:"Ej: 555-123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"gender",className:"text-sm font-medium",children:"Género"}),e.jsxs(V,{value:r.gender,onValueChange:a=>t("gender",a),children:[e.jsx(B,{children:e.jsx(G,{placeholder:"Seleccionar género"})}),e.jsxs(H,{children:[e.jsx(i,{value:"masculino",children:"Masculino"}),e.jsx(i,{value:"femenino",children:"Femenino"}),e.jsx(i,{value:"no_especificar",children:"Prefiero no decir"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"birthDate",className:"text-sm font-medium",children:"Fecha de nacimiento"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{id:"birthDate",type:"date",value:r.birthDate,onChange:a=>t("birthDate",a.target.value),className:"w-full"}),e.jsx(ua,{className:"h-4 w-4 absolute right-3 top-3 text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"bio",className:"text-sm font-medium",children:"Biografía"}),e.jsx(_,{id:"bio",value:r.bio,onChange:a=>t("bio",a.target.value),placeholder:"Breve descripción personal",rows:3})]})]})]})]}),r.role==="instructor"&&e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Información Profesional de Instructor"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"specialties",className:"text-sm font-medium",children:"Especialidades"}),e.jsx(_,{id:"specialties",value:Array.isArray(r.specialties)?r.specialties.join(", "):"",onChange:a=>t("specialties",a.target.value.split(", ")),placeholder:"Yoga, Fitness, Artes marciales, Deportes infantiles, etc.",rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ingresa las especialidades separadas por comas"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"curriculumFile",className:"text-sm font-medium",children:"Curriculum Vitae"}),e.jsx("div",{className:"border border-gray-300 rounded-md p-4 bg-gray-50",children:r.curriculumFile?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 truncate max-w-[150px]",children:r.curriculumFile.name})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700",onClick:()=>t("curriculumFile",null),children:e.jsx(Z,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("label",{htmlFor:"curriculumUpload",className:"cursor-pointer inline-flex items-center gap-2 py-2 px-4 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(A,{className:"h-4 w-4"}),"Subir CV",e.jsx("input",{id:"curriculumUpload",type:"file",accept:".pdf,.doc,.docx",className:"hidden",onChange:$})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formatos: PDF, DOC, DOCX. Máx: 5MB"})]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"experience",className:"text-sm font-medium",children:"Experiencia y Certificaciones"}),e.jsx(_,{id:"experience",value:r.experience,onChange:a=>t("experience",a.target.value),placeholder:"Describe tu experiencia profesional, certificaciones, logros y áreas de especialización.",rows:4})]})]}),r.role==="concesionario"&&e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Información de Concesionario"}),e.jsxs(fe,{defaultValue:"datos",className:"w-full",children:[e.jsxs(ve,{className:"grid w-full grid-cols-3",children:[e.jsx(Q,{value:"datos",children:"Datos Generales"}),e.jsx(Q,{value:"documentos",children:"Documentación"}),e.jsx(Q,{value:"evaluaciones",children:"Evaluaciones"})]}),e.jsxs(X,{value:"datos",className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"tipo",className:"text-sm font-medium",children:"Tipo"}),e.jsxs(V,{value:r.tipo||"persona_fisica",onValueChange:a=>t("tipo",a),children:[e.jsx(B,{id:"tipo",children:e.jsx(G,{placeholder:"Selecciona el tipo"})}),e.jsxs(H,{children:[e.jsx(i,{value:"persona_fisica",children:"Persona Física"}),e.jsx(i,{value:"persona_moral",children:"Persona Moral"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"rfc",className:"text-sm font-medium",children:"RFC"}),e.jsx(C,{id:"rfc",value:r.rfc||"",onChange:a=>t("rfc",a.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"domicilioFiscal",className:"text-sm font-medium",children:"Domicilio Fiscal"}),e.jsx(_,{id:"domicilioFiscal",value:r.domicilioFiscal||"",onChange:a=>t("domicilioFiscal",a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"representanteLegal",className:"text-sm font-medium",children:"Representante Legal"}),e.jsx(C,{id:"representanteLegal",value:r.representanteLegal||"",onChange:a=>t("representanteLegal",a.target.value)})]})]}),e.jsxs(X,{value:"documentos",className:"space-y-4 mt-4",children:[e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(ae,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Documentación Requerida"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Después de guardar los datos generales, podrás cargar los siguientes documentos requeridos:"}),e.jsxs("ul",{className:"mt-2 space-y-1 text-sm text-blue-700 list-disc list-inside",children:[e.jsx("li",{children:"Identificación oficial (INE/Pasaporte)"}),e.jsx("li",{children:"Comprobante de domicilio fiscal"}),e.jsx("li",{children:"Constancia de situación fiscal"}),e.jsx("li",{children:"Acta constitutiva (para personas morales)"}),e.jsx("li",{children:"Poder notarial (para representantes legales)"})]})]})]})}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Documentos disponibles"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:d?"Guarda los datos del concesionario primero para gestionar documentos.":"Selecciona un documento para cargar o ver detalles."}),!d&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between border-b pb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Identificación oficial"})]}),e.jsx(o,{variant:"outline",size:"sm",disabled:d,children:"Cargar"})]}),e.jsxs("div",{className:"flex items-center justify-between border-b pb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Comprobante de domicilio"})]}),e.jsx(o,{variant:"outline",size:"sm",disabled:d,children:"Cargar"})]}),e.jsxs("div",{className:"flex items-center justify-between border-b pb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-4 w-4 mr-2 text-blue-500"}),e.jsx("span",{className:"text-sm",children:"Situación fiscal"})]}),e.jsx(o,{variant:"outline",size:"sm",disabled:d,children:"Cargar"})]})]})]})]}),e.jsxs(X,{value:"evaluaciones",className:"space-y-4 mt-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(pa,{className:"h-5 w-5 text-yellow-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-yellow-800",children:"Evaluaciones de Desempeño"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Las evaluaciones periódicas permiten verificar el cumplimiento de los términos de concesión y la calidad del servicio ofrecido."})]})]})}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Historial de evaluaciones"}),e.jsx("p",{className:"text-muted-foreground text-sm mb-4",children:d?"Guarda los datos del concesionario primero para registrar evaluaciones.":"Aún no hay evaluaciones registradas para este concesionario."}),!d&&e.jsx(o,{variant:"outline",size:"sm",disabled:d,children:"Registrar evaluación"})]})]})]})]}),r.role==="voluntario"&&e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Información de Voluntario"}),e.jsxs(fe,{defaultValue:"personal",className:"w-full",children:[e.jsxs(ve,{className:"grid w-full grid-cols-3",children:[e.jsx(Q,{value:"personal",children:"Información Personal"}),e.jsx(Q,{value:"experiencia",children:"Experiencia y Disponibilidad"}),e.jsx(Q,{value:"documentos",children:"Documentación y Términos"})]}),e.jsxs(X,{value:"personal",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"address",className:"text-sm font-medium",children:"Dirección"}),e.jsx(_,{id:"address",value:r.address,onChange:a=>t("address",a.target.value),placeholder:"Dirección completa",rows:2})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium",children:"Información de Contacto de Emergencia"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"emergencyContactName",className:"text-sm font-medium",children:"Nombre de contacto"}),e.jsx(C,{id:"emergencyContactName",value:r.emergencyContactName,onChange:a=>t("emergencyContactName",a.target.value),placeholder:"Nombre completo"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"emergencyContactPhone",className:"text-sm font-medium",children:"Teléfono de emergencia"}),e.jsx(C,{id:"emergencyContactPhone",value:r.emergencyContactPhone,onChange:a=>t("emergencyContactPhone",a.target.value),placeholder:"Ej: 555-123-4567"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"preferredParkId",className:"text-sm font-medium",children:"Parque preferido"}),e.jsxs(V,{value:((W=r.preferredParkId)==null?void 0:W.toString())||"null",onValueChange:a=>t("preferredParkId",a==="null"?null:parseInt(a)),children:[e.jsx(B,{children:e.jsx(G,{placeholder:"Seleccionar parque"})}),e.jsxs(H,{children:[e.jsx(i,{value:"null",children:"Sin preferencia"}),x&&x.length>0?x.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsxs(e.Fragment,{children:[e.jsx(i,{value:"1",children:"Parque Metropolitano"}),e.jsx(i,{value:"2",children:"Parque Agua Azul"}),e.jsx(i,{value:"3",children:"Parque de la Solidaridad"})]})]})]})]})})]}),e.jsxs(X,{value:"experiencia",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"volunteerExperience",className:"text-sm font-medium",children:"Experiencia previa como voluntario"}),e.jsx(_,{id:"volunteerExperience",value:r.volunteerExperience||"",onChange:a=>t("volunteerExperience",a.target.value),placeholder:"Describe tu experiencia previa como voluntario",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"skills",className:"text-sm font-medium",children:"Habilidades especiales"}),e.jsx(_,{id:"skills",value:r.skills||"",onChange:a=>t("skills",a.target.value),placeholder:"Jardinería, organización de eventos, deportes, etc.",rows:2}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Ingresa las habilidades separadas por comas"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"availability",className:"text-sm font-medium",children:"Disponibilidad"}),e.jsxs(V,{value:r.availability||"weekends",onValueChange:a=>t("availability",a),children:[e.jsx(B,{children:e.jsx(G,{placeholder:"Seleccionar disponibilidad"})}),e.jsxs(H,{children:[e.jsx(i,{value:"weekdays",children:"Entre semana"}),e.jsx(i,{value:"weekends",children:"Fines de semana"}),e.jsx(i,{value:"evenings",children:"Tardes/Noches"}),e.jsx(i,{value:"mornings",children:"Mañanas"}),e.jsx(i,{value:"flexible",children:"Horario flexible"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"interests",className:"text-sm font-medium",children:"Áreas de interés"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"interest-nature",checked:r.interestNature||!1,onCheckedChange:a=>t("interestNature",a===!0)}),e.jsx("label",{htmlFor:"interest-nature",className:"text-sm",children:"Naturaleza y Conservación"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"interest-events",checked:r.interestEvents||!1,onCheckedChange:a=>t("interestEvents",a===!0)}),e.jsx("label",{htmlFor:"interest-events",className:"text-sm",children:"Eventos y Actividades"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"interest-education",checked:r.interestEducation||!1,onCheckedChange:a=>t("interestEducation",a===!0)}),e.jsx("label",{htmlFor:"interest-education",className:"text-sm",children:"Educación Ambiental"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"interest-maintenance",checked:r.interestMaintenance||!1,onCheckedChange:a=>t("interestMaintenance",a===!0)}),e.jsx("label",{htmlFor:"interest-maintenance",className:"text-sm",children:"Mantenimiento"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"interest-sports",checked:r.interestSports||!1,onCheckedChange:a=>t("interestSports",a===!0)}),e.jsx("label",{htmlFor:"interest-sports",className:"text-sm",children:"Deportes y Recreación"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(T,{id:"interest-cultural",checked:r.interestCultural||!1,onCheckedChange:a=>t("interestCultural",a===!0)}),e.jsx("label",{htmlFor:"interest-cultural",className:"text-sm",children:"Arte y Cultura"})]})]})]})]}),e.jsxs(X,{value:"documentos",className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"idDocument",className:"text-sm font-medium",children:"Identificación oficial"}),e.jsx("div",{className:"border border-gray-300 rounded-md p-4 bg-gray-50",children:r.idDocumentFile?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 truncate max-w-[150px]",children:r.idDocumentFile.name})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700",onClick:()=>t("idDocumentFile",null),children:e.jsx(Z,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("label",{htmlFor:"idDocumentUpload",className:"cursor-pointer inline-flex items-center gap-2 py-2 px-4 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(A,{className:"h-4 w-4"}),"Subir identificación",e.jsx("input",{id:"idDocumentUpload",type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"hidden",onChange:a=>{a.target.files&&a.target.files[0]&&t("idDocumentFile",a.target.files[0])}})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formatos: PDF, JPG, PNG. Máx: 5MB"})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"addressDocument",className:"text-sm font-medium",children:"Comprobante de domicilio"}),e.jsx("div",{className:"border border-gray-300 rounded-md p-4 bg-gray-50",children:r.addressDocumentFile?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 truncate max-w-[150px]",children:r.addressDocumentFile.name})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700",onClick:()=>t("addressDocumentFile",null),children:e.jsx(Z,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("label",{htmlFor:"addressDocumentUpload",className:"cursor-pointer inline-flex items-center gap-2 py-2 px-4 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(A,{className:"h-4 w-4"}),"Subir comprobante",e.jsx("input",{id:"addressDocumentUpload",type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"hidden",onChange:a=>{a.target.files&&a.target.files[0]&&t("addressDocumentFile",a.target.files[0])}})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formatos: PDF, JPG, PNG. Máx: 5MB"})]})})]}),e.jsxs("div",{className:"space-y-4 mt-4 pt-4 border-t border-gray-200",children:[e.jsx("h4",{className:"font-medium",children:"Términos y condiciones"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(T,{id:"legalConsent",checked:r.legalConsent||!1,onCheckedChange:a=>t("legalConsent",a===!0),className:"mt-1"}),e.jsx("label",{htmlFor:"legalConsent",className:"text-sm text-gray-700",children:"Acepto los términos y condiciones del programa de voluntariado y autorizo el uso de mis datos personales para los fines del programa."})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(T,{id:"ageConsent",checked:r.ageConsent||!1,onCheckedChange:a=>t("ageConsent",a===!0),className:"mt-1"}),e.jsx("label",{htmlFor:"ageConsent",className:"text-sm text-gray-700",children:"Confirmo que soy mayor de 18 años de edad o cuento con autorización de mi tutor legal para participar en el programa."})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(T,{id:"conductConsent",checked:r.conductConsent||!1,onCheckedChange:a=>t("conductConsent",a===!0),className:"mt-1"}),e.jsx("label",{htmlFor:"conductConsent",className:"text-sm text-gray-700",children:"Me comprometo a seguir el código de conducta del programa de voluntariado y entiendo que su incumplimiento puede resultar en mi exclusión del programa."})]})]})]})]})]})]}),e.jsxs(ke,{className:"pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:y,disabled:g,children:"Cancelar"}),e.jsxs(o,{type:"submit",disabled:g,children:[g&&e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),d?"Crear usuario":"Guardar cambios"]})]})]})]})})},Fa=({isOpen:s,title:d,message:y,onConfirm:L,onCancel:g,isLoading:f})=>e.jsx(Ce,{open:s,onOpenChange:g,children:e.jsxs(we,{children:[e.jsx(Ie,{children:e.jsx(Fe,{children:d})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:y})}),e.jsxs(ke,{children:[e.jsx(o,{variant:"outline",onClick:g,disabled:f,children:"Cancelar"}),e.jsxs(o,{variant:"destructive",onClick:L,disabled:f,children:[f&&e.jsx(ie,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar"]})]})]})}),Ta=()=>{const s=aa(),{toast:d}=sa(),[y,L]=j.useState(""),[g,f]=j.useState(null),[r,z]=j.useState(null),[x,t]=j.useState(!1),[w,$]=j.useState(!1),[P,F]=j.useState(null),[I,W]=j.useState("id"),[a,u]=j.useState("asc"),[c,k]=j.useState("all"),[p,M]=j.useState("all"),[S,q]=j.useState(!1),[h,E]=j.useState(1),[se]=j.useState(10);j.useEffect(()=>{E(1)},[y,c,p]);const{data:ne=[],isLoading:Ee,isError:De,refetch:ka}=be({queryKey:["/api/users"],queryFn:async()=>{try{const l=await fetch("/api/users");if(!l.ok)throw new Error(`Error ${l.status}: ${l.statusText}`);const n=await l.json();return console.log("Usuarios obtenidos de la API:",n.length),n}catch(l){throw console.error("Error fetching users:",l),l}}}),ce=pe({mutationFn:async l=>{const n=!!g,m=n?`/api/users/${g==null?void 0:g.id}`:"/api/users",N=n?"PUT":"POST";if(n&&!l.password){const{password:ue,...Be}=l;l=Be}console.log(`${N} usuario:`,l);const v=await fetch(m,{method:N,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!v.ok){const ue=await v.json();throw new Error(ue.message||"Error al procesar la solicitud")}return await v.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["/api/users"]}),d({title:x?"Usuario creado":"Usuario actualizado",description:x?"El usuario ha sido creado exitosamente":"Los datos del usuario han sido actualizados"}),de()},onError:l=>{console.error("Error saving user:",l),d({title:"Error",description:`No se pudo ${x?"crear":"actualizar"} el usuario. Inténtalo de nuevo.`,variant:"destructive"})}}),oe=pe({mutationFn:async l=>{console.log("DELETE usuario:",l);const n=await fetch(`/api/users/${l}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!n.ok){const m=await n.json().catch(()=>({}));throw new Error(m.message||"Error al eliminar el usuario")}return l},onSuccess:()=>{s.invalidateQueries({queryKey:["/api/users"]}),d({title:"Usuario eliminado",description:"El usuario ha sido eliminado exitosamente"}),$(!1),F(null)},onError:l=>{console.error("Error deleting user:",l),d({title:"Error",description:"No se pudo eliminar el usuario. Inténtalo de nuevo.",variant:"destructive"}),$(!1)}}),Pe=()=>{f(null),t(!0)},Ue=l=>{f(l),z(l.id),t(!1)},de=()=>{f(null),z(null),t(!1)},Te=async l=>{const n=r||g&&g.id;if(l.profileImageUrl&&n)try{localStorage.setItem(`profile_image_${n}`,l.profileImageUrl),console.log(`Imagen guardada en localStorage para usuario ID: ${n}`),(await fetch(`/api/users/${n}/profile-image`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({imageUrl:l.profileImageUrl})})).ok?console.log(`✅ Imagen guardada con éxito para el usuario ID: ${n}`):console.error(`❌ Error al guardar la imagen para el usuario ID: ${n}`);const N=()=>{fetch(`/api/users/${n}/profile-image`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({imageUrl:l.profileImageUrl})}).then(()=>console.log(`Verificación adicional completada para usuario ID: ${n}`))};setTimeout(N,500),setTimeout(N,1500)}catch(m){console.error("Error al guardar la imagen en la caché:",m)}ce.mutate(l)},Ae=l=>{F(l),$(!0)},Le=()=>{P&&oe.mutate(P.id)},J=l=>{I===l?u(a==="asc"?"desc":"asc"):(W(l),u("asc"))},K=l=>I!==l?e.jsx(ga,{className:"h-4 w-4 text-gray-400"}):a==="asc"?e.jsx(ba,{className:"h-4 w-4 text-blue-600"}):e.jsx(ja,{className:"h-4 w-4 text-blue-600"}),$e=()=>{L(""),k("all"),M("all"),W("id"),u("asc"),E(1)},me=ne.filter(l=>{const n=y.toLowerCase(),m=l.username.toLowerCase().includes(n)||l.email.toLowerCase().includes(n)||l.fullName&&l.fullName.toLowerCase().includes(n)||l.role.toLowerCase().includes(n),N=c==="all"||!c||l.role===c;let v=!0;if(p!=="all")switch(p){case"admin":v=["admin","director"].includes(l.role);break;case"staff":v=["manager","supervisor","guardaparques","guardia"].includes(l.role);break;case"community":v=["voluntario","instructor","ciudadano"].includes(l.role);break;case"business":v=l.role==="concesionario";break;case"active":v=l.createdAt?new Date(l.createdAt)>new Date(Date.now()-30*24*60*60*1e3):!1;break;default:v=!0}return m&&N&&v}).sort((l,n)=>{const m=l[I],N=n[I];if(m==null)return 1;if(N==null)return-1;let v=0;return m<N&&(v=-1),m>N&&(v=1),a==="asc"?v:-v}),Y=me.length,D=Math.ceil(Y/se),le=(h-1)*se,he=le+se,xe=me.slice(le,he),Me=l=>{E(l)},qe=()=>{h>1&&E(h-1)},ze=()=>{h<D&&E(h+1)},Oe=()=>{E(1)},Re=()=>{E(D)},_e=l=>{if(!l)return"N/A";try{return fa(new Date(l),"dd/MM/yyyy HH:mm",{locale:va})}catch(n){return console.error("Error al formatear fecha:",n),"Fecha inválida"}},Ve=l=>{switch(l){case"admin":return e.jsx(b,{className:"bg-purple-100 text-purple-800 hover:bg-purple-100",children:"Administrador"});case"director":return e.jsx(b,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Director"});case"manager":return e.jsx(b,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"Gestor"});case"supervisor":return e.jsx(b,{className:"bg-teal-100 text-teal-800 hover:bg-teal-100",children:"Supervisor"});case"ciudadano":return e.jsx(b,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Ciudadano"});case"voluntario":return e.jsx(b,{className:"bg-amber-100 text-amber-800 hover:bg-amber-100",children:"Voluntario"});case"instructor":return e.jsx(b,{className:"bg-indigo-100 text-indigo-800 hover:bg-indigo-100",children:"Instructor"});case"guardaparques":return e.jsx(b,{className:"bg-emerald-100 text-emerald-800 hover:bg-emerald-100",children:"Guardaparques"});case"guardia":return e.jsx(b,{className:"bg-cyan-100 text-cyan-800 hover:bg-cyan-100",children:"Guardia"});case"concesionario":return e.jsx(b,{className:"bg-pink-100 text-pink-800 hover:bg-pink-100",children:"Concesionario"});case"user":return e.jsx(b,{className:"bg-gray-100 text-gray-800 hover:bg-gray-100",children:"Usuario"});default:return e.jsx(b,{children:l})}},{t:ee}=ge("common"),{t:re}=ge("users");return e.jsxs(la,{title:re("title"),children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-96",children:[e.jsx(ra,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(C,{type:"search",placeholder:`${ee("actions.search")} ${ee("navigation.users")}...`,className:"pl-9",value:y,onChange:l=>L(l.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:()=>q(!S),className:"flex items-center gap-2",children:[e.jsx(ta,{className:"h-4 w-4"}),ee("actions.filter")]}),e.jsxs(o,{onClick:Pe,children:[e.jsx(ia,{className:"h-4 w-4 mr-2"}),re("newUser")]})]})]}),S&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrar por rol específico"}),e.jsxs(V,{value:c,onValueChange:k,children:[e.jsx(B,{children:e.jsx(G,{placeholder:"Todos los roles"})}),e.jsxs(H,{children:[e.jsx(i,{value:"all",children:"Todos los roles"}),e.jsx(i,{value:"admin",children:"Administrador"}),e.jsx(i,{value:"director",children:"Director"}),e.jsx(i,{value:"manager",children:"Gestor"}),e.jsx(i,{value:"supervisor",children:"Supervisor"}),e.jsx(i,{value:"ciudadano",children:"Ciudadano"}),e.jsx(i,{value:"voluntario",children:"Voluntario"}),e.jsx(i,{value:"instructor",children:"Instructor"}),e.jsx(i,{value:"guardaparques",children:"Guardaparques"}),e.jsx(i,{value:"guardia",children:"Guardia"}),e.jsx(i,{value:"concesionario",children:"Concesionario"}),e.jsx(i,{value:"user",children:"Usuario"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrar por tipo de usuario"}),e.jsxs(V,{value:p,onValueChange:M,children:[e.jsx(B,{children:e.jsx(G,{placeholder:"Todos los tipos"})}),e.jsxs(H,{children:[e.jsx(i,{value:"all",children:"Todos los tipos"}),e.jsx(i,{value:"admin",children:"Administración"}),e.jsx(i,{value:"staff",children:"Personal"}),e.jsx(i,{value:"community",children:"Comunidad"}),e.jsx(i,{value:"business",children:"Negocios"}),e.jsx(i,{value:"active",children:"Usuarios activos (últimos 30 días)"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(o,{variant:"outline",onClick:$e,className:"flex items-center gap-2 w-full",children:[e.jsx(Na,{className:"h-4 w-4"}),"Limpiar filtros"]})})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600 pt-2 border-t",children:[e.jsxs("span",{children:["Mostrando ",Y," de ",ne.length," usuarios"]}),e.jsxs("span",{children:["Página ",h," de ",D]})]})]})]}),e.jsx("div",{className:"rounded-md border",children:Ee?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(ie,{className:"h-8 w-8 animate-spin text-primary"})}):De?e.jsxs("div",{className:"flex justify-center items-center p-8 text-red-500",children:[e.jsx(Z,{className:"h-8 w-8 mr-2"}),e.jsx("span",{children:"Error al cargar los usuarios. Inténtalo de nuevo."})]}):xe.length===0?e.jsxs("div",{className:"flex flex-col justify-center items-center p-8 text-gray-500",children:[e.jsx(Se,{className:"h-12 w-12 mb-2"}),e.jsx("h3",{className:"text-lg font-medium",children:"No se encontraron usuarios"}),y?e.jsxs("p",{children:['No hay resultados para "',y,'". Intenta con otra búsqueda.']}):e.jsx("p",{children:"No hay usuarios registrados en el sistema."})]}):e.jsxs(na,{children:[e.jsx(ca,{children:e.jsxs(je,{children:[e.jsx(O,{children:e.jsxs(o,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>J("id"),children:["ID ",K("id")]})}),e.jsx(O,{children:e.jsxs(o,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>J("username"),children:["Usuario ",K("username")]})}),e.jsx(O,{children:e.jsxs(o,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>J("email"),children:["Email ",K("email")]})}),e.jsx(O,{children:e.jsxs(o,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>J("fullName"),children:["Nombre ",K("fullName")]})}),e.jsx(O,{children:e.jsxs(o,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>J("role"),children:["Rol ",K("role")]})}),e.jsx(O,{children:e.jsxs(o,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>J("createdAt"),children:["Fecha de Creación ",K("createdAt")]})}),e.jsx(O,{className:"text-right",children:"Acciones"})]})}),e.jsx(oa,{children:xe.map(l=>e.jsxs(je,{children:[e.jsx(R,{className:"font-medium",children:l.id}),e.jsx(R,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ye,{userId:l.id,role:l.role,name:l.fullName||`${l.firstName||""} ${l.lastName||""}`,size:"sm"}),e.jsx("span",{children:l.username})]})}),e.jsx(R,{children:l.email}),e.jsx(R,{children:l.fullName||`${l.firstName||""} ${l.lastName||""}`}),e.jsx(R,{children:Ve(l.role)}),e.jsx(R,{children:_e(l.createdAt)}),e.jsx(R,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>Ue(l),title:"Editar usuario",children:e.jsx(da,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"icon",onClick:()=>Ae(l),title:"Eliminar usuario",className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(ma,{className:"h-4 w-4"})})]})})]},l.id))})]})}),Y>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",le+1," a ",Math.min(he,Y)," de ",Y," usuarios"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"icon",onClick:Oe,disabled:h===1,title:"Primera página",children:e.jsx(ya,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"icon",onClick:qe,disabled:h===1,title:"Página anterior",children:e.jsx(ha,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,D)},(l,n)=>{let m;D<=5||h<=3?m=n+1:h>=D-2?m=D-4+n:m=h-2+n;const N=m===h;return e.jsx(o,{variant:N?"default":"outline",size:"icon",onClick:()=>Me(m),className:N?"bg-primary text-primary-foreground":"",children:m},m)})}),e.jsx(o,{variant:"outline",size:"icon",onClick:ze,disabled:h===D,title:"Página siguiente",children:e.jsx(xa,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"icon",onClick:Re,disabled:h===D,title:"Última página",children:e.jsx(Ca,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Página ",h," de ",D]})]}),(g!==null||x)&&e.jsx(Ia,{user:g,isNew:x,onClose:de,onSave:Te,isSaving:ce.isPending,editingUserId:r}),e.jsx(Fa,{isOpen:w,title:re("deleteUser"),message:`${ee("messages.deleteConfirm")} ${P==null?void 0:P.username}?`,onConfirm:Le,onCancel:()=>$(!1),isLoading:oe.isPending})]})};export{Ta as default};
