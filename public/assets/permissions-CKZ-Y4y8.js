import{c as F,a2 as g,ae as Q,u as Y,ag as X,j as e,aX as E,f as j,e as v,B as m,bF as Z,bG as J,i as w,K as B,aq as W,cb as u,g as R,h as $,ab as I,bt as c,d as K,o as ee,c9 as se,ao as f,au as L,bO as N,bq as M,aV as ae,M as ie,cp as ne,as as re,av as te,aY as ce,m as O,ar as de,cq as le,U as G,bp as oe,t as me}from"./index-D5qLf1ib.js";import{T as xe}from"./trending-down-Bn0HnEog.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=F("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),pe={dashboard:{name:"Dashboard",icon:ae,path:"/admin",children:{}},operations:{name:"Operaciones",icon:ie,children:{parks:{name:"Parques",icon:ne,path:"/admin/parks"},assets:{name:"Activos",icon:he,path:"/admin/assets"},incidents:{name:"Incidentes",icon:B,path:"/admin/incidents"}}},finance:{name:"Finanzas",icon:re,children:{catalog:{name:"Catálogo",icon:te,path:"/admin/finance/catalog"},incomes:{name:"Ingresos",icon:ce,path:"/admin/finance/incomes"},expenses:{name:"Egresos",icon:xe,path:"/admin/finance/expenses"}}},activities:{name:"Actividades",icon:O,children:{list:{name:"Listado",icon:de,path:"/admin/activities"},calendar:{name:"Calendario",icon:O,path:"/admin/activities/calendar"},instructors:{name:"Instructores",icon:le,path:"/admin/instructors"}}},users:{name:"Personal",icon:G,path:"/admin/users",children:{}},settings:{name:"Configuración",icon:oe,path:"/admin/settings",children:{}}},T=[{id:"super_admin",name:"Super Administrador",color:"bg-red-100 text-red-800",icon:v},{id:"admin",name:"Administrador",color:"bg-orange-100 text-orange-800",icon:v},{id:"moderator",name:"Moderador",color:"bg-blue-100 text-blue-800",icon:G},{id:"operator",name:"Operador",color:"bg-green-100 text-green-800",icon:me}],ue=()=>{var q;const[C,y]=g.useState({}),[r,U]=g.useState("super_admin"),[k,b]=g.useState(!1),_=Q(),{data:o,isLoading:D}=Y({queryKey:["/api/role-permissions"],enabled:!0});g.useEffect(()=>{o&&y(o)},[o]);const x=X({mutationFn:async a=>W("/api/role-permissions",{method:"PUT",data:a}),onSuccess:()=>{u({title:"Permisos guardados exitosamente"}),b(!1),_.invalidateQueries({queryKey:["/api/role-permissions"]})},onError:()=>{u({title:"Error al guardar permisos",variant:"destructive"})}}),s=()=>r==="admin"||r==="super_admin",h=(a,i,n)=>{if(s()){u({title:"Permisos bloqueados",description:`Los roles ${r==="super_admin"?"Super Administrador":"Administrador"} tienen todos los permisos activos y no se pueden modificar.`,variant:"destructive"});return}const d=n?`${a}.${n}`:a;y(t=>{var l;return{...t,[r]:{...t[r],[`${d}.${i}`]:!((l=t[r])!=null&&l[`${d}.${i}`])}}}),b(!0)},p=(a,i,n)=>{var t;if(s())return!0;const d=n?`${a}.${n}`:a;return((t=C[r])==null?void 0:t[`${d}.${i}`])||!1},P=()=>{o&&(y(o),b(!1))},S=()=>{if(s()){u({title:"Permisos bloqueados",description:`Los permisos para ${r==="super_admin"?"Super Administrador":"Administrador"} no se pueden modificar.`,variant:"destructive"});return}x.mutate(C)},A=()=>T.find(a=>a.id===r),z=()=>e.jsxs(j,{children:[e.jsxs(R,{children:[e.jsx($,{className:"text-xl",children:"Seleccionar Rol"}),e.jsx(I,{children:"Elige el rol del cual deseas configurar los permisos de acceso"})]}),e.jsx(w,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:T.map(a=>{const i=a.icon;return e.jsxs(m,{variant:r===a.id?"default":"outline",className:c("h-auto p-4 flex flex-col items-center gap-2 transition-all",r===a.id&&"ring-2 ring-blue-500"),onClick:()=>U(a.id),children:[e.jsx(i,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs font-medium text-center",children:a.name}),r===a.id&&e.jsx(K,{className:"w-4 h-4 text-green-600"})]},a.id)})})})]}),H=()=>{const a=A();return a?e.jsxs(j,{children:[e.jsxs(R,{children:[e.jsxs($,{className:"flex items-center gap-3",children:[e.jsxs(ee,{className:a.color,variant:"secondary",children:[e.jsx(a.icon,{className:"w-4 h-4 mr-2"}),a.name]}),e.jsx("span",{className:"text-lg",children:"Configuración de Permisos"})]}),e.jsx(I,{children:"Configura qué secciones del dashboard puede acceder este rol"})]}),e.jsxs(w,{children:[s()&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-800",children:"Rol Protegido"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Este rol tiene todos los permisos activos de forma permanente y no se pueden modificar por razones de seguridad."})]})]})}),e.jsx(se,{className:"h-[600px] pr-4",children:e.jsx("div",{className:"space-y-6",children:Object.entries(pe).map(([i,n])=>{const d=n.icon;return e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(d,{className:"w-6 h-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:n.name}),e.jsx("p",{className:"text-sm text-gray-600",children:n.path?`Ruta: ${n.path}`:"Módulo principal"})]})]}),Object.keys(n.children||{}).length===0&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{checked:p(i,"view"),onCheckedChange:()=>h(i,"view"),disabled:s(),className:c("h-4 w-4",s()&&"opacity-60 cursor-not-allowed")}),e.jsxs("div",{className:c("flex items-center gap-1 text-sm",(s(),"text-gray-600")),children:[e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{children:"Ver"}),s()&&e.jsx(N,{className:"w-3 h-3 text-gray-500"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{checked:p(i,"edit"),onCheckedChange:()=>h(i,"edit"),disabled:s(),className:c("h-4 w-4",s()&&"opacity-60 cursor-not-allowed")}),e.jsxs("div",{className:c("flex items-center gap-1 text-sm",(s(),"text-gray-600")),children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:"Editar"}),s()&&e.jsx(N,{className:"w-3 h-3 text-gray-500"})]})]})]})]}),Object.keys(n.children||{}).length>0&&e.jsx("div",{className:"ml-6 space-y-3",children:Object.entries(n.children||{}).map(([t,l])=>{const V=l.icon;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5 text-gray-600"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:l.name}),e.jsx("p",{className:"text-sm text-gray-500",children:l.path})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{checked:p(i,"view",t),onCheckedChange:()=>h(i,"view",t),disabled:s(),className:c("h-4 w-4",s()&&"opacity-60 cursor-not-allowed")}),e.jsxs("div",{className:c("flex items-center gap-1 text-xs",(s(),"text-gray-600")),children:[e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{children:"Ver"}),s()&&e.jsx(N,{className:"w-3 h-3 text-gray-500"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{checked:p(i,"edit",t),onCheckedChange:()=>h(i,"edit",t),disabled:s(),className:c("h-4 w-4",s()&&"opacity-60 cursor-not-allowed")}),e.jsxs("div",{className:c("flex items-center gap-1 text-xs",(s(),"text-gray-600")),children:[e.jsx(M,{className:"w-3 h-3"}),e.jsx("span",{children:"Editar"}),s()&&e.jsx(N,{className:"w-3 h-3 text-gray-500"})]})]})]})]},t)})})]},i)})})})]})]}):null};return D?e.jsx(E,{children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-center",children:"Cargando permisos..."})})}):e.jsx(E,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(j,{className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestión de Permisos"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Selecciona un rol y configura qué secciones del dashboard puede acceder"})]})]}),k&&!s()&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:P,className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Revertir"]}),e.jsxs(m,{onClick:S,disabled:x.isPending,className:"flex items-center gap-2",children:[e.jsx(J,{className:"w-4 h-4"}),x.isPending?"Guardando...":"Guardar Cambios"]})]})]})}),z(),H(),k&&!s()&&e.jsx(j,{className:"border-yellow-200 bg-yellow-50",children:e.jsx(w,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-yellow-600"}),e.jsxs("span",{className:"text-yellow-800 font-medium",children:["Hay cambios sin guardar en los permisos del rol ",(q=A())==null?void 0:q.name]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:P,children:"Revertir"}),e.jsx(m,{size:"sm",onClick:S,disabled:x.isPending,children:"Guardar"})]})]})})})]})})};export{ue as default};
