import{aD as te,e as re,a6 as le,Y as P,u as L,a8 as V,j as e,B as c,l as M,aO as se,aP as ae,aQ as K,C as h,c as p,U as me,D as ne,r as ce,t as de,v as oe,w as xe,h as X,i as W,M as B,f as b,bb as he,b2 as ie,ai as Q,ap as ye,aq as be,av as Z,ck as we,X as I,b7 as J,V as G,cl as _,cm as je,a as $,b as O,a9 as Ce,cn as Pe,R as ke,aI as pe,cd as Me,ax as qe,ba as De,bz as Se,aR as Y,a3 as ee,y as A,m as ue,I as H,n as Ee,P as Fe,O as Ae,co as Te,aH as Le,cp as $e}from"./index-VG22aPDC.js";import{p as T}from"./parseISO-Bs9g2l9_.js";import{e as ze}from"./eachDayOfInterval-CwIOwwrT.js";import{H as He}from"./Helmet-CoO02W0T.js";import{C as Ke}from"./camera-awBmfv_v.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=te("CalendarCheck",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=te("CalendarPlus",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M19 16v6",key:"tddt3s"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=te("HeartOff",[["line",{x1:"2",y1:"2",x2:"22",y2:"22",key:"1w4vcy"}],["path",{d:"M16.5 16.5 12 21l-7-7c-1.5-1.45-3-3.2-3-5.5a5.5 5.5 0 0 1 2.14-4.35",key:"3mpagl"}],["path",{d:"M8.76 3.1c1.15.22 2.13.78 3.24 1.9 1.5-1.5 2.74-2 4.5-2A5.5 5.5 0 0 1 22 8.5c0 2.12-1.3 3.78-2.67 5.17",key:"1gh3v3"}]]),Qe=({userId:s})=>{const{toast:N}=re(),j=le(),[l,u]=P.useState(new Date),[S,w]=P.useState("month"),[n,E]=P.useState(null),[q,d]=P.useState(!1),{data:m=[],isLoading:f}=L({queryKey:["/api/activities"]}),{data:g=[],isLoading:i}=L({queryKey:[`/api/users/${s}/calendar-activities`],enabled:!!s}),{data:F=[]}=L({queryKey:["/api/parks"]}),v=V({mutationFn:async x=>Q(`/api/users/${s}/calendar-activities`,{method:"POST",data:{activityId:x}}),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/users/${s}/calendar-activities`]}),N({title:"Actividad agregada",description:"La actividad se ha agregado a tu calendario personal."})},onError:()=>{N({title:"Error",description:"No se pudo agregar la actividad al calendario.",variant:"destructive"})}}),C=V({mutationFn:async x=>Q(`/api/users/${s}/calendar-activities/${x}`,{method:"DELETE"}),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/users/${s}/calendar-activities`]}),N({title:"Actividad removida",description:"La actividad se ha removido de tu calendario personal."})},onError:()=>{N({title:"Error",description:"No se pudo remover la actividad del calendario.",variant:"destructive"})}}),z=x=>{const r=F.find(k=>k.id===x);return(r==null?void 0:r.name)||"Parque no disponible"},D=x=>g.some(r=>r.activityId===x||r.id===x),t=x=>m.filter(r=>{const k=T(r.startDate);return Z(k,x)}),a=x=>g.filter(r=>{const k=m.find(R=>R.id===r.activityId);if(!k)return!1;const y=T(k.startDate);return Z(y,x)}),o=()=>{const x=ye(l),r=be(l),k=ze({start:x,end:r});return e.jsxs("div",{className:"grid grid-cols-7 gap-2",children:[["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"].map(y=>e.jsx("div",{className:"p-2 text-center font-semibold text-gray-500 text-sm",children:y},y)),k.map(y=>{const R=t(y);a(y);const Ne=Z(y,new Date);return e.jsxs("div",{className:`
                min-h-[100px] p-2 border rounded-lg cursor-pointer transition-colors
                ${Ne?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}
                ${we(y,l)?"":"text-gray-300 bg-gray-50"}
              `,onClick:()=>u(y),children:[e.jsx("div",{className:"font-semibold text-sm mb-1",children:M(y,"d")}),e.jsxs("div",{className:"space-y-1",children:[R.slice(0,2).map(U=>e.jsx("div",{className:`
                      text-xs p-1 rounded cursor-pointer
                      ${D(U.id)?"bg-green-100 text-green-800 border border-green-200":"bg-blue-100 text-blue-800 border border-blue-200"}
                    `,onClick:fe=>{fe.stopPropagation(),E(U),d(!0)},children:U.title.length>15?U.title.substring(0,15)+"...":U.title},U.id)),R.length>2&&e.jsxs("div",{className:"text-xs text-gray-500",children:["+",R.length-2," más"]})]})]},y.toISOString())})]})},ve=()=>{const x=m.filter(r=>new Date(r.startDate)>=new Date).sort((r,k)=>new Date(r.startDate).getTime()-new Date(k.startDate).getTime());return e.jsx("div",{className:"space-y-4",children:x.map(r=>e.jsx(h,{className:"border border-gray-200",children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:r.title}),e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:r.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-sm text-gray-500 mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),M(T(r.startDate),"dd/MM/yyyy",{locale:I})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),M(T(r.startDate),"HH:mm")]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),z(r.parkId)]}),r.location&&e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{children:["📍 ",r.location]})})]}),e.jsx(b,{variant:"outline",className:"mb-2",children:r.category})]}),e.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>{E(r),d(!0)},children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Ver"]}),D(r.id)?e.jsxs(c,{size:"sm",variant:"destructive",onClick:()=>C.mutate(r.id),disabled:C.isPending,children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Quitar"]}):e.jsxs(c,{size:"sm",onClick:()=>v.mutate(r.id),disabled:v.isPending,children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Agregar"]})]})]})})},r.id))})};return f||i?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("p",{children:"Cargando calendario..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(c,{variant:"outline",onClick:()=>u(new Date(l.getFullYear(),l.getMonth()-1,1)),children:"←"}),e.jsx("h2",{className:"text-xl font-semibold",children:M(l,"MMMM yyyy",{locale:I})}),e.jsx(c,{variant:"outline",onClick:()=>u(new Date(l.getFullYear(),l.getMonth()+1,1)),children:"→"})]}),e.jsx(se,{value:S,onValueChange:x=>w(x),children:e.jsxs(ae,{children:[e.jsx(K,{value:"month",children:"Mes"}),e.jsx(K,{value:"list",children:"Lista"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Oe,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"En mi calendario"}),e.jsx("p",{className:"text-2xl font-bold",children:g.length})]})]})})}),e.jsx(h,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ve,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Disponibles"}),e.jsx("p",{className:"text-2xl font-bold",children:m.length})]})]})})}),e.jsx(h,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(me,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Próximas"}),e.jsx("p",{className:"text-2xl font-bold",children:m.filter(x=>new Date(x.startDate)>=new Date).length})]})]})})})]}),e.jsx(h,{children:e.jsx(p,{className:"p-6",children:S==="month"?o():ve()})}),e.jsx(ne,{open:q,onOpenChange:d,children:e.jsx(ce,{className:"max-w-2xl",children:n&&e.jsxs(e.Fragment,{children:[e.jsxs(de,{children:[e.jsx(oe,{className:"text-xl",children:n.title}),e.jsx(xe,{className:"text-base",children:n.description})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(X,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("span",{children:M(T(n.startDate),"dd/MM/yyyy",{locale:I})})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(W,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsxs("span",{children:[M(T(n.startDate),"HH:mm")," hrs"]})]}),e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("span",{children:z(n.parkId)})]}),n.location&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("span",{className:"mr-2",children:"📍"}),e.jsx("span",{children:n.location})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(b,{variant:"outline",children:n.category}),n.capacity&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(me,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsxs("span",{children:["Capacidad: ",n.capacity," personas"]})]}),n.price&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("span",{className:"mr-2",children:"💰"}),e.jsxs("span",{children:["Precio: $",n.price]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>d(!1),children:"Cerrar"}),D(n.id)?e.jsxs(c,{variant:"destructive",onClick:()=>{C.mutate(n.id),d(!1)},disabled:C.isPending,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Quitar de mi calendario"]}):e.jsxs(c,{onClick:()=>{v.mutate(n.id),d(!1)},disabled:v.isPending,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Agregar a mi calendario"]})]})]})]})})})]})},Ue=({userId:s})=>{const{toast:N}=re(),j=le(),[l,u]=P.useState(null),[S,w]=P.useState(!1),{data:n=[],isLoading:E}=L({queryKey:["/api/parks"]}),{data:q=[],isLoading:d}=L({queryKey:[`/api/users/${s}/favorite-parks`],enabled:!!s}),{data:m=[],isLoading:f}=L({queryKey:[`/api/users/${s}/pending-parks`],enabled:!!s}),{data:g=[],isLoading:i}=L({queryKey:[`/api/users/${s}/favorite-parks-activities`],enabled:!!s&&q.length>0}),F=V({mutationFn:async t=>Q(`/api/users/${s}/favorite-parks`,{method:"POST",data:{parkId:t}}),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/users/${s}/favorite-parks`]}),j.invalidateQueries({queryKey:[`/api/users/${s}/favorite-parks-activities`]}),N({title:"Parque agregado a favoritos",description:"El parque se ha agregado a tu lista de favoritos."})},onError:()=>{N({title:"Error",description:"No se pudo agregar el parque a favoritos.",variant:"destructive"})}}),v=V({mutationFn:async t=>Q(`/api/users/${s}/favorite-parks/${t}`,{method:"DELETE"}),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/users/${s}/favorite-parks`]}),j.invalidateQueries({queryKey:[`/api/users/${s}/favorite-parks-activities`]}),N({title:"Parque removido de favoritos",description:"El parque se ha removido de tu lista de favoritos."})},onError:()=>{N({title:"Error",description:"No se pudo remover el parque de favoritos.",variant:"destructive"})}}),C=V({mutationFn:async t=>Q(`/api/users/${s}/visited-parks`,{method:"POST",data:{parkId:t}}),onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/users/${s}/pending-parks`]}),N({title:"Parque marcado como visitado",description:"¡Felicidades por visitar este parque!"})},onError:()=>{N({title:"Error",description:"No se pudo marcar el parque como visitado.",variant:"destructive"})}}),z=t=>q.some(a=>a.parkId===t||a.id===t),D=n.filter(t=>!z(t.id));return E||d||f?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx("p",{children:"Cargando información de parques..."})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(h,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-5 w-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Parques Favoritos"}),e.jsx("p",{className:"text-2xl font-bold",children:q.length})]})]})})}),e.jsx(h,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-5 w-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pendientes por Visitar"}),e.jsx("p",{className:"text-2xl font-bold",children:m.length})]})]})})}),e.jsx(h,{children:e.jsx(p,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Próximas Actividades"}),e.jsx("p",{className:"text-2xl font-bold",children:g.length})]})]})})})]}),g.length>0&&e.jsxs(h,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Actividades Próximas en tus Parques Favoritos"})]})}),e.jsx(p,{children:e.jsxs("div",{className:"space-y-3",children:[g.slice(0,3).map(t=>e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-blue-900",children:t.title}),e.jsx("p",{className:"text-sm text-blue-700 mb-2",children:t.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-blue-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),t.parkName]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),M(T(t.startDate),"dd/MM/yyyy",{locale:I})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),M(T(t.startDate),"HH:mm")]})]})]}),e.jsx(b,{variant:"outline",className:"bg-blue-100 text-blue-800",children:"Favorito"})]})},t.id)),g.length>3&&e.jsxs("p",{className:"text-sm text-gray-500 text-center",children:["+",g.length-3," actividades más en tus parques favoritos"]})]})})]}),e.jsxs(h,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{children:"Mis Parques Favoritos"})]})}),e.jsx(p,{children:q.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No tienes parques favoritos aún"}),e.jsx("p",{className:"text-sm",children:"Agrega parques a tus favoritos para recibir notificaciones de actividades"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:q.map(t=>{const a=n.find(o=>o.id===t.parkId)||t;return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:a.description||"Sin descripción"}),a.address&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),a.address]})]}),e.jsxs("div",{className:"flex space-x-1 ml-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{u(a),w(!0)},children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(c,{size:"sm",variant:"destructive",onClick:()=>v.mutate(a.id),disabled:v.isPending,children:e.jsx(ge,{className:"h-4 w-4"})})]})]})},a.id)})})})]}),e.jsxs(h,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(_,{className:"h-5 w-5 text-orange-600"}),e.jsx("span",{children:"Parques Pendientes por Visitar"})]})}),e.jsx(p,{children:m.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"No tienes parques pendientes por visitar"}),e.jsx("p",{className:"text-sm",children:"Los parques se agregan automáticamente cuando planificas visitarlos"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:m.map(t=>{const a=n.find(o=>o.id===t.parkId)||t;return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:a.description||"Sin descripción"}),a.address&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),a.address]})]}),e.jsxs("div",{className:"flex space-x-1 ml-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{u(a),w(!0)},children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(c,{size:"sm",onClick:()=>C.mutate(a.id),disabled:C.isPending,children:e.jsx(Ce,{className:"h-4 w-4"})})]})]})},a.id)})})})]}),e.jsxs(h,{children:[e.jsx($,{children:e.jsxs(O,{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{children:"Explorar Más Parques"})]})}),e.jsxs(p,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:D.slice(0,6).map(t=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600 mb-2 line-clamp-2",children:t.description||"Sin descripción"}),e.jsx(b,{variant:"outline",className:"text-xs",children:t.parkType||"Parque"})]}),e.jsxs("div",{className:"flex flex-col space-y-1 ml-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{u(t),w(!0)},children:e.jsx(J,{className:"h-3 w-3"})}),e.jsx(c,{size:"sm",onClick:()=>F.mutate(t.id),disabled:F.isPending,children:e.jsx(G,{className:"h-3 w-3"})})]})]})},t.id))}),D.length>6&&e.jsx("div",{className:"text-center mt-4",children:e.jsxs("p",{className:"text-sm text-gray-500",children:["+",D.length-6," parques más disponibles"]})})]})]}),e.jsx(ne,{open:S,onOpenChange:w,children:e.jsx(ce,{className:"max-w-2xl",children:l&&e.jsxs(e.Fragment,{children:[e.jsxs(de,{children:[e.jsx(oe,{className:"text-xl",children:l.name}),e.jsx(xe,{className:"text-base",children:l.description||"Información del parque"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[l.address&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(B,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("span",{children:l.address})]}),l.openingHours&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx(W,{className:"h-4 w-4 mr-2 text-gray-500"}),e.jsx("span",{children:l.openingHours})]}),l.contactPhone&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("span",{className:"mr-2",children:"📞"}),e.jsx("span",{children:l.contactPhone})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(b,{variant:"outline",children:l.parkType||"Parque"}),l.contactEmail&&e.jsxs("div",{className:"flex items-center text-sm",children:[e.jsx("span",{className:"mr-2",children:"📧"}),e.jsx("span",{children:l.contactEmail})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>w(!1),children:"Cerrar"}),z(l.id)?e.jsxs(c,{variant:"destructive",onClick:()=>{v.mutate(l.id),w(!1)},disabled:v.isPending,children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Quitar de favoritos"]}):e.jsxs(c,{onClick:()=>{F.mutate(l.id),w(!1)},disabled:F.isPending,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Agregar a favoritos"]})]})]})]})})})]})};function Je(){const{user:s,logout:N}=Pe(),{toast:j}=re(),l=le(),[u,S]=P.useState(!1),[w,n]=P.useState(!1),[E,q]=P.useState(!1),[d,m]=P.useState({fullName:"",email:"",phone:"",bio:"",birthDate:"",gender:""}),[f,g]=P.useState({currentPassword:"",newPassword:"",confirmPassword:""}),{data:i,isLoading:F}=L({queryKey:[`/api/users/${s==null?void 0:s.id}`],enabled:!!(s!=null&&s.id)});ke.useEffect(()=>{i&&m({fullName:i.fullName||"",email:i.email||"",phone:i.phone||"",bio:i.bio||"",birthDate:i.birthDate||"",gender:i.gender||""})},[i]);const v=V({mutationFn:async a=>Q(`/api/users/${s==null?void 0:s.id}`,{method:"PUT",data:a}),onSuccess:()=>{l.invalidateQueries({queryKey:[`/api/users/${s==null?void 0:s.id}`]}),j({title:"Perfil actualizado",description:"Tu información se ha actualizado correctamente."}),S(!1)},onError:a=>{j({title:"Error",description:"No se pudo actualizar el perfil. Inténtalo de nuevo.",variant:"destructive"})}}),C=V({mutationFn:async a=>Q(`/api/users/${s==null?void 0:s.id}/change-password`,{method:"PUT",data:a}),onSuccess:()=>{j({title:"Contraseña actualizada",description:"Tu contraseña se ha cambiado correctamente."}),n(!1),g({currentPassword:"",newPassword:"",confirmPassword:""})},onError:a=>{j({title:"Error",description:"No se pudo cambiar la contraseña. Verifica tu contraseña actual.",variant:"destructive"})}}),z=()=>{v.mutate(d)},D=()=>{if(f.newPassword!==f.confirmPassword){j({title:"Error",description:"Las contraseñas no coinciden.",variant:"destructive"});return}C.mutate(f)},t=a=>{switch(a){case"admin":return e.jsx(b,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Administrador"});case"director":return e.jsx(b,{className:"bg-purple-100 text-purple-800 hover:bg-purple-100",children:"Director"});case"manager":return e.jsx(b,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"Gerente"});case"instructor":return e.jsx(b,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Instructor"});case"volunteer":return e.jsx(b,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Voluntario"});default:return e.jsx(b,{variant:"outline",children:a})}};return F?e.jsx(pe,{title:"Mi Perfil",children:e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("p",{children:"Cargando perfil..."})})}):e.jsxs(pe,{title:"Mi Perfil",children:[e.jsx(He,{children:e.jsx("title",{children:"Mi Perfil | Bosques Urbanos"})}),e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx(h,{children:e.jsx($,{children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Me,{userId:s==null?void 0:s.id,size:"lg",className:"h-24 w-24"}),e.jsx(c,{size:"icon",variant:"outline",className:"absolute bottom-0 right-0 h-8 w-8 rounded-full bg-white",onClick:()=>{j({title:"Próximamente",description:"La función de cambio de foto estará disponible pronto."})},children:e.jsx(Ke,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:(i==null?void 0:i.fullName)||(s==null?void 0:s.username)}),e.jsx("p",{className:"text-gray-500 mb-2",children:i==null?void 0:i.email}),e.jsxs("div",{className:"flex items-center space-x-3",children:[t(s==null?void 0:s.role),(i==null?void 0:i.municipality)&&e.jsxs(b,{variant:"outline",className:"flex items-center space-x-1",children:[e.jsx(qe,{className:"h-3 w-3"}),e.jsx("span",{children:i.municipality.name})]})]})]}),e.jsx("div",{className:"flex space-x-2",children:u?e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"outline",onClick:()=>{S(!1),m({fullName:(i==null?void 0:i.fullName)||"",email:(i==null?void 0:i.email)||"",phone:(i==null?void 0:i.phone)||"",bio:(i==null?void 0:i.bio)||"",birthDate:(i==null?void 0:i.birthDate)||"",gender:(i==null?void 0:i.gender)||""})},children:"Cancelar"}),e.jsxs(c,{onClick:z,disabled:v.isPending,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),v.isPending?"Guardando...":"Guardar"]})]}):e.jsxs(c,{onClick:()=>S(!0),children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Editar Perfil"]})})]})})}),e.jsxs(se,{defaultValue:"info",className:"w-full",children:[e.jsxs(ae,{className:"grid w-full grid-cols-3",children:[e.jsx(K,{value:"info",children:"Información Personal"}),e.jsx(K,{value:"security",children:"Seguridad"}),e.jsx(K,{value:"activity",children:"Actividad"})]}),e.jsx(Y,{value:"info",className:"space-y-6",children:e.jsxs(h,{children:[e.jsxs($,{children:[e.jsx(O,{children:"Datos Personales"}),e.jsx(ee,{children:"Información básica de tu perfil"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"fullName",children:"Nombre Completo"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(ue,{className:"h-4 w-4 text-gray-400"}),u?e.jsx(H,{id:"fullName",value:d.fullName,onChange:a=>m(o=>({...o,fullName:a.target.value})),placeholder:"Tu nombre completo"}):e.jsx("span",{className:"text-gray-900",children:d.fullName||"No especificado"})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"email",children:"Correo Electrónico"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-400"}),u?e.jsx(H,{id:"email",type:"email",value:d.email,onChange:a=>m(o=>({...o,email:a.target.value})),placeholder:"tu@email.com"}):e.jsx("span",{className:"text-gray-900",children:d.email||"No especificado"})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"phone",children:"Teléfono"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(Fe,{className:"h-4 w-4 text-gray-400"}),u?e.jsx(H,{id:"phone",value:d.phone,onChange:a=>m(o=>({...o,phone:a.target.value})),placeholder:"Tu número de teléfono"}):e.jsx("span",{className:"text-gray-900",children:d.phone||"No especificado"})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"birthDate",children:"Fecha de Nacimiento"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(X,{className:"h-4 w-4 text-gray-400"}),u?e.jsx(H,{id:"birthDate",type:"date",value:d.birthDate?d.birthDate.split("T")[0]:"",onChange:a=>m(o=>({...o,birthDate:a.target.value}))}):e.jsx("span",{className:"text-gray-900",children:d.birthDate?M(new Date(d.birthDate),"dd/MM/yyyy",{locale:I}):"No especificado"})]})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"bio",children:"Biografía"}),e.jsx("div",{className:"mt-1",children:u?e.jsx(Ae,{id:"bio",value:d.bio,onChange:a=>m(o=>({...o,bio:a.target.value})),placeholder:"Cuéntanos sobre ti...",rows:4}):e.jsx("p",{className:"text-gray-900 bg-gray-50 p-3 rounded-md min-h-[100px]",children:d.bio||"No hay biografía disponible"})})]})]})]})}),e.jsx(Y,{value:"security",className:"space-y-6",children:e.jsxs(h,{children:[e.jsxs($,{children:[e.jsx(O,{children:"Configuración de Seguridad"}),e.jsx(ee,{children:"Gestiona tu contraseña y configuración de seguridad"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Te,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Contraseña"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Gestiona tu contraseña de acceso"})]})]}),e.jsx(c,{variant:"outline",onClick:()=>n(!0),children:"Cambiar Contraseña"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Le,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Rol del Sistema"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Tu nivel de acceso: ",s==null?void 0:s.role]})]})]}),t(s==null?void 0:s.role)]}),e.jsx("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ue,{className:"h-5 w-5 text-gray-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Información de la Cuenta"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Miembro desde: ",i!=null&&i.createdAt?M(new Date(i.createdAt),"MMMM yyyy",{locale:I}):"Fecha no disponible"]})]})]})})]})]})}),e.jsx(Y,{value:"activity",className:"space-y-6",children:e.jsxs(se,{defaultValue:"calendar",className:"w-full",children:[e.jsxs(ae,{className:"grid w-full grid-cols-2",children:[e.jsx(K,{value:"calendar",children:"Mi Calendario de Actividades"}),e.jsx(K,{value:"parks",children:"Mis Parques"})]}),e.jsx(Y,{value:"calendar",className:"mt-6",children:e.jsxs(h,{children:[e.jsxs($,{children:[e.jsx(O,{children:"Mi Calendario de Actividades"}),e.jsx(ee,{children:"Gestiona las actividades que te interesan y agrégalas a tu calendario personal"})]}),e.jsx(p,{children:e.jsx(Qe,{userId:s==null?void 0:s.id})})]})}),e.jsx(Y,{value:"parks",className:"mt-6",children:e.jsx(Ue,{userId:s==null?void 0:s.id})})]})})]})]}),e.jsx(ne,{open:w,onOpenChange:n,children:e.jsxs(ce,{children:[e.jsxs(de,{children:[e.jsx(oe,{children:"Cambiar Contraseña"}),e.jsx(xe,{children:"Ingresa tu contraseña actual y la nueva contraseña"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"currentPassword",children:"Contraseña Actual"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{id:"currentPassword",type:E?"text":"password",value:f.currentPassword,onChange:a=>g(o=>({...o,currentPassword:a.target.value})),placeholder:"Tu contraseña actual"}),e.jsx(c,{type:"button",variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 transform -translate-y-1/2",onClick:()=>q(!E),children:E?e.jsx($e,{className:"h-4 w-4"}):e.jsx(J,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"newPassword",children:"Nueva Contraseña"}),e.jsx(H,{id:"newPassword",type:"password",value:f.newPassword,onChange:a=>g(o=>({...o,newPassword:a.target.value})),placeholder:"Tu nueva contraseña"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"confirmPassword",children:"Confirmar Nueva Contraseña"}),e.jsx(H,{id:"confirmPassword",type:"password",value:f.confirmPassword,onChange:a=>g(o=>({...o,confirmPassword:a.target.value})),placeholder:"Confirma tu nueva contraseña"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(c,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"}),e.jsx(c,{onClick:D,disabled:C.isPending||!f.currentPassword||!f.newPassword,children:C.isPending?"Cambiando...":"Cambiar Contraseña"})]})]})})]})}export{Je as default};
