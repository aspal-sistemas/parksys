import{c as Y,a2 as N,u as V,j as e,B as o,f as r,g as i,h as c,ar as z,i as l,ah as T,bo as Z,bO as M,U as _,e as f,o as E,b1 as U,b2 as G,b3 as u,b4 as j,ab as m,aw as I,au as y,ay as q,aW as ee,r as se,G as ae,a1 as re,l as te,af as ne,ag as B,ai as ie,aj as C,ak as P,al as S,am as A,O as L,cu as k,an as F,ax as ce,ad as w,ap as le,aX as de,bp as H}from"./index-D5qLf1ib.js";import{P as oe}from"./progress-CD1SWYCP.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=Y("LockOpen",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);function me(){var d;const[t,g]=N.useState(30),{data:s,isLoading:R}=V({queryKey:["/api/security/admin/stats",t],queryFn:()=>fetch(`/api/security/admin/stats?days=${t}`).then(n=>n.json())}),{data:h,isLoading:v}=V({queryKey:["/api/security/admin/suspicious-activity"],queryFn:()=>fetch("/api/security/admin/suspicious-activity?hours=24").then(n=>n.json())});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Centro de Seguridad"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitoreo y gestión de la seguridad del sistema"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:t===7?"default":"outline",size:"sm",onClick:()=>g(7),children:"7 días"}),e.jsx(o,{variant:t===30?"default":"outline",size:"sm",onClick:()=>g(30),children:"30 días"}),e.jsx(o,{variant:t===90?"default":"outline",size:"sm",onClick:()=>g(90),children:"90 días"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-4",children:[e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Total Accesos"}),e.jsx(z,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.totalLogins)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Últimos ",t," días"]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Accesos Exitosos"}),e.jsx(T,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:(s==null?void 0:s.successfulLogins)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[((d=s==null?void 0:s.successRate)==null?void 0:d.toFixed(1))||0,"% tasa de éxito"]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Accesos Fallidos"}),e.jsx(Z,{className:"h-4 w-4 text-red-500"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:(s==null?void 0:s.failedLogins)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s!=null&&s.totalLogins?(s.failedLogins/s.totalLogins*100).toFixed(1):0,"% del total"]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Cuentas Bloqueadas"}),e.jsx(M,{className:"h-4 w-4 text-orange-500"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:(s==null?void 0:s.activeLockouts)||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Actualmente activas"})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Usuarios Activos"}),e.jsx(_,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(l,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(s==null?void 0:s.activeUsers)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Últimos ",t," días"]})]})]}),e.jsxs(r,{children:[e.jsxs(i,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium",children:"Estado General"}),e.jsx(f,{className:`h-4 w-4 ${((s==null?void 0:s.activeLockouts)||0)===0?"text-green-500":"text-yellow-500"}`})]}),e.jsxs(l,{children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(E,{variant:((s==null?void 0:s.activeLockouts)||0)===0?"default":"secondary",children:((s==null?void 0:s.activeLockouts)||0)===0?"Seguro":"Alerta"})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Sistema ",((s==null?void 0:s.activeLockouts)||0)===0?"protegido":"monitoreado"]})]})]})]}),e.jsxs(U,{defaultValue:"activity",className:"space-y-4",children:[e.jsxs(G,{children:[e.jsx(u,{value:"activity",children:"Actividad Reciente"}),e.jsx(u,{value:"suspicious",children:"Actividad Sospechosa"}),e.jsx(u,{value:"tools",children:"Herramientas"})]}),e.jsx(j,{value:"activity",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Actividad del Sistema"}),e.jsx(m,{children:"Registro de eventos de seguridad más recientes"})]}),e.jsx(l,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs(I,{children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx(q,{children:"Próximamente: Visualización detallada de la actividad del sistema"})]})})})]})}),e.jsx(j,{value:"suspicious",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Actividad Sospechosa"}),e.jsx(m,{children:"Intentos de acceso fallidos en las últimas 24 horas"})]}),e.jsx(l,{children:v?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Cargando actividad sospechosa..."})]}):h&&h.length>0?e.jsx("div",{className:"space-y-3",children:h.slice(0,10).map(n=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ee,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.username}),e.jsx("p",{className:"text-sm text-gray-500",children:n.ipAddress})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(E,{variant:"destructive",children:n.failureReason||"Error de acceso"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:se(new Date(n.attemptedAt),"dd/MM/yyyy HH:mm",{locale:re})})]})]},n.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("p",{className:"text-lg font-medium",children:"Sin actividad sospechosa"}),e.jsx("p",{className:"text-gray-500",children:"No se han detectado intentos de acceso fallidos"})]})})]})}),e.jsx(j,{value:"tools",className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(xe,{className:"h-5 w-5"}),e.jsx("span",{children:"Desbloquear Cuentas"})]}),e.jsx(m,{children:"Herramienta para desbloquear cuentas de usuario"})]}),e.jsx(l,{children:e.jsx(o,{className:"w-full",children:"Gestionar Bloqueos"})})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-5 w-5"}),e.jsx("span",{children:"Auditoría"})]}),e.jsx(m,{children:"Revisar logs de auditoría del sistema"})]}),e.jsx(l,{children:e.jsx(o,{className:"w-full",variant:"outline",children:"Ver Auditoría"})})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(ae,{className:"h-5 w-5"}),e.jsx("span",{children:"Análisis IP"})]}),e.jsx(m,{children:"Analizar patrones de acceso por IP"})]}),e.jsx(l,{children:e.jsx(o,{className:"w-full",variant:"outline",children:"Analizar IPs"})})]})]})})]})]})}const he=w.object({currentPassword:w.string().min(1,"Contraseña actual requerida"),newPassword:w.string().min(8,"La nueva contraseña debe tener al menos 8 caracteres"),confirmPassword:w.string().min(1,"Confirmar nueva contraseña requerida")}).refine(t=>t.newPassword===t.confirmPassword,{message:"Las contraseñas no coinciden",path:["confirmPassword"]});function ue(){const[t,g]=N.useState(!1),[s,R]=N.useState(!1),[h,v]=N.useState(!1),[d,n]=N.useState(null),{toast:D}=te(),x=ne({resolver:le(he),defaultValues:{currentPassword:"",newPassword:"",confirmPassword:""}}),{mutate:$}=B({mutationFn:async a=>(await fetch("/api/security/validate-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:a})})).json(),onSuccess:a=>{n(a)}}),b=B({mutationFn:async a=>{const p=await fetch("/api/security/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:a.currentPassword,newPassword:a.newPassword})}),O=await p.json();if(!p.ok)throw new Error(O.error||"Error al cambiar contraseña");return O},onSuccess:()=>{D({title:"Contraseña actualizada",description:"Tu contraseña se ha cambiado correctamente"}),x.reset(),n(null)},onError:a=>{D({title:"Error",description:a.message,variant:"destructive"})}}),J=a=>{b.mutate(a)},K=a=>{x.setValue("newPassword",a),a.length>0?$(a):n(null)},X=a=>{switch(a){case"weak":return"text-red-500";case"medium":return"text-yellow-500";case"strong":return"text-green-500";default:return"text-gray-500"}},Q=a=>{switch(a){case"weak":return 25;case"medium":return 60;case"strong":return 100;default:return 0}},W=a=>{switch(a){case"weak":return"destructive";case"medium":return"secondary";case"strong":return"default";default:return"outline"}};return e.jsxs("div",{className:"max-w-2xl mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cambiar Contraseña"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Actualiza tu contraseña para mantener tu cuenta segura"})]}),e.jsxs(I,{children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx(q,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium",children:"Recomendaciones de seguridad:"}),e.jsxs("ul",{className:"text-sm space-y-1 ml-4",children:[e.jsx("li",{children:"• Usa al menos 8 caracteres"}),e.jsx("li",{children:"• Incluye mayúsculas, minúsculas, números y símbolos"}),e.jsx("li",{children:"• No uses información personal"}),e.jsx("li",{children:"• No reutilices contraseñas anteriores"})]})]})})]}),e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsxs(c,{className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-5 w-5"}),e.jsx("span",{children:"Cambiar Contraseña"})]}),e.jsx(m,{children:"Ingresa tu contraseña actual y define una nueva contraseña segura"})]}),e.jsx(l,{children:e.jsx(ie,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(J),className:"space-y-6",children:[e.jsx(C,{control:x.control,name:"currentPassword",render:({field:a})=>e.jsxs(P,{children:[e.jsx(S,{children:"Contraseña Actual"}),e.jsx(A,{children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:t?"text":"password",placeholder:"Ingresa tu contraseña actual",...a}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>g(!t),children:t?e.jsx(k,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]})}),e.jsx(F,{})]})}),e.jsx(C,{control:x.control,name:"newPassword",render:({field:a})=>e.jsxs(P,{children:[e.jsx(S,{children:"Nueva Contraseña"}),e.jsx(A,{children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:s?"text":"password",placeholder:"Ingresa tu nueva contraseña",...a,onChange:p=>{a.onChange(p),K(p.target.value)}}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>R(!s),children:s?e.jsx(k,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]})}),e.jsx(F,{}),d&&a.value.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm",children:"Fortaleza de contraseña:"}),e.jsxs(E,{variant:W(d.strength),children:[d.strength==="weak"&&"Débil",d.strength==="medium"&&"Media",d.strength==="strong"&&"Fuerte"]})]}),e.jsx(oe,{value:Q(d.strength),className:"h-2"}),e.jsx("p",{className:`text-sm ${X(d.strength)}`,children:d.message})]})]})}),e.jsx(C,{control:x.control,name:"confirmPassword",render:({field:a})=>e.jsxs(P,{children:[e.jsx(S,{children:"Confirmar Nueva Contraseña"}),e.jsx(A,{children:e.jsxs("div",{className:"relative",children:[e.jsx(L,{type:h?"text":"password",placeholder:"Confirma tu nueva contraseña",...a}),e.jsx(o,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3",onClick:()=>v(!h),children:h?e.jsx(k,{className:"h-4 w-4"}):e.jsx(y,{className:"h-4 w-4"})})]})}),e.jsx(F,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>{x.reset(),n(null)},children:"Cancelar"}),e.jsx(o,{type:"submit",disabled:b.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Cambiando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Cambiar Contraseña"]})})]})]})})})]}),e.jsxs(I,{children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsxs(q,{children:[e.jsx("strong",{children:"Nota:"})," Después de cambiar tu contraseña, podrías necesitar iniciar sesión nuevamente en otros dispositivos."]})]})]})}function ge(){return e.jsx(de,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(r,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Módulo de Seguridad"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Centro de control de seguridad y monitoreo del sistema"})]}),e.jsxs(U,{defaultValue:"dashboard",className:"space-y-6",children:[e.jsxs(G,{className:"grid w-full grid-cols-4",children:[e.jsxs(u,{value:"dashboard",className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:"Dashboard"})]}),e.jsxs(u,{value:"password",className:"flex items-center space-x-2",children:[e.jsx(M,{className:"h-4 w-4"}),e.jsx("span",{children:"Contraseña"})]}),e.jsxs(u,{value:"audit",className:"flex items-center space-x-2",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx("span",{children:"Auditoría"})]}),e.jsxs(u,{value:"settings",className:"flex items-center space-x-2",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx("span",{children:"Configuración"})]})]}),e.jsx(j,{value:"dashboard",children:e.jsx(me,{})}),e.jsx(j,{value:"password",children:e.jsx(ue,{})}),e.jsx(j,{value:"audit",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Registro de Auditoría"}),e.jsx(m,{children:"Historial completo de eventos de seguridad del sistema"})]}),e.jsx(l,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(f,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Función en Desarrollo"}),e.jsx("p",{className:"text-gray-500",children:"El registro de auditoría estará disponible próximamente con filtros avanzados y exportación de reportes."})]})})]})}),e.jsx(j,{value:"settings",className:"space-y-4",children:e.jsxs(r,{children:[e.jsxs(i,{children:[e.jsx(c,{children:"Configuración de Seguridad"}),e.jsx(m,{children:"Ajustes globales de políticas de seguridad del sistema"})]}),e.jsx(l,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Configuración Avanzada"}),e.jsx("p",{className:"text-gray-500",children:"Las configuraciones de seguridad estarán disponibles próximamente para administradores del sistema."})]})})]})})]})]})})}export{ge as default};
