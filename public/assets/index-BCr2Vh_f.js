import{ad as r,aC as ne,az as re,l as ie,ae as oe,a2 as L,af as ce,u as F,j as e,aX as G,aw as te,aW as de,dz as ue,ay as he,B as m,A as Q,dx as xe,ai as me,b1 as je,b2 as ge,b3 as A,b4 as T,f as R,g as U,h as z,ab as V,i as O,aj as i,ak as o,al as c,Q as f,am as t,V as C,W as y,Y as N,aB as $,_ as E,aF as d,an as u,M as J,O as j,$ as M,cc as H,ao as S,ap as pe,aq as ve}from"./index-D5qLf1ib.js";import{H as be}from"./Helmet-BNepwt1P.js";import{D as W}from"./date-picker-BGQBE3iK.js";import{S as fe}from"./separator-Bek7HtsH.js";import{S as g}from"./skeleton-XQWc31Aw.js";import{R as Ce}from"./ruler-CydzKUS0.js";const ye=r.object({speciesId:r.string().min(1,{message:"Debe seleccionar una especie"}),parkId:r.string().min(1,{message:"Debe seleccionar un parque"}),latitude:r.string().min(1,{message:"La latitud es obligatoria"}),longitude:r.string().min(1,{message:"La longitud es obligatoria"}),plantingDate:r.date().nullable(),developmentStage:r.string().nullable(),ageEstimate:r.coerce.number().int().nullable(),height:r.coerce.number().positive().nullable(),diameter:r.coerce.number().positive().nullable(),canopyCoverage:r.coerce.number().positive().nullable(),healthStatus:r.string(),physicalCondition:r.string().nullable(),hasHollows:r.boolean().default(!1),hasExposedRoots:r.boolean().default(!1),hasPests:r.boolean().default(!1),observations:r.string().nullable(),lastInspectionDate:r.date().nullable(),isProtected:r.boolean().default(!1),locationDescription:r.string().nullable(),imageUrl:r.string().nullable()});function qe(){const[Ne,D]=ne("/admin/trees/inventory/:id/edit"),[,p]=re(),{toast:v}=ie(),B=oe(),[X,b]=L.useState("location"),[K,w]=L.useState(!1),x=D==null?void 0:D.id,n=ce({resolver:pe(ye),defaultValues:{speciesId:"",parkId:"",latitude:"",longitude:"",plantingDate:null,developmentStage:"",ageEstimate:null,height:null,diameter:null,canopyCoverage:null,healthStatus:"Bueno",physicalCondition:"",hasHollows:!1,hasExposedRoots:!1,hasPests:!1,observations:"",lastInspectionDate:null,isProtected:!1,locationDescription:"",imageUrl:""}}),{data:I,isLoading:k,error:Y}=F({queryKey:[`/api/trees/${x}`],queryFn:async()=>{const a=await fetch(`/api/trees/${x}`);if(!a.ok)throw new Error("Error al cargar la informaci칩n del 치rbol");return a.json()},enabled:!!x}),l=I==null?void 0:I.data,{data:P,isLoading:_}=F({queryKey:["/api/tree-species"],queryFn:async()=>{const a=await fetch("/api/tree-species");if(!a.ok)throw new Error("Error al cargar las especies arb칩reas");return a.json()}}),{data:q,isLoading:Z}=F({queryKey:["/api/parks"],queryFn:async()=>{const a=await fetch("/api/parks");if(!a.ok)throw new Error("Error al cargar los parques");return a.json()}});L.useEffect(()=>{var a,s;if(l){console.log("Datos del 치rbol recibidos de la API:",l);const h=l.plantingDate?new Date(l.plantingDate):null;n.reset({speciesId:((a=l.speciesId)==null?void 0:a.toString())||"",parkId:((s=l.parkId)==null?void 0:s.toString())||"",latitude:l.latitude||"",longitude:l.longitude||"",plantingDate:h,developmentStage:l.developmentStage||"",ageEstimate:l.ageEstimate?Number(l.ageEstimate):null,height:l.height?Number(l.height):null,diameter:l.diameter?Number(l.diameter):null,canopyCoverage:l.canopyCoverage?Number(l.canopyCoverage):null,healthStatus:l.healthStatus||"Bueno",physicalCondition:l.condition||"",hasHollows:l.hasHollows||!1,hasExposedRoots:l.hasExposedRoots||!1,hasPests:l.hasPests||!1,observations:l.notes||"",lastInspectionDate:null,isProtected:l.isProtected||!1,locationDescription:l.locationDescription||"",imageUrl:l.imageUrl||""})}},[l,n]);const ee=async a=>{console.log("游꺕 onSubmit LLAMADO - Iniciando proceso de guardado"),console.log("游꺕 Estado del formulario:",n.formState),console.log("游꺕 Errores del formulario:",n.formState.errors);try{console.log("游꺕 Datos del formulario antes de formatear:",a);const s={...a,speciesId:parseInt(a.speciesId),parkId:parseInt(a.parkId)};console.log("游꺕 Datos formateados que se enviar치n:",s),console.log("游꺕 Realizando petici칩n PUT a:",`/api/trees/${x}`),await ve(`/api/trees/${x}`,{method:"PUT",data:s}),v({title:"츼rbol actualizado",description:"Los cambios han sido guardados correctamente.",variant:"success"}),B.invalidateQueries({queryKey:[`/api/trees/${x}`]}),B.invalidateQueries({queryKey:["/api/trees"]}),p(`/admin/trees/inventory/${x}`)}catch(s){console.error("Error al actualizar el 치rbol:",s),v({title:"Error",description:"No se pudieron guardar los cambios. Por favor, intenta nuevamente.",variant:"destructive"})}},ae=()=>{navigator.geolocation?(w(!0),navigator.geolocation.getCurrentPosition(a=>{n.setValue("latitude",a.coords.latitude.toString()),n.setValue("longitude",a.coords.longitude.toString()),w(!1),v({title:"Ubicaci칩n obtenida",description:"Las coordenadas de tu ubicaci칩n actual han sido capturadas.",variant:"success"})},a=>{console.error("Error al obtener la ubicaci칩n:",a),w(!1),v({title:"Error de geolocalizaci칩n",description:"No se pudo obtener tu ubicaci칩n actual. Por favor, ingresa las coordenadas manualmente.",variant:"destructive"})})):v({title:"Geolocalizaci칩n no soportada",description:"Tu navegador no soporta la geolocalizaci칩n. Por favor, ingresa las coordenadas manualmente.",variant:"destructive"})},se=[{value:"Juvenil",label:"Juvenil"},{value:"Maduro",label:"Maduro"},{value:"Senescente",label:"Senescente"}],le=[{value:"Bueno",label:"Bueno"},{value:"Regular",label:"Regular"},{value:"Malo",label:"Malo"},{value:"Cr칤tico",label:"Cr칤tico"}];return Y?e.jsx(G,{children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs(te,{variant:"destructive",className:"mb-4",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx(ue,{children:"Error"}),e.jsx(he,{children:"No se pudo cargar la informaci칩n del 치rbol. Verifica que el ID sea correcto."})]}),e.jsxs(m,{onClick:()=>p("/admin/trees/inventory"),variant:"outline",className:"mt-4",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"})," Volver al Inventario"]})]})}):e.jsxs(G,{children:[e.jsxs(be,{children:[e.jsx("title",{children:k?"Cargando...":`Editar 츼rbol ${l.code} | Inventario Arb칩reo | ParquesMX`}),e.jsx("meta",{name:"description",content:"Editar informaci칩n del 치rbol en el inventario de parques municipales"})]}),e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>p(`/admin/trees/inventory/${x}`),className:"mr-2",children:e.jsx(Q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[k?e.jsx(g,{className:"h-8 w-64"}):e.jsxs("h1",{className:"text-3xl font-bold text-green-800 flex items-center",children:[e.jsx(xe,{className:"mr-2 h-8 w-8"}),"Editar 츼rbol: ",l.code]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Actualiza la informaci칩n del 치rbol en el inventario"})]})]}),k?e.jsxs("div",{className:"space-y-6",children:[e.jsx(g,{className:"h-[300px] w-full rounded-lg"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx(g,{className:"h-12 w-full rounded-md"}),e.jsx(g,{className:"h-12 w-full rounded-md"}),e.jsx(g,{className:"h-12 w-full rounded-md"})]}),e.jsx(g,{className:"h-[400px] w-full rounded-lg"})]}):e.jsx(me,{...n,children:e.jsx("form",{onSubmit:n.handleSubmit(ee),className:"space-y-6",children:e.jsxs(je,{defaultValue:"location",value:X,onValueChange:b,children:[e.jsxs(ge,{className:"grid grid-cols-3 mb-4",children:[e.jsx(A,{value:"location",children:"Ubicaci칩n"}),e.jsx(A,{value:"characteristics",children:"Caracter칤sticas"}),e.jsx(A,{value:"health",children:"Estado y Observaciones"})]}),e.jsx(T,{value:"location",children:e.jsxs(R,{children:[e.jsxs(U,{children:[e.jsx(z,{children:"Datos de Ubicaci칩n"}),e.jsx(V,{children:"Informaci칩n sobre la ubicaci칩n del 치rbol en el parque"})]}),e.jsxs(O,{className:"space-y-4",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(i,{control:n.control,name:"parkId",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Parque*"}),e.jsxs(f,{onValueChange:a.onChange,value:a.value,children:[e.jsx(t,{children:e.jsx(C,{children:e.jsx(y,{placeholder:"Selecciona un parque"})})}),e.jsx(N,{children:Z?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx($,{className:"h-6 w-6 animate-spin text-gray-500"})}):q==null?void 0:q.map(s=>e.jsx(E,{value:s.id.toString(),children:s.name},s.id))})]}),e.jsx(d,{children:"Parque donde se encuentra el 치rbol"}),e.jsx(u,{})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:n.control,name:"speciesId",render:({field:a})=>{var s;return e.jsxs(o,{children:[e.jsx(c,{children:"Especie*"}),e.jsxs(f,{onValueChange:a.onChange,value:a.value,children:[e.jsx(t,{children:e.jsx(C,{children:e.jsx(y,{placeholder:"Selecciona una especie"})})}),e.jsx(N,{children:_?e.jsx("div",{className:"flex items-center justify-center p-4",children:e.jsx($,{className:"h-6 w-6 animate-spin text-gray-500"})}):(s=P==null?void 0:P.data)==null?void 0:s.map(h=>e.jsxs(E,{value:h.id.toString(),children:[h.commonName," (",h.scientificName,")"]},h.id))})]}),e.jsx(d,{children:"Especie a la que pertenece el 치rbol"}),e.jsx(u,{})]})}}),e.jsx(i,{control:n.control,name:"plantingDate",render:({field:a})=>e.jsxs(o,{className:"flex flex-col",children:[e.jsx(c,{children:"Fecha de Plantaci칩n"}),e.jsx(t,{children:e.jsx(W,{selected:a.value,onSelect:a.onChange,placeholder:"Selecciona una fecha"})}),e.jsx(d,{children:"Fecha en que se plant칩 el 치rbol (si se conoce)"}),e.jsx(u,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center",children:[e.jsx(J,{className:"h-5 w-5 mr-2 text-green-600"}),"Geolocalizaci칩n"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Coordenadas exactas donde se encuentra el 치rbol"})]}),e.jsx(m,{type:"button",variant:"outline",onClick:ae,disabled:K,children:K?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}),"Obteniendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Usar mi ubicaci칩n"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:n.control,name:"latitude",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Latitud*"}),e.jsx(t,{children:e.jsx(j,{placeholder:"Ej: 20.6736",...a})}),e.jsx(u,{})]})}),e.jsx(i,{control:n.control,name:"longitude",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Longitud*"}),e.jsx(t,{children:e.jsx(j,{placeholder:"Ej: -103.3456",...a})}),e.jsx(u,{})]})})]})]}),e.jsx(i,{control:n.control,name:"locationDescription",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Descripci칩n de la Ubicaci칩n"}),e.jsx(t,{children:e.jsx(M,{placeholder:"Describe la ubicaci칩n del 치rbol dentro del parque...",...a,value:a.value||""})}),e.jsx(d,{children:'Descripci칩n que ayude a ubicar el 치rbol (ej: "Cerca de la entrada principal")'}),e.jsx(u,{})]})})]})]}),e.jsxs(H,{className:"flex justify-between",children:[e.jsx(m,{variant:"outline",onClick:()=>p(`/admin/trees/inventory/${x}`),children:"Cancelar"}),e.jsx(m,{type:"button",onClick:()=>b("characteristics"),children:"Siguiente"})]})]})}),e.jsx(T,{value:"characteristics",children:e.jsxs(R,{children:[e.jsxs(U,{children:[e.jsx(z,{children:"Caracter칤sticas F칤sicas"}),e.jsx(V,{children:"Informaci칩n sobre las caracter칤sticas f칤sicas y dimensiones del 치rbol"})]}),e.jsxs(O,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{control:n.control,name:"developmentStage",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Etapa de Desarrollo"}),e.jsxs(f,{onValueChange:a.onChange,value:a.value||"",children:[e.jsx(t,{children:e.jsx(C,{children:e.jsx(y,{placeholder:"Selecciona una etapa"})})}),e.jsx(N,{children:se.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))})]}),e.jsx(d,{children:"Etapa actual de desarrollo del 치rbol"}),e.jsx(u,{})]})}),e.jsx(i,{control:n.control,name:"ageEstimate",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Edad Estimada (a침os)"}),e.jsx(t,{children:e.jsx(j,{type:"number",min:"0",placeholder:"Ej: 15",...a,value:a.value===null?"":a.value,onChange:s=>{const h=s.target.value===""?null:parseInt(s.target.value);a.onChange(h)}})}),e.jsx(d,{children:"Edad aproximada del 치rbol en a침os"}),e.jsx(u,{})]})}),e.jsx(i,{control:n.control,name:"imageUrl",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"URL de Imagen"}),e.jsx(t,{children:e.jsx(j,{placeholder:"https://ejemplo.com/imagen.jpg",...a,value:a.value||""})}),e.jsx(d,{children:"URL de una fotograf칤a del 치rbol"}),e.jsx(u,{})]})})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center mb-4",children:[e.jsx(Ce,{className:"h-5 w-5 mr-2 text-green-600"}),"Dimensiones"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{control:n.control,name:"height",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Altura (metros)"}),e.jsx(t,{children:e.jsx(j,{type:"number",step:"0.1",min:"0",placeholder:"Ej: 12.5",...a,value:a.value===null?"":a.value,onChange:s=>{const h=s.target.value===""?null:parseFloat(s.target.value);a.onChange(h)}})}),e.jsx(d,{children:"Altura aproximada en metros"}),e.jsx(u,{})]})}),e.jsx(i,{control:n.control,name:"diameter",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Di치metro del Tronco (cm)"}),e.jsx(t,{children:e.jsx(j,{type:"number",step:"0.1",min:"0",placeholder:"Ej: 45.2",...a,value:a.value===null?"":a.value,onChange:s=>{const h=s.target.value===""?null:parseFloat(s.target.value);a.onChange(h)}})}),e.jsx(d,{children:"Di치metro a la altura del pecho (DAP)"}),e.jsx(u,{})]})}),e.jsx(i,{control:n.control,name:"canopyCoverage",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Cobertura de Copa (m)"}),e.jsx(t,{children:e.jsx(j,{type:"number",step:"0.1",min:"0",placeholder:"Ej: 28.3",...a,value:a.value===null?"":a.value,onChange:s=>{const h=s.target.value===""?null:parseFloat(s.target.value);a.onChange(h)}})}),e.jsx(d,{children:"츼rea que cubre la copa en metros cuadrados"}),e.jsx(u,{})]})})]})]})]}),e.jsxs(H,{className:"flex justify-between",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>b("location"),children:"Anterior"}),e.jsx(m,{type:"button",onClick:()=>b("health"),children:"Siguiente"})]})]})}),e.jsx(T,{value:"health",children:e.jsxs(R,{children:[e.jsxs(U,{children:[e.jsx(z,{children:"Estado y Observaciones"}),e.jsx(V,{children:"Informaci칩n sobre el estado de salud del 치rbol y observaciones adicionales"})]}),e.jsxs(O,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:n.control,name:"healthStatus",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Estado de Salud"}),e.jsxs(f,{onValueChange:a.onChange,value:a.value,children:[e.jsx(t,{children:e.jsx(C,{children:e.jsx(y,{placeholder:"Selecciona un estado"})})}),e.jsx(N,{children:le.map(s=>e.jsx(E,{value:s.value,children:s.label},s.value))})]}),e.jsx(d,{children:"Evaluaci칩n general del estado del 치rbol"}),e.jsx(u,{})]})}),e.jsx(i,{control:n.control,name:"lastInspectionDate",render:({field:a})=>e.jsxs(o,{className:"flex flex-col",children:[e.jsx(c,{children:"Fecha de 칔ltima Inspecci칩n"}),e.jsx(t,{children:e.jsx(W,{selected:a.value,onSelect:a.onChange,placeholder:"Selecciona una fecha"})}),e.jsx(d,{children:"Fecha de la 칰ltima inspecci칩n realizada"}),e.jsx(u,{})]})})]}),e.jsx(i,{control:n.control,name:"physicalCondition",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Condici칩n F칤sica"}),e.jsx(t,{children:e.jsx(M,{placeholder:"Describe la condici칩n f칤sica del 치rbol...",...a,value:a.value||""})}),e.jsx(d,{children:"Detalles sobre la condici칩n f칤sica (inclinaci칩n, vigor, etc.)"}),e.jsx(u,{})]})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Condiciones Espec칤ficas"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(i,{control:n.control,name:"hasHollows",render:({field:a})=>e.jsxs(o,{className:"flex flex-row items-start space-x-3 space-y-0 p-4",children:[e.jsx(t,{children:e.jsx(S,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(c,{children:"Presencia de Huecos"}),e.jsx(d,{children:"El 치rbol tiene cavidades o huecos"})]})]})}),e.jsx(i,{control:n.control,name:"hasExposedRoots",render:({field:a})=>e.jsxs(o,{className:"flex flex-row items-start space-x-3 space-y-0 p-4",children:[e.jsx(t,{children:e.jsx(S,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(c,{children:"Ra칤ces Expuestas"}),e.jsx(d,{children:"El 치rbol tiene ra칤ces visibles en superficie"})]})]})}),e.jsx(i,{control:n.control,name:"hasPests",render:({field:a})=>e.jsxs(o,{className:"flex flex-row items-start space-x-3 space-y-0 p-4",children:[e.jsx(t,{children:e.jsx(S,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(c,{children:"Presencia de Plagas"}),e.jsx(d,{children:"El 치rbol tiene signos de plagas o enfermedades"})]})]})})]})]}),e.jsx(fe,{}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(i,{control:n.control,name:"observations",render:({field:a})=>e.jsxs(o,{children:[e.jsx(c,{children:"Observaciones Adicionales"}),e.jsx(t,{children:e.jsx(M,{placeholder:"Observaciones adicionales sobre el 치rbol...",className:"min-h-[100px]",...a,value:a.value||""})}),e.jsx(d,{children:"Cualquier informaci칩n adicional relevante"}),e.jsx(u,{})]})}),e.jsx(i,{control:n.control,name:"isProtected",render:({field:a})=>e.jsxs(o,{className:"flex flex-row items-start space-x-3 space-y-0 p-4 border border-green-200 bg-green-50 rounded-lg",children:[e.jsx(t,{children:e.jsx(S,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(c,{className:"text-green-800",children:"츼rbol con Protecci칩n Especial"}),e.jsx(d,{className:"text-green-700",children:"Marcar si el 치rbol tiene alguna designaci칩n especial de protecci칩n"})]})]})})]})]}),e.jsxs(H,{className:"flex justify-between",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>p(`/admin/trees/inventory/${x}`),children:"Cancelar"}),e.jsx(m,{type:"button",variant:"outline",onClick:()=>b("characteristics"),children:"Anterior"})]}),e.jsx(m,{type:"submit",className:"bg-green-600 hover:bg-green-700",onClick:()=>console.log("游꺕 BOT칍N GUARDAR CLICKEADO"),children:"Guardar Cambios"})]})]})})]})})})]})]})}export{qe as default};
