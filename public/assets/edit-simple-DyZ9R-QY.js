import{cl as L,al as K,e as P,a6 as z,Y as A,u as p,a8 as T,j as e,B as C,A as O,C as R,a as $,b as B,c as F,y as s,I as o,z as u,H as h,J as x,K as m,N as l,O as f,ah as w}from"./index-BBGHPKhn.js";import{S as M}from"./save-BO66L-dX.js";function H(){const[,v]=L("/admin/assets/:id/edit-simple"),[,I]=K(),{toast:c}=P(),q=z(),r=v==null?void 0:v.id,[i,D]=A.useState({name:"",description:"",serialNumber:"",parkId:"",categoryId:"",amenityId:"",status:"activo",condition:"bueno",acquisitionDate:"",acquisitionCost:"",currentValue:"",location:"",latitude:"",longitude:"",notes:""}),{data:n,isLoading:V}=p({queryKey:[`/api/assets/${r}`],enabled:!!r}),{data:b}=p({queryKey:["/api/parks"]}),{data:N}=p({queryKey:["/api/asset-categories"]});A.useEffect(()=>{var a,j,g,S,E;n&&D({name:n.name||"",description:n.description||"",serialNumber:n.serialNumber||"",parkId:((a=n.parkId)==null?void 0:a.toString())||"",categoryId:((j=n.categoryId)==null?void 0:j.toString())||"",amenityId:((g=n.amenityId)==null?void 0:g.toString())||"",status:n.status||"activo",condition:n.condition||"bueno",acquisitionDate:n.acquisitionDate||"",acquisitionCost:((S=n.acquisitionCost)==null?void 0:S.toString())||"",currentValue:((E=n.currentValue)==null?void 0:E.toString())||"",location:n.location||"",latitude:n.latitude||"",longitude:n.longitude||"",notes:n.notes||""})},[n]);const{data:y}=p({queryKey:[`/api/parks/${i.parkId}/amenities`],enabled:!!i.parkId}),d=T({mutationFn:a=>(console.log("=== ENVIANDO DATOS AL BACKEND ===",a),w(`/api/assets/${r}`,"PUT")),onSuccess:()=>{q.invalidateQueries({queryKey:[`/api/assets/${r}`]}),q.invalidateQueries({queryKey:["/api/assets"]}),c({title:"Activo actualizado",description:"El activo se ha actualizado correctamente."}),I(`/admin/assets/${r}`)},onError:a=>{console.error("Error al actualizar:",a),c({title:"Error",description:"Ha ocurrido un error al actualizar el activo.",variant:"destructive"})}}),k=()=>{if(console.log("=== INICIANDO ENVÍO SIMPLE ==="),console.log("ID del activo:",r),console.log("Parámetros de la URL:",v),console.log("Datos del formulario:",i),!r||isNaN(Number(r))){c({title:"Error",description:"ID de activo no válido.",variant:"destructive"});return}if(!i.name.trim()){c({title:"Error",description:"El nombre es obligatorio.",variant:"destructive"});return}if(!i.parkId){c({title:"Error",description:"Debe seleccionar un parque.",variant:"destructive"});return}if(!i.categoryId){c({title:"Error",description:"Debe seleccionar una categoría.",variant:"destructive"});return}const a={name:i.name.trim(),description:i.description||null,serialNumber:i.serialNumber||null,parkId:Number(i.parkId),categoryId:Number(i.categoryId),amenityId:i.amenityId&&i.amenityId!=="none"?Number(i.amenityId):null,status:i.status,condition:i.condition,acquisitionDate:i.acquisitionDate||null,acquisitionCost:i.acquisitionCost?parseFloat(i.acquisitionCost):null,currentValue:i.currentValue?parseFloat(i.currentValue):null,location:i.location||null,latitude:i.latitude||null,longitude:i.longitude||null,notes:i.notes||null};console.log("Datos procesados:",a),d.mutate(a)},t=(a,j)=>{D(g=>({...g,[a]:j}))};return V?e.jsx("div",{className:"container mx-auto py-8",children:e.jsx("div",{className:"text-center",children:"Cargando..."})}):e.jsxs("div",{className:"container mx-auto py-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsxs(C,{variant:"outline",size:"sm",onClick:()=>I(`/admin/assets/${r}`),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Editar Activo (Versión Simple)"})]}),e.jsxs(R,{children:[e.jsx($,{children:e.jsx(B,{children:"Información del Activo"})}),e.jsxs(F,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx(s,{children:"Nombre *"}),e.jsx(o,{value:i.name,onChange:a=>t("name",a.target.value),placeholder:"Nombre del activo"})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Número de Serie"}),e.jsx(o,{value:i.serialNumber,onChange:a=>t("serialNumber",a.target.value),placeholder:"Número de serie"})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Parque *"}),e.jsxs(u,{value:i.parkId,onValueChange:a=>t("parkId",a),children:[e.jsx(h,{children:e.jsx(x,{placeholder:"Seleccionar parque"})}),e.jsx(m,{children:b==null?void 0:b.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Categoría *"}),e.jsxs(u,{value:i.categoryId,onValueChange:a=>t("categoryId",a),children:[e.jsx(h,{children:e.jsx(x,{placeholder:"Seleccionar categoría"})}),e.jsx(m,{children:N==null?void 0:N.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Amenidad"}),e.jsxs(u,{value:i.amenityId,onValueChange:a=>t("amenityId",a),children:[e.jsx(h,{children:e.jsx(x,{placeholder:"Seleccionar amenidad"})}),e.jsxs(m,{children:[e.jsx(l,{value:"none",children:"Sin amenidad"}),y==null?void 0:y.map(a=>e.jsx(l,{value:a.id.toString(),children:a.name},a.id))]})]})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Estado"}),e.jsxs(u,{value:i.status,onValueChange:a=>t("status",a),children:[e.jsx(h,{children:e.jsx(x,{})}),e.jsxs(m,{children:[e.jsx(l,{value:"activo",children:"Activo"}),e.jsx(l,{value:"inactivo",children:"Inactivo"}),e.jsx(l,{value:"mantenimiento",children:"En Mantenimiento"})]})]})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Condición"}),e.jsxs(u,{value:i.condition,onValueChange:a=>t("condition",a),children:[e.jsx(h,{children:e.jsx(x,{})}),e.jsxs(m,{children:[e.jsx(l,{value:"excelente",children:"Excelente"}),e.jsx(l,{value:"bueno",children:"Bueno"}),e.jsx(l,{value:"regular",children:"Regular"}),e.jsx(l,{value:"malo",children:"Malo"})]})]})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Fecha de Adquisición"}),e.jsx(o,{type:"date",value:i.acquisitionDate,onChange:a=>t("acquisitionDate",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Costo de Adquisición"}),e.jsx(o,{type:"number",step:"0.01",value:i.acquisitionCost,onChange:a=>t("acquisitionCost",a.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Valor Actual"}),e.jsx(o,{type:"number",step:"0.01",value:i.currentValue,onChange:a=>t("currentValue",a.target.value),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Ubicación"}),e.jsx(o,{value:i.location,onChange:a=>t("location",a.target.value),placeholder:"Descripción de la ubicación"})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Latitud"}),e.jsx(o,{value:i.latitude,onChange:a=>t("latitude",a.target.value),placeholder:"19.4326"})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Longitud"}),e.jsx(o,{value:i.longitude,onChange:a=>t("longitude",a.target.value),placeholder:"-99.1332"})]})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Descripción"}),e.jsx(f,{value:i.description,onChange:a=>t("description",a.target.value),placeholder:"Descripción del activo",rows:3})]}),e.jsxs("div",{children:[e.jsx(s,{children:"Notas"}),e.jsx(f,{value:i.notes,onChange:a=>t("notes",a.target.value),placeholder:"Notas adicionales",rows:3})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsx(C,{variant:"outline",onClick:()=>I(`/admin/assets/${r}`),children:"Cancelar"}),e.jsxs(C,{onClick:()=>{console.log("=== BOTÓN CLICKEADO ==="),k()},disabled:d.isPending,children:[d.isPending?"Guardando...":"Guardar Cambios",e.jsx(M,{className:"ml-2 h-4 w-4"})]}),e.jsx(C,{onClick:()=>{console.log("=== PRUEBA DIRECTA ==="),console.log("ID:",r),console.log("Formulario:",i);const a={name:i.name+" (Actualizado)",description:i.description,serialNumber:i.serialNumber,parkId:Number(i.parkId),categoryId:Number(i.categoryId),amenityId:null,status:"activo",condition:"bueno",acquisitionDate:null,acquisitionCost:2500,currentValue:null,location:null,latitude:null,longitude:null,notes:"Actualizado desde formulario simple"};console.log("Enviando datos de prueba:",a),d.mutate(a)},variant:"secondary",disabled:d.isPending,children:"Prueba Directa"})]})]})]})]})}export{H as default};
