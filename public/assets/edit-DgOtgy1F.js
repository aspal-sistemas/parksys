import{az as H,l as _,ae as Z,a2 as p,u as U,ag as ee,j as e,aX as b,B as m,A as ae,f as j,g,h as N,t as B,i as v,a8 as se,a9 as ie,aa as re,O as o,aR as le,a3 as te,Q as R,V as G,W as M,Y,_ as d,o as ce,X as T,M as ne,$ as C,bG as oe}from"./index-D5qLf1ib.js";import{F as z}from"./file-symlink-BAMbNlkN.js";function pe(){var k,D,q;const[V,u]=H(),{toast:x}=_(),F=Z(),I=V.split("/"),h=I[I.length-1],[L,P]=p.useState(null),[f,w]=p.useState(""),[i,E]=p.useState({firstName:"",lastName:"",email:"",phone:"",specialties:[],experienceYears:1,bio:"",preferredParkId:void 0,qualifications:"",availability:"",hourlyRate:0,experience:"",profileImageFile:null,curriculumFile:null}),{data:c,isLoading:O,isError:K}=U({queryKey:[`/api/instructors/${h}`],enabled:!!h}),{data:n=[]}=U({queryKey:["/api/parks"]});p.useEffect(()=>{console.log("游댌 DEBUG: Parks data:",n),console.log("游댌 DEBUG: Parks count:",(n==null?void 0:n.length)||0),n&&n.length>0&&console.log("游댌 DEBUG: Primera park:",n[0])},[n]),p.useEffect(()=>{if(c&&typeof c=="object"){const a=c;console.log("游댌 DEBUG: Datos del instructor cargados:",a),console.log("游댌 DEBUG: preferredParkId:",a.preferredParkId,typeof a.preferredParkId);let s=[];if(a.specialties){if(Array.isArray(a.specialties))s=a.specialties;else if(typeof a.specialties=="string")try{if(a.specialties.startsWith("[")||a.specialties.startsWith("{")){const t=JSON.parse(a.specialties);s=Array.isArray(t)?t:[t]}else a.specialties.includes(",")?s=a.specialties.split(",").map(t=>t.trim()):s=[a.specialties.trim()]}catch{s=[a.specialties]}}const r={firstName:a.firstName||"",lastName:a.lastName||"",email:a.email||"",phone:a.phone||"",specialties:s,experienceYears:a.experienceYears||1,bio:a.bio||"",preferredParkId:a.preferredParkId||void 0,qualifications:a.qualifications||"",availability:a.availability||"",hourlyRate:a.hourlyRate||0,experience:a.experience||"",profileImageFile:null,curriculumFile:null};console.log("游댌 DEBUG: Form data preparada:",r),console.log("游댌 DEBUG: preferredParkId en form data:",r.preferredParkId,typeof r.preferredParkId),E(r),a.profileImageUrl&&P(a.profileImageUrl)}},[c]);const y=ee({mutationFn:async a=>{const s=new FormData;s.append("firstName",a.firstName),s.append("lastName",a.lastName),s.append("email",a.email),s.append("phone",a.phone||""),s.append("specialties",JSON.stringify(a.specialties)),s.append("experienceYears",a.experienceYears.toString()),s.append("bio",a.bio||""),s.append("qualifications",a.qualifications||""),s.append("availability",a.availability||""),s.append("hourlyRate",(a.hourlyRate||0).toString()),s.append("experience",a.experience||""),a.preferredParkId&&s.append("preferredParkId",a.preferredParkId.toString()),a.profileImageFile&&s.append("profileImage",a.profileImageFile),a.curriculumFile&&s.append("curriculum",a.curriculumFile);const r=await fetch(`/api/instructors/${h}`,{method:"PUT",body:s});if(!r.ok){const t=await r.json();throw new Error(t.message||"Error al actualizar instructor")}return await r.json()},onSuccess:()=>{x({title:"Instructor actualizado",description:"Los datos del instructor han sido actualizados exitosamente."}),F.invalidateQueries({queryKey:["/api/instructors"]}),F.invalidateQueries({queryKey:[`/api/instructors/${h}`]}),u("/admin/instructors")},onError:a=>{x({title:"Error al actualizar",description:a.message,variant:"destructive"})}}),l=(a,s)=>{E(r=>({...r,[a]:s}))},Q=a=>{var r;const s=(r=a.target.files)==null?void 0:r[0];if(s){const t=new FileReader;t.onload=W=>{var A;return P((A=W.target)==null?void 0:A.result)},t.readAsDataURL(s),l("profileImageFile",s)}},X=a=>{var r;const s=(r=a.target.files)==null?void 0:r[0];s&&l("curriculumFile",s)},S=()=>{if(f.trim()&&!i.specialties.includes(f.trim())){const a=[...i.specialties,f.trim()];l("specialties",a),w("")}},$=a=>{const s=i.specialties.filter(r=>r!==a);l("specialties",s)},J=a=>{if(a.preventDefault(),!i.firstName||!i.lastName||!i.email){x({title:"Campos requeridos",description:"Por favor completa los campos de nombre, apellido y email.",variant:"destructive"});return}if(i.specialties.length===0){x({title:"Especialidades requeridas",description:"Por favor agrega al menos una especialidad.",variant:"destructive"});return}y.mutate(i)};return O?e.jsx(b,{title:"Cargando...",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-[#00a587] mx-auto mb-4"}),e.jsx("p",{children:"Cargando datos del instructor..."})]})})}):K?e.jsx(b,{title:"Error",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-red-600 mb-4",children:"Error al cargar los datos del instructor"}),e.jsx(m,{onClick:()=>u("/admin/instructors"),children:"Volver a la lista"})]})})}):e.jsx(b,{title:"Editar Instructor",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsxs(m,{variant:"ghost",onClick:()=>u("/admin/instructors"),className:"mr-4",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Editar Instructor"}),e.jsxs("p",{className:"text-muted-foreground",children:["Actualiza la informaci칩n del instructor ",c==null?void 0:c.firstName," ",c==null?void 0:c.lastName]})]})]})}),e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(B,{className:"mr-2 h-5 w-5"}),"Foto de Perfil"]})}),e.jsx(v,{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[e.jsxs(se,{className:"h-32 w-32",children:[e.jsx(ie,{src:L||void 0}),e.jsxs(re,{className:"text-2xl",children:[(k=i.firstName)==null?void 0:k[0],(D=i.lastName)==null?void 0:D[0]]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{type:"file",accept:"image/*",onChange:Q,className:"hidden",id:"profile-image"}),e.jsx("label",{htmlFor:"profile-image",children:e.jsx(m,{type:"button",variant:"outline",size:"sm",asChild:!0,children:e.jsxs("span",{className:"cursor-pointer",children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Cambiar foto"]})})})]}),e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Formatos: JPG, PNG. M치x: 5MB"})]})})]})}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(B,{className:"mr-2 h-5 w-5"}),"Informaci칩n Personal"]})}),e.jsxs(v,{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"firstName",className:"text-sm font-medium",children:"Nombre *"}),e.jsx(o,{id:"firstName",placeholder:"Nombre del instructor",value:i.firstName,onChange:a=>l("firstName",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"lastName",className:"text-sm font-medium",children:"Apellido *"}),e.jsx(o,{id:"lastName",placeholder:"Apellido del instructor",value:i.lastName,onChange:a=>l("lastName",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email *"}),e.jsx(o,{id:"email",type:"email",placeholder:"email@ejemplo.com",value:i.email,onChange:a=>l("email",a.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium",children:"Tel칠fono"}),e.jsx(o,{id:"phone",placeholder:"(33) 1234-5678",value:i.phone,onChange:a=>l("phone",a.target.value)})]})]})]}),e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(te,{className:"mr-2 h-5 w-5"}),"Informaci칩n Profesional"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"experienceYears",className:"text-sm font-medium",children:"A침os de Experiencia"}),e.jsx(o,{id:"experienceYears",type:"number",min:"0",max:"50",value:i.experienceYears,onChange:a=>l("experienceYears",parseInt(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"hourlyRate",className:"text-sm font-medium",children:"Tarifa por Hora (MXN)"}),e.jsx(o,{id:"hourlyRate",type:"number",min:"0",placeholder:"0",value:i.hourlyRate,onChange:a=>l("hourlyRate",parseFloat(a.target.value)||0)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"availability",className:"text-sm font-medium",children:"Disponibilidad"}),e.jsxs(R,{value:i.availability,onValueChange:a=>l("availability",a),children:[e.jsx(G,{children:e.jsx(M,{placeholder:"Selecciona disponibilidad"})}),e.jsxs(Y,{children:[e.jsx(d,{value:"full-time",children:"Tiempo completo"}),e.jsx(d,{value:"part-time",children:"Medio tiempo"}),e.jsx(d,{value:"weekends",children:"Fines de semana"}),e.jsx(d,{value:"evenings",children:"Tardes"}),e.jsx(d,{value:"mornings",children:"Ma침anas"}),e.jsx(d,{value:"flexible",children:"Flexible"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Especialidades *"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(o,{placeholder:"Ej: Yoga, Danza, Deportes acu치ticos",value:f,onChange:a=>w(a.target.value),onKeyPress:a=>a.key==="Enter"&&(a.preventDefault(),S())}),e.jsx(m,{type:"button",onClick:S,variant:"outline",children:"Agregar"})]}),i.specialties.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:i.specialties.map((a,s)=>e.jsxs(ce,{variant:"secondary",className:"bg-[#00a587]/10 text-[#00a587]",children:[a,e.jsx("button",{type:"button",onClick:()=>$(a),className:"ml-2 hover:text-red-600",children:e.jsx(T,{className:"h-3 w-3"})})]},s))})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"Agrega las especialidades una por una"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"curriculumFile",className:"text-sm font-medium",children:"Curriculum Vitae"}),e.jsx("div",{className:"border border-gray-300 rounded-md p-4 bg-gray-50",children:i.curriculumFile?e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 truncate max-w-[200px]",children:i.curriculumFile.name})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700",onClick:()=>l("curriculumFile",null),children:e.jsx(T,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("label",{htmlFor:"curriculumUpload",className:"cursor-pointer inline-flex items-center gap-2 py-2 px-4 bg-white border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50",children:[e.jsx(z,{className:"h-4 w-4"}),"Subir CV",e.jsx("input",{id:"curriculumUpload",type:"file",accept:".pdf,.doc,.docx",className:"hidden",onChange:X})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Formatos: PDF, DOC, DOCX. M치x: 5MB"})]})})]})]})]}),e.jsxs(j,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(ne,{className:"mr-2 h-5 w-5"}),"Informaci칩n Adicional"]})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"preferredParkId",className:"text-sm font-medium",children:"Parque Preferido (Opcional)"}),e.jsxs(R,{value:(q=i.preferredParkId)==null?void 0:q.toString(),onValueChange:a=>l("preferredParkId",parseInt(a)),children:[e.jsx(G,{children:e.jsx(M,{placeholder:"Selecciona un parque"})}),e.jsx(Y,{children:n.map(a=>e.jsx(d,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx("p",{className:"text-xs text-gray-500",children:"El parque donde el instructor prefiere dar sus actividades"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"qualifications",className:"text-sm font-medium",children:"Certificaciones y Cualificaciones"}),e.jsx(C,{id:"qualifications",placeholder:"Describe las certificaciones, t칤tulos o cualificaciones del instructor...",value:i.qualifications,onChange:a=>l("qualifications",a.target.value),rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"experience",className:"text-sm font-medium",children:"Experiencia Profesional"}),e.jsx(C,{id:"experience",placeholder:"Describe la experiencia profesional, logros y 치reas de especializaci칩n...",value:i.experience,onChange:a=>l("experience",a.target.value),rows:4})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"bio",className:"text-sm font-medium",children:"Biograf칤a"}),e.jsx(C,{id:"bio",placeholder:"Describe la filosof칤a y enfoque del instructor...",value:i.bio,onChange:a=>l("bio",a.target.value),rows:3}),e.jsx("p",{className:"text-xs text-gray-500",children:"Esta informaci칩n ser치 visible en el perfil p칰blico del instructor"})]})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4 pt-6 border-t",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>u("/admin/instructors"),children:"Cancelar"}),e.jsxs(m,{type:"submit",disabled:y.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),y.isPending?"Guardando...":"Guardar Cambios"]})]})]})]})})}export{pe as default};
