import{a2 as g,l as ge,ae as pe,u as M,af as W,ag as R,j as e,aX as be,w as H,x as Ne,B as f,bh as ye,y as $,z as K,I as X,J as Y,ai as _,aj as n,ak as r,al as c,Q as D,am as t,V as I,W as w,Y as E,_ as o,an as l,O as p,$ as ee,M as Q,bC as se,a4 as Ce,f as fe,g as ve,h as Se,ab as De,i as Ie,bH as we,bI as Ee,bJ as z,bK as S,bL as ze,bM as b,F as Le,bq as ke,bn as Oe,b$ as Te,c1 as Ue,c2 as qe,c3 as Pe,c4 as Ve,c5 as Fe,c6 as Ae,c7 as Ze,ad as j,ap as ae}from"./index-D5qLf1ib.js";import{H as Me}from"./Helmet-BNepwt1P.js";const ie=j.object({contractId:j.string().min(1,"Debes seleccionar un contrato"),parkZoneId:j.string().optional(),latitude:j.string().optional(),longitude:j.string().optional(),areaSize:j.string().min(1,"La superficie es obligatoria"),locationDescription:j.string().optional(),polygonCoordinates:j.string().optional()});function $e(){const[ne,B]=g.useState(!1),[re,L]=g.useState(!1),[ce,G]=g.useState(!1),[te,k]=g.useState(!1),[i,O]=g.useState(null),[v,oe]=g.useState("");g.useRef(null);const{toast:N}=ge(),T=pe(),{data:J,isLoading:le}=M({queryKey:["/api/concession-locations"]}),{data:y,isLoading:U}=M({queryKey:["/api/concession-contracts"]}),{data:C,isLoading:q}=M({queryKey:["/api/park-zones"]}),h=W({resolver:ae(ie),defaultValues:{contractId:"",parkZoneId:"",latitude:"",longitude:"",areaSize:"",locationDescription:"",polygonCoordinates:""}}),x=W({resolver:ae(ie),defaultValues:{contractId:"",parkZoneId:"",latitude:"",longitude:"",areaSize:"",locationDescription:"",polygonCoordinates:""}}),P=R({mutationFn:async s=>{const a=await fetch("/api/concession-locations",{method:"POST",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:JSON.stringify(s)});if(!a.ok){const d=await a.json();throw new Error(d.message||"Error al crear la ubicación")}return await a.json()},onSuccess:()=>{T.invalidateQueries({queryKey:["/api/concession-locations"]}),N({title:"Ubicación creada",description:"La ubicación ha sido creada exitosamente."}),h.reset(),B(!1)},onError:s=>{N({title:"Error",description:s.message,variant:"destructive"})}}),V=R({mutationFn:async s=>{const{id:a,...d}=s,m=await fetch(`/api/concession-locations/${a}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:JSON.stringify(d)});if(!m.ok){const u=await m.json();throw new Error(u.message||"Error al actualizar la ubicación")}return await m.json()},onSuccess:()=>{T.invalidateQueries({queryKey:["/api/concession-locations"]}),N({title:"Ubicación actualizada",description:"La ubicación ha sido actualizada exitosamente."}),x.reset(),L(!1)},onError:s=>{N({title:"Error",description:s.message,variant:"destructive"})}}),F=R({mutationFn:async s=>{const a=await fetch(`/api/concession-locations/${s}`,{method:"DELETE",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""}});if(!a.ok){const d=await a.json();throw new Error(d.message||"Error al eliminar la ubicación")}return await a.json()},onSuccess:()=>{T.invalidateQueries({queryKey:["/api/concession-locations"]}),N({title:"Ubicación eliminada",description:"La ubicación ha sido eliminada exitosamente."}),k(!1)},onError:s=>{N({title:"Error",description:s.message,variant:"destructive"})}}),de=s=>{P.mutate(s)},xe=s=>{i&&V.mutate({...s,id:i.id})},he=s=>{var a,d,m,u;O(s),x.reset({contractId:s.contractId.toString(),parkZoneId:((a=s.parkZoneId)==null?void 0:a.toString())||"",latitude:((d=s.latitude)==null?void 0:d.toString())||"",longitude:((m=s.longitude)==null?void 0:m.toString())||"",areaSize:((u=s.areaSize)==null?void 0:u.toString())||"",locationDescription:s.locationDescription||"",polygonCoordinates:s.polygonCoordinates?JSON.stringify(s.polygonCoordinates):""}),L(!0)},me=s=>{O(s),G(!0)},je=s=>{O(s),k(!0)},ue=()=>{i&&F.mutate(i.id)},A=J?J.filter(s=>{var d,m,u;return v===""||((d=s.contractName)==null?void 0:d.toLowerCase().includes(v.toLowerCase()))||((m=s.parkName)==null?void 0:m.toLowerCase().includes(v.toLowerCase()))||((u=s.locationDescription)==null?void 0:u.toLowerCase().includes(v.toLowerCase()))}):[],Z=U||q;return e.jsxs(be,{children:[e.jsxs(Me,{children:[e.jsx("title",{children:"Ubicaciones de Concesiones | Bosques Urbanos"}),e.jsx("meta",{name:"description",content:"Gestiona la ubicación y georreferenciación de las concesiones en los parques"})]}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Ubicaciones de Concesiones"}),e.jsx("p",{className:"text-muted-foreground",children:"Administra la ubicación y georreferenciación de las concesiones en los parques"})]}),e.jsxs(H,{open:ne,onOpenChange:B,children:[e.jsx(Ne,{asChild:!0,children:e.jsxs(f,{className:"gap-2",children:[e.jsx(ye,{size:16}),"Nueva ubicación"]})}),e.jsxs($,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsx(X,{children:"Agregar ubicación para concesión"}),e.jsx(Y,{children:"Introduce la información de ubicación para la concesión"})]}),e.jsx(_,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(de),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:h.control,name:"contractId",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Contrato de Concesión"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:Z,children:[e.jsx(t,{children:e.jsx(I,{children:e.jsx(w,{placeholder:"Selecciona un contrato"})})}),e.jsx(E,{children:U?e.jsx(o,{value:"loading",children:"Cargando contratos..."}):y&&y.length>0?y.map(a=>e.jsxs(o,{value:a.id.toString(),children:[a.parkName," - ",a.concessionaireName]},a.id)):e.jsx(o,{value:"empty",children:"No hay contratos disponibles"})})]}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"parkZoneId",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Zona del Parque (Opcional)"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:Z,children:[e.jsx(t,{children:e.jsx(I,{children:e.jsx(w,{placeholder:"Selecciona una zona"})})}),e.jsx(E,{children:q?e.jsx(o,{value:"loading",children:"Cargando zonas..."}):C&&C.length>0?C.map(a=>e.jsx(o,{value:a.id.toString(),children:a.name},a.id)):e.jsx(o,{value:"empty",children:"No hay zonas disponibles"})})]}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{control:h.control,name:"latitude",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Latitud (Opcional)"}),e.jsx(t,{children:e.jsx(p,{placeholder:"Ej. 19.4326",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"longitude",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Longitud (Opcional)"}),e.jsx(t,{children:e.jsx(p,{placeholder:"Ej. -99.1332",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:h.control,name:"areaSize",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Superficie (m²)"}),e.jsx(t,{children:e.jsx(p,{placeholder:"Ej. 250",...s,type:"number",min:"0",step:"0.01"})}),e.jsx(l,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsx(n,{control:h.control,name:"locationDescription",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Descripción de la Ubicación"}),e.jsx(t,{children:e.jsx(ee,{placeholder:"Describe la ubicación de la concesión dentro del parque",...s})}),e.jsx(l,{})]})})}),e.jsx("div",{className:"h-80 bg-gray-100 rounded-md p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"mx-auto mb-2 h-10 w-10 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Visualizador de mapa (en desarrollo)"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Pronto podrás seleccionar ubicaciones en el mapa"})]})}),e.jsx(se,{children:e.jsx(f,{type:"submit",disabled:P.isPending,children:P.isPending?"Guardando...":"Guardar ubicación"})})]})})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative w-full max-w-sm",children:[e.jsx(Ce,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(p,{placeholder:"Buscar ubicaciones...",className:"pl-8",value:v,onChange:s=>oe(s.target.value)})]})}),e.jsxs(fe,{children:[e.jsxs(ve,{className:"pb-3",children:[e.jsx(Se,{children:"Ubicaciones de Concesiones"}),e.jsx(De,{children:"Lista de ubicaciones registradas para las concesiones"})]}),e.jsx(Ie,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(we,{children:[e.jsx(Ee,{children:e.jsxs(z,{children:[e.jsx(S,{children:"Parque"}),e.jsx(S,{children:"Concesionario"}),e.jsx(S,{children:"Ubicación"}),e.jsx(S,{children:"Superficie (m²)"}),e.jsx(S,{children:"Acciones"})]})}),e.jsx(ze,{children:le?e.jsx(z,{children:e.jsx(b,{colSpan:5,className:"text-center py-4",children:"Cargando ubicaciones..."})}):A&&A.length>0?A.map(s=>e.jsxs(z,{children:[e.jsx(b,{children:s.parkName}),e.jsx(b,{children:s.concessionaireName}),e.jsx(b,{children:s.locationDescription||(s.latitude&&s.longitude?`${s.latitude}, ${s.longitude}`:"No especificada")}),e.jsxs(b,{children:[s.areaSize," m²"]}),e.jsx(b,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>me(s),title:"Ver detalles",children:e.jsx(Le,{size:16})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>he(s),title:"Editar",children:e.jsx(ke,{size:16})}),e.jsx(f,{variant:"ghost",size:"icon",onClick:()=>je(s),title:"Eliminar",className:"text-destructive",children:e.jsx(Oe,{size:16})})]})})]},s.id)):e.jsx(z,{children:e.jsx(b,{colSpan:5,className:"text-center py-4",children:'No hay ubicaciones registradas. Agrega una ubicación usando el botón "Nueva ubicación".'})})})]})})})]})]}),e.jsx(H,{open:ce,onOpenChange:G,children:e.jsxs($,{className:"sm:max-w-[750px]",children:[e.jsx(K,{children:e.jsx(X,{children:"Detalles de la Ubicación"})}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Contrato"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.contractName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Parque"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.parkName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Concesionario"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.concessionaireName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Zona del Parque"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.zoneName||"No especificada"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Coordenadas"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.latitude&&i.longitude?`${i.latitude}, ${i.longitude}`:"No especificadas"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Superficie"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[i.areaSize," m²"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium",children:"Descripción de la Ubicación"}),e.jsx("p",{className:"text-sm text-gray-500",children:i.locationDescription||"Sin descripción"})]}),e.jsx("div",{className:"h-80 bg-gray-100 rounded-md p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"mx-auto mb-2 h-10 w-10 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Visualizador de mapa (en desarrollo)"})]})})]})]})}),e.jsx(H,{open:re,onOpenChange:L,children:e.jsxs($,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(K,{children:[e.jsx(X,{children:"Editar Ubicación"}),e.jsx(Y,{children:"Modifica la información de ubicación para esta concesión"})]}),e.jsx(_,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(xe),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:x.control,name:"contractId",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Contrato de Concesión"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:!0,children:[e.jsx(t,{children:e.jsx(I,{children:e.jsx(w,{placeholder:"Selecciona un contrato"})})}),e.jsx(E,{children:U?e.jsx(o,{value:"loading",children:"Cargando contratos..."}):y&&y.length>0?y.map(a=>e.jsxs(o,{value:a.id.toString(),children:[a.parkName," - ",a.concessionaireName]},a.id)):e.jsx(o,{value:"empty",children:"No hay contratos disponibles"})})]}),e.jsx(l,{})]})}),e.jsx(n,{control:x.control,name:"parkZoneId",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Zona del Parque (Opcional)"}),e.jsxs(D,{onValueChange:s.onChange,defaultValue:s.value,disabled:Z,children:[e.jsx(t,{children:e.jsx(I,{children:e.jsx(w,{placeholder:"Selecciona una zona"})})}),e.jsx(E,{children:q?e.jsx(o,{value:"loading",children:"Cargando zonas..."}):C&&C.length>0?C.map(a=>e.jsx(o,{value:a.id.toString(),children:a.name},a.id)):e.jsx(o,{value:"empty",children:"No hay zonas disponibles"})})]}),e.jsx(l,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{control:x.control,name:"latitude",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Latitud (Opcional)"}),e.jsx(t,{children:e.jsx(p,{placeholder:"Ej. 19.4326",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:x.control,name:"longitude",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Longitud (Opcional)"}),e.jsx(t,{children:e.jsx(p,{placeholder:"Ej. -99.1332",...s})}),e.jsx(l,{})]})}),e.jsx(n,{control:x.control,name:"areaSize",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Superficie (m²)"}),e.jsx(t,{children:e.jsx(p,{placeholder:"Ej. 250",...s,type:"number",min:"0",step:"0.01"})}),e.jsx(l,{})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:e.jsx(n,{control:x.control,name:"locationDescription",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Descripción de la Ubicación"}),e.jsx(t,{children:e.jsx(ee,{placeholder:"Describe la ubicación de la concesión dentro del parque",...s})}),e.jsx(l,{})]})})}),e.jsx("div",{className:"h-80 bg-gray-100 rounded-md p-4 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"mx-auto mb-2 h-10 w-10 text-gray-400"}),e.jsx("p",{className:"text-gray-500",children:"Visualizador de mapa (en desarrollo)"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Pronto podrás seleccionar ubicaciones en el mapa"})]})}),e.jsx(se,{children:e.jsx(f,{type:"submit",disabled:V.isPending,children:V.isPending?"Guardando...":"Guardar cambios"})})]})})]})}),e.jsx(Te,{open:te,onOpenChange:k,children:e.jsxs(Ue,{children:[e.jsxs(qe,{children:[e.jsx(Pe,{children:"¿Estás seguro?"}),e.jsx(Ve,{children:"Esta acción eliminará permanentemente la ubicación de la concesión."})]}),e.jsxs(Fe,{children:[e.jsx(Ae,{children:"Cancelar"}),e.jsx(Ze,{onClick:ue,disabled:F.isPending,children:F.isPending?"Eliminando...":"Eliminar"})]})]})})]})}export{$e as default};
