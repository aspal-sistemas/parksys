import{aw as ps,Y as S,j as e,u as ke,f as re,b9 as Ns,C as F,S as ss,c as q,B as g,b0 as _e,R as ee,Z as Te,I as H,z as V,H as D,J as z,K as U,N as h,au as as,ba as ts,bb as ls,bc as qe,bd as le,be as is,bf as ie,L as Z,b3 as He,aq as Ve,ar as De,aj as ve,aE as Qe,aW as Fe,M as Ne,h as Ee,bg as vs,aC as Be,m as rs,l as fs,X as ys,U as Oe,n as ns,P as cs,d as bs,e as ds,a6 as os,a8 as Pe,A as Ye,aB as ws,b5 as Cs,aH as As,aI as Ls,aJ as me,aK as he,a as G,b as W,an as xs,i as Ss,F as $e,as as Ms,aA as ks,G as Ze,a3 as je,D as Ce,r as Ae,t as Le,v as Se,w as Re,a5 as $,p as Es,bh as Fs,bi as qs,b4 as Ps,bj as Is,bk as Ts,bl as Vs,bm as Ds,bn as zs,bo as Us,bp as $s,a7 as ms,aa as hs,ab as J,ac as X,ad as B,ae as Q,af as Y,ag as js,ah as Ie}from"./index-BBGHPKhn.js";import{l as us,M as Bs,T as Os,a as Rs}from"./leaflet-C1l5RZCP.js";import{u as _s}from"./hooks-DtJC8wAk.js";import{I as Hs}from"./images-UHLIx5DH.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=ps("ArrowUpNarrowWide",[["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}],["path",{d:"M11 12h4",key:"q8tih4"}],["path",{d:"M11 16h7",key:"uosisv"}],["path",{d:"M11 20h10",key:"jvxblo"}]]);delete us.Icon.Default.prototype._getIconUrl;us.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png"});function Ks({onMapClick:n}){return _s({click:i=>{n&&n(i.latlng.lat,i.latlng.lng)}}),null}function Me({latitude:n,longitude:i,parkName:b,className:m,height:p="300px",onMapClick:l,selectedLocation:j}){const[y,d]=S.useState(null);if(S.useEffect(()=>{if(n&&i){const E=typeof n=="string"?parseFloat(n):n,v=typeof i=="string"?parseFloat(i):i;!isNaN(E)&&!isNaN(v)&&d([E,v])}},[n,i]),!y)return e.jsx("div",{className:`bg-gray-100 rounded-lg border flex items-center justify-center ${m}`,style:{height:p},children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx("div",{className:"text-sm",children:"📍 Ubicación no disponible"}),e.jsx("div",{className:"text-xs mt-1",children:"No se han establecido coordenadas para este parque"})]})});const A=j?[j.lat,j.lng]:y;return e.jsxs("div",{className:`relative ${m}`,children:[e.jsx("div",{style:{height:p,width:"100%"},className:"rounded-lg overflow-hidden border",children:e.jsxs(Bs,{center:y,zoom:15,style:{height:"100%",width:"100%"},scrollWheelZoom:!0,zoomControl:!0,dragging:!0,doubleClickZoom:!0,children:[e.jsx(Os,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),A&&e.jsx(Rs,{position:A}),l&&e.jsx(Ks,{onMapClick:l})]})}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 flex items-center justify-between",children:[e.jsxs("span",{children:["📍 ",b||"Ubicación del parque"]}),e.jsx("span",{children:j?`${j.lat.toFixed(6)}, ${j.lng.toFixed(6)}`:`${y[0].toFixed(6)}, ${y[1].toFixed(6)}`})]}),l&&e.jsx("div",{className:"mt-1 text-xs text-blue-600",children:"Haz clic en el mapa para seleccionar una ubicación"})]})}function Gs({parkId:n}){const{data:i=[],isLoading:b}=ke({queryKey:[`/api/parks/${n}/images`],queryFn:async()=>{const m=await fetch(`/api/parks/${n}/images`,{headers:{Authorization:"Bearer direct-token-1750522117022","X-User-Id":"1","X-User-Role":"super_admin"}});if(!m.ok)throw new Error("Error cargando imágenes");return m.json()},staleTime:3e5});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Galería de Imágenes"}),e.jsx(re,{variant:"secondary",className:"text-xs",children:"Solo visualización"})]}),b?e.jsx("div",{className:"text-center py-8",children:"Cargando imágenes..."}):i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Ns,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay imágenes"}),e.jsx("p",{className:"text-sm",children:"Este parque aún no tiene imágenes cargadas."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(m=>e.jsxs(F,{className:"overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:m.imageUrl,alt:m.caption,className:"w-full h-48 object-cover"}),m.isPrimary&&e.jsxs(re,{className:"absolute top-2 left-2 bg-yellow-500",children:[e.jsx(ss,{className:"h-3 w-3 mr-1"}),"Principal"]})]}),e.jsxs(q,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:m.caption}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(g,{size:"sm",variant:"outline",onClick:()=>window.open(m.imageUrl,"_blank"),className:"flex-1",children:[e.jsx(_e,{className:"h-3 w-3 mr-1"}),"Ver completa"]})})]})]},m.id))})]})}const Ws=({parkId:n})=>{const[i,b]=S.useState(1),[m,p]=S.useState(""),[l,j]=S.useState("all"),y=10,{data:d,isLoading:A,error:E}=ke({queryKey:["/api/trees",n,i,m,l],queryFn:async()=>{let o=`/api/trees?parkId=${n}&page=${i}&limit=${y}`;m&&(o+=`&search=${encodeURIComponent(m)}`),l!=="all"&&(o+=`&condition=${l}`);const L=await fetch(o);if(!L.ok)throw new Error("Error al cargar los árboles del parque");return L.json()}}),v=o=>{switch(o){case"Bueno":return"bg-green-100 text-green-800";case"Regular":return"bg-yellow-100 text-yellow-800";case"Malo":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},O=o=>o?new Date(o).toLocaleDateString("es-ES"):"No registrada",T=(d==null?void 0:d.data)||[],P=Math.ceil(((d==null?void 0:d.total)||0)/y);return ee.useEffect(()=>{b(1)},[m,l]),A?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600"})}):E?e.jsxs("div",{className:"text-center py-8 text-red-600",children:[e.jsx("p",{children:"Error al cargar el inventario de árboles"}),e.jsx("p",{className:"text-sm mt-2",children:"Por favor, intenta nuevamente"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(H,{placeholder:"Buscar por especie, ubicación o notas...",value:m,onChange:o=>p(o.target.value),className:"pl-10"})]}),e.jsxs(V,{value:l,onValueChange:j,children:[e.jsx(D,{className:"w-full sm:w-48",children:e.jsx(z,{placeholder:"Filtrar por condición"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todas las condiciones"}),e.jsx(h,{value:"Bueno",children:"Bueno"}),e.jsx(h,{value:"Regular",children:"Regular"}),e.jsx(h,{value:"Malo",children:"Malo"})]})]})]}),T.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(as,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay árboles registrados"}),e.jsx("p",{className:"text-sm",children:m||l!=="all"?"No se encontraron árboles con los filtros aplicados":"Este parque aún no tiene árboles registrados en el inventario"})]}):e.jsx("div",{className:"rounded-lg border",children:e.jsxs(ts,{children:[e.jsx(ls,{children:e.jsxs(qe,{children:[e.jsx(le,{children:"Especie"}),e.jsx(le,{children:"Condición"}),e.jsx(le,{children:"Ubicación"}),e.jsx(le,{children:"Dimensiones"}),e.jsx(le,{children:"Última Mantención"}),e.jsx(le,{children:"Acciones"})]})}),e.jsx(is,{children:T.map(o=>e.jsxs(qe,{children:[e.jsx(ie,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:o.speciesName}),e.jsx("div",{className:"text-sm text-gray-500 italic",children:o.scientificName})]})}),e.jsx(ie,{children:e.jsx(re,{className:v(o.condition||o.healthStatus),children:o.condition||o.healthStatus||"No especificada"})}),e.jsx(ie,{children:e.jsx("div",{className:"text-sm",children:o.locationDescription||"No especificada"})}),e.jsx(ie,{children:e.jsxs("div",{className:"text-sm",children:[o.height?`${o.height} m`:"-"," × ",o.diameter?`${o.diameter} cm`:"-"]})}),e.jsx(ie,{children:e.jsx("div",{className:"text-sm",children:O(o.lastMaintenanceDate)})}),e.jsx(ie,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Z,{href:`/admin/trees/inventory/${o.id}`,children:e.jsx(g,{variant:"ghost",size:"sm",children:e.jsx(_e,{className:"h-4 w-4"})})}),e.jsx(Z,{href:`/admin/trees/inventory/${o.id}/edit`,children:e.jsx(g,{variant:"ghost",size:"sm",children:e.jsx(He,{className:"h-4 w-4"})})})]})})]},o.id))})]})}),P>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mostrando ",(i-1)*y+1," a ",Math.min(i*y,(d==null?void 0:d.total)||0)," de ",(d==null?void 0:d.total)||0," árboles"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>b(o=>Math.max(1,o-1)),disabled:i===1,children:[e.jsx(Ve,{className:"h-4 w-4"}),"Anterior"]}),Array.from({length:P},(o,L)=>L+1).map(o=>e.jsx(g,{variant:i===o?"default":"outline",size:"sm",onClick:()=>b(o),className:i===o?"bg-green-600 hover:bg-green-700":"",children:o},o)),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>b(o=>Math.min(P,o+1)),disabled:i===P,children:["Siguiente",e.jsx(De,{className:"h-4 w-4"})]})]})]})]})},Js=({parkId:n,assets:i,amenities:b})=>{const[m,p]=S.useState(1),[l,j]=S.useState(""),[y,d]=S.useState("all"),[A,E]=S.useState("all"),[v,O]=S.useState("all"),[T,P]=S.useState("name"),[o,L]=S.useState("asc"),w=10,c=(()=>{let t=[...i];return l&&(t=t.filter(a=>{var x,s,r,u,C;return((x=a.name)==null?void 0:x.toLowerCase().includes(l.toLowerCase()))||((s=a.category)==null?void 0:s.toLowerCase().includes(l.toLowerCase()))||((r=a.locationDescription)==null?void 0:r.toLowerCase().includes(l.toLowerCase()))||((u=a.manufacturer)==null?void 0:u.toLowerCase().includes(l.toLowerCase()))||((C=a.model)==null?void 0:C.toLowerCase().includes(l.toLowerCase()))})),y!=="all"&&(t=t.filter(a=>{var x;return((x=a.category)==null?void 0:x.toLowerCase())===y.toLowerCase()})),A!=="all"&&(t=t.filter(a=>{var x;return((x=a.status)==null?void 0:x.toLowerCase())===A.toLowerCase()})),v!=="all"&&(t=t.filter(a=>{var x;return((x=a.condition)==null?void 0:x.toLowerCase())===v.toLowerCase()})),t.sort((a,x)=>{var u,C,M,R,_,te;let s="",r="";switch(T){case"category":s=((u=a.category)==null?void 0:u.toLowerCase())||"",r=((C=x.category)==null?void 0:C.toLowerCase())||"";break;case"condition":s=((M=a.condition)==null?void 0:M.toLowerCase())||"",r=((R=x.condition)==null?void 0:R.toLowerCase())||"";break;case"acquisitionDate":s=a.acquisitionDate||"",r=x.acquisitionDate||"";break;case"lastMaintenance":s=a.lastMaintenance||"",r=x.lastMaintenance||"";break;default:s=((_=a.name)==null?void 0:_.toLowerCase())||"",r=((te=x.name)==null?void 0:te.toLowerCase())||""}return o==="desc"?r.localeCompare(s):s.localeCompare(r)}),t})(),I=Math.ceil(c.length/w),K=(m-1)*w,ce=K+w,se=c.slice(K,ce);ee.useEffect(()=>{p(1)},[l,y,A,v,T,o]);const ae=t=>{const a=new Map;return t.filter(Boolean).forEach(x=>{if(x){const s=x.toLowerCase();a.has(s)||a.set(s,x)}}),Array.from(a.keys())},ne=ae(i.map(t=>t.category)),N=ae(i.map(t=>t.status)),de=ae(i.map(t=>t.condition)),oe=()=>{j(""),d("all"),E("all"),O("all"),P("name"),L("asc")},xe=t=>({excelente:"default",bueno:"default",regular:"secondary",malo:"destructive"})[t==null?void 0:t.toLowerCase()]||"secondary";return e.jsxs("div",{className:"space-y-4",children:[i.length>0&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Filtros y Ordenamiento"}),e.jsxs("span",{className:"ml-auto text-sm text-gray-500",children:["(",c.length," de ",i.length," activos)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(H,{placeholder:"Buscar activos...",value:l,onChange:t=>j(t.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs(V,{value:y,onValueChange:d,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Categoría"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todas las categorías"}),ne.map(t=>e.jsx(h,{value:t,children:t.charAt(0).toUpperCase()+t.slice(1)},t))]})]})}),e.jsx("div",{children:e.jsxs(V,{value:A,onValueChange:E,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Estado"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todos los estados"}),N.map(t=>e.jsx(h,{value:t,children:t==="active"||t==="activo"?"Activo":t.charAt(0).toUpperCase()+t.slice(1)},t))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("div",{children:e.jsxs(V,{value:v,onValueChange:O,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Condición"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todas las condiciones"}),de.map(t=>e.jsx(h,{value:t,children:t==="excellent"||t==="excelente"?"Excelente":t==="good"||t==="bueno"?"Bueno":t==="regular"?"Regular":t==="bad"||t==="malo"?"Malo":t.charAt(0).toUpperCase()+t.slice(1)},t))]})]})}),e.jsx("div",{children:e.jsxs(V,{value:T,onValueChange:P,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Ordenar por"})}),e.jsxs(U,{children:[e.jsx(h,{value:"name",children:"Nombre"}),e.jsx(h,{value:"category",children:"Categoría"}),e.jsx(h,{value:"condition",children:"Condición"}),e.jsx(h,{value:"acquisitionDate",children:"Fecha de Adquisición"}),e.jsx(h,{value:"lastMaintenance",children:"Último Mantenimiento"})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:o==="asc"?"default":"outline",size:"sm",onClick:()=>L("asc"),className:"flex-1",children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx(g,{variant:o==="desc"?"default":"outline",size:"sm",onClick:()=>L("desc"),className:"flex-1",children:e.jsx(es,{className:"h-4 w-4 rotate-180"})})]}),e.jsx("div",{children:e.jsx(g,{variant:"outline",size:"sm",onClick:oe,className:"w-full",children:"Limpiar"})})]})]}),c.length===0&&i.length>0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No se encontraron activos"}),e.jsx("p",{className:"text-sm",children:"Prueba ajustando los filtros de búsqueda."}),e.jsx(g,{variant:"outline",className:"mt-4",onClick:oe,children:"Limpiar Filtros"})]}):i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Qe,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay activos registrados"}),e.jsx("p",{className:"text-sm",children:"Este parque aún no tiene activos asignados."}),e.jsx(Z,{href:`/admin/assets/new?parkId=${n}`,children:e.jsxs(g,{className:"mt-4",variant:"outline",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Agregar primer activo"]})})]}):e.jsx("div",{className:"space-y-4",children:se.map(t=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-lg",children:t.name}),e.jsx(re,{variant:xe(t.condition),children:t.condition}),t.status&&e.jsx(re,{variant:t.status==="active"?"default":"secondary",children:t.status==="active"?"Activo":t.status})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Categoría:"}),e.jsx("span",{className:"text-gray-600",children:t.category||"Sin categoría"})]}),t.serialNumber&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Número de Serie:"}),e.jsx("span",{className:"text-gray-600 font-mono text-xs bg-gray-100 px-2 py-1 rounded",children:t.serialNumber})]}),t.locationDescription&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ne,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Ubicación:"}),e.jsx("span",{className:"text-gray-600",children:t.locationDescription})]})]}),e.jsxs("div",{className:"space-y-2",children:[t.acquisitionDate&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Fecha de Adquisición:"}),e.jsx("span",{className:"text-gray-600",children:new Date(t.acquisitionDate).toLocaleDateString()})]}),t.lastMaintenance&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Qe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Último Mantenimiento:"}),e.jsx("span",{className:"text-gray-600",children:new Date(t.lastMaintenance).toLocaleDateString()})]})]})]}),t.notes&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Notas:"})," ",t.notes]})})]}),e.jsx("div",{className:"ml-4 flex flex-col gap-2",children:e.jsx(Z,{href:`/admin/assets/${t.id}/edit`,children:e.jsx(g,{size:"sm",variant:"outline",children:e.jsx(He,{className:"h-4 w-4"})})})})]})},t.id))}),I>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mostrando ",K+1," a ",Math.min(ce,c.length)," de ",c.length," activos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>p(t=>Math.max(1,t-1)),disabled:m===1,children:[e.jsx(Ve,{className:"h-4 w-4"}),"Anterior"]}),Array.from({length:I},(t,a)=>a+1).map(t=>e.jsx(g,{variant:m===t?"default":"outline",size:"sm",onClick:()=>p(t),className:m===t?"bg-green-600 hover:bg-green-700":"",children:t},t)),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>p(t=>Math.min(I,t+1)),disabled:m===I,children:["Siguiente",e.jsx(De,{className:"h-4 w-4"})]})]})]})]})},Xs=({parkId:n})=>{const[i,b]=S.useState(1),[m,p]=S.useState(""),[l,j]=S.useState("all"),[y,d]=S.useState("all"),[A,E]=S.useState("all"),[v,O]=S.useState("createdAt"),[T,P]=S.useState("desc"),o=10,{data:L=[],isLoading:w,error:f}=ke({queryKey:["incidents",n],queryFn:async()=>{const s=await fetch(`/api/incidents?parkId=${n}`);if(!s.ok)throw new Error("Error al cargar incidencias");return s.json()},enabled:!!n,staleTime:5*60*1e3}),I=(()=>{let s=[...L];return m&&(s=s.filter(r=>{var u,C,M,R,_;return((u=r.title)==null?void 0:u.toLowerCase().includes(m.toLowerCase()))||((C=r.description)==null?void 0:C.toLowerCase().includes(m.toLowerCase()))||((M=r.location)==null?void 0:M.toLowerCase().includes(m.toLowerCase()))||((R=r.reporterName)==null?void 0:R.toLowerCase().includes(m.toLowerCase()))||((_=r.assetName)==null?void 0:_.toLowerCase().includes(m.toLowerCase()))})),l!=="all"&&(s=s.filter(r=>{var u;return((u=r.status)==null?void 0:u.toLowerCase())===l.toLowerCase()})),y!=="all"&&(s=s.filter(r=>{var u;return((u=r.severity)==null?void 0:u.toLowerCase())===y.toLowerCase()})),A!=="all"&&(s=s.filter(r=>{var u;return((u=r.category)==null?void 0:u.toLowerCase())===A.toLowerCase()})),s.sort((r,u)=>{var R,_,te,ue,ge,pe,fe,ye,be,we;let C="",M="";switch(v){case"title":C=((R=r.title)==null?void 0:R.toLowerCase())||"",M=((_=u.title)==null?void 0:_.toLowerCase())||"";break;case"status":C=((te=r.status)==null?void 0:te.toLowerCase())||"",M=((ue=u.status)==null?void 0:ue.toLowerCase())||"";break;case"severity":C=((ge=r.severity)==null?void 0:ge.toLowerCase())||"",M=((pe=u.severity)==null?void 0:pe.toLowerCase())||"";break;case"category":C=((fe=r.category)==null?void 0:fe.toLowerCase())||"",M=((ye=u.category)==null?void 0:ye.toLowerCase())||"";break;case"reporterName":C=((be=r.reporterName)==null?void 0:be.toLowerCase())||"",M=((we=u.reporterName)==null?void 0:we.toLowerCase())||"";break;case"updatedAt":C=r.updatedAt||"",M=u.updatedAt||"";break;default:C=r.createdAt||"",M=u.createdAt||""}return T==="desc"?M.localeCompare(C):C.localeCompare(M)}),s})(),K=Math.ceil(I.length/o),ce=(i-1)*o,se=ce+o,ae=I.slice(ce,se);ee.useEffect(()=>{b(1)},[m,l,y,A,v,T]);const ne=s=>{const r=new Map;return s.filter(Boolean).forEach(u=>{if(u){const C=u.toLowerCase();r.has(C)||r.set(C,u)}}),Array.from(r.keys())},N=ne(L.map(s=>s.status)),de=ne(L.map(s=>s.severity)),oe=ne(L.map(s=>s.category)),xe=()=>{p(""),j("all"),d("all"),E("all"),O("createdAt"),P("desc")},t=s=>({pending:"destructive",assigned:"secondary",in_progress:"secondary",review:"outline",resolved:"default",closed:"default",rejected:"destructive"})[s==null?void 0:s.toLowerCase()]||"secondary",a=s=>({urgent:"destructive",high:"destructive",normal:"secondary",low:"outline"})[s==null?void 0:s.toLowerCase()]||"secondary",x=s=>{if(!s)return"No registrada";try{return fs(new Date(s),"dd/MM/yyyy HH:mm",{locale:ys})}catch{return"Fecha inválida"}};return w?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(vs,{className:"h-8 w-8 animate-spin text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Cargando incidencias..."})]}):f?e.jsxs("div",{className:"text-center py-8 text-red-500",children:[e.jsx(Be,{className:"h-12 w-12 mx-auto mb-3"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"Error al cargar incidencias"}),e.jsx("p",{className:"text-sm",children:"Por favor, intenta recargar la página."})]}):e.jsxs("div",{className:"space-y-4",children:[L.length>0&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Filtros y Ordenamiento"}),e.jsxs("span",{className:"ml-auto text-sm text-gray-500",children:["(",I.length," de ",L.length," incidencias)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(H,{placeholder:"Buscar incidencias...",value:m,onChange:s=>p(s.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs(V,{value:l,onValueChange:j,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Estado"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todos los estados"}),N.map(s=>e.jsx(h,{value:s,children:s==="abierto"?"Abierto":s==="en_proceso"?"En Proceso":s==="resuelto"?"Resuelto":s==="completado"?"Completado":s==="cerrado"?"Cerrado":s.charAt(0).toUpperCase()+s.slice(1)},s))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("div",{children:e.jsxs(V,{value:y,onValueChange:d,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Severidad"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todas las severidades"}),de.map(s=>e.jsx(h,{value:s,children:s==="urgent"?"Urgente":s==="high"?"Alta":s==="normal"?"Normal":s==="low"?"Baja":s.charAt(0).toUpperCase()+s.slice(1)},s))]})]})}),e.jsx("div",{children:e.jsxs(V,{value:A,onValueChange:E,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Categoría"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todas las categorías"}),oe.map(s=>e.jsx(h,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))]})]})}),e.jsx("div",{children:e.jsxs(V,{value:v,onValueChange:O,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Ordenar por"})}),e.jsxs(U,{children:[e.jsx(h,{value:"createdAt",children:"Fecha de Creación"}),e.jsx(h,{value:"updatedAt",children:"Fecha de Actualización"}),e.jsx(h,{value:"title",children:"Título"}),e.jsx(h,{value:"status",children:"Estado"}),e.jsx(h,{value:"severity",children:"Severidad"}),e.jsx(h,{value:"category",children:"Categoría"}),e.jsx(h,{value:"reporterName",children:"Reportado por"})]})]})}),e.jsx("div",{children:e.jsx(g,{variant:"outline",size:"sm",onClick:xe,className:"w-full",children:"Limpiar"})})]})]}),I.length===0&&L.length>0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No se encontraron incidencias"}),e.jsx("p",{className:"text-sm",children:"Prueba ajustando los filtros de búsqueda."}),e.jsx(g,{variant:"outline",className:"mt-4",onClick:xe,children:"Limpiar Filtros"})]}):L.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Be,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay incidencias registradas"}),e.jsx("p",{className:"text-sm",children:"Este parque aún no tiene incidencias reportadas."}),e.jsx(Z,{href:`/admin/incidents/new?parkId=${n}`,children:e.jsxs(g,{className:"mt-4",variant:"outline",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Reportar primera incidencia"]})})]}):e.jsx("div",{className:"space-y-4",children:ae.map(s=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-lg",children:s.title}),e.jsx(re,{variant:t(s.status),children:s.status==="pending"?"Pendiente":s.status==="assigned"?"Asignada":s.status==="in_progress"?"En Progreso":s.status==="review"?"En Revisión":s.status==="resolved"?"Resuelta":s.status==="closed"?"Cerrada":s.status==="rejected"?"Rechazada":s.status}),e.jsx(re,{variant:a(s.severity),children:s.severity==="urgent"?"Urgente":s.severity==="high"?"Alta":s.severity==="normal"?"Normal":s.severity==="low"?"Baja":s.severity})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:s.description}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Categoría:"}),e.jsx("span",{className:"text-gray-600",children:s.category||"Sin especificar"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Ubicación:"}),e.jsx("span",{className:"text-gray-600",children:s.location||"No especificada"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(rs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Reportado por:"}),e.jsx("span",{className:"text-gray-600",children:s.reporterName})]}),s.assetName&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Activo:"}),e.jsx("span",{className:"text-gray-600",children:s.assetName})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Creado:"}),e.jsx("span",{className:"text-gray-600",children:x(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Actualizado:"}),e.jsx("span",{className:"text-gray-600",children:x(s.updatedAt)})]}),s.reporterEmail&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Email:"}),e.jsx("span",{className:"text-gray-600",children:s.reporterEmail})]})]})]}),e.jsx("div",{className:"mt-3 flex gap-2",children:e.jsx(Z,{href:`/admin/incidents/${s.id}`,children:e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Ver Detalle"]})})})]}),e.jsx("div",{className:"ml-4 flex flex-col gap-2",children:e.jsx(Z,{href:`/admin/incidents/${s.id}`,children:e.jsx(g,{size:"sm",variant:"outline",children:"Ver detalles"})})})]})},s.id))}),K>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mostrando ",ce+1," a ",Math.min(se,I.length)," de ",I.length," incidencias"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>b(s=>Math.max(1,s-1)),disabled:i===1,children:[e.jsx(Ve,{className:"h-4 w-4"}),"Anterior"]}),Array.from({length:K},(s,r)=>r+1).map(s=>e.jsx(g,{variant:i===s?"default":"outline",size:"sm",onClick:()=>b(s),className:i===s?"bg-green-600 hover:bg-green-700":"",children:s},s)),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>b(s=>Math.min(K,s+1)),disabled:i===K,children:["Siguiente",e.jsx(De,{className:"h-4 w-4"})]})]})]})]})},Qs=({parkId:n,volunteers:i})=>{const[b,m]=S.useState(1),[p,l]=S.useState(""),[j,y]=S.useState("all"),[d,A]=S.useState("all"),[E,v]=S.useState("all"),[O,T]=S.useState("fullName"),[P,o]=S.useState("asc"),L=10,f=(()=>{let a=[...i];return p&&(a=a.filter(x=>{var s,r,u,C;return((s=x.fullName)==null?void 0:s.toLowerCase().includes(p.toLowerCase()))||((r=x.email)==null?void 0:r.toLowerCase().includes(p.toLowerCase()))||((u=x.skills)==null?void 0:u.toLowerCase().includes(p.toLowerCase()))||((C=x.experience)==null?void 0:C.toLowerCase().includes(p.toLowerCase()))})),j!=="all"&&(a=a.filter(x=>{var s;return((s=x.status)==null?void 0:s.toLowerCase())===j.toLowerCase()})),d!=="all"&&(a=a.filter(x=>{var s;return((s=x.availability)==null?void 0:s.toLowerCase())===d.toLowerCase()})),E!=="all"&&(a=a.filter(x=>{var s;return((s=x.gender)==null?void 0:s.toLowerCase())===E.toLowerCase()})),a.sort((x,s)=>{var C,M,R,_,te,ue,ge,pe;let r="",u="";switch(O){case"email":r=((C=x.email)==null?void 0:C.toLowerCase())||"",u=((M=s.email)==null?void 0:M.toLowerCase())||"";break;case"status":r=((R=x.status)==null?void 0:R.toLowerCase())||"",u=((_=s.status)==null?void 0:_.toLowerCase())||"";break;case"availability":r=((te=x.availability)==null?void 0:te.toLowerCase())||"",u=((ue=s.availability)==null?void 0:ue.toLowerCase())||"";break;case"createdAt":r=x.createdAt||"",u=s.createdAt||"";break;case"lastActivity":r=x.lastActivity||"",u=s.lastActivity||"";break;case"hoursLogged":r=(x.hoursLogged||0).toString(),u=(s.hoursLogged||0).toString();break;default:r=((ge=x.fullName)==null?void 0:ge.toLowerCase())||"",u=((pe=s.fullName)==null?void 0:pe.toLowerCase())||""}return P==="desc"?u.localeCompare(r):r.localeCompare(u)}),a})(),c=Math.ceil(f.length/L),I=(b-1)*L,K=I+L,ce=f.slice(I,K);ee.useEffect(()=>{m(1)},[p,j,d,E,O,P]);const se=a=>{const x=new Map;return a.filter(Boolean).forEach(s=>{if(s){const r=s.toLowerCase();x.has(r)||x.set(r,s)}}),Array.from(x.keys())},ae=se(i.map(a=>a.status)),ne=se(i.map(a=>a.availability)),N=se(i.map(a=>a.gender)),de=()=>{l(""),y("all"),A("all"),v("all"),T("fullName"),o("asc")},oe=a=>({activo:"default",active:"default",inactivo:"secondary",inactive:"secondary",pendiente:"outline",pending:"outline",suspendido:"destructive",suspended:"destructive"})[a==null?void 0:a.toLowerCase()]||"secondary",xe=a=>({"tiempo completo":"default",tiempo_completo:"default","medio tiempo":"secondary",medio_tiempo:"secondary","fines de semana":"outline",fines_de_semana:"outline","por horas":"outline",por_horas:"outline",flexible:"default"})[a==null?void 0:a.toLowerCase()]||"secondary",t=a=>a?new Date(a).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}):"No registrada";return e.jsxs("div",{className:"space-y-4",children:[i.length>0&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(ve,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Filtros y Ordenamiento"}),e.jsxs("span",{className:"ml-auto text-sm text-gray-500",children:["(",f.length," de ",i.length," voluntarios)"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(H,{placeholder:"Buscar voluntarios...",value:p,onChange:a=>l(a.target.value),className:"pl-10"})]}),e.jsx("div",{children:e.jsxs(V,{value:j,onValueChange:y,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Estado"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todos los estados"}),ae.map(a=>e.jsx(h,{value:a,children:a==="activo"?"Activo":a==="inactivo"?"Inactivo":a==="pendiente"?"Pendiente":a==="suspendido"?"Suspendido":a.charAt(0).toUpperCase()+a.slice(1)},a))]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsx("div",{children:e.jsxs(V,{value:d,onValueChange:A,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Disponibilidad"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todas las disponibilidades"}),ne.map(a=>e.jsx(h,{value:a,children:a==="tiempo_completo"?"Tiempo Completo":a==="medio_tiempo"?"Medio Tiempo":a==="fines_de_semana"?"Fines de Semana":a==="por_horas"?"Por Horas":a==="flexible"?"Flexible":a.charAt(0).toUpperCase()+a.slice(1)},a))]})]})}),e.jsx("div",{children:e.jsxs(V,{value:E,onValueChange:v,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Género"})}),e.jsxs(U,{children:[e.jsx(h,{value:"all",children:"Todos los géneros"}),N.map(a=>e.jsx(h,{value:a,children:a==="masculino"?"Masculino":a==="femenino"?"Femenino":a==="no_especificar"?"No Especificar":a.charAt(0).toUpperCase()+a.slice(1)},a))]})]})}),e.jsx("div",{children:e.jsxs(V,{value:O,onValueChange:T,children:[e.jsx(D,{className:"h-9",children:e.jsx(z,{placeholder:"Ordenar por"})}),e.jsxs(U,{children:[e.jsx(h,{value:"fullName",children:"Nombre"}),e.jsx(h,{value:"email",children:"Email"}),e.jsx(h,{value:"status",children:"Estado"}),e.jsx(h,{value:"availability",children:"Disponibilidad"}),e.jsx(h,{value:"createdAt",children:"Fecha de Registro"}),e.jsx(h,{value:"lastActivity",children:"Última Actividad"}),e.jsx(h,{value:"hoursLogged",children:"Horas Registradas"})]})]})}),e.jsx("div",{children:e.jsx(g,{variant:"outline",size:"sm",onClick:de,className:"w-full",children:"Limpiar"})})]})]}),f.length===0&&i.length>0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(ve,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No se encontraron voluntarios"}),e.jsx("p",{className:"text-sm",children:"Prueba ajustando los filtros de búsqueda."}),e.jsx(g,{variant:"outline",className:"mt-4",onClick:de,children:"Limpiar Filtros"})]}):i.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Oe,{className:"h-12 w-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{className:"text-lg font-medium mb-2",children:"No hay voluntarios asignados"}),e.jsx("p",{className:"text-sm",children:"Este parque aún no tiene voluntarios registrados."}),e.jsx(Z,{href:"/admin/volunteers/register",children:e.jsxs(g,{className:"mt-4",variant:"outline",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Registrar primer voluntario"]})})]}):e.jsx("div",{className:"space-y-4",children:ce.map(a=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-semibold text-lg",children:a.fullName}),e.jsx(re,{variant:oe(a.status),children:a.status==="activo"?"Activo":a.status==="inactivo"?"Inactivo":a.status}),a.availability&&e.jsx(re,{variant:xe(a.availability),children:a.availability==="tiempo_completo"?"Tiempo Completo":a.availability==="medio_tiempo"?"Medio Tiempo":a.availability==="fines_de_semana"?"Fines de Semana":a.availability==="por_horas"?"Por Horas":a.availability})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ns,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Email:"}),e.jsx("span",{className:"text-gray-600",children:a.email})]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(cs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Teléfono:"}),e.jsx("span",{className:"text-gray-600",children:a.phone})]}),a.skills&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Habilidades:"}),e.jsx("span",{className:"text-gray-600",children:a.skills})]}),a.age&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(rs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Edad:"}),e.jsxs("span",{className:"text-gray-600",children:[a.age," años"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Registrado:"}),e.jsx("span",{className:"text-gray-600",children:t(a.createdAt)})]}),a.lastActivity&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Última Actividad:"}),e.jsx("span",{className:"text-gray-600",children:t(a.lastActivity)})]}),a.hoursLogged&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Horas Registradas:"}),e.jsxs("span",{className:"text-gray-600",children:[a.hoursLogged," horas"]})]}),a.experience&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Experiencia:"}),e.jsx("span",{className:"text-gray-600",children:a.experience})]})]})]}),a.notes&&e.jsx("div",{className:"mt-3 p-3 bg-blue-50 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-800",children:[e.jsx("span",{className:"font-medium",children:"Notas:"})," ",a.notes]})})]}),e.jsx("div",{className:"ml-4 flex flex-col gap-2",children:e.jsx(Z,{href:`/admin/volunteers/${a.id}`,children:e.jsx(g,{size:"sm",variant:"outline",children:"Ver perfil"})})})]})},a.id))}),c>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mostrando ",I+1," a ",Math.min(K,f.length)," de ",f.length," voluntarios"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>m(a=>Math.max(1,a-1)),disabled:b===1,children:[e.jsx(Ve,{className:"h-4 w-4"}),"Anterior"]}),Array.from({length:c},(a,x)=>x+1).map(a=>e.jsx(g,{variant:b===a?"default":"outline",size:"sm",onClick:()=>m(a),className:b===a?"bg-green-600 hover:bg-green-700":"",children:a},a)),e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>m(a=>Math.min(c,a+1)),disabled:b===c,children:["Siguiente",e.jsx(De,{className:"h-4 w-4"})]})]})]})]})},Ys=$.object({amenityId:$.number().min(1,"Seleccione una amenidad"),moduleName:$.string().min(1,"El nombre del módulo es requerido"),surfaceArea:$.string().optional(),locationLatitude:$.string().optional(),locationLongitude:$.string().optional(),status:$.string().default("Activa"),description:$.string().optional()}),Zs=$.object({moduleName:$.string().min(1,"El nombre del módulo es requerido"),surfaceArea:$.string().optional(),locationLatitude:$.string().optional(),locationLongitude:$.string().optional(),status:$.string().default("Activa"),description:$.string().optional()}),ze=n=>({playground:"🛝",toilet:"🚽",sportsCourt:"🏀",bicycle:"🚴",pets:"🐕",bench:"🪑",fountain:"⛲",parking:"🚗",security:"🔒",wifi:"📶",restaurant:"🍽️",cafe:"☕",garden:"🌺",lake:"🏞️",trail:"🥾"})[n]||"📍";function ea(n){if(!n)return e.jsx("span",{children:"No especificado"});try{const i=JSON.parse(n),b={monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",thursday:"Jueves",friday:"Viernes",saturday:"Sábado",sunday:"Domingo"},m=Object.entries(i).filter(([p,l])=>l.enabled).map(([p,l])=>`${b[p]}: ${l.openTime} - ${l.closeTime}`);return m.length===0?e.jsx("span",{children:"Cerrado todos los días"}):e.jsx("div",{className:"space-y-1",children:m.map((p,l)=>e.jsx("div",{className:"text-gray-600",children:p},l))})}catch{return e.jsx("span",{children:n})}}function na(){var de,oe,xe,t,a,x,s,r,u,C,M,R,_,te,ue,ge,pe,fe,ye,be,we,Ke,Ge,We,Je,Xe;const{id:n}=bs(),{toast:i}=ds(),b=os(),[m,p]=ee.useState(!1),[l,j]=ee.useState(!1),[y,d]=ee.useState(!1),[A,E]=ee.useState(null),[v,O]=ee.useState(null),[T,P]=ee.useState(0),[o,L]=ee.useState(!1),[w,f]=ee.useState(null),{data:c,isLoading:I,error:K,refetch:ce}=ke({queryKey:[`/api/parks/${n}/details`,T],enabled:!!n}),{data:se}=ke({queryKey:["/api/amenities"]}),ae=Pe({mutationFn:async k=>Ie(`/api/parks/${n}/amenities`,{method:"POST",data:k}),onSuccess:()=>{p(!1),i({title:"Amenidad agregada",description:"La amenidad se ha agregado al parque exitosamente."}),setTimeout(()=>window.location.reload(),1e3)},onError:()=>{i({title:"Error",description:"No se pudo agregar la amenidad al parque.",variant:"destructive"})}}),ne=Pe({mutationFn:async({amenityId:k,data:Ue})=>Ie(`/api/parks/${n}/amenities/${k}`,{method:"PUT",data:Ue}),onSuccess:()=>{b.invalidateQueries({queryKey:[`/api/parks/${n}`]}),j(!1),E(null),i({title:"Amenidad actualizada",description:"La amenidad se ha actualizado exitosamente."})},onError:()=>{i({title:"Error",description:"No se pudo actualizar la amenidad.",variant:"destructive"})}});if(I)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-6"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[...Array(4)].map((k,Ue)=>e.jsx("div",{className:"h-24 bg-gray-200 rounded"},Ue))}),e.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})});if(K||!c)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Parque no encontrado"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"No se pudo cargar la información del parque."}),e.jsx(Z,{href:"/admin/parks",children:e.jsxs(g,{variant:"outline",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Volver a Parques"]})})]})});const N=c;return e.jsx(ws,{children:e.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Z,{href:"/admin/parks",children:e.jsxs(g,{variant:"outline",size:"sm",children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:N.name}),e.jsxs("p",{className:"text-gray-600 flex items-center gap-2 mt-1",children:[e.jsx(Ne,{className:"h-4 w-4"}),N.address||N.location," • ",((de=N.municipality)==null?void 0:de.name)||"Municipio no encontrado"]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(Z,{href:`/admin/parks/${n}/edit`,children:e.jsx(g,{children:"Editar Parque"})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 mb-8",children:[e.jsx(F,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ee,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:((oe=N.stats)==null?void 0:oe.totalActivities)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Actividades"})]})]})})}),e.jsx(F,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Oe,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:((xe=c.stats)==null?void 0:xe.activeVolunteers)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Voluntarios"})]})]})})}),e.jsx(F,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(as,{className:"h-8 w-8 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:((t=c.stats)==null?void 0:t.totalTrees)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Árboles"})]})]})})}),e.jsx(F,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ss,{className:"h-8 w-8 text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:((x=(a=c.stats)==null?void 0:a.averageEvaluation)==null?void 0:x.toFixed(1))||"0.0"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Evaluación"})]})]})})}),e.jsx(F,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Cs,{className:"h-8 w-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:((s=c.stats)==null?void 0:s.totalAssets)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Activos"})]})]})})}),e.jsx(F,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Be,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:((r=c.stats)==null?void 0:r.pendingIncidents)||0}),e.jsx("p",{className:"text-sm text-gray-600",children:"Incidencias"})]})]})})})]}),e.jsxs(As,{defaultValue:"basic-info",className:"space-y-6",children:[e.jsxs(Ls,{className:"grid w-full grid-cols-9",children:[e.jsx(me,{value:"basic-info",children:"Información"}),e.jsx(me,{value:"amenities",children:"Amenidades"}),e.jsx(me,{value:"activities",children:"Actividades"}),e.jsx(me,{value:"trees",children:"Árboles"}),e.jsx(me,{value:"assets",children:"Activos"}),e.jsx(me,{value:"incidents",children:"Incidencias"}),e.jsx(me,{value:"volunteers",children:"Voluntarios"}),e.jsx(me,{value:"documents",children:"Documentos"}),e.jsx(me,{value:"multimedia",children:"Multimedia"})]}),e.jsx(he,{value:"basic-info",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(xs,{className:"h-5 w-5 text-blue-600"}),"Información General"]})}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-medium text-gray-700",children:"Tipo de Parque:"})}),e.jsx("p",{className:"text-gray-600",children:N.parkType||"No especificado"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ss,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Horarios:"})]}),ea(N.openingHours)]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx($e,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Descripción:"})]}),e.jsx("p",{className:"text-gray-600",children:N.description||"No especificado"})]}),N.area&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-medium text-gray-700",children:"Superficie Total:"})}),e.jsxs("p",{className:"text-gray-600",children:[N.area," m²"]})]}),N.greenArea&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-medium text-gray-700",children:"Área Permeable:"})}),e.jsxs("p",{className:"text-gray-600",children:[parseFloat(N.greenArea).toLocaleString()," m²"]})]}),N.foundationYear&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ee,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Año de Fundación:"})]}),e.jsx("p",{className:"text-gray-600",children:N.foundationYear})]})]})]}),e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-green-600"}),"Ubicación y Contacto"]})}),e.jsxs(q,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ms,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Municipio:"})]}),e.jsx("p",{className:"text-gray-600",children:((u=N.municipality)==null?void 0:u.name)||"No especificado"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ne,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Dirección:"})]}),e.jsx("p",{className:"text-gray-600",children:N.address||N.location||"No especificado"})]}),N.postalCode&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-medium text-gray-700",children:"Código Postal:"})}),e.jsx("p",{className:"text-gray-600",children:N.postalCode})]}),N.contactPhone&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(cs,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Teléfono:"})]}),e.jsx("p",{className:"text-gray-600",children:N.contactPhone})]}),N.contactEmail&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(ns,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Correo Electrónico:"})]}),e.jsx("p",{className:"text-gray-600",children:N.contactEmail})]}),N.latitude&&N.longitude&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ne,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Coordenadas:"})]}),e.jsxs("p",{className:"text-gray-600",children:[N.latitude,", ",N.longitude]})]}),N.latitude&&N.longitude&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ne,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Ubicación en el Mapa:"})]}),e.jsx(Me,{latitude:N.latitude,longitude:N.longitude,parkName:N.name,height:"300px",className:"w-full"})]})]})]}),e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"h-5 w-5 text-purple-600"}),"Características"]})}),e.jsxs(q,{className:"space-y-4",children:[N.administrator&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Oe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Administrador:"})]}),e.jsx("p",{className:"text-gray-600",children:N.administrator})]}),N.conservationStatus&&e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"font-medium text-gray-700",children:"Estado de Conservación:"})}),e.jsx(re,{variant:N.conservationStatus==="bueno"?"default":"secondary",children:N.conservationStatus})]})]})]}),e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs(W,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-5 w-5 text-indigo-600"}),"Enlaces y Recursos"]})}),e.jsxs(q,{className:"space-y-4",children:[c.regulationUrl&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx($e,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Reglamento:"})]}),e.jsx("a",{href:c.regulationUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"Ver reglamento"})]}),c.videoUrl&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Ze,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700",children:"Video:"})]}),e.jsx("a",{href:c.videoUrl,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:"Ver video del parque"})]}),!c.regulationUrl&&!c.videoUrl&&e.jsx("p",{className:"text-gray-500 italic",children:"No hay enlaces disponibles"})]})]})]})}),e.jsx(he,{value:"amenities",className:"space-y-4",children:e.jsx(sa,{parkId:parseInt(n||"0"),isAddAmenityModalOpen:m,setIsAddAmenityModalOpen:p,availableAmenities:se||[],addAmenityMutation:ae,parkData:c,isEditAmenityModalOpen:l,setIsEditAmenityModalOpen:j,editingAmenity:A,setEditingAmenity:E,isViewAmenityModalOpen:y,setIsViewAmenityModalOpen:d,viewingAmenity:v,setViewingAmenity:O})}),e.jsx(he,{value:"activities",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(G,{children:[e.jsxs(W,{children:["Actividades (",((C=c.activities)==null?void 0:C.length)||0,")"]}),e.jsx(je,{children:"Actividades programadas en este parque"})]}),e.jsx(q,{children:e.jsx("div",{className:"space-y-4",children:(M=c.activities)==null?void 0:M.map(k=>e.jsx("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:k.title}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:k.description}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["📅 ",new Date(k.startDate).toLocaleDateString()]}),k.instructorName&&e.jsxs("span",{children:["👨‍🏫 ",k.instructorName]}),e.jsxs("span",{children:["👥 ",k.participantCount," participantes"]})]})]})},k.id))})})]})}),e.jsx(he,{value:"trees",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(G,{children:[e.jsxs(W,{children:["Inventario de Árboles (",((_=(R=c.trees)==null?void 0:R.stats)==null?void 0:_.total)||0,")"]}),e.jsx(je,{children:"Estado y estadísticas de árboles en este parque"})]}),e.jsxs(q,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:((ue=(te=c.trees)==null?void 0:te.stats)==null?void 0:ue.good)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Bueno"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:((pe=(ge=c.trees)==null?void 0:ge.stats)==null?void 0:pe.regular)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Regular"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:((ye=(fe=c.trees)==null?void 0:fe.stats)==null?void 0:ye.bad)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Malo"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:((we=(be=c.trees)==null?void 0:be.stats)==null?void 0:we.total)||0}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total"})]})]}),e.jsx(Ws,{parkId:parseInt(n)})]})]})}),e.jsx(he,{value:"assets",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(G,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[e.jsxs("div",{children:[e.jsxs(W,{children:["Activos (",((Ke=c.assets)==null?void 0:Ke.length)||0,")"]}),e.jsx(je,{children:"Equipamiento e infraestructura del parque"})]}),e.jsx(Z,{href:`/admin/assets/new?parkId=${n}`,children:e.jsxs(g,{size:"sm",children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Agregar Activo"]})})]}),e.jsx(q,{children:e.jsx(Js,{parkId:parseInt(n),assets:c.assets||[],amenities:c.amenities||[]})})]})}),e.jsx(he,{value:"incidents",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(G,{children:[e.jsxs(W,{children:["Incidencias (",((Ge=c.stats)==null?void 0:Ge.pendingIncidents)||0,")"]}),e.jsx(je,{children:"Reportes e incidencias del parque"})]}),e.jsx(q,{children:e.jsx(Xs,{parkId:parseInt(n)})})]})}),e.jsx(he,{value:"volunteers",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(G,{children:[e.jsxs(W,{children:["Voluntarios (",((We=c.volunteers)==null?void 0:We.length)||0,")"]}),e.jsx(je,{children:"Voluntarios asignados a este parque"})]}),e.jsx(q,{children:e.jsx(Qs,{parkId:parseInt(n),volunteers:c.volunteers||[]})})]})}),e.jsx(he,{value:"documents",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(G,{children:[e.jsxs(W,{children:["Documentos (",((Je=c.documents)==null?void 0:Je.length)||0,")"]}),e.jsx(je,{children:"Documentos oficiales y archivos del parque"})]}),e.jsx(q,{children:e.jsx("div",{className:"space-y-4",children:(Xe=c.documents)==null?void 0:Xe.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($e,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:k.title}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsx("span",{children:k.type})," •",e.jsxs("span",{children:[" ",new Date(k.uploadedAt).toLocaleDateString()]})]})]})]}),e.jsx(g,{variant:"outline",size:"sm",children:"Descargar"})]},k.id))})})]})}),e.jsx(he,{value:"multimedia",className:"space-y-4",children:e.jsxs(F,{children:[e.jsxs(G,{children:[e.jsxs(W,{className:"text-2xl text-green-600 flex items-center gap-2",children:[e.jsx(Hs,{className:"h-6 w-6"}),"Multimedia del Parque"]}),e.jsx(je,{children:"Visualiza las imágenes y documentos del parque."})]}),e.jsx(q,{children:e.jsx(Gs,{parkId:parseInt(n)})})]})})]}),e.jsx(Ce,{open:m,onOpenChange:p,children:e.jsxs(Ae,{className:"max-w-2xl",children:[e.jsx(Le,{children:e.jsx(Se,{children:"Agregar módulo"})}),e.jsx(gs,{availableAmenities:se||[],onSubmit:k=>ae.mutate(k),isLoading:ae.isPending,onCancel:()=>p(!1),parkData:c})]})}),e.jsx(Ce,{open:l,onOpenChange:j,children:e.jsxs(Ae,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Le,{children:[e.jsx(Se,{children:"Editar Módulo de Amenidad"}),e.jsx(Re,{children:"Modifique la configuración del módulo de amenidad seleccionado."})]}),A&&e.jsx(aa,{amenity:A,onSubmit:k=>ne.mutate({amenityId:A.parkAmenityId,data:k}),isLoading:ne.isPending,onCancel:()=>{j(!1),E(null)},parkData:c})]})}),e.jsx(Ce,{open:y,onOpenChange:d,children:e.jsxs(Ae,{className:"sm:max-w-[600px]",children:[e.jsx(Le,{children:e.jsx(Se,{children:"Detalles del Módulo de Amenidad"})}),v&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Tipo de Amenidad"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:ze(v.amenityIcon)}),e.jsx("p",{className:"font-semibold",children:v.amenityName||"No especificado"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Nombre del Módulo"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"font-semibold",children:v.moduleName||"Sin nombre"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Superficie (m²)"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{children:v.surfaceArea?`${v.surfaceArea} m²`:"No especificada"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Estado"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${v.status==="Activa"?"bg-green-100 text-green-800":v.status==="Inactiva"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:v.status||"Sin estado"})})]}),v.locationLatitude&&v.locationLongitude&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ubicación en el Parque"}),e.jsxs("div",{className:"border rounded-lg p-3 bg-white overflow-hidden",children:[e.jsx("div",{className:"w-full h-48 relative mb-2",children:e.jsx(Me,{latitude:parseFloat((c==null?void 0:c.latitude)||"20.6597"),longitude:parseFloat((c==null?void 0:c.longitude)||"-103.3496"),parkName:(c==null?void 0:c.name)||"Parque",height:"192px",selectedLocation:{lat:parseFloat(v.locationLatitude),lng:parseFloat(v.locationLongitude)}})}),e.jsxs("div",{className:"text-xs text-gray-500",children:["📍 ",parseFloat(v.locationLatitude).toFixed(6),", ",parseFloat(v.locationLongitude).toFixed(6)]})]})]}),v.description&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Descripción"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{children:v.description})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Fecha de Creación"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-sm",children:v.createdAt?new Date(v.createdAt).toLocaleDateString("es-MX"):"No disponible"})})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(g,{variant:"outline",onClick:()=>d(!1),children:"Cerrar"})})]})]})}),e.jsx(Ce,{open:o,onOpenChange:L,children:e.jsxs(Ae,{className:"max-w-4xl h-[600px] overflow-y-auto",children:[e.jsxs(Le,{children:[e.jsxs(Se,{children:["Ubicación del Activo: ",w==null?void 0:w.name]}),e.jsx(Re,{children:(w==null?void 0:w.locationDescription)&&e.jsx("span",{className:"text-sm text-gray-600",children:w.locationDescription})})]}),w&&w.latitude&&w.longitude&&e.jsxs("div",{className:"flex-1 h-full",children:[e.jsx(Me,{latitude:w.latitude,longitude:w.longitude,parkName:w.name,height:"500px",className:"w-full"}),e.jsx("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Categoría:"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:w.category||"Sin categoría"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Estado:"}),e.jsx("span",{className:`ml-2 inline-block px-2 py-1 text-xs rounded ${w.condition==="excellent"?"bg-green-100 text-green-800":w.condition==="good"?"bg-blue-100 text-blue-800":w.condition==="regular"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:w.condition==="excellent"?"Excelente":w.condition==="good"?"Bueno":w.condition==="regular"?"Regular":w.condition==="poor"?"Malo":w.condition})]}),w.locationDescription&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Descripción de ubicación:"}),e.jsx("p",{className:"mt-1 text-sm text-gray-600",children:w.locationDescription})]})]})})]}),e.jsx("div",{className:"flex justify-end gap-2 pt-4",children:e.jsx(g,{variant:"outline",onClick:()=>L(!1),children:"Cerrar"})})]})})]})})}const sa=({parkId:n,isAddAmenityModalOpen:i,setIsAddAmenityModalOpen:b,availableAmenities:m,addAmenityMutation:p,parkData:l,isEditAmenityModalOpen:j,setIsEditAmenityModalOpen:y,editingAmenity:d,setEditingAmenity:A,isViewAmenityModalOpen:E,setIsViewAmenityModalOpen:v,viewingAmenity:O,setViewingAmenity:T})=>{os();const{toast:P}=ds(),o=Array.isArray(l==null?void 0:l.amenities)?l.amenities.map(f=>({...f,amenityName:f.name,amenityIcon:f.icon})):[],L=!l,w=Pe({mutationFn:async f=>{await Ie(`/api/park-amenities/${f}`,{method:"DELETE"})},onSuccess:()=>{P({title:"Amenidad eliminada",description:"La amenidad ha sido eliminada exitosamente."}),setTimeout(()=>window.location.reload(),1e3)},onError:()=>{P({title:"Error",description:"No se pudo eliminar la amenidad.",variant:"destructive"})}});return Pe({mutationFn:async({amenityId:f,data:c})=>Ie(`/api/parks/${n}/amenities/${f}`,{method:"PUT",data:c}),onSuccess:()=>{y(!1),A(null),P({title:"Amenidad actualizada",description:"La amenidad se ha actualizado exitosamente."}),setTimeout(()=>window.location.reload(),1e3)},onError:()=>{P({title:"Error",description:"No se pudo actualizar la amenidad.",variant:"destructive"})}}),L?e.jsxs(F,{children:[e.jsxs(G,{children:[e.jsx(W,{children:"Amenidades del Parque"}),e.jsx(je,{children:"Cargando servicios e infraestructura..."})]}),e.jsx(q,{children:e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"})})})]}):e.jsxs(F,{children:[e.jsx(G,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs(W,{children:["Amenidades del Parque (",o.length,")"]}),e.jsx(je,{children:"Servicios e infraestructura disponible"})]}),e.jsxs(Ce,{open:i,onOpenChange:b,children:[e.jsx(Es,{asChild:!0,children:e.jsxs(g,{children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"Agregar Módulo"]})}),e.jsxs(Ae,{className:"sm:max-w-[500px]",children:[e.jsxs(Le,{children:[e.jsx(Se,{children:"Agregar módulo"}),e.jsx(Re,{children:"Selecciona una amenidad existente para agregar al parque."})]}),e.jsx(gs,{availableAmenities:m||[],onSubmit:f=>p.mutate(f),isLoading:p.isPending,onCancel:()=>b(!1)})]})]})]})}),e.jsx(q,{children:o.length>0?e.jsxs(ts,{children:[e.jsx(ls,{children:e.jsxs(qe,{children:[e.jsx(le,{children:"Nombre del Módulo"}),e.jsx(le,{children:"Amenidad"}),e.jsx(le,{children:"Superficie (m²)"}),e.jsx(le,{children:"Estado"}),e.jsx(le,{className:"text-right",children:"Acciones"})]})}),e.jsx(is,{children:o.map(f=>e.jsxs(qe,{children:[e.jsxs(ie,{children:[e.jsx("span",{className:"font-medium",children:f.moduleName||"-"}),f.locationLatitude&&f.locationLongitude&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["📍 ",parseFloat(f.locationLatitude).toFixed(6),", ",parseFloat(f.locationLongitude).toFixed(6)]})]}),e.jsxs(ie,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:ze(f.amenityIcon)}),e.jsx("span",{className:"font-medium",children:f.amenityName})]}),e.jsx(ie,{children:f.surfaceArea?`${parseFloat(f.surfaceArea).toLocaleString()} m²`:"-"}),e.jsx(ie,{children:e.jsx(re,{variant:f.status==="Activa"?"default":f.status==="Mantenimiento"?"secondary":"destructive",children:f.status||"Activa"})}),e.jsx(ie,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{T(f),v(!0)},title:"Ver detalles",children:e.jsx(xs,{className:"h-4 w-4"})}),e.jsx(g,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{A(f),y(!0)},title:"Editar amenidad",children:e.jsx(He,{className:"h-4 w-4"})}),e.jsxs(Fs,{children:[e.jsx(qs,{asChild:!0,children:e.jsx(g,{variant:"outline",size:"sm",className:"h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(Ps,{className:"h-4 w-4"})})}),e.jsxs(Is,{children:[e.jsxs(Ts,{children:[e.jsx(Vs,{children:"¿Eliminar amenidad?"}),e.jsxs(Ds,{children:['Esta acción eliminará permanentemente la amenidad "',f.moduleName,'" del parque. Esta acción no se puede deshacer.']})]}),e.jsxs(zs,{children:[e.jsx(Us,{children:"Cancelar"}),e.jsx($s,{onClick:()=>w.mutate(f.parkAmenityId),className:"bg-red-600 hover:bg-red-700",disabled:w.isPending,children:w.isPending?"Eliminando...":"Eliminar"})]})]})]})]})})]},f.id))})]}):e.jsx("p",{className:"text-gray-500 italic",children:"No hay amenidades registradas para este parque."})})]})};function gs({availableAmenities:n,onSubmit:i,isLoading:b,onCancel:m,parkData:p}){const l=ms({resolver:js(Ys),defaultValues:{amenityId:0,moduleName:"",surfaceArea:"",locationLatitude:"",locationLongitude:"",status:"Activa",description:""}});return e.jsx(hs,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(i),className:"space-y-4",children:[e.jsx(J,{control:l.control,name:"amenityId",render:({field:j})=>{var y;return e.jsxs(X,{children:[e.jsx(B,{children:"Amenidad"}),e.jsxs(V,{onValueChange:d=>j.onChange(parseInt(d)),value:(y=j.value)==null?void 0:y.toString(),children:[e.jsx(Q,{children:e.jsx(D,{children:e.jsx(z,{placeholder:"Selecciona una amenidad"})})}),e.jsx(U,{children:n.map(d=>e.jsx(h,{value:d.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:ze(d.icon)}),e.jsx("span",{children:d.name})]})},d.id))})]}),e.jsx(Y,{})]})}}),e.jsx(J,{control:l.control,name:"moduleName",render:({field:j})=>e.jsxs(X,{children:[e.jsx(B,{children:"Nombre del Módulo"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Ej: Módulo Central, Área Norte...",...j})}),e.jsx(Y,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(J,{control:l.control,name:"surfaceArea",render:({field:j})=>e.jsxs(X,{children:[e.jsx(B,{children:"Superficie (m²)"}),e.jsx(Q,{children:e.jsx(H,{type:"number",placeholder:"0",...j})}),e.jsx(Y,{})]})}),e.jsx(J,{control:l.control,name:"status",render:({field:j})=>e.jsxs(X,{children:[e.jsx(B,{children:"Estado"}),e.jsxs(V,{onValueChange:j.onChange,defaultValue:j.value,children:[e.jsx(Q,{children:e.jsx(D,{children:e.jsx(z,{})})}),e.jsxs(U,{children:[e.jsx(h,{value:"Activa",children:"Activa"}),e.jsx(h,{value:"Mantenimiento",children:"Mantenimiento"}),e.jsx(h,{value:"Inactiva",children:"Inactiva"})]})]}),e.jsx(Y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(J,{control:l.control,name:"locationLatitude",render:({field:j})=>e.jsxs(X,{children:[e.jsx(B,{children:"Latitud"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Ej: 20.6597",...j})}),e.jsx(Y,{})]})}),e.jsx(J,{control:l.control,name:"locationLongitude",render:({field:j})=>e.jsxs(X,{children:[e.jsx(B,{children:"Longitud"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Ej: -103.3496",...j})}),e.jsx(Y,{})]})})]}),e.jsx(J,{control:l.control,name:"description",render:({field:j})=>e.jsxs(X,{children:[e.jsx(B,{children:"Descripción"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Descripción adicional...",...j})}),e.jsx(Y,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Ubicación en el Parque (opcional)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Haz clic en el mapa para seleccionar la ubicación del módulo"}),e.jsx("div",{className:"h-64 border rounded-lg overflow-hidden",children:p&&e.jsx(Me,{latitude:p.latitude||20.6597,longitude:p.longitude||-103.3496,parkName:p.name,height:"256px",onMapClick:(j,y)=>{l.setValue("locationLatitude",j.toString()),l.setValue("locationLongitude",y.toString())},selectedLocation:l.watch("locationLatitude")&&l.watch("locationLongitude")?{lat:parseFloat(l.watch("locationLatitude")),lng:parseFloat(l.watch("locationLongitude"))}:null})}),l.watch("locationLatitude")&&l.watch("locationLongitude")&&e.jsxs("p",{className:"text-xs text-green-600",children:["Coordenadas seleccionadas: ",l.watch("locationLatitude"),", ",l.watch("locationLongitude")]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:m,disabled:b,children:"Cancelar"}),e.jsx(g,{type:"submit",disabled:b,children:b?"Agregando...":"Agregar Amenidad"})]})]})})}function aa({amenity:n,onSubmit:i,isLoading:b,onCancel:m,parkData:p}){const l=ms({resolver:js(Zs),defaultValues:{moduleName:n.moduleName||"",surfaceArea:n.surfaceArea||"",locationLatitude:n.locationLatitude||"",locationLongitude:n.locationLongitude||"",status:n.status||"Activa",description:n.description||""}}),j=(d,A)=>{l.setValue("locationLatitude",d.toString()),l.setValue("locationLongitude",A.toString())},y=d=>{i(d)};return e.jsx(hs,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(y),className:"space-y-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:ze(n.amenityIcon)}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:n.amenityName}),e.jsx("p",{className:"text-sm text-blue-700",children:"Editando módulo de amenidad"})]})]})}),e.jsx(J,{control:l.control,name:"moduleName",render:({field:d})=>e.jsxs(X,{children:[e.jsx(B,{children:"Nombre del Módulo"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Ej: Cancha de Fútbol Norte",...d})}),e.jsx(Y,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(J,{control:l.control,name:"surfaceArea",render:({field:d})=>e.jsxs(X,{children:[e.jsx(B,{children:"Superficie (m²)"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Ej: 500",...d})}),e.jsx(Y,{})]})}),e.jsx(J,{control:l.control,name:"status",render:({field:d})=>e.jsxs(X,{children:[e.jsx(B,{children:"Estado"}),e.jsxs(V,{onValueChange:d.onChange,defaultValue:d.value,children:[e.jsx(Q,{children:e.jsx(D,{children:e.jsx(z,{placeholder:"Seleccione el estado"})})}),e.jsxs(U,{children:[e.jsx(h,{value:"Activa",children:"Activa"}),e.jsx(h,{value:"Mantenimiento",children:"Mantenimiento"}),e.jsx(h,{value:"Inactiva",children:"Inactiva"})]})]}),e.jsx(Y,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(J,{control:l.control,name:"locationLatitude",render:({field:d})=>e.jsxs(X,{children:[e.jsx(B,{children:"Latitud"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Ej: 20.6597",...d})}),e.jsx(Y,{})]})}),e.jsx(J,{control:l.control,name:"locationLongitude",render:({field:d})=>e.jsxs(X,{children:[e.jsx(B,{children:"Longitud"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Ej: -103.3496",...d})}),e.jsx(Y,{})]})})]}),e.jsx(J,{control:l.control,name:"description",render:({field:d})=>e.jsxs(X,{children:[e.jsx(B,{children:"Descripción"}),e.jsx(Q,{children:e.jsx(H,{placeholder:"Descripción adicional...",...d})}),e.jsx(Y,{})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{children:"Ubicación en el Parque (opcional)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Haz clic en el mapa para actualizar la ubicación del módulo"}),e.jsx("div",{className:"h-64 border rounded-lg overflow-hidden",children:p&&e.jsx(Me,{latitude:p.latitude||20.6597,longitude:p.longitude||-103.3496,parkName:p.name,height:"256px",onMapClick:j,selectedLocation:l.watch("locationLatitude")&&l.watch("locationLongitude")?{lat:parseFloat(l.watch("locationLatitude")||"0"),lng:parseFloat(l.watch("locationLongitude")||"0")}:null})}),l.watch("locationLatitude")&&l.watch("locationLongitude")&&e.jsxs("p",{className:"text-xs text-green-600",children:["Coordenadas actuales: ",l.watch("locationLatitude"),", ",l.watch("locationLongitude")]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(g,{type:"button",variant:"outline",onClick:m,disabled:b,children:"Cancelar"}),e.jsx(g,{type:"submit",disabled:b,children:b?"Guardando...":"Guardar Cambios"})]})]})})}export{na as default};
