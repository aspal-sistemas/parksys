import{c as fe,ae as Qe,l as Ge,a2 as m,u as le,ag as xe,cl as ue,j as e,aX as He,f as se,U as We,B as d,bh as Xe,a4 as Ye,O as $,a7 as Ze,Q as K,V as J,W as Q,Y as G,_ as N,bF as ea,b_ as re,X as je,bH as aa,bI as sa,bJ as ge,bK as E,ao as pe,bL as la,bM as P,cm as ve,bq as ra,bn as ta,aM as ia,aN as na,w as Ne,y as be,z as ye,I as Ce,m as oa,$ as ca,bC as we,cn as da,co as ma,r as ha,a1 as xa}from"./index-D5qLf1ib.js";import{S as W,R as X}from"./RoleBadge-D5voYAx-.js";import{U as Ie}from"./user-round-7dlnkIYD.js";import{A as ua}from"./arrow-up-CGIsfagf.js";import"./gem-dXiyKzl3.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ga=fe("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pa=fe("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]),fa=({user:s,isNew:g,onClose:C,onSave:A,isSaving:p,editingUserId:v})=>{const[c,q]=m.useState({role:s!=null&&s.roleId?String(s.roleId):"1",username:(s==null?void 0:s.username)||"",email:(s==null?void 0:s.email)||"",fullName:(s==null?void 0:s.fullName)||"",password:"",municipalityId:(s==null?void 0:s.municipalityId)||null,phone:(s==null?void 0:s.phone)||"",gender:(s==null?void 0:s.gender)||"no_especificar",birthDate:(s==null?void 0:s.birthDate)||"",profileImageUrl:(s==null?void 0:s.profileImageUrl)||"",profileImageFile:null,bio:(s==null?void 0:s.bio)||"",experience:(s==null?void 0:s.experience)||"",specialties:(s==null?void 0:s.specialties)||[],curriculumFile:null,address:(s==null?void 0:s.address)||"",emergencyContactName:(s==null?void 0:s.emergencyContactName)||"",emergencyContactPhone:(s==null?void 0:s.emergencyContactPhone)||"",preferredParkId:(s==null?void 0:s.preferredParkId)!==void 0?s==null?void 0:s.preferredParkId:3,legalConsent:(s==null?void 0:s.legalConsent)!==void 0?s==null?void 0:s.legalConsent:!1});m.useEffect(()=>{s&&s.roleId===6&&v&&(console.log("ðŸ”¥ DATOS RECIBIDOS DEL USUARIO:",s),(async()=>{try{const n=await fetch(`/api/volunteers/by-user/${v}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(n.ok){const t=await n.json();console.log("âœ… DATOS DE VOLUNTARIO CARGADOS:",t),q(f=>{var h,b,I,y,T,B;return{...f,address:t.address||"",emergencyContactName:t.emergency_contact||"",emergencyContactPhone:t.emergency_phone||"",preferredParkId:t.preferred_park_id||3,volunteerExperience:t.previous_experience||"",skills:t.skills||"",availability:t.available_hours||"flexible",interestNature:((h=t.interest_areas)==null?void 0:h.includes("nature"))||!1,interestEvents:((b=t.interest_areas)==null?void 0:b.includes("events"))||!1,interestEducation:((I=t.interest_areas)==null?void 0:I.includes("education"))||!1,interestMaintenance:((y=t.interest_areas)==null?void 0:y.includes("maintenance"))||!1,interestSports:((T=t.interest_areas)==null?void 0:T.includes("sports"))||!1,interestCultural:((B=t.interest_areas)==null?void 0:B.includes("cultural"))||!1,legalConsent:t.legal_consent===!0,ageConsent:t.age_consent===!0||!1,conductConsent:t.conduct_consent===!0||!1}})}else console.error("Error al cargar datos de voluntario:",await n.text())}catch(n){console.error("Error al obtener datos de voluntario:",n)}})())},[s,v]);const{data:w=[]}=le({queryKey:["/api/public/parks/list"],enabled:!0,refetchOnWindowFocus:!1,staleTime:5*60*1e3,retry:3}),{data:k=[]}=le({queryKey:["/api/roles"],refetchOnWindowFocus:!1,staleTime:10*60*1e3,retry:3});m.useEffect(()=>{var t;const r=k.find(f=>String(f.id)===c.role),n=(t=r==null?void 0:r.name)==null?void 0:t.toLowerCase().includes("voluntario");s&&n&&console.log("Datos del usuario cargados:",{userId:s.id,userPreferredParkId:s==null?void 0:s.preferredParkId,formPreferredParkId:c.preferredParkId,availableParks:(w==null?void 0:w.length)||0,selectedRole:r==null?void 0:r.name})},[s,c.role,c.preferredParkId,w,k]);const x=(r,n)=>{q(t=>({...t,[r]:n}))},L=async r=>{var t;const n=(t=r.target.files)==null?void 0:t[0];if(n)try{const f=new FormData;f.append("profileImage",n);const h=v||s&&s.id;h&&(f.append("userId",h.toString()),console.log(`Subiendo imagen para usuario ID: ${h}`));const b=await fetch("/api/upload/profile-image",{method:"POST",body:f,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!b.ok)throw new Error("Error al cargar la imagen");const I=await b.json();if(x("profileImageUrl",I.url),x("profileImageFile",null),h)try{await fetch(`/api/users/${h}/profile-image`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({imageUrl:I.url})}),console.log(`Imagen de perfil guardada en cachÃ© para el usuario ${h}`);const y=`profile_image_${h}`,T=`profile_image_cache_${h}`;localStorage.setItem(y,I.url),localStorage.setItem(T,Date.now().toString()),window.dispatchEvent(new CustomEvent("profileImageUpdated",{detail:{userId:h,imageUrl:I.url}})),toast({title:"Imagen actualizada",description:"La foto de perfil se ha actualizado correctamente.",variant:"default"})}catch(y){console.error("Error al guardar la URL en la cachÃ©:",y)}}catch(f){console.error("Error al cargar la imagen:",f);const h=URL.createObjectURL(n);x("profileImageUrl",h),x("profileImageFile",n)}},D=r=>{r.preventDefault(),A(c)};return e.jsx(Ne,{open:!0,onOpenChange:C,children:e.jsxs(be,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ye,{children:e.jsx(Ce,{children:g?"Crear nuevo usuario":"Editar usuario"})}),e.jsxs("form",{onSubmit:D,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsx("h3",{className:"font-medium text-lg text-primary-600",children:"Rol del Usuario"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(K,{value:c.role,onValueChange:r=>x("role",r),children:[e.jsx(J,{className:"w-full",children:e.jsx(Q,{placeholder:"Seleccionar rol"})}),e.jsx(G,{children:k.map(r=>e.jsx(N,{value:String(r.id),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-block w-2 h-2 rounded-full",style:{backgroundColor:r.color}}),e.jsx("span",{children:r.name}),e.jsxs("span",{className:"text-xs text-muted-foreground ml-auto",children:["Nivel ",r.level]})]})},r.id))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"El rol determina los permisos y funciones disponibles para el usuario."})]})]}),e.jsxs("div",{className:"space-y-4 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"InformaciÃ³n de Cuenta"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"fullName",className:"text-sm font-medium",children:"Nombre Completo"}),e.jsx($,{id:"fullName",value:c.fullName,onChange:r=>x("fullName",r.target.value),required:!0,placeholder:"Ej: Juan PÃ©rez GarcÃ­a"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"username",className:"text-sm font-medium",children:"Nombre de usuario"}),e.jsx($,{id:"username",value:c.username,onChange:r=>x("username",r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email"}),e.jsx($,{id:"email",type:"email",value:c.email,onChange:r=>x("email",r.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"password",className:"text-sm font-medium",children:g?"ContraseÃ±a":"ContraseÃ±a (dejar en blanco para no cambiar)"}),e.jsx($,{id:"password",type:"password",value:c.password,onChange:r=>x("password",r.target.value),required:g})]})]}),e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"InformaciÃ³n de Contacto y Perfil"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"profileImage",className:"text-sm font-medium",children:"Foto de perfil"}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"relative mb-3",children:!g&&v?e.jsx(ve,{userId:v,role:c.role,name:c.fullName||"Usuario",size:"xl",className:"w-32 h-32 border border-gray-300"}):c.profileImageUrl?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:c.profileImageUrl,alt:"Vista previa",className:"w-32 h-32 rounded-full object-cover border border-gray-300"}),e.jsx("button",{type:"button",className:"absolute -top-2 -right-2 bg-red-500 text-white p-1 rounded-full",onClick:()=>{x("profileImageUrl",""),x("profileImageFile",null)},children:e.jsx(je,{className:"h-4 w-4"})})]}):e.jsx("div",{className:"w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(Ie,{className:"h-16 w-16 text-gray-400"})})}),e.jsxs("label",{htmlFor:"imageUpload",className:"cursor-pointer py-2 px-3 bg-gray-100 hover:bg-gray-200 rounded text-sm text-center",children:["Subir imagen",e.jsx("input",{id:"imageUpload",type:"file",accept:"image/*",className:"hidden",onChange:L})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center",children:"Formatos: JPG, PNG. MÃ¡x: 5MB"})]})]})}),e.jsxs("div",{className:"space-y-4 col-span-2",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"phone",className:"text-sm font-medium",children:"TelÃ©fono"}),e.jsx($,{id:"phone",value:c.phone,onChange:r=>x("phone",r.target.value),placeholder:"Ej: 555-123-4567"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"gender",className:"text-sm font-medium",children:"GÃ©nero"}),e.jsxs(K,{value:c.gender,onValueChange:r=>x("gender",r),children:[e.jsx(J,{children:e.jsx(Q,{placeholder:"Seleccionar gÃ©nero"})}),e.jsxs(G,{children:[e.jsx(N,{value:"masculino",children:"Masculino"}),e.jsx(N,{value:"femenino",children:"Femenino"}),e.jsx(N,{value:"no_especificar",children:"Prefiero no decir"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"birthDate",className:"text-sm font-medium",children:"Fecha de nacimiento"}),e.jsxs("div",{className:"relative",children:[e.jsx($,{id:"birthDate",type:"date",value:c.birthDate,onChange:r=>x("birthDate",r.target.value),className:"w-full"}),e.jsx(oa,{className:"h-4 w-4 absolute right-3 top-3 text-gray-400"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"bio",className:"text-sm font-medium",children:"BiografÃ­a"}),e.jsx(ca,{id:"bio",value:c.bio,onChange:r=>x("bio",r.target.value),placeholder:"Breve descripciÃ³n personal",rows:3})]})]})]})]}),(()=>{var t;const r=k.find(f=>String(f.id)===c.role),n=((t=r==null?void 0:r.name)==null?void 0:t.toLowerCase())||"";return n.includes("instructor")?e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"InformaciÃ³n de Instructor"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete la informaciÃ³n bÃ¡sica para crear el perfil de instructor."})]}):n.includes("concesionario")?e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"InformaciÃ³n de Concesionario"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete la informaciÃ³n bÃ¡sica para crear el perfil de concesionario."})]}):n.includes("voluntario")?e.jsxs("div",{className:"space-y-4 mt-6 pt-6 border-t border-gray-200",children:[e.jsx("h3",{className:"font-medium text-lg",children:"InformaciÃ³n de Voluntario"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Complete la informaciÃ³n bÃ¡sica para crear el perfil de voluntario."})]}):null})(),e.jsxs(we,{className:"pt-4",children:[e.jsx(d,{type:"button",variant:"outline",onClick:C,disabled:p,children:"Cancelar"}),e.jsxs(d,{type:"submit",disabled:p,children:[p&&e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),g?"Crear usuario":"Guardar cambios"]})]})]})]})})},ja=({isOpen:s,title:g,message:C,onConfirm:A,onCancel:p,isLoading:v})=>e.jsx(Ne,{open:s,onOpenChange:p,children:e.jsxs(be,{children:[e.jsx(ye,{children:e.jsx(Ce,{children:g})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:C})}),e.jsxs(we,{children:[e.jsx(d,{variant:"outline",onClick:p,disabled:v,children:"Cancelar"}),e.jsxs(d,{variant:"destructive",onClick:A,disabled:v,children:[v&&e.jsx(re,{className:"mr-2 h-4 w-4 animate-spin"}),"Confirmar"]})]})]})}),Ia=()=>{const s=Qe(),{toast:g}=Ge(),[C,A]=m.useState(""),[p,v]=m.useState(null),[c,q]=m.useState(null),[w,k]=m.useState(!1),[x,L]=m.useState(!1),[D,r]=m.useState(null),[n,t]=m.useState("id"),[f,h]=m.useState("asc"),[b,I]=m.useState("all"),[y,T]=m.useState("all"),[B,Se]=m.useState(!1),[U,R]=m.useState([]),[H,te]=m.useState(""),[j,F]=m.useState(1),[Y]=m.useState(10);m.useEffect(()=>{F(1)},[C,b,y]);const{data:ie,isLoading:Ue,isError:ke,refetch:va}=le({queryKey:["/api/users"],retry:1,queryFn:async()=>{try{const a=await fetch("/api/users");if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);const l=await a.json();return console.log("Usuarios obtenidos de la API:",l),l}catch(a){throw console.error("Error fetching users:",a),a}}}),V=Array.isArray(ie)?ie:[];console.log("Total usuarios procesados:",V.length);const ne=xe({mutationFn:async a=>{const l=!!p,i=l?`/api/users/${p==null?void 0:p.id}`:"/api/users",o=l?"PUT":"POST";if(l&&!a.password){const{password:he,...Je}=a;a=Je}console.log(`${o} usuario:`,a);const u=await fetch(i,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!u.ok){const he=await u.json();throw new Error(he.message||"Error al procesar la solicitud")}return await u.json()},onSuccess:()=>{s.invalidateQueries({queryKey:["/api/users"]}),g({title:w?"Usuario creado":"Usuario actualizado",description:w?"El usuario ha sido creado exitosamente":"Los datos del usuario han sido actualizados"}),ce()},onError:a=>{console.error("Error saving user:",a),g({title:"Error",description:`No se pudo ${w?"crear":"actualizar"} el usuario. IntÃ©ntalo de nuevo.`,variant:"destructive"})}}),oe=xe({mutationFn:async a=>{console.log("DELETE usuario:",a);const l=await fetch(`/api/users/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!l.ok){const i=await l.json().catch(()=>({}));throw new Error(i.message||"Error al eliminar el usuario")}return a},onSuccess:()=>{s.invalidateQueries({queryKey:["/api/users"]}),g({title:"Usuario eliminado",description:"El usuario ha sido eliminado exitosamente"}),L(!1),r(null)},onError:a=>{console.error("Error deleting user:",a),g({title:"Error",description:"No se pudo eliminar el usuario. IntÃ©ntalo de nuevo.",variant:"destructive"}),L(!1)}}),Ee=()=>{v(null),k(!0)},Pe=a=>{v(a),q(a.id),k(!1)},ce=()=>{v(null),q(null),k(!1)},De=async a=>{const l=c||p&&p.id;if(a.profileImageUrl&&l)try{localStorage.setItem(`profile_image_${l}`,a.profileImageUrl),console.log(`Imagen guardada en localStorage para usuario ID: ${l}`),(await fetch(`/api/users/${l}/profile-image`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({imageUrl:a.profileImageUrl})})).ok?console.log(`âœ… Imagen guardada con Ã©xito para el usuario ID: ${l}`):console.error(`âŒ Error al guardar la imagen para el usuario ID: ${l}`);const o=()=>{fetch(`/api/users/${l}/profile-image`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({imageUrl:a.profileImageUrl})}).then(()=>console.log(`VerificaciÃ³n adicional completada para usuario ID: ${l}`))};setTimeout(o,500),setTimeout(o,1500)}catch(i){console.error("Error al guardar la imagen en la cachÃ©:",i)}ne.mutate(a)},Te=a=>{r(a),L(!0)},Fe=()=>{D&&oe.mutate(D.id)},_=a=>{n===a?h(f==="asc"?"desc":"asc"):(t(a),h("asc"))},z=a=>n!==a?e.jsx(da,{className:"h-4 w-4 text-gray-400"}):f==="asc"?e.jsx(ua,{className:"h-4 w-4 text-blue-600"}):e.jsx(ma,{className:"h-4 w-4 text-blue-600"}),$e=()=>{A(""),I("all"),T("all"),t("id"),h("asc"),F(1)},Ae=()=>{const a={};return W.forEach(l=>{a[l.id]=0}),console.log("ðŸ” Debug: Total usuarios para estadÃ­sticas:",V.length),V.forEach((l,i)=>{if(console.log(`ðŸ” Debug Usuario ${i+1}:`,{id:l.id,roleId:l.roleId,roleName:l.roleName,roleLevel:l.roleLevel}),l.roleId){const o=String(l.roleId);a[o]=(a[o]||0)+1,console.log(`âœ… Rol ID encontrado: ${o} (${l.roleName}), Contador: ${a[o]}`)}else a[7]=(a[7]||0)+1,console.log(`âš ï¸ Usuario sin roleId, asignado a rol 7, Contador: ${a[7]}`)}),console.log("ðŸ“Š EstadÃ­sticas finales por rol:",a),a},Le=(a,l)=>{R(l?i=>[...i,a]:i=>i.filter(o=>o!==a))},Re=a=>{R(a?M.map(l=>l.id):[])},_e=async()=>{if(!H||U.length===0){g({title:"Error",description:"Selecciona usuarios y un rol para asignar",variant:"destructive"});return}try{console.log("AsignaciÃ³n masiva:",{users:U,roleId:H}),g({title:"Roles asignados",description:`Se asignÃ³ el rol a ${U.length} usuarios exitosamente`}),R([]),te("")}catch{g({title:"Error en asignaciÃ³n masiva",description:"No se pudieron asignar los roles",variant:"destructive"})}},de=V.filter(a=>{const l=C.toLowerCase(),i=a.username.toLowerCase().includes(l)||a.email.toLowerCase().includes(l)||a.fullName&&a.fullName.toLowerCase().includes(l)||a.roleName&&a.roleName.toLowerCase().includes(l);let o=!0;b!=="all"&&b&&(o=a.roleId?String(a.roleId)===b:!1);let u=!0;if(y!=="all")switch(y){case"admin":u=a.roleId&&[1,2].includes(Number(a.roleId));break;case"staff":u=a.roleId&&[3,4,5].includes(Number(a.roleId));break;case"community":u=a.roleId&&Number(a.roleId)===6;break;case"business":u=a.roleId&&Number(a.roleId)===7;break;case"active":u=a.createdAt?new Date(a.createdAt)>new Date(Date.now()-30*24*60*60*1e3):!1;break;default:u=!0}return i&&o&&u}).sort((a,l)=>{const i=a[n],o=l[n];if(i==null)return 1;if(o==null)return-1;let u=0;return i<o&&(u=-1),i>o&&(u=1),f==="asc"?u:-u}),O=de.length;console.log("Usuarios despuÃ©s del filtro:",O);const S=Math.ceil(O/Y),Z=(j-1)*Y,me=Z+Y,M=de.slice(Z,me);console.log("Usuarios en pÃ¡gina actual:",M.length);const ze=a=>{F(a)},Oe=()=>{j>1&&F(j-1)},Me=()=>{j<S&&F(j+1)},qe=()=>{F(1)},Be=()=>{F(S)},Ve=a=>{if(!a)return"N/A";try{return ha(new Date(a),"dd/MM/yyyy HH:mm",{locale:xa})}catch(l){return console.error("Error al formatear fecha:",l),"Fecha invÃ¡lida"}},Ke=a=>a.roleId?e.jsx(X,{roleId:String(a.roleId),size:"sm"}):e.jsx(X,{roleId:"7",size:"sm"}),{t:ee}=ue("common"),{t:ae}=ue("users");return e.jsx(He,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(se,{className:"p-6 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:ae("title")}),e.jsx("p",{className:"text-gray-600 mt-2",children:ae("subtitle")})]})]}),e.jsxs(d,{onClick:Ee,className:"bg-[#00a587] hover:bg-[#067f5f]",children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),ae("newUser")]})]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:W.map(a=>{const l=Ae()[a.id]||0,i=a.icon;return e.jsx(se,{className:"p-4 hover:bg-blue-50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded bg-blue-100 text-blue-800",children:e.jsx(i,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:l}),e.jsx("div",{className:"text-xs text-gray-600",children:a.displayName})]})]})},a.id)})}),e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{className:"relative w-full sm:w-96",children:[e.jsx(Ye,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx($,{type:"search",placeholder:`${ee("actions.search")} ${ee("navigation.users")}...`,className:"pl-9",value:C,onChange:a=>A(a.target.value)})]}),e.jsxs(d,{variant:"outline",onClick:()=>Se(!B),className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),ee("actions.filter")]})]}),B&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrar por rol especÃ­fico"}),e.jsxs(K,{value:b,onValueChange:I,children:[e.jsx(J,{children:e.jsx(Q,{placeholder:"Todos los roles"})}),e.jsxs(G,{children:[e.jsx(N,{value:"all",children:"Todos los roles"}),W.map(a=>e.jsx(N,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{roleId:a.id,size:"sm",showText:!1}),e.jsx("span",{children:a.displayName})]})},a.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filtrar por tipo de usuario"}),e.jsxs(K,{value:y,onValueChange:T,children:[e.jsx(J,{children:e.jsx(Q,{placeholder:"Todos los tipos"})}),e.jsxs(G,{children:[e.jsx(N,{value:"all",children:"Todos los tipos"}),e.jsx(N,{value:"admin",children:"AdministraciÃ³n"}),e.jsx(N,{value:"staff",children:"Personal"}),e.jsx(N,{value:"community",children:"Comunidad"}),e.jsx(N,{value:"business",children:"Negocios"}),e.jsx(N,{value:"active",children:"Usuarios activos (Ãºltimos 30 dÃ­as)"})]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs(d,{variant:"outline",onClick:$e,className:"flex items-center gap-2 w-full",children:[e.jsx(ea,{className:"h-4 w-4"}),"Limpiar filtros"]})})]}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600 pt-2 border-t",children:[e.jsxs("span",{children:["Mostrando ",O," de ",V.length," usuarios"]}),e.jsxs("span",{children:["PÃ¡gina ",j," de ",S]})]})]})]}),U.length>0&&e.jsx(se,{className:"p-4 bg-blue-50 border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-sm font-medium text-blue-900",children:[U.length," usuario",U.length>1?"s":""," seleccionado",U.length>1?"s":""]}),e.jsxs(K,{value:H,onValueChange:te,children:[e.jsx(J,{className:"w-64",children:e.jsx(Q,{placeholder:"Seleccionar nuevo rol"})}),e.jsx(G,{children:W.map(a=>e.jsx(N,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{roleId:a.id,size:"sm",showText:!1}),e.jsx("span",{children:a.displayName})]})},a.id))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{onClick:_e,disabled:!H,className:"bg-blue-600 hover:bg-blue-700",children:"Asignar Rol"}),e.jsx(d,{variant:"outline",onClick:()=>R([]),children:"Cancelar"})]})]})}),e.jsx("div",{className:"rounded-md border",children:Ue?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(re,{className:"h-8 w-8 animate-spin text-primary"})}):ke?e.jsxs("div",{className:"flex justify-center items-center p-8 text-red-500",children:[e.jsx(je,{className:"h-8 w-8 mr-2"}),e.jsx("span",{children:"Error al cargar los usuarios. IntÃ©ntalo de nuevo."})]}):M.length===0?e.jsxs("div",{className:"flex flex-col justify-center items-center p-8 text-gray-500",children:[e.jsx(Ie,{className:"h-12 w-12 mb-2"}),e.jsx("h3",{className:"text-lg font-medium",children:"No se encontraron usuarios"}),C?e.jsxs("p",{children:['No hay resultados para "',C,'". Intenta con otra bÃºsqueda.']}):e.jsx("p",{children:"No hay usuarios registrados en el sistema."})]}):e.jsxs(aa,{children:[e.jsx(sa,{children:e.jsxs(ge,{children:[e.jsx(E,{className:"w-12",children:e.jsx(pe,{checked:U.length===M.length&&M.length>0,onCheckedChange:Re})}),e.jsx(E,{children:e.jsxs(d,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>_("id"),children:["ID ",z("id")]})}),e.jsx(E,{children:e.jsxs(d,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>_("username"),children:["Usuario ",z("username")]})}),e.jsx(E,{children:e.jsxs(d,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>_("email"),children:["Email ",z("email")]})}),e.jsx(E,{children:e.jsxs(d,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>_("fullName"),children:["Nombre ",z("fullName")]})}),e.jsx(E,{children:e.jsxs(d,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>_("role"),children:["Rol ",z("role")]})}),e.jsx(E,{children:e.jsxs(d,{variant:"ghost",className:"h-auto p-0 font-semibold hover:bg-transparent",onClick:()=>_("createdAt"),children:["Fecha de CreaciÃ³n ",z("createdAt")]})}),e.jsx(E,{className:"text-right",children:"Acciones"})]})}),e.jsx(la,{children:M.map(a=>e.jsxs(ge,{children:[e.jsx(P,{children:e.jsx(pe,{checked:U.includes(a.id),onCheckedChange:l=>Le(a.id,l)})}),e.jsx(P,{className:"font-medium",children:a.id}),e.jsx(P,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ve,{userId:a.id,role:a.role,name:a.fullName||`${a.firstName||""} ${a.lastName||""}`,size:"sm"}),e.jsx("span",{children:a.username})]})}),e.jsx(P,{children:a.email}),e.jsx(P,{children:a.fullName||"Sin nombre"}),e.jsx(P,{children:Ke(a)}),e.jsx(P,{children:Ve(a.createdAt)}),e.jsx(P,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>Pe(a),title:"Editar usuario",children:e.jsx(ra,{className:"h-4 w-4"})}),e.jsx(d,{variant:"ghost",size:"icon",onClick:()=>Te(a),title:"Eliminar usuario",className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsx(ta,{className:"h-4 w-4"})})]})})]},a.id))})]})}),O>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",Z+1," a ",Math.min(me,O)," de ",O," usuarios"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{variant:"outline",size:"icon",onClick:qe,disabled:j===1,title:"Primera pÃ¡gina",children:e.jsx(ga,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:Oe,disabled:j===1,title:"PÃ¡gina anterior",children:e.jsx(ia,{className:"h-4 w-4"})}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,S)},(a,l)=>{let i;S<=5||j<=3?i=l+1:j>=S-2?i=S-4+l:i=j-2+l;const o=i===j;return e.jsx(d,{variant:o?"default":"outline",size:"icon",onClick:()=>ze(i),className:o?"bg-primary text-primary-foreground":"",children:i},i)})}),e.jsx(d,{variant:"outline",size:"icon",onClick:Me,disabled:j===S,title:"PÃ¡gina siguiente",children:e.jsx(na,{className:"h-4 w-4"})}),e.jsx(d,{variant:"outline",size:"icon",onClick:Be,disabled:j===S,title:"Ãšltima pÃ¡gina",children:e.jsx(pa,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["PÃ¡gina ",j," de ",S]})]}),(p!==null||w)&&e.jsx(fa,{user:p,isNew:w,onClose:ce,onSave:De,isSaving:ne.isPending,editingUserId:c}),e.jsx(ja,{isOpen:x,title:"Eliminar Usuario",message:`Â¿EstÃ¡s seguro de que deseas eliminar al usuario ${D==null?void 0:D.username}?`,onConfirm:Fe,onCancel:()=>L(!1),isLoading:oe.isPending})]})})};export{Ia as default};
