import{a2 as y,l as A,ae as P,ag as S,j as e,L as k,B as d,A as M,bF as O,e as z,bG as F,f as o,i as l,a7 as R,o as c,g as E,h as L,a5 as b,ab as T,R as V,bp as q,ao as B,bO as D,bY as v,b as H,Z as J,a3 as $,au as I}from"./index-D5qLf1ib.js";import{D as U}from"./DynamicAdminLayout-FWhFap-u.js";import{C as Z,G as Q}from"./gem-dXiyKzl3.js";import"./RoleBadge-D5voYAx-.js";const n=[{id:"super-admin",name:"super-admin",displayName:"Super Admin",level:10,badge:{color:"bg-red-500",icon:e.jsx(Z,{className:"w-3 h-3"})}},{id:"director-general",name:"director-general",displayName:"Director General",level:9,badge:{color:"bg-purple-500",icon:e.jsx(H,{className:"w-3 h-3"})}},{id:"coordinador-parques",name:"coordinador-parques",displayName:"Coord. Parques",level:8,badge:{color:"bg-green-500",icon:e.jsx(Q,{className:"w-3 h-3"})}},{id:"coordinador-actividades",name:"coordinador-actividades",displayName:"Coord. Actividades",level:7,badge:{color:"bg-blue-500",icon:e.jsx(J,{className:"w-3 h-3"})}},{id:"operador-parque",name:"operador-parque",displayName:"Operador",level:4,badge:{color:"bg-orange-500",icon:e.jsx($,{className:"w-3 h-3"})}},{id:"admin-financiero",name:"admin-financiero",displayName:"Admin Financiero",level:6,badge:{color:"bg-yellow-500",icon:e.jsx(v,{className:"w-3 h-3"})}},{id:"consultor-auditor",name:"consultor-auditor",displayName:"Consultor",level:1,badge:{color:"bg-gray-500",icon:e.jsx(I,{className:"w-3 h-3"})}}],m=[{id:"config_view_notifications",name:"Ver Notificaciones",module:"Configuración",type:"read",description:"Ver configuración de notificaciones"},{id:"config_manage_notifications",name:"Gestionar Notificaciones",module:"Configuración",type:"write",description:"Configurar notificaciones del sistema"},{id:"config_system_settings",name:"Configuraciones Sistema",module:"Configuración",type:"admin",description:"Acceso completo a configuraciones"},{id:"mgmt_view_dashboards",name:"Ver Dashboards",module:"Gestión",type:"read",description:"Acceso a dashboards informativos"},{id:"mgmt_manage_parks",name:"Gestionar Parques",module:"Gestión",type:"write",description:"Crear y editar información de parques"},{id:"mgmt_manage_activities",name:"Gestionar Actividades",module:"Gestión",type:"write",description:"Administrar actividades y eventos"},{id:"mgmt_manage_visitors",name:"Gestionar Visitantes",module:"Gestión",type:"write",description:"Registrar y analizar visitantes"},{id:"ops_view_assets",name:"Ver Activos",module:"Operaciones",type:"read",description:"Consultar inventario de activos"},{id:"ops_manage_assets",name:"Gestionar Activos",module:"Operaciones",type:"write",description:"Administrar inventario y activos"},{id:"ops_schedule_maintenance",name:"Programar Mantenimiento",module:"Operaciones",type:"write",description:"Crear y programar mantenimiento"},{id:"ops_manage_incidents",name:"Gestionar Incidencias",module:"Operaciones",type:"write",description:"Reportar y gestionar incidencias"},{id:"fin_view_dashboard",name:"Ver Dashboard Financiero",module:"Finanzas",type:"read",description:"Acceso a información financiera"},{id:"fin_manage_budgets",name:"Gestionar Presupuestos",module:"Finanzas",type:"write",description:"Crear y modificar presupuestos"},{id:"fin_manage_transactions",name:"Gestionar Transacciones",module:"Finanzas",type:"admin",description:"Control total de transacciones"},{id:"mkt_manage_communications",name:"Gestionar Comunicaciones",module:"Marketing",type:"write",description:"Crear y enviar comunicaciones"},{id:"mkt_manage_advertising",name:"Gestionar Publicidad",module:"Marketing",type:"write",description:"Administrar espacios publicitarios"},{id:"hr_view_employees",name:"Ver Empleados",module:"RH",type:"read",description:"Consultar información de empleados"},{id:"hr_manage_employees",name:"Gestionar Empleados",module:"RH",type:"write",description:"Administrar información de personal"},{id:"hr_manage_payroll",name:"Gestionar Nómina",module:"RH",type:"admin",description:"Control de nómina y pagos"},{id:"sec_view_users",name:"Ver Usuarios",module:"Seguridad",type:"read",description:"Consultar lista de usuarios"},{id:"sec_manage_users",name:"Gestionar Usuarios",module:"Seguridad",type:"admin",description:"Crear y administrar usuarios"},{id:"sec_manage_roles",name:"Gestionar Roles",module:"Seguridad",type:"admin",description:"Administrar roles y permisos"}];function ee(){const[t,u]=y.useState(()=>{const a=localStorage.getItem("admin-roles-permission-matrix");return a?JSON.parse(a):{}}),[p,N]=y.useState("all"),{toast:g}=A();P();const h=S({mutationFn:async a=>(await new Promise(s=>setTimeout(s,1500)),console.log("Guardando matriz:",a),{success:!0}),onSuccess:()=>{g({title:"Matriz guardada",description:"Los permisos se han actualizado correctamente."})},onError:a=>{g({title:"Error al guardar",description:a.message,variant:"destructive"})}}),w=(a,s)=>{var r;const i={...t,[a]:{...t[a],[s]:!((r=t[a])!=null&&r[s])}};u(i),localStorage.setItem("admin-roles-permission-matrix",JSON.stringify(i))},_=(a,s)=>{var i;return((i=t[a])==null?void 0:i[s])||!1},j=p==="all"?m:m.filter(a=>a.type===p),C=j.reduce((a,s)=>(a[s.module]||(a[s.module]=[]),a[s.module].push(s),a),{}),f=a=>{if(a==="clear"){u({}),localStorage.setItem("admin-roles-permission-matrix",JSON.stringify({}));return}const s={};n.forEach(i=>{s[i.id]={},m.forEach(r=>{if(i.id==="super-admin"){s[i.id][r.id]=!0;return}let x=!1;switch(r.type){case"read":x=i.level>=1;break;case"write":x=i.level>=4;break;case"admin":x=i.level>=8;break}s[i.id][r.id]=x})}),u(s),localStorage.setItem("admin-roles-permission-matrix",JSON.stringify(s)),g({title:"Plantilla aplicada",description:"Se han asignado permisos según la jerarquía de roles."})},G=a=>{switch(a){case"read":return"bg-gray-100 text-gray-700";case"write":return"bg-blue-100 text-blue-700";case"admin":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return e.jsx(U,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(k,{href:"/admin-roles/permissions",children:e.jsxs(d,{variant:"outline",size:"sm",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Matriz de Permisos"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Configurar permisos específicos para cada rol del sistema"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(d,{variant:"outline",onClick:()=>f("clear"),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Limpiar Todo"]}),e.jsxs(d,{variant:"outline",onClick:()=>f("hierarchical"),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Aplicar Plantilla"]}),e.jsx(d,{onClick:()=>h.mutate(t),disabled:h.isPending,children:h.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 mr-2 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Guardar Cambios"]})})]})]}),e.jsx(o,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-medium",children:"Filtrar por tipo:"})]}),e.jsx("div",{className:"flex gap-2",children:["all","read","write","admin"].map(a=>e.jsx(d,{variant:p===a?"default":"outline",size:"sm",onClick:()=>N(a),children:a==="all"?"Todos":a==="read"?"Lectura":a==="write"?"Escritura":"Admin"},a))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",className:"text-gray-600",children:[j.length," permisos mostrados"]}),e.jsxs(c,{variant:"outline",className:"text-blue-600",children:[n.length," roles"]})]})]})})}),e.jsxs(o,{children:[e.jsxs(E,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"Matriz de Roles vs Permisos"]}),e.jsx(T,{children:"Marca las casillas para asignar permisos específicos a cada rol"})]}),e.jsx(l,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left border-b font-medium text-gray-900 sticky left-0 bg-white z-10 min-w-[250px]",children:"Permisos / Roles"}),n.map(a=>e.jsx("th",{className:"p-3 text-center border-b font-medium min-w-[120px]",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("div",{className:`inline-flex items-center justify-center rounded text-white w-8 h-8 ${a.badge.color}`,children:a.badge.icon}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs font-medium",children:a.name.toUpperCase()}),e.jsxs(c,{variant:"outline",className:"text-xs",children:["Nivel ",a.level]})]})]})},a.id))]})}),e.jsx("tbody",{children:Object.entries(C).map(([a,s])=>e.jsxs(V.Fragment,{children:[e.jsx("tr",{children:e.jsx("td",{colSpan:n.length+1,className:"p-3 bg-gray-50 border-b",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-gray-600"}),e.jsx("span",{className:"font-semibold text-gray-900",children:a}),e.jsxs(c,{variant:"secondary",className:"ml-auto",children:[s.length," permisos"]})]})})}),s.map(i=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-b sticky left-0 bg-white z-10",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:i.name}),e.jsx("p",{className:"text-sm text-gray-600",children:i.description})]}),e.jsx(c,{variant:"secondary",className:`text-xs ${G(i.type)}`,children:i.type==="read"?"Lectura":i.type==="write"?"Escritura":"Admin"})]})}),n.map(r=>e.jsx("td",{className:"p-3 border-b text-center",children:e.jsx(B,{checked:_(r.id,i.id),onCheckedChange:()=>w(r.id,i.id),className:"mx-auto"})},`${r.id}-${i.id}`))]},i.id))]},a))})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(o,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Permisos Asignados"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:Object.values(t).reduce((a,s)=>a+Object.values(s).filter(Boolean).length,0)})]}),e.jsx(b,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(o,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Posible"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900",children:n.length*m.length})]}),e.jsx(D,{className:"h-8 w-8 text-gray-500"})]})})}),e.jsx(o,{children:e.jsx(l,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Cobertura"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[Math.round(Object.values(t).reduce((a,s)=>a+Object.values(s).filter(Boolean).length,0)/(n.length*m.length)*100),"%"]})]}),e.jsx(v,{className:"h-8 w-8 text-green-500"})]})})})]})]})})}export{ee as default};
