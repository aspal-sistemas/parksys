import{ce as ve,cX as $,cf as w,a2 as g,l as ye,u as J,af as ie,ap as te,ag as Q,j as e,aX as Ne,aY as fe,B as t,aB as D,w as X,x as Ce,bh as be,y as B,z as Y,I as H,J as U,ai as le,aj as l,ak as o,al as c,Q as p,am as d,V as v,W as y,Y as N,_ as n,an as h,O as j,N as O,f as Ie,g as Se,h as we,as as De,ab as Ee,i as Fe,m as Me,ah as Te,bq as ke,bn as Ae,aM as Oe,aN as Pe,ca as _}from"./index-D5qLf1ib.js";const oe=ve({parkId:$(),categoryId:$(),subcategory:w().optional(),amount:$().min(.01,"El monto debe ser mayor a 0"),description:w().min(1,"La descripción es requerida"),date:w().min(1,"La fecha es requerida"),source:w().optional(),notes:w().optional()}),Ve=()=>{const[ce,P]=g.useState(!1),[G,W]=g.useState(null),[de,E]=g.useState(!1),[he,F]=g.useState(!1),[I,Z]=g.useState(null),[i,S]=g.useState({year:"",month:"",date:"",category:"",amount:""}),[u,M]=g.useState(1),q=10,{toast:f}=ye(),{data:T,isLoading:ee,refetch:xe}=J({queryKey:["/api/actual-incomes"]}),{data:k,isLoading:qe}=J({queryKey:["/api/parks"]}),{data:C,isLoading:Le}=J({queryKey:["/api/income-categories"]}),m=ie({resolver:te(oe),defaultValues:{parkId:3,amount:void 0,description:"",date:new Date().toISOString().split("T")[0],source:"",notes:""}}),x=ie({resolver:te(oe),defaultValues:{parkId:3,amount:void 0,description:"",date:new Date().toISOString().split("T")[0],source:"",notes:""}}),L=Q({mutationFn:async s=>{const r=await fetch("/api/actual-incomes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const a=await r.text();throw new Error(`Error al crear el ingreso: ${a}`)}return await r.json()},onSuccess:()=>{_.invalidateQueries({queryKey:["/api/actual-incomes"]}),P(!1),m.reset(),f({title:"Ingreso creado",description:"El ingreso se ha creado correctamente."})},onError:s=>{console.error("Error al crear ingreso:",s),f({title:"Error",description:"No se pudo crear el ingreso. Intenta nuevamente.",variant:"destructive"})}}),z=Q({mutationFn:async s=>{const r=await fetch(`/api/actual-incomes/${G.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok){const a=await r.text();throw new Error(`Error al editar el ingreso: ${a}`)}return await r.json()},onSuccess:()=>{_.invalidateQueries({queryKey:["/api/actual-incomes"]}),E(!1),W(null),x.reset(),f({title:"Ingreso actualizado",description:"El ingreso se ha actualizado correctamente."})},onError:s=>{console.error("Error al editar ingreso:",s),f({title:"Error",description:"No se pudo editar el ingreso. Intenta nuevamente.",variant:"destructive"})}}),V=Q({mutationFn:async s=>{const r=await fetch(`/api/actual-incomes/${s}`,{method:"DELETE"});if(!r.ok){const a=await r.text();throw new Error(`Error al eliminar el ingreso: ${a}`)}return await r.json()},onSuccess:()=>{_.invalidateQueries({queryKey:["/api/actual-incomes"]}),F(!1),Z(null),f({title:"Ingreso eliminado",description:"El ingreso se ha eliminado correctamente."})},onError:s=>{console.error("Error al eliminar ingreso:",s),f({title:"Error",description:"No se pudo eliminar el ingreso. Intenta nuevamente.",variant:"destructive"})}}),je=s=>{W(s),x.reset({parkId:s.parkId,categoryId:s.categoryId,amount:s.amount,description:s.description||"",date:s.date?s.date.split("T")[0]:new Date().toISOString().split("T")[0],source:s.source||"",notes:s.notes||""}),E(!0)},se=g.useMemo(()=>!T||!Array.isArray(T)?[]:T.filter(s=>{const r=new Date(s.date),a=r.getFullYear().toString(),ue=(r.getMonth()+1).toString().padStart(2,"0"),pe=r.toISOString().split("T")[0];return!(i.year&&a!==i.year||i.month&&ue!==i.month||i.date&&pe!==i.date||i.category&&s.categoryId.toString()!==i.category)}),[T,i]),A=se.length,b=Math.ceil(A/q),K=(u-1)*q,ae=K+q,R=se.slice(K,ae);g.useMemo(()=>{M(1)},[i]);const re=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(s),ne=s=>new Date(s).toLocaleDateString("es-MX"),me=s=>{L.mutate(s)},ge=s=>{z.mutate(s)};return e.jsx(Ne,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(fe,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Cédula de Ingresos"}),e.jsx("p",{className:"text-gray-600",children:"Gestión y registro de todos los ingresos del parque"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(t,{variant:"outline",onClick:()=>xe(),className:"flex items-center gap-2",children:[e.jsx(D,{className:`h-4 w-4 ${ee?"animate-spin":""}`}),"Actualizar"]})})]}),e.jsxs(X,{open:ce,onOpenChange:P,children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(t,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Nuevo Ingreso"]})}),e.jsxs(B,{className:"max-w-lg",children:[e.jsxs(Y,{children:[e.jsx(H,{children:"Registrar Nuevo Ingreso"}),e.jsx(U,{children:"Completa la información del ingreso a registrar."})]}),e.jsx(le,{...m,children:e.jsxs("form",{onSubmit:m.handleSubmit(me),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:m.control,name:"parkId",render:({field:s})=>{var r;return e.jsxs(o,{children:[e.jsx(c,{children:"Parque"}),e.jsxs(p,{onValueChange:a=>s.onChange(parseInt(a)),value:(r=s.value)==null?void 0:r.toString(),children:[e.jsx(d,{children:e.jsx(v,{children:e.jsx(y,{placeholder:"Selecciona parque"})})}),e.jsx(N,{children:Array.isArray(k)&&k.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(h,{})]})}}),e.jsx(l,{control:m.control,name:"categoryId",render:({field:s})=>{var r;return e.jsxs(o,{children:[e.jsx(c,{children:"Categoría"}),e.jsxs(p,{onValueChange:a=>s.onChange(parseInt(a)),value:(r=s.value)==null?void 0:r.toString(),children:[e.jsx(d,{children:e.jsx(v,{children:e.jsx(y,{placeholder:"Selecciona categoría"})})}),e.jsx(N,{children:Array.isArray(C)&&C.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(h,{})]})}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:m.control,name:"amount",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Monto"}),e.jsx(d,{children:e.jsx(j,{type:"number",placeholder:"0.00",...s,onChange:r=>s.onChange(parseFloat(r.target.value)||0)})}),e.jsx(h,{})]})}),e.jsx(l,{control:m.control,name:"date",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Fecha"}),e.jsx(d,{children:e.jsx(j,{type:"date",...s})}),e.jsx(h,{})]})})]}),e.jsx(l,{control:m.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Descripción"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Descripción del ingreso",...s})}),e.jsx(h,{})]})}),e.jsx(l,{control:m.control,name:"source",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Fuente (Opcional)"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Fuente del ingreso",...s})}),e.jsx(h,{})]})}),e.jsx(l,{control:m.control,name:"notes",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Notas (Opcional)"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Notas adicionales",...s})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancelar"}),e.jsxs(t,{type:"submit",disabled:L.isPending,children:[L.isPending&&e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Registrar Ingreso"]})]})]})})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Filtros"}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"filter-year",children:"Año"}),e.jsxs(p,{value:i.year,onValueChange:s=>S({...i,year:s}),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Año"})}),e.jsxs(N,{children:[e.jsx(n,{value:"all",children:"Todos los años"}),e.jsx(n,{value:"2025",children:"2025"}),e.jsx(n,{value:"2024",children:"2024"}),e.jsx(n,{value:"2023",children:"2023"})]})]})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"filter-month",children:"Mes"}),e.jsxs(p,{value:i.month,onValueChange:s=>S({...i,month:s}),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Mes"})}),e.jsxs(N,{children:[e.jsx(n,{value:"all",children:"Todos los meses"}),e.jsx(n,{value:"01",children:"Enero"}),e.jsx(n,{value:"02",children:"Febrero"}),e.jsx(n,{value:"03",children:"Marzo"}),e.jsx(n,{value:"04",children:"Abril"}),e.jsx(n,{value:"05",children:"Mayo"}),e.jsx(n,{value:"06",children:"Junio"}),e.jsx(n,{value:"07",children:"Julio"}),e.jsx(n,{value:"08",children:"Agosto"}),e.jsx(n,{value:"09",children:"Septiembre"}),e.jsx(n,{value:"10",children:"Octubre"}),e.jsx(n,{value:"11",children:"Noviembre"}),e.jsx(n,{value:"12",children:"Diciembre"})]})]})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"filter-date",children:"Fecha específica"}),e.jsx(j,{type:"date",value:i.date,onChange:s=>S({...i,date:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"filter-category",children:"Categoría"}),e.jsxs(p,{value:i.category,onValueChange:s=>S({...i,category:s}),children:[e.jsx(v,{children:e.jsx(y,{placeholder:"Categoría"})}),e.jsxs(N,{children:[e.jsx(n,{value:"all",children:"Todas las categorías"}),Array.isArray(C)&&C.map(s=>e.jsx(n,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(t,{variant:"outline",onClick:()=>S({year:"",month:"",date:"",category:"",amount:""}),className:"w-full",children:"Limpiar filtros"})})]})]}),e.jsxs(Ie,{children:[e.jsxs(Se,{children:[e.jsxs(we,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5"}),"Registro de Ingresos"]}),e.jsxs(Ee,{children:["Listado completo de todos los ingresos registrados (",A," registros)"]})]}),e.jsxs(Fe,{children:[ee?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(D,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Cargando ingresos..."})]}):R&&R.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-8 gap-4 text-sm font-medium text-gray-500 pb-2 border-b",children:[e.jsx("div",{children:"Fecha"}),e.jsx("div",{children:"Parque"}),e.jsx("div",{children:"Categoría"}),e.jsx("div",{children:"Descripción"}),e.jsx("div",{children:"Monto"}),e.jsx("div",{children:"Fuente"}),e.jsx("div",{children:"Estado"}),e.jsx("div",{children:"Acciones"})]}),R.map(s=>e.jsxs("div",{className:"grid grid-cols-8 gap-4 text-sm py-3 border-b border-gray-100 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-4 w-4 text-gray-400"}),ne(s.date)]}),e.jsx("div",{className:"font-medium",children:s.parkName||"N/A"}),e.jsx("div",{children:e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs",children:s.categoryName||"Sin categoría"})}),e.jsx("div",{className:"text-gray-600",children:s.description}),e.jsx("div",{className:"font-semibold text-green-600",children:re(s.amount)}),e.jsx("div",{className:"text-gray-500",children:s.source||"-"}),e.jsx("div",{children:e.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(Te,{className:"h-4 w-4"}),"Registrado"]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>je(s),className:"h-8 w-8 p-0",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(t,{variant:"ghost",size:"sm",onClick:()=>{Z(s),F(!0)},className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:e.jsx(Ae,{className:"h-4 w-4"})})]})]},s.id))]}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No se encontraron ingresos registrados"}),b>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Página ",u," de ",b," - Mostrando ",K+1,"-",Math.min(ae,A)," de ",A," ingresos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>M(Math.max(1,u-1)),disabled:u===1,className:"flex items-center gap-1",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Anterior"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,b)},(s,r)=>{const a=Math.max(1,Math.min(b-4,u-2))+r;return e.jsx(t,{variant:u===a?"default":"outline",size:"sm",onClick:()=>M(a),className:"w-8 h-8 p-0",children:a},a)})}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>M(Math.min(b,u+1)),disabled:u===b,className:"flex items-center gap-1",children:["Siguiente",e.jsx(Pe,{className:"h-4 w-4"})]})]})]})]})]}),e.jsx(X,{open:de,onOpenChange:E,children:e.jsxs(B,{className:"max-w-lg",children:[e.jsxs(Y,{children:[e.jsx(H,{children:"Editar Ingreso"}),e.jsx(U,{children:"Modifica la información del ingreso."})]}),G&&e.jsx(le,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(ge),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:x.control,name:"parkId",render:({field:s})=>{var r;return e.jsxs(o,{children:[e.jsx(c,{children:"Parque"}),e.jsxs(p,{onValueChange:a=>s.onChange(parseInt(a)),value:(r=s.value)==null?void 0:r.toString(),children:[e.jsx(d,{children:e.jsx(v,{children:e.jsx(y,{placeholder:"Selecciona parque"})})}),e.jsx(N,{children:Array.isArray(k)&&k.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(h,{})]})}}),e.jsx(l,{control:x.control,name:"categoryId",render:({field:s})=>{var r;return e.jsxs(o,{children:[e.jsx(c,{children:"Categoría"}),e.jsxs(p,{onValueChange:a=>s.onChange(parseInt(a)),value:(r=s.value)==null?void 0:r.toString(),children:[e.jsx(d,{children:e.jsx(v,{children:e.jsx(y,{placeholder:"Selecciona categoría"})})}),e.jsx(N,{children:Array.isArray(C)&&C.map(a=>e.jsx(n,{value:a.id.toString(),children:a.name},a.id))})]}),e.jsx(h,{})]})}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:x.control,name:"amount",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Monto"}),e.jsx(d,{children:e.jsx(j,{type:"number",placeholder:"0.00",...s,onChange:r=>s.onChange(parseFloat(r.target.value)||0)})}),e.jsx(h,{})]})}),e.jsx(l,{control:x.control,name:"date",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Fecha"}),e.jsx(d,{children:e.jsx(j,{type:"date",...s})}),e.jsx(h,{})]})})]}),e.jsx(l,{control:x.control,name:"description",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Descripción"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Descripción del ingreso",...s})}),e.jsx(h,{})]})}),e.jsx(l,{control:x.control,name:"source",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Fuente (Opcional)"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Fuente del ingreso",...s})}),e.jsx(h,{})]})}),e.jsx(l,{control:x.control,name:"notes",render:({field:s})=>e.jsxs(o,{children:[e.jsx(c,{children:"Notas (Opcional)"}),e.jsx(d,{children:e.jsx(j,{placeholder:"Notas adicionales",...s})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsxs(t,{type:"submit",disabled:z.isPending,children:[z.isPending&&e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Actualizar Ingreso"]})]})]})})]})}),e.jsx(X,{open:he,onOpenChange:F,children:e.jsxs(B,{children:[e.jsxs(Y,{children:[e.jsx(H,{children:"Confirmar Eliminación"}),e.jsx(U,{children:"¿Estás seguro de que deseas eliminar este ingreso? Esta acción no se puede deshacer."})]}),I&&e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Descripción:"})," ",I.description]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Monto:"})," ",re(I.amount)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fecha:"})," ",ne(I.date)]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(t,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),e.jsxs(t,{variant:"destructive",onClick:()=>V.mutate(I.id),disabled:V.isPending,children:[V.isPending&&e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Eliminar Ingreso"]})]})]})})]})})};export{Ve as default};
