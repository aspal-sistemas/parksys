import{a2 as o,ae as se,u as A,ag as ae,j as e,aX as L,f as p,F as T,L as h,B as r,bh as te,bQ as le,i as E,a4 as re,O as ne,Q as q,V as F,W as I,Y as M,_ as i,a7 as ie,a as ce,g as de,h as oe,o as b,M as me,t as xe,m as z,n as he,au as ge,bq as $,bn as je,aM as pe,aN as ue,w as Ne,y as ye,z as ve,I as fe,p as be,P as V,aq as we}from"./index-D5qLf1ib.js";import{I as Ce}from"./images-BMibsPhC.js";function Le(){const[g,_]=o.useState(""),[u,B]=o.useState("all"),[N,Q]=o.useState("all"),[n,j]=o.useState(1),[a,H]=o.useState(null),[R,w]=o.useState(!1),y=10,C=se(),{data:c,isLoading:G,refetch:K}=A({queryKey:["/api/active-concessions"],suspense:!1,retry:1,queryFn:async()=>(await fetch("/api/active-concessions")).json(),refetchOnWindowFocus:!0,staleTime:3e4}),{data:d}=A({queryKey:["/api/parks"],suspense:!1,retry:1,queryFn:async()=>(await fetch("/api/parks")).json()}),O=ae({mutationFn:s=>we(`/api/active-concessions/${s}`,{method:"DELETE"}),onSuccess:()=>{C.invalidateQueries({queryKey:["/api/active-concessions"]})}}),X=Array.isArray(c==null?void 0:c.data)?c.data:Array.isArray(c)?c:[],U=Array.isArray(d==null?void 0:d.data)?d.data:Array.isArray(d)?d:[],v=X.filter(s=>{const l=s.name||"",t=s.concessionTypeName||"",x=s.parkName||"",ee=s.status||"";return(l.toLowerCase().includes(g.toLowerCase())||t.toLowerCase().includes(g.toLowerCase())||x.toLowerCase().includes(g.toLowerCase()))&&(u==="all"||ee===u)&&(N==="all"||x===N)}),m=Math.ceil(v.length/y),S=(n-1)*y,W=v.slice(S,S+y),f=()=>{j(1)},D=s=>{const l={activa:{color:"bg-green-100 text-green-800",label:"Activa"},suspendida:{color:"bg-red-100 text-red-800",label:"Suspendida"},vencida:{color:"bg-gray-100 text-gray-800",label:"Vencida"},renovacion:{color:"bg-yellow-100 text-yellow-800",label:"En Renovación"}},t=l[s]||l.activa;return e.jsx(b,{className:t.color,children:t.label})},P=s=>{const l={alta:{color:"bg-red-100 text-red-800",label:"Alta"},normal:{color:"bg-blue-100 text-blue-800",label:"Normal"},baja:{color:"bg-gray-100 text-gray-800",label:"Baja"}},t=l[s]||l.normal;return e.jsx(b,{variant:"outline",className:t.color,children:t.label})},Y=s=>{window.confirm(`¿Estás seguro de que deseas eliminar la concesión "${s.name}"?`)&&O.mutate(s.id)},J=()=>{C.invalidateQueries({queryKey:["/api/active-concessions"]}),K()},Z=s=>{H(s),w(!0)},k=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(s);return G?e.jsx(L,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx(p,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Concesiones Activas"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestión integral de concesiones operativas"})]})]})}),e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})]})}):e.jsx(L,{children:e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx(p,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Concesiones Activas"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestión integral de concesiones operativas"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{href:"/admin/concessions/active/new",children:e.jsxs(r,{className:"bg-green-600 hover:bg-green-700 text-white gap-2",children:[e.jsx(te,{size:16}),"Nueva Concesión Activa"]})}),e.jsxs(r,{variant:"outline",onClick:J,className:"border-green-600 text-green-600 hover:bg-green-50 gap-2",children:[e.jsx(le,{size:16}),"Actualizar"]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ne,{placeholder:"Buscar concesiones...",value:g,onChange:s=>{_(s.target.value),f()},className:"pl-10"})]})}),e.jsxs(q,{value:u,onValueChange:s=>{B(s),f()},children:[e.jsx(F,{children:e.jsx(I,{placeholder:"Estado"})}),e.jsxs(M,{children:[e.jsx(i,{value:"all",children:"Todos los estados"}),e.jsx(i,{value:"active",children:"Activa"}),e.jsx(i,{value:"suspended",children:"Suspendida"}),e.jsx(i,{value:"expired",children:"Vencida"}),e.jsx(i,{value:"renewal",children:"En Renovación"})]})]}),e.jsxs(q,{value:N,onValueChange:s=>{Q(s),f()},children:[e.jsx(F,{children:e.jsx(I,{placeholder:"Parque"})}),e.jsxs(M,{children:[e.jsx(i,{value:"all",children:"Todos los parques"}),U.map(s=>e.jsx(i,{value:s.name,children:s.name},s.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[v.length," concesión(es) encontrada(s)"]})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6",children:W.map(s=>e.jsxs(p,{className:"overflow-hidden hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"h-48 bg-gradient-to-br from-green-100 to-green-200 relative",children:[s.primaryImage?e.jsx("img",{src:`${s.primaryImage}${s.primaryImage.includes("?")?"&":"?"}t=${Date.now()}`,alt:s.name,className:"w-full h-full object-cover",onError:l=>{var t,x;l.currentTarget.style.display="none",(x=(t=l.currentTarget.parentElement)==null?void 0:t.querySelector(".fallback-icon"))==null||x.classList.remove("hidden")}}):null,e.jsx("div",{className:`fallback-icon flex items-center justify-center h-full ${s.primaryImage?"hidden":""}`,children:e.jsx(ce,{className:"h-16 w-16 text-green-600 opacity-50"})}),e.jsx("div",{className:"absolute top-4 right-4 flex gap-2",children:D(s.status)}),e.jsx("div",{className:"absolute top-4 left-4",children:P(s.priority)})]}),e.jsxs(de,{className:"pb-2",children:[e.jsx(oe,{className:"text-lg font-semibold line-clamp-1",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:s.description})]}),e.jsxs(E,{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(b,{variant:"secondary",className:"text-xs",children:s.concessionTypeName})}),e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx(me,{className:"h-4 w-4 text-gray-500 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.parkName}),e.jsx("p",{className:"text-gray-600",children:s.specific_location})]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(xe,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"truncate",children:s.concessionaireName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(z,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-gray-600",children:[new Date(s.start_date).toLocaleDateString()," - ",new Date(s.end_date).toLocaleDateString()]})]}),s.operating_hours&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(he,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"text-gray-600",children:s.operating_hours})]}),s.monthly_payment&&e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"font-medium text-green-600",children:[k(s.monthly_payment),"/mes"]})}),e.jsxs("div",{className:"flex gap-2 pt-2 flex-wrap",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>Z(s),className:"flex-1",children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Ver"]}),e.jsx(h,{href:`/admin/concessions/active/${s.id}/edit`,children:e.jsx(r,{variant:"outline",size:"sm",children:e.jsx($,{className:"h-4 w-4"})})}),e.jsx(h,{href:`/admin/concessions/active/${s.id}/images`,children:e.jsx(r,{variant:"outline",size:"sm",className:"text-purple-600 hover:text-purple-700",children:e.jsx(Ce,{className:"h-4 w-4"})})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>Y(s),className:"text-red-600 hover:text-red-700",children:e.jsx(je,{className:"h-4 w-4"})})]})]})]},s.id))}),m>1&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 mt-8",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>j(s=>Math.max(s-1,1)),disabled:n===1,children:[e.jsx(pe,{className:"h-4 w-4"}),"Anterior"]}),e.jsx("div",{className:"flex space-x-1",children:Array.from({length:Math.min(5,m)},(s,l)=>{const t=n<=3?l+1:n-2+l;return t>m?null:e.jsx(r,{variant:n===t?"default":"outline",size:"sm",onClick:()=>j(t),className:n===t?"bg-green-600 hover:bg-green-700":"",children:t},t)})}),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>j(s=>Math.min(s+1,m)),disabled:n===m,children:["Siguiente",e.jsx(ue,{className:"h-4 w-4"})]})]}),e.jsx(Ne,{open:R,onOpenChange:w,children:e.jsxs(ye,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(fe,{className:"text-xl font-bold",children:a==null?void 0:a.name})}),a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-4",children:[D(a.status),P(a.priority)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Información General"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",a.concessionTypeName]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Descripción:"})," ",a.description]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Ubicación:"})," ",a.parkName," - ",a.specificLocation]}),a.operatingHours&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Horarios:"})," ",a.operatingHours]}),a.operatingDays&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Días:"})," ",a.operatingDays]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Concesionario"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.concessionaireName]}),a.concessionaireEmail&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:a.concessionaireEmail})]}),a.concessionairePhone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:a.concessionairePhone})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Vigencia"}),e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[new Date(a.startDate).toLocaleDateString()," - ",new Date(a.endDate).toLocaleDateString()]})]})})]}),a.monthlyPayment&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Información Financiera"}),e.jsx("div",{className:"space-y-2 text-sm",children:e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Pago mensual:"})," ",k(a.monthlyPayment)]})})]})]}),(a.emergencyContact||a.emergencyPhone)&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Contacto de Emergencia"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[a.emergencyContact&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",a.emergencyContact]}),a.emergencyPhone&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:a.emergencyPhone})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[e.jsx(h,{href:`/admin/concessions/active/${a.id}/edit`,children:e.jsxs(r,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Editar Concesión"]})}),e.jsx(h,{href:`/admin/concessions/active/${a.id}/images`,children:e.jsxs(r,{variant:"outline",children:["Gestionar Imágenes (",a.imageCount,")"]})})]})]})]})})]})]})})}export{Le as default};
