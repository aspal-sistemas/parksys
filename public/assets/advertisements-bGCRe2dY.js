import{Y as x,e as ke,a6 as Le,u as oe,a8 as K,j as e,aI as de,B as c,b7 as ce,cg as Pe,D as me,p as qe,b2 as Oe,r as ue,t as xe,v as he,y as r,I as u,z as j,H as f,J as y,K as _,N as d,O as pe,C as w,c as C,bg as Be,aj as Re,b6 as $e,$ as Ge,_ as Ke,ba as ge,bb as ve,d4 as Qe,ai as je,at as We,au as Je}from"./index-Dzu3mJf5.js";const fe=({src:A,alt:E})=>{const[V,b]=x.useState(!1);return!A||V?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center border border-blue-200",children:e.jsx(Qe,{className:"w-6 h-6 text-blue-500"})}):e.jsx("img",{src:A,alt:E,className:"w-full h-full object-cover",onError:()=>b(!0)})},Ze=()=>{const[A,E]=x.useState(!1),[V,b]=x.useState(!1),[Q,W]=x.useState(null),[U,ye]=x.useState(""),[z,_e]=x.useState("all"),[F,be]=x.useState("all"),[J,Ne]=x.useState(Date.now()),[H,we]=x.useState(Date.now()),[T,Ce]=x.useState(null),[D,N]=x.useState(!1),[v,Z]=x.useState(1),[S,Y]=x.useState("list"),k=12,[a,s]=x.useState({title:"",description:"",image_url:"",content:"",button_text:"",campaign_id:0,is_active:!0,media_type:"image",storage_type:"url",duration:0,alt_text:""}),{toast:o}=ke(),p=Le(),X=async t=>{N(!0);try{const i=new FormData;i.append("file",t),console.log("📁 Subiendo archivo:",t.name,t.type,t.size);const n=await fetch("/api/advertising/upload",{method:"POST",body:i,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});console.log("📁 Response status:",n.status);const h=await n.text();if(console.log("📁 Response text:",h),!n.ok){let m="Error al subir el archivo";try{const M=JSON.parse(h);m=M.error||M.message||m}catch(M){console.error("Error parsing response:",M),m=`Error del servidor: ${n.status}`}throw new Error(m)}const l=JSON.parse(h);if(l.success)return l.url;throw new Error(l.error||"Error desconocido")}catch(i){throw console.error("Error uploading file:",i),i}finally{N(!1)}},{data:L,isLoading:Ee,refetch:Se}=oe({queryKey:["/api/advertising-management/advertisements"],staleTime:10*1e3,gcTime:30*1e3}),g=(L==null?void 0:L.data)||[],{data:P}=oe({queryKey:["/api/advertising-management/campaigns"],staleTime:5*60*1e3}),I=(P==null?void 0:P.data)||[];x.useEffect(()=>{if(!g||g.length===0)return;const t=g.find(i=>i.id===13);t&&t.updatedAt&&t.updatedAt!==T&&(console.log("🎯 ANUNCIO 13 DETECTADO - Cambio en timestamp:",{anterior:T,nuevo:t.updatedAt,diferencia:T?"CAMBIO DETECTADO":"PRIMER CARGA"}),Ce(t.updatedAt),ee())},[g,T]);const ee=()=>{console.log("🎯 FORZANDO ACTUALIZACIÓN DEL ANUNCIO 13..."),p.invalidateQueries({queryKey:["/api/advertising-management/advertisements"]}),Ne(Date.now()),we(Date.now()),Se()},Ae=K({mutationFn:async t=>{const i=new FormData;return i.append("campaign_id",t.campaign_id.toString()),i.append("title",t.title),i.append("description",t.description||""),i.append("content",t.content||""),i.append("image_url",t.image_url||""),i.append("media_type",t.media_type||"image"),i.append("storage_type",t.storage_type||"url"),i.append("duration",t.duration.toString()),i.append("alt_text",t.alt_text||""),i.append("is_active",t.is_active.toString()),await fetch("/api/advertising-management/advertisements",{method:"POST",body:i}).then(n=>n.json())},onSuccess:()=>{o({title:"Éxito",description:"Anuncio creado correctamente"}),E(!1),s({title:"",description:"",image_url:"",content:"",campaign_id:0,is_active:!0,media_type:"image",storage_type:"url",duration:0,alt_text:""}),p.invalidateQueries({queryKey:["/api/advertising-management/advertisements"]}),localStorage.setItem("adForceUpdate",Date.now().toString()),window.dispatchEvent(new CustomEvent("adForceUpdate")),window.dispatchEvent(new StorageEvent("storage",{key:"adForceUpdate",newValue:Date.now().toString(),oldValue:null,url:window.location.href})),console.log("🌐 Eventos globales disparados para actualizar todas las páginas (CREATE)")},onError:t=>{o({title:"Error",description:t.message||"Error al crear el anuncio",variant:"destructive"})}}),q=K({mutationFn:async t=>await je(`/api/advertising-management/advertisements/${t.id}`,{method:"PUT",data:t}),onSuccess:()=>{o({title:"Éxito",description:"Anuncio actualizado correctamente"}),b(!1),W(null),p.invalidateQueries({queryKey:["/api/advertising-management/advertisements"]}),p.invalidateQueries({queryKey:["/api/advertising/placements"]}),p.invalidateQueries({queryKey:["/api/advertising"]});const t=[0,500,1e3,1500,2e3,3e3,4e3];t.forEach((i,n)=>{setTimeout(()=>{p.invalidateQueries({queryKey:["/api/advertising/placements"]}),p.refetchQueries({queryKey:["/api/advertising/placements"]}),document.querySelectorAll('img[src*="unsplash"]').forEach(l=>{const m=l.getAttribute("src");m&&l.setAttribute("src",m+"&reload="+Date.now())}),console.log(`🔄 Cache de publicidad invalidado - Iteración ${n+1}/${t.length}`)},i)}),console.log("🔄 Cache de publicidad invalidado completamente"),localStorage.setItem("adForceUpdate",Date.now().toString()),window.dispatchEvent(new CustomEvent("adForceUpdate")),window.dispatchEvent(new StorageEvent("storage",{key:"adForceUpdate",newValue:Date.now().toString(),oldValue:null,url:window.location.href})),console.log("🌐 Eventos globales disparados para actualizar todas las páginas")},onError:t=>{o({title:"Error",description:t.message||"Error al actualizar el anuncio",variant:"destructive"})}}),Fe=K({mutationFn:async t=>await je(`/api/advertising-management/advertisements/${t}`,{method:"DELETE"}),onSuccess:()=>{o({title:"Éxito",description:"Anuncio eliminado correctamente"}),p.invalidateQueries({queryKey:["/api/advertising-management/advertisements"]}),localStorage.setItem("adForceUpdate",Date.now().toString()),window.dispatchEvent(new CustomEvent("adForceUpdate")),window.dispatchEvent(new StorageEvent("storage",{key:"adForceUpdate",newValue:Date.now().toString(),oldValue:null,url:window.location.href})),console.log("🌐 Eventos globales disparados para actualizar todas las páginas (DELETE)")},onError:t=>{o({title:"Error",description:t.message||"Error al eliminar el anuncio",variant:"destructive"})}}),Te=t=>{if(t.preventDefault(),!a.title||!a.image_url||a.campaign_id===0){o({title:"Error",description:"Por favor completa todos los campos requeridos",variant:"destructive"});return}Ae.mutate(a)},De=t=>{if(t.preventDefault(),!Q){o({title:"Error",description:"No se ha seleccionado un anuncio para editar",variant:"destructive"});return}if(!a.title||!a.image_url||a.campaign_id===0){o({title:"Error",description:"Por favor completa todos los campos requeridos",variant:"destructive"});return}const i={id:Q.id,title:a.title,description:a.description||"",image_url:a.image_url,link_url:"",alt_text:a.alt_text||"",button_text:a.button_text||"",ad_type:"institutional",media_type:a.media_type,frequency:"always",priority:5,is_active:a.is_active,video_url:null,html_content:a.content||"",carousel_images:[],scheduled_days:[],scheduled_hours:[],target_pages:[],target_positions:[],campaign_id:a.campaign_id,content:a.content||"",storage_type:a.storage_type||"url",media_file_id:null,duration:a.duration||0,type:a.media_type,status:"active"};console.log("Datos para actualizar:",i),q.mutate(i)},te=t=>{console.log("Editando anuncio:",t),W(t),s({title:t.title||"",description:t.description||"",image_url:t.imageUrl||"",content:t.content||"",button_text:t.button_text||"",campaign_id:t.campaignId||0,is_active:t.isActive||!1,media_type:t.mediaType||"image",storage_type:t.storageType||"url",duration:t.duration||0,alt_text:t.altText||""}),b(!0)},ae=t=>{window.confirm("¿Estás seguro de que quieres eliminar este anuncio?")&&Fe.mutate(t)},ie=g.filter(t=>{const i=t.title.toLowerCase().includes(U.toLowerCase())||t.description.toLowerCase().includes(U.toLowerCase()),n=z==="all"||t.campaignId&&t.campaignId.toString()===z,h=F==="all"||F==="active"&&t.isActive||F==="inactive"&&!t.isActive;return i&&n&&h}),O=ie.length,B=Math.ceil(O/k),R=(v-1)*k,se=Math.min(R+k,O),re=ie.slice(R,se),$=t=>{t(),Z(1)},G=t=>{Z(t)},Ie=()=>{if(B<=1)return null;const t=[],i=5;let n=Math.max(1,v-Math.floor(i/2)),h=Math.min(B,n+i-1);h-n<i-1&&(n=Math.max(1,h-i+1));for(let l=n;l<=h;l++)t.push(l);return e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",R+1," a ",se," de ",O," anuncios"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>G(v-1),disabled:v===1,children:[e.jsx(We,{className:"h-4 w-4"}),"Anterior"]}),t.map(l=>e.jsx(c,{variant:v===l?"default":"outline",size:"sm",onClick:()=>G(l),className:v===l?"bg-[#00a587] hover:bg-[#067f5f]":"",children:l},l)),e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>G(v+1),disabled:v===B,children:["Siguiente",e.jsx(Je,{className:"h-4 w-4"})]})]})]})},Me=g.length,Ve=g.filter(t=>t.isActive).length,Ue=g.reduce((t,i)=>t+i.id*150,0),ze=g.reduce((t,i)=>t+i.id*25,0),ne=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),le=t=>{const i=I.find(n=>n.id===t);return(i==null?void 0:i.name)||"Sin campaña"};return Ee?e.jsx(de,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-[#00a587]"})})}):e.jsx(de,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestión de Anuncios"}),e.jsx("p",{className:"text-gray-600",children:"Crea y gestiona el contenido publicitario para tus espacios"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{onClick:ee,variant:"outline",className:"bg-orange-50 hover:bg-orange-100 text-orange-700",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Actualizar Anuncio 13"]}),e.jsxs(c,{onClick:()=>{localStorage.setItem("adForceUpdate",Date.now().toString()),window.dispatchEvent(new CustomEvent("adForceUpdate")),window.dispatchEvent(new StorageEvent("storage",{key:"adForceUpdate",newValue:Date.now().toString(),oldValue:null,url:window.location.href})),[0,500,1e3,1500,2e3].forEach(i=>{setTimeout(()=>{p.invalidateQueries({queryKey:["/api/advertising/placements"]}),p.refetchQueries({queryKey:["/api/advertising/placements"]})},i)}),console.log("🔄 Actualización manual de todas las imágenes publicitarias disparada"),o({title:"Actualización enviada",description:"Se ha disparado la actualización de todas las imágenes publicitarias en las páginas"})},variant:"outline",className:"bg-blue-50 hover:bg-blue-100 text-blue-700",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Actualizar Todas las Imágenes"]}),e.jsxs(me,{open:A,onOpenChange:E,children:[e.jsx(qe,{asChild:!0,children:e.jsxs(c,{className:"bg-[#00a587] hover:bg-[#067f5f]",children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Nuevo Anuncio"]})}),e.jsxs(ue,{className:"max-w-2xl",children:[e.jsx(xe,{children:e.jsx(he,{children:"Crear Nuevo Anuncio"})}),e.jsxs("form",{onSubmit:Te,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"title",children:"Título *"}),e.jsx(u,{id:"title",value:a.title,onChange:t=>s({...a,title:t.target.value}),required:!0,placeholder:"Título del anuncio"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"campaign",children:"Campaña *"}),e.jsxs(j,{value:a.campaign_id?a.campaign_id.toString():"",onValueChange:t=>s({...a,campaign_id:parseInt(t)}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar campaña"})}),e.jsx(_,{children:I.map(t=>e.jsx(d,{value:t.id.toString(),children:t.name},t.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"description",children:"Descripción"}),e.jsx(pe,{id:"description",value:a.description,onChange:t=>s({...a,description:t.target.value}),placeholder:"Descripción del anuncio",rows:3})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"media_type",children:"Tipo de Contenido *"}),e.jsxs(j,{value:a.media_type,onValueChange:t=>s({...a,media_type:t}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar tipo de contenido"})}),e.jsxs(_,{children:[e.jsx(d,{value:"image",children:"Imagen"}),e.jsx(d,{value:"video",children:"Video"}),e.jsx(d,{value:"gif",children:"GIF Animado"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"storage_type",children:"Método de Almacenamiento *"}),e.jsxs(j,{value:a.storage_type,onValueChange:t=>s({...a,storage_type:t}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar método"})}),e.jsxs(_,{children:[e.jsx(d,{value:"url",children:"URL Externa"}),e.jsx(d,{value:"upload",children:"Subir Archivo"})]})]})]}),a.storage_type==="url"?e.jsxs("div",{children:[e.jsx(r,{htmlFor:"image_url",children:"URL del Contenido *"}),e.jsx(u,{id:"image_url",value:a.image_url,onChange:t=>s({...a,image_url:t.target.value}),required:!0,placeholder:"https://ejemplo.com/imagen.jpg"})]}):e.jsxs("div",{children:[e.jsx(r,{htmlFor:"file_upload",children:"Subir Archivo *"}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:[a.media_type==="image"&&"Formatos: JPG, PNG, WEBP (máx 5MB)",a.media_type==="video"&&"Formatos: MP4, WEBM, OGG, AVI, MOV (máx 10MB, 30 segundos recomendado)",a.media_type==="gif"&&"Formato: GIF animado (máx 3MB)"]}),e.jsx(u,{id:"file_upload",type:"file",accept:a.media_type==="image"?"image/*":a.media_type==="video"?"video/*":a.media_type==="gif"?"image/gif":"*/*",onChange:async t=>{var n;const i=(n=t.target.files)==null?void 0:n[0];if(i){if(!(a.media_type==="image"&&i.type.startsWith("image/")||a.media_type==="video"&&i.type.startsWith("video/")||a.media_type==="gif"&&i.type==="image/gif")){o({title:"Error",description:`Tipo de archivo inválido. Se esperaba ${a.media_type==="video"?"un video":"una imagen"}.`,variant:"destructive"});return}const l=a.media_type==="video"?10*1024*1024:5*1024*1024;if(i.size>l){o({title:"Error",description:`Archivo demasiado grande. Máximo ${a.media_type==="video"?"10MB":"5MB"}.`,variant:"destructive"});return}try{N(!0);const m=await X(i);s({...a,image_url:m}),o({title:"Éxito",description:"Archivo subido correctamente"})}catch(m){console.error("Error uploading file:",m),o({title:"Error",description:"Error al subir el archivo",variant:"destructive"})}finally{N(!1)}}},disabled:D,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#00a587] file:text-white hover:file:bg-[#067f5f] disabled:opacity-50"}),D&&e.jsxs("div",{className:"flex items-center mt-2 text-sm text-gray-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#00a587] mr-2"}),"Subiendo archivo..."]}),a.image_url&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vista previa:"}),e.jsx("div",{className:"mt-1 border border-gray-300 rounded-lg p-2",children:a.media_type==="image"||a.media_type==="gif"?e.jsx("img",{src:a.image_url,alt:"Vista previa",className:"max-w-full h-32 object-cover rounded"}):a.media_type==="video"?e.jsxs("video",{src:a.image_url,controls:!0,muted:!0,className:"max-w-full h-32 rounded",children:[e.jsx("source",{src:a.image_url,type:"video/mp4"}),"Tu navegador no soporta videos."]}):null})]})]}),a.media_type==="video"&&e.jsxs("div",{children:[e.jsx(r,{htmlFor:"duration",children:"Duración (segundos)"}),e.jsx(u,{id:"duration",type:"number",value:a.duration,onChange:t=>s({...a,duration:parseInt(t.target.value)||0}),placeholder:"30",min:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"alt_text",children:"Texto Alternativo"}),e.jsx(u,{id:"alt_text",value:a.alt_text,onChange:t=>s({...a,alt_text:t.target.value}),placeholder:"Descripción del contenido para accesibilidad"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"content",children:"URL de Contenido"}),e.jsx(u,{id:"content",value:a.content,onChange:t=>s({...a,content:t.target.value}),placeholder:"https://ejemplo.com/destino - Liga donde irá el usuario al hacer clic"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta es la URL donde será dirigido el usuario cuando haga clic en el banner publicitario"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"button_text",children:"Texto del Botón"}),e.jsx(u,{id:"button_text",value:a.button_text,onChange:t=>s({...a,button_text:t.target.value}),placeholder:"Ej: Inscríbete Ahora, Ver Más, Obtener Info",maxLength:50}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Texto personalizado que aparecerá en el botón del anuncio (máx. 50 caracteres)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:a.is_active,onChange:t=>s({...a,is_active:t.target.checked})}),e.jsx(r,{htmlFor:"is_active",children:"Anuncio activo"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(c,{type:"submit",className:"bg-[#00a587] hover:bg-[#067f5f]",children:"Crear Anuncio"})]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(w,{children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Anuncios"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Me})]}),e.jsx(Be,{className:"h-8 w-8 text-[#00a587]"})]})})}),e.jsx(w,{children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Anuncios Activos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Ve})]}),e.jsx(Re,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(w,{children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Impresiones"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Ue.toLocaleString()})]}),e.jsx(ce,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(w,{children:e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Clicks"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:ze.toLocaleString()})]}),e.jsx($e,{className:"h-8 w-8 text-purple-600"})]})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx("div",{className:"flex-1 min-w-[250px]",children:e.jsx(u,{placeholder:"Buscar anuncios...",value:U,onChange:t=>$(()=>ye(t.target.value))})}),e.jsx("div",{className:"min-w-[150px]",children:e.jsxs(j,{value:z,onValueChange:t=>$(()=>_e(t)),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Filtrar por campaña"})}),e.jsxs(_,{children:[e.jsx(d,{value:"all",children:"Todas las campañas"}),I.map(t=>e.jsx(d,{value:t.id.toString(),children:t.name},t.id))]})]})}),e.jsx("div",{className:"min-w-[120px]",children:e.jsxs(j,{value:F,onValueChange:t=>$(()=>be(t)),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Estado"})}),e.jsxs(_,{children:[e.jsx(d,{value:"all",children:"Todos"}),e.jsx(d,{value:"active",children:"Activos"}),e.jsx(d,{value:"inactive",children:"Inactivos"})]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(c,{variant:S==="list"?"default":"outline",size:"sm",onClick:()=>Y("list"),className:S==="list"?"bg-[#00a587] hover:bg-[#067f5f]":"",children:e.jsx(Ge,{className:"h-4 w-4"})}),e.jsx(c,{variant:S==="grid"?"default":"outline",size:"sm",onClick:()=>Y("grid"),className:S==="grid"?"bg-[#00a587] hover:bg-[#067f5f]":"",children:e.jsx(Ke,{className:"h-4 w-4"})})]})]}),S==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:re.map(t=>e.jsxs(w,{className:"overflow-hidden","data-ad-id":t.id,children:[e.jsxs("div",{className:"aspect-video relative overflow-hidden",children:[e.jsx(fe,{src:t.imageUrl,alt:t.title}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Activo":"Inactivo"})})]}),e.jsx(C,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:le(t.campaignId)}),e.jsx("span",{children:ne(t.createdAt)})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>te(t),children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Editar"]}),e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>ae(t.id),children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]})})]},`${t.id}-${J}-${H}`))}):e.jsx("div",{className:"space-y-4",children:re.map(t=>e.jsx(w,{className:"overflow-hidden","data-ad-id":t.id,children:e.jsx(C,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"flex-shrink-0 w-32 h-24 relative overflow-hidden rounded-lg",children:e.jsx(fe,{src:t.imageUrl,alt:t.title})}),e.jsx("div",{className:"flex-grow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:t.title}),e.jsx("p",{className:"text-gray-600 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Campaña: ",e.jsx("span",{className:"font-medium",children:le(t.campaignId)})]}),e.jsxs("span",{children:["Creado: ",ne(t.createdAt)]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Activo":"Inactivo"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>te(t),children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Editar"]}),e.jsxs(c,{variant:"destructive",size:"sm",onClick:()=>ae(t.id),children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]})})]})})},`${t.id}-${J}-${H}`))}),Ie(),e.jsx(me,{open:V,onOpenChange:b,children:e.jsxs(ue,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(xe,{children:e.jsx(he,{children:"Editar Anuncio"})}),e.jsxs("form",{onSubmit:De,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_title",children:"Título *"}),e.jsx(u,{id:"edit_title",value:a.title||"",onChange:t=>s({...a,title:t.target.value}),required:!0,placeholder:"Título del anuncio"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_campaign",children:"Campaña *"}),e.jsxs(j,{value:a.campaign_id?a.campaign_id.toString():"",onValueChange:t=>s({...a,campaign_id:parseInt(t)}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar campaña"})}),e.jsx(_,{children:I.map(t=>e.jsx(d,{value:t.id.toString(),children:t.name},t.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_description",children:"Descripción"}),e.jsx(pe,{id:"edit_description",value:a.description||"",onChange:t=>s({...a,description:t.target.value}),placeholder:"Descripción del anuncio",rows:3})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_media_type",children:"Tipo de Contenido *"}),e.jsxs(j,{value:a.media_type,onValueChange:t=>s({...a,media_type:t}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar tipo de contenido"})}),e.jsxs(_,{children:[e.jsx(d,{value:"image",children:"Imagen"}),e.jsx(d,{value:"video",children:"Video"}),e.jsx(d,{value:"gif",children:"GIF Animado"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_storage_type",children:"Método de Almacenamiento *"}),e.jsxs(j,{value:a.storage_type,onValueChange:t=>s({...a,storage_type:t}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar método"})}),e.jsxs(_,{children:[e.jsx(d,{value:"url",children:"URL Externa"}),e.jsx(d,{value:"upload",children:"Subir Archivo"})]})]})]}),a.storage_type==="url"?e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_image_url",children:"URL del Contenido *"}),e.jsx(u,{id:"edit_image_url",value:a.image_url||"",onChange:t=>s({...a,image_url:t.target.value}),required:!0,placeholder:"https://ejemplo.com/imagen.jpg"})]}):e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_file_upload",children:"Subir Archivo *"}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:[a.media_type==="image"&&"Formatos: JPG, PNG, WEBP (máx 5MB)",a.media_type==="video"&&"Formatos: MP4, WEBM, OGG (máx 10MB, 30 segundos recomendado)",a.media_type==="gif"&&"Formato: GIF animado (máx 3MB)"]}),e.jsx(u,{id:"edit_file_upload",type:"file",accept:a.media_type==="video"?"video/*,.mp4,.webm,.ogg,.avi,.mov":a.media_type==="image"?"image/*":a.media_type==="gif"?"image/gif":"*/*",onChange:async t=>{var n;const i=(n=t.target.files)==null?void 0:n[0];if(i){if(!(a.media_type==="image"&&i.type.startsWith("image/")||a.media_type==="video"&&i.type.startsWith("video/")||a.media_type==="gif"&&i.type==="image/gif")){o({title:"Error",description:`Tipo de archivo inválido. Se esperaba ${a.media_type==="video"?"un video":"una imagen"}.`,variant:"destructive"});return}const l=a.media_type==="video"?10*1024*1024:5*1024*1024;if(i.size>l){o({title:"Error",description:`Archivo demasiado grande. Máximo ${a.media_type==="video"?"10MB":"5MB"}.`,variant:"destructive"});return}try{N(!0);const m=await X(i);s({...a,image_url:m}),o({title:"Éxito",description:"Archivo subido correctamente"})}catch(m){console.error("Error uploading file:",m),o({title:"Error",description:"Error al subir el archivo",variant:"destructive"})}finally{N(!1)}}},disabled:D,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#00a587] file:text-white hover:file:bg-[#067f5f] disabled:opacity-50"}),D&&e.jsxs("div",{className:"flex items-center mt-2 text-sm text-gray-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#00a587] mr-2"}),"Subiendo archivo..."]}),a.image_url&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vista previa actual:"}),e.jsx("div",{className:"mt-1 border border-gray-300 rounded-lg p-2",children:a.media_type==="image"||a.media_type==="gif"?e.jsx("img",{src:a.image_url,alt:"Vista previa",className:"max-w-full h-32 object-cover rounded"}):a.media_type==="video"?e.jsxs("video",{src:a.image_url,controls:!0,muted:!0,className:"max-w-full h-32 rounded",children:[e.jsx("source",{src:a.image_url,type:"video/mp4"}),"Tu navegador no soporta videos."]}):null})]})]}),a.media_type==="video"&&e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_duration",children:"Duración (segundos)"}),e.jsx(u,{id:"edit_duration",type:"number",value:a.duration||0,onChange:t=>s({...a,duration:parseInt(t.target.value)||0}),placeholder:"30",min:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_alt_text",children:"Texto Alternativo"}),e.jsx(u,{id:"edit_alt_text",value:a.alt_text||"",onChange:t=>s({...a,alt_text:t.target.value}),placeholder:"Descripción del contenido para accesibilidad"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_content",children:"URL de Contenido"}),e.jsx(u,{id:"edit_content",value:a.content||"",onChange:t=>s({...a,content:t.target.value}),placeholder:"https://ejemplo.com/destino - Liga donde irá el usuario al hacer clic"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta es la URL donde será dirigido el usuario cuando haga clic en el banner publicitario"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_button_text",children:"Texto del Botón"}),e.jsx(u,{id:"edit_button_text",value:a.button_text||"",onChange:t=>s({...a,button_text:t.target.value}),placeholder:"Ej: Inscríbete Ahora, Ver Más, Obtener Info",maxLength:50}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Texto personalizado que aparecerá en el botón del anuncio (máx. 50 caracteres)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit_is_active",checked:a.is_active||!1,onChange:t=>s({...a,is_active:t.target.checked})}),e.jsx(r,{htmlFor:"edit_is_active",children:"Anuncio activo"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(c,{type:"submit",className:"bg-[#00a587] hover:bg-[#067f5f]",disabled:q.isPending,children:q.isPending?"Actualizando...":"Actualizar Anuncio"})]})]})]})})]})})};export{Ze as default};
