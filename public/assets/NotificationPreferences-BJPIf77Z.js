import{a2 as u,ae,u as y,ag as ie,j as e,aX as ne,f as o,bN as re,b1 as te,b2 as le,b3 as z,bp as U,b0 as _,b4 as $,g as k,h as C,U as G,ab as w,i as m,a4 as oe,O as ce,B as K,X as Q,Q as de,V as me,W as ue,Y as pe,_ as O,aW as W,o as x,p as xe,ah as S,br as be,cb as A,aq as he}from"./index-D5qLf1ib.js";import{S as ge}from"./separator-Bek7HtsH.js";const fe=[{key:"system_updates",label:"Actualizaciones del Sistema",description:"Notificaciones sobre actualizaciones y mantenimiento del sistema"},{key:"system_backup",label:"Respaldos del Sistema",description:"Alertas sobre el estado de los respaldos automáticos"},{key:"system_errors",label:"Errores del Sistema",description:"Notificaciones críticas sobre errores del sistema"},{key:"activities_new",label:"Nuevas Actividades",description:"Cuando se registra una nueva actividad en el sistema"},{key:"activities_registration",label:"Inscripciones a Actividades",description:"Cuando alguien se inscribe a una actividad"},{key:"activities_cancellation",label:"Cancelaciones de Actividades",description:"Cuando se cancela una actividad programada"},{key:"activities_reminder",label:"Recordatorios de Actividades",description:"Recordatorios automáticos antes de actividades"},{key:"volunteers_new",label:"Nuevos Voluntarios",description:"Cuando se registra un nuevo voluntario"},{key:"volunteers_assignment",label:"Asignaciones de Voluntarios",description:"Cuando se asigna un voluntario a una actividad"},{key:"volunteers_evaluation",label:"Evaluaciones de Voluntarios",description:"Recordatorios para evaluar voluntarios"},{key:"volunteers_recognition",label:"Reconocimientos",description:"Notificaciones sobre reconocimientos otorgados"},{key:"maintenance_scheduled",label:"Mantenimiento Programado",description:"Notificaciones sobre mantenimiento programado"},{key:"maintenance_completed",label:"Mantenimiento Completado",description:"Cuando se completa una tarea de mantenimiento"},{key:"maintenance_overdue",label:"Mantenimiento Vencido",description:"Alertas sobre mantenimiento vencido"},{key:"maintenance_emergency",label:"Mantenimiento de Emergencia",description:"Notificaciones urgentes de mantenimiento"},{key:"incidents_new",label:"Nuevos Incidentes",description:"Cuando se reporta un nuevo incidente"},{key:"incidents_assigned",label:"Incidentes Asignados",description:"Cuando se te asigna un incidente"},{key:"incidents_resolved",label:"Incidentes Resueltos",description:"Cuando se resuelve un incidente"},{key:"incidents_escalated",label:"Incidentes Escalados",description:"Cuando un incidente se escala"},{key:"finance_budget_alerts",label:"Alertas de Presupuesto",description:"Cuando se excede un límite presupuestario"},{key:"finance_payments",label:"Pagos Procesados",description:"Confirmaciones de pagos procesados"},{key:"finance_reports",label:"Reportes Financieros",description:"Cuando están listos los reportes financieros"},{key:"finance_approvals",label:"Aprobaciones Financieras",description:"Solicitudes que requieren aprobación financiera"},{key:"hr_new_employee",label:"Nuevos Empleados",description:"Cuando se registra un nuevo empleado"},{key:"hr_payroll",label:"Nómina Procesada",description:"Confirmaciones de procesamiento de nómina"},{key:"hr_vacation_requests",label:"Solicitudes de Vacaciones",description:"Nuevas solicitudes de vacaciones"},{key:"hr_evaluations",label:"Evaluaciones de Desempeño",description:"Recordatorios de evaluaciones pendientes"},{key:"events_new",label:"Nuevos Eventos",description:"Cuando se programa un nuevo evento"},{key:"events_registration",label:"Registro a Eventos",description:"Cuando alguien se registra a un evento"},{key:"events_reminder",label:"Recordatorios de Eventos",description:"Recordatorios automáticos de eventos próximos"},{key:"events_cancellation",label:"Cancelación de Eventos",description:"Cuando se cancela un evento"},{key:"communications_messages",label:"Mensajes Directos",description:"Mensajes directos de otros usuarios"},{key:"communications_announcements",label:"Anuncios Generales",description:"Anuncios importantes del sistema"},{key:"communications_newsletters",label:"Boletines Informativos",description:"Boletines periódicos del sistema"},{key:"feedback",label:"📋 Sistema de Retroalimentación",description:"Configuración principal para todas las notificaciones de feedback del sistema"},{key:"feedback_share_enabled",label:"  └─ Compartir Experiencia",description:"Invitaciones para compartir experiencias en actividades y servicios"},{key:"feedback_report_problem_enabled",label:"  └─ Reportar Problemas",description:"Solicitudes para reportar problemas o incidencias detectadas"},{key:"feedback_suggest_improvement_enabled",label:"  └─ Sugerir Mejoras",description:"Invitaciones para sugerir mejoras en servicios y procesos"},{key:"feedback_propose_event_enabled",label:"  └─ Proponer Eventos",description:"Oportunidades para proponer nuevos eventos y actividades"},{key:"security_login_alerts",label:"Alertas de Inicio de Sesión",description:"Notificaciones sobre inicios de sesión sospechosos"},{key:"security_password_changes",label:"Cambios de Contraseña",description:"Confirmaciones de cambios de contraseña"},{key:"security_access_violations",label:"Violaciones de Acceso",description:"Intentos de acceso no autorizados"},{key:"inventory_low_stock",label:"Stock Bajo",description:"Alertas cuando el inventario está bajo"},{key:"inventory_new_items",label:"Nuevos Elementos",description:"Cuando se agregan nuevos elementos al inventario"},{key:"inventory_assignments",label:"Asignaciones de Inventario",description:"Cuando se asignan elementos del inventario"}];function _e(){var P,T,V,L,M,q;const[n,E]=u.useState(null),[t,b]=u.useState(""),[c,R]=u.useState("all"),I=ae();u.useEffect(()=>(console.log("🔍 NotificationPreferences component mounted"),()=>{console.log("🔍 NotificationPreferences component unmounted")}),[]);const{data:r,isLoading:X,error:je}=y({queryKey:["/api/users"],select:s=>(s==null?void 0:s.users)||s||[],retry:3,retryDelay:1e3}),{data:H,isLoading:Y,error:h}=y({queryKey:[`/api/users/${n}/notification-preferences`],enabled:!!n}),g=n&&r?{userId:n,role:((P=r.find(s=>s.id===n))==null?void 0:P.roleName)||((T=r.find(s=>s.id===n))==null?void 0:T.role)||"admin",fullName:((V=r.find(s=>s.id===n))==null?void 0:V.fullName)||((L=r.find(s=>s.id===n))==null?void 0:L.name)||"Usuario",email:((M=r.find(s=>s.id===n))==null?void 0:M.email)||"email@example.com",preferences:{system_updates:!0,activities_new:!0,volunteers_new:!0,maintenance_scheduled:!0,incidents_new:!0,feedback:!0,feedback_share_enabled:!1,feedback_report_problem_enabled:!0,feedback_suggest_improvement_enabled:!0,feedback_propose_event_enabled:!1},availableNotifications:fe}:null,a=H||(h?g:null),{data:d,error:ve}=y({queryKey:["/api/users/notification-preferences/summary"],retry:3,retryDelay:1e3}),f=ie({mutationFn:async({userId:s,preferences:i})=>he(`/api/users/${s}/notification-preferences`,{method:"PUT",data:i}),onSuccess:()=>{A({title:"Preferencias actualizadas",description:"Las preferencias de notificación se han guardado correctamente."}),I.invalidateQueries({queryKey:[`/api/users/${n}/notification-preferences`]}),I.invalidateQueries({queryKey:["/api/users/notification-preferences/summary"]})},onError:s=>{A({title:"Error",description:(s==null?void 0:s.message)||"No se pudieron actualizar las preferencias.",variant:"destructive"})}});u.useEffect(()=>{if(r&&r.length>0&&!n){const s=r.find(i=>i.roleName==="Super Administrador"||i.roleName==="Administrador"||i.roleName==="Director"||i.role==="admin"||i.role==="super_admin");s&&E(s.id)}},[r,n]);const J=(s,i)=>{if(!a)return;if(h&&g){g.preferences[s]=i,A({title:"Preferencia actualizada",description:`${s} ${i?"activada":"desactivada"} (modo demo)`});return}const l={...a.preferences,[s]:i};f.mutate({userId:a.userId,preferences:l})},j=s=>{switch(s){case"Super Administrador":case"super_admin":return"bg-purple-100 text-purple-800";case"Administrador":case"admin":return"bg-red-100 text-red-800";case"Director":case"Gerente":case"manager":return"bg-blue-100 text-blue-800";case"Instructor":case"instructor":return"bg-green-100 text-green-800";case"Voluntario":case"volunteer":return"bg-orange-100 text-orange-800";case"Concesionario":case"concessionaire":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},p=s=>{switch(s){case"super_admin":return"Super Administrador";case"admin":return"Administrador";case"manager":return"Director/Gerente";case"instructor":return"Instructor";case"volunteer":return"Voluntario";case"concessionaire":return"Concesionario";case"Super Administrador":case"Administrador":case"Director":case"Gerente":case"Instructor":case"Voluntario":case"Concesionario":return s;default:return s}},v=(r==null?void 0:r.filter(s=>{const i=s.roleName||s.role;return["Super Administrador","Administrador","Director","Gerente","Instructor","Voluntario","Concesionario","admin","super_admin","manager","instructor","volunteer","concessionaire"].includes(i)}))||[],N=v.filter(s=>{const i=t===""||(s.fullName||s.name||"").toLowerCase().includes(t.toLowerCase())||(s.email||"").toLowerCase().includes(t.toLowerCase()),l=s.roleName||s.role;return i&&(c==="all"||l===c)}),Z=Array.from(new Set(v.map(s=>s.roleName||s.role))),ee=()=>{b(""),R("all")};return e.jsx(ne,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(o,{className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Preferencias de Notificaciones"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Configura qué tipos de notificaciones recibe cada usuario del sistema"})]})]})}),e.jsxs(te,{defaultValue:"configuracion",className:"w-full",children:[e.jsxs(le,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(z,{value:"configuracion",className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4"}),"Configuración de Usuario"]}),e.jsxs(z,{value:"resumen",className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Resumen por Roles"]})]}),e.jsx($,{value:"configuracion",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(o,{children:[e.jsxs(k,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Seleccionar Usuario"]}),e.jsx(w,{children:"Elige el usuario para configurar sus preferencias"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"space-y-4 mb-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(ce,{placeholder:"Buscar por nombre o email...",value:t,onChange:s=>b(s.target.value),className:"pl-9 pr-9"}),t&&e.jsx(K,{variant:"ghost",size:"sm",onClick:()=>b(""),className:"absolute right-1 top-1 h-8 w-8 p-0 hover:bg-gray-100",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsxs(de,{value:c,onValueChange:R,children:[e.jsx(me,{children:e.jsx(ue,{placeholder:"Filtrar por rol"})}),e.jsxs(pe,{children:[e.jsx(O,{value:"all",children:"Todos los roles"}),Z.map(s=>e.jsx(O,{value:s,children:p(s)},s))]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[N.length," de ",v.length," usuarios"]}),(t||c!=="all")&&e.jsxs(K,{variant:"ghost",size:"sm",onClick:ee,className:"h-6 text-xs",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Limpiar"]})]})]}),X?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(s=>e.jsx("div",{className:"h-12 bg-gray-200 animate-pulse rounded"},s))}):N.length===0?e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(W,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"font-medium mb-1",children:t||c!=="all"?"Sin resultados":"No hay usuarios"}),e.jsx("p",{className:"text-xs",children:t||c!=="all"?"Prueba ajustando los filtros de búsqueda":"No se encontraron usuarios relevantes"})]}):e.jsx("div",{className:"space-y-2 max-h-80 overflow-y-auto",children:N.map(s=>e.jsx("div",{onClick:()=>E(s.id),className:`p-3 rounded-lg border cursor-pointer transition-colors ${n===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.fullName||s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.email})]}),e.jsx(x,{className:j(s.roleName||s.role),variant:"secondary",children:p(s.roleName||s.role)})]})},s.id))})]})]}),e.jsx("div",{className:"lg:col-span-2",children:Y?e.jsx(o,{children:e.jsxs(m,{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Cargando preferencias..."})]})}):a?e.jsxs(o,{children:[e.jsxs(k,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Preferencias de ",a.fullName||"Usuario",h&&e.jsx(x,{variant:"outline",className:"ml-2",children:"Modo Demo"})]}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),a.email,e.jsx(x,{className:j(a.role),variant:"secondary",children:p(a.role)})]})})]}),e.jsxs(m,{className:"space-y-4",children:[((q=a==null?void 0:a.availableNotifications)==null?void 0:q.map((s,i)=>{var D,B;const l=s.key.startsWith("feedback_"),F=s.key==="feedback";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:F?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-semibold text-sm text-blue-800",children:s.label})]}):l?e.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[e.jsx("div",{className:"w-3 h-px bg-gray-300"}),e.jsx(S,{className:"h-3 w-3 text-green-600"}),e.jsx("span",{className:"font-medium text-xs",children:s.label.replace("  └─ ","")})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"font-medium text-sm",children:s.label})]})}),e.jsx("p",{className:`text-xs text-gray-500 ${l?"ml-8":"ml-6"}`,children:s.description})]}),e.jsx(be,{checked:((D=a==null?void 0:a.preferences)==null?void 0:D[s.key])||!1,onCheckedChange:se=>J(s.key,se),disabled:f.isPending,className:l?"scale-90":""})]}),i<(((B=a==null?void 0:a.availableNotifications)==null?void 0:B.length)||0)-1&&e.jsx(ge,{className:"mt-4"})]},s.key)}))||[],(!(a!=null&&a.availableNotifications)||a.availableNotifications.length===0)&&e.jsxs("div",{className:"p-4 text-center text-gray-500",children:[e.jsx(W,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"No hay preferencias de notificación disponibles para este usuario"})]}),f.isPending&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),"Guardando cambios..."]})]})]}):e.jsx(o,{children:e.jsxs(m,{className:"p-8 text-center",children:[e.jsx(G,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Selecciona un usuario"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Elige un usuario de la lista para configurar sus preferencias de notificación"})]})})})]})}),e.jsx($,{value:"resumen",children:d!=null&&d.summary&&Array.isArray(d.summary)&&d.summary.length>0?e.jsxs(o,{children:[e.jsxs(k,{children:[e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Resumen por Roles"]}),e.jsx(w,{children:"Vista general de las preferencias de notificación por tipo de usuario"})]}),e.jsx(m,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.summary.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(x,{className:j(s.role),children:p(s.role)}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.total_users," usuarios"]})]}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Feedback general:"}),e.jsxs("span",{className:"font-medium",children:[s.feedback_enabled,"/",s.total_users]})]}),e.jsxs("div",{className:"flex justify-between ml-2",children:[e.jsx("span",{children:"├ Experiencias:"}),e.jsxs("span",{className:"font-medium text-green-600",children:[s.feedback_share_enabled,"/",s.total_users]})]}),e.jsxs("div",{className:"flex justify-between ml-2",children:[e.jsx("span",{children:"├ Problemas:"}),e.jsxs("span",{className:"font-medium text-red-600",children:[s.feedback_report_problem_enabled,"/",s.total_users]})]}),e.jsxs("div",{className:"flex justify-between ml-2",children:[e.jsx("span",{children:"├ Mejoras:"}),e.jsxs("span",{className:"font-medium text-blue-600",children:[s.feedback_suggest_improvement_enabled,"/",s.total_users]})]}),e.jsxs("div",{className:"flex justify-between ml-2",children:[e.jsx("span",{children:"└ Eventos:"}),e.jsxs("span",{className:"font-medium text-purple-600",children:[s.feedback_propose_event_enabled,"/",s.total_users]})]}),e.jsxs("div",{className:"flex justify-between pt-1",children:[e.jsx("span",{children:"Eventos:"}),e.jsxs("span",{className:"font-medium",children:[s.events_enabled,"/",s.total_users]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Mantenimiento:"}),e.jsxs("span",{className:"font-medium",children:[s.maintenance_enabled,"/",s.total_users]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Nómina:"}),e.jsxs("span",{className:"font-medium",children:[s.payroll_enabled,"/",s.total_users]})]})]})]},s.role))})})]}):e.jsx(o,{children:e.jsxs(m,{className:"p-8 text-center",children:[e.jsx(_,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Sin datos de resumen"}),e.jsx("p",{className:"text-sm text-gray-500",children:"No hay datos disponibles para mostrar el resumen por roles"})]})})})]})]})})}export{_e as default};
