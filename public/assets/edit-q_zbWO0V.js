import{am as Q,e as $,a6 as W,bZ as X,Y as I,a7 as Y,u as U,a8 as Z,j as e,aI as T,B as v,A as ee,ba as ne,aa as se,C as f,a as y,b as C,a3 as N,c as b,ab as l,ac as i,ad as o,ae as t,I as j,af as d,z as P,H as D,J as F,K as V,N as x,az as ae,as as re,O as B,ag as h,bz as le,a5 as r,ai as G,ah as ie}from"./index-Dzu3mJf5.js";import{C as oe}from"./camera-D-5G6Skd.js";const te=r.object({firstName:r.string().min(1,"El nombre es requerido"),lastName:r.string().min(1,"El apellido es requerido"),email:r.string().email("Email inv√°lido"),phone:r.string().min(10,"El tel√©fono debe tener al menos 10 d√≠gitos"),gender:r.enum(["masculino","femenino","no_especificar"]),birthDate:r.string().optional(),address:r.string().optional(),emergencyContactName:r.string().min(1,"El nombre del contacto de emergencia es requerido"),emergencyContactPhone:r.string().min(10,"El tel√©fono de emergencia debe tener al menos 10 d√≠gitos"),preferredParkId:r.string().optional(),volunteerExperience:r.string().optional(),skills:r.string().optional(),availability:r.enum(["weekdays","weekends","evenings","mornings","flexible"]),interestNature:r.boolean().optional(),interestEvents:r.boolean().optional(),interestEducation:r.boolean().optional(),interestMaintenance:r.boolean().optional(),interestSports:r.boolean().optional(),interestCultural:r.boolean().optional(),legalConsent:r.boolean().refine(m=>m===!0,"Debe aceptar los t√©rminos legales"),ageConsent:r.boolean().refine(m=>m===!0,"Debe confirmar ser mayor de edad"),conductConsent:r.boolean().refine(m=>m===!0,"Debe aceptar el c√≥digo de conducta"),profileImage:r.any().optional(),municipalityId:r.number().optional()});function he(){const[,m]=Q(),{toast:p}=$(),K=W(),[ce,k]=X("/admin/volunteers/edit/:id"),g=k==null?void 0:k.id,[z,E]=I.useState(null),[de,q]=I.useState(null),[M,_]=I.useState(!1),a=Y({resolver:ie(te),defaultValues:{firstName:"",lastName:"",email:"",phone:"",gender:"no_especificar",birthDate:"",address:"",emergencyContactName:"",emergencyContactPhone:"",preferredParkId:"",volunteerExperience:"",skills:"",availability:"flexible",interestNature:!1,interestEvents:!1,interestEducation:!1,interestMaintenance:!1,interestSports:!1,interestCultural:!1,legalConsent:!1,ageConsent:!1,conductConsent:!1,municipalityId:2,profileImage:null}}),R=async n=>{_(!0);try{const c=new FormData;c.append("file",n),c.append("volunteerId",g);const u=await G("/api/upload/volunteer-profile",{method:"POST",data:c,headers:{}});u.url&&(E(u.url),q(n),a.setValue("profileImage",n),p({title:"Imagen actualizada",description:"La fotograf√≠a del voluntario se ha actualizado correctamente"}))}catch(c){console.error("Error subiendo imagen:",c),p({title:"Error",description:"No se pudo subir la imagen. Intente nuevamente.",variant:"destructive"})}finally{_(!1)}},H=()=>{E(null),q(null),a.setValue("profileImage",null),p({title:"Imagen removida",description:"La fotograf√≠a del voluntario ha sido removida"})},{data:s,isLoading:J}=U({queryKey:["/api/volunteers",g],queryFn:async()=>{const n=await fetch(`/api/volunteers/${g}`);if(!n.ok)throw new Error("Error al obtener datos del voluntario");return n.json()},enabled:!!g}),{data:S}=U({queryKey:["/api/parks"]}),A=(S==null?void 0:S.data)||[];I.useEffect(()=>{var n,c;if(s){const u=s.profileImageUrl||s.profile_image_url;u&&E(u),a.reset({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phone:s.phone||"",gender:s.gender||"no_especificar",birthDate:s.birthDate||"",address:s.address||"",emergencyContactName:s.emergencyContactName||s.emergency_contact||"",emergencyContactPhone:s.emergencyContactPhone||s.emergency_phone||"",preferredParkId:((n=s.preferredParkId)==null?void 0:n.toString())||((c=s.preferred_park_id)==null?void 0:c.toString())||"",volunteerExperience:s.volunteerExperience||s.previous_experience||"",skills:s.skills||"",availability:s.availability||"flexible",interestNature:s.interestNature||!1,interestEvents:s.interestEvents||!1,interestEducation:s.interestEducation||!1,interestMaintenance:s.interestMaintenance||!1,interestSports:s.interestSports||!1,interestCultural:s.interestCultural||!1,legalConsent:s.legalConsent||!0,ageConsent:s.ageConsent||!0,conductConsent:s.conductConsent||!0,municipalityId:s.municipalityId||2,profileImage:s.profileImageUrl||s.profile_image_url||null})}},[s,a]);const w=Z({mutationFn:async n=>(console.log("üöÄ Enviando datos al servidor:",n),await G(`/api/volunteers/${g}`,{method:"PUT",data:n})),onSuccess:()=>{p({title:"Voluntario actualizado",description:"Los datos del voluntario han sido actualizados exitosamente"}),K.invalidateQueries({queryKey:["/api/volunteers"]}),m("/admin/volunteers")},onError:n=>{p({title:"Error",description:"No se pudo actualizar el voluntario",variant:"destructive"}),console.error("Error actualizando voluntario:",n)}}),O=n=>{w.mutate(n)};return J?e.jsx(T,{children:e.jsx("div",{className:"container mx-auto p-6",children:e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{children:"Cargando datos del voluntario..."})})})}):e.jsx(T,{children:e.jsxs("div",{className:"container mx-auto p-6 max-w-4xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(v,{variant:"ghost",onClick:()=>m("/admin/volunteers"),className:"mb-4",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Volver a Voluntarios"]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ne,{className:"h-8 w-8 text-blue-600"}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Editar Voluntario"})]}),e.jsx("p",{className:"text-muted-foreground",children:"Actualice la informaci√≥n del voluntario"})]}),e.jsx(se,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(O),className:"space-y-6",children:[e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Informaci√≥n Personal"}),e.jsx(N,{children:"Datos b√°sicos del voluntario"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:a.control,name:"firstName",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Nombre"}),e.jsx(t,{children:e.jsx(j,{placeholder:"Ingrese el nombre",...n})}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"lastName",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Apellido"}),e.jsx(t,{children:e.jsx(j,{placeholder:"Ingrese el apellido",...n})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:a.control,name:"email",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Email"}),e.jsx(t,{children:e.jsx(j,{type:"email",placeholder:"ejemplo@email.com",...n})}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"phone",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Tel√©fono"}),e.jsx(t,{children:e.jsx(j,{placeholder:"N√∫mero de tel√©fono",...n})}),e.jsx(d,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(l,{control:a.control,name:"gender",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"G√©nero"}),e.jsxs(P,{onValueChange:n.onChange,value:n.value,children:[e.jsx(t,{children:e.jsx(D,{children:e.jsx(F,{placeholder:"Seleccione"})})}),e.jsxs(V,{children:[e.jsx(x,{value:"masculino",children:"Masculino"}),e.jsx(x,{value:"femenino",children:"Femenino"}),e.jsx(x,{value:"no_especificar",children:"No especificar"})]})]}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"birthDate",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Fecha de Nacimiento"}),e.jsx(t,{children:e.jsx(j,{type:"date",...n})}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"availability",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Disponibilidad"}),e.jsxs(P,{onValueChange:n.onChange,value:n.value,children:[e.jsx(t,{children:e.jsx(D,{children:e.jsx(F,{placeholder:"Seleccione"})})}),e.jsxs(V,{children:[e.jsx(x,{value:"weekdays",children:"D√≠as de semana"}),e.jsx(x,{value:"weekends",children:"Fines de semana"}),e.jsx(x,{value:"evenings",children:"Tardes"}),e.jsx(x,{value:"mornings",children:"Ma√±anas"}),e.jsx(x,{value:"flexible",children:"Flexible"})]})]}),e.jsx(d,{})]})})]}),e.jsx(l,{control:a.control,name:"address",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Direcci√≥n"}),e.jsx(t,{children:e.jsx(j,{placeholder:"Direcci√≥n completa",...n})}),e.jsx(d,{})]})}),e.jsx("div",{className:"mt-6",children:e.jsx(l,{control:a.control,name:"profileImage",render:({field:n})=>e.jsxs(i,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Fotograf√≠a del Voluntario (Opcional)"]}),e.jsx(t,{children:e.jsx("div",{className:"space-y-4",children:z?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:z,alt:"Foto del voluntario",className:"w-32 h-32 object-cover rounded-lg border"}),e.jsx(v,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 p-0",onClick:H,children:e.jsx(re,{className:"h-3 w-3"})})]}):e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(ae,{className:"h-8 w-8 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Subir o cambiar fotograf√≠a del voluntario"}),e.jsx("p",{className:"text-xs text-gray-500",children:"JPG, PNG o WEBP (m√°x. 5MB)"}),e.jsx("input",{type:"file",accept:"image/*",onChange:c=>{var L;const u=(L=c.target.files)==null?void 0:L[0];u&&R(u)},className:"hidden",id:"volunteer-image-upload-edit"}),e.jsx(v,{type:"button",variant:"outline",size:"sm",onClick:()=>{var c;return(c=document.getElementById("volunteer-image-upload-edit"))==null?void 0:c.click()},disabled:M,children:M?"Subiendo...":"Seleccionar Imagen"})]})})})}),e.jsx(d,{})]})})})]})]}),e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Contacto de Emergencia"}),e.jsx(N,{children:"Informaci√≥n de contacto en caso de emergencia"})]}),e.jsx(b,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:a.control,name:"emergencyContactName",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Nombre del contacto"}),e.jsx(t,{children:e.jsx(j,{placeholder:"Nombre completo",...n})}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"emergencyContactPhone",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Tel√©fono de emergencia"}),e.jsx(t,{children:e.jsx(j,{placeholder:"N√∫mero de tel√©fono",...n})}),e.jsx(d,{})]})})]})})]}),e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Informaci√≥n de Voluntariado"}),e.jsx(N,{children:"Preferencias y experiencia del voluntario"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsx(l,{control:a.control,name:"preferredParkId",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Parque Preferido"}),e.jsxs(P,{onValueChange:n.onChange,value:n.value,children:[e.jsx(t,{children:e.jsx(D,{children:e.jsx(F,{placeholder:"Seleccione un parque"})})}),e.jsxs(V,{children:[e.jsx(x,{value:"none",children:"Sin preferencia"}),A&&A.map(c=>e.jsx(x,{value:c.id.toString(),children:c.name},c.id))]})]}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"volunteerExperience",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Experiencia Previa"}),e.jsx(t,{children:e.jsx(B,{placeholder:"Describa su experiencia previa como voluntario...",className:"resize-none",...n})}),e.jsx(d,{})]})}),e.jsx(l,{control:a.control,name:"skills",render:({field:n})=>e.jsxs(i,{children:[e.jsx(o,{children:"Habilidades y Talentos"}),e.jsx(t,{children:e.jsx(B,{placeholder:"Describa sus habilidades y talentos...",className:"resize-none",...n})}),e.jsx(d,{})]})})]})]}),e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"√Åreas de Inter√©s"}),e.jsx(N,{children:"Seleccione las √°reas en las que le gustar√≠a participar"})]}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:a.control,name:"interestNature",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Naturaleza y Medio Ambiente"})})]})}),e.jsx(l,{control:a.control,name:"interestEvents",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Eventos y Actividades"})})]})}),e.jsx(l,{control:a.control,name:"interestEducation",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Educaci√≥n Ambiental"})})]})}),e.jsx(l,{control:a.control,name:"interestMaintenance",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Mantenimiento y Jardiner√≠a"})})]})}),e.jsx(l,{control:a.control,name:"interestSports",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Deportes y Recreaci√≥n"})})]})}),e.jsx(l,{control:a.control,name:"interestCultural",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Actividades Culturales"})})]})})]})})]}),e.jsxs(f,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Consentimientos Legales"}),e.jsx(N,{children:"Aceptaci√≥n de t√©rminos y condiciones"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsx(l,{control:a.control,name:"legalConsent",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Acepto los t√©rminos y condiciones legales"})})]})}),e.jsx(l,{control:a.control,name:"ageConsent",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Confirmo que soy mayor de edad"})})]})}),e.jsx(l,{control:a.control,name:"conductConsent",render:({field:n})=>e.jsxs(i,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(t,{children:e.jsx(h,{checked:n.value,onCheckedChange:n.onChange})}),e.jsx("div",{className:"space-y-1 leading-none",children:e.jsx(o,{children:"Acepto el c√≥digo de conducta del voluntario"})})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>m("/admin/volunteers"),children:"Cancelar"}),e.jsxs(v,{type:"submit",disabled:w.isPending,children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),w.isPending?"Guardando...":"Guardar Cambios"]})]})]})})]})})}export{he as default};
