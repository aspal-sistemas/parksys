import{a2 as y,l as se,ae,u as B,r as M,j as e,aX as I,f as i,b0 as P,i as d,g as j,h as u,a7 as te,Q as E,V as F,W as U,Y as O,_ as g,O as re,U as le,aY as ie,ar as ne,M as de,b1 as oe,b2 as ce,b3 as C,b4 as D,b5 as f,b6 as xe,b7 as R,b8 as q,b9 as K,ba as b,bb as he,bc as L,bd as H,be as Q,bf as W,a1 as _,bg as me}from"./index-D5qLf1ib.js";import{B as G}from"./BarChart-BX_xVycl.js";import{p as Y}from"./parseISO-DQfTOoXY.js";const V=["#00a587","#067f5f","#bcd256","#8498a5","#4CAF50","#FF6B6B","#4ECDC4","#45B7D1"],je={estimation:"EstimaciÃ³n",manual_counter:"Contador Manual",event_based:"Basado en Eventos",entrance_control:"Control de Acceso"},ue={sunny:"Soleado",cloudy:"Nublado",rainy:"Lluvioso",other:"Otro"};function ye(){var $;const[v,z]=y.useState("all"),[k,X]=y.useState("30"),[J,Z]=y.useState("");se();const A=ae();y.useEffect(()=>{A.invalidateQueries({queryKey:["/api/parks/visitor-dashboard"]}),A.removeQueries({queryKey:["/api/parks/visitor-dashboard"]})},[A]);const{data:h,isLoading:ee}=B({queryKey:["/api/visitor-counts/dashboard",v,k],queryFn:async()=>{const s=new URLSearchParams;if(v!=="all"&&s.append("parkId",v),k!=="all"){const S=parseInt(k),l=M(me(new Date,S),"yyyy-MM-dd");s.append("startDate",l)}s.append("limit","1000");const r=await fetch(`/api/visitor-counts/dashboard?${s}`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const x=await r.json();return console.log("ðŸŒ [FRONTEND] Datos recibidos del dashboard:",x),x},suspense:!1,retry:1,refetchOnWindowFocus:!0,staleTime:0}),{data:p}=B({queryKey:["/api/parks"]}),T=Array.isArray(p)?p:(p==null?void 0:p.data)||[],m=(h==null?void 0:h.records)||[],a=(h==null?void 0:h.metrics)||null,w=(h==null?void 0:h.parkSummaries)||[],c=y.useMemo(()=>{if(!m||!Array.isArray(m))return{daily:[],parks:[],methods:[],weather:[]};const s=m.reduce((l,t)=>{const o=t.date,n=l.find(N=>N.date===o);return n?(n.visitors+=t.totalVisitors,n.adults+=t.adults,n.children+=t.children,n.seniors+=t.seniors,n.pets+=t.pets):l.push({date:o,visitors:t.totalVisitors,adults:t.adults,children:t.children,seniors:t.seniors,pets:t.pets,formattedDate:M(Y(o),"dd/MM",{locale:_})}),l},[]).sort((l,t)=>l.date.localeCompare(t.date));let r=[];w&&w.length>0?(r=w.map((l,t)=>({parkName:l.parkName||"Sin nombre",parkNumber:t+1,visitors:parseInt(l.totalVisitors)||0,records:parseInt(l.totalRecords)||0})).sort((l,t)=>t.visitors-l.visitors),r=r.map((l,t)=>({...l,parkNumber:t+1})),console.log("ðŸŒ [CHART DEBUG] Usando parkSummaries:",r)):(r=m.reduce((l,t)=>{const o=l.find(n=>n.parkName===t.parkName);return o?(o.visitors+=t.totalVisitors,o.records+=1):l.push({parkName:t.parkName||"Sin nombre",visitors:t.totalVisitors||0,records:1}),l},[]).sort((l,t)=>t.visitors-l.visitors),r=r.map((l,t)=>({...l,parkNumber:t+1})),console.log("ðŸŒ [CHART DEBUG] Usando visitorData:",r));const x=m.reduce((l,t)=>{const o=je[t.countingMethod]||t.countingMethod,n=l.find(N=>N.method===o);return n?(n.count+=1,n.visitors+=t.totalVisitors):l.push({method:o,count:1,visitors:t.totalVisitors}),l},[]),S=m.reduce((l,t)=>{const o=ue[t.weather]||t.weather,n=l.find(N=>N.weather===o);return n?(n.count+=1,n.visitors+=t.totalVisitors):l.push({weather:o,count:1,visitors:t.totalVisitors}),l},[]);return console.log("ðŸŒ [CHART DEBUG] chartData generado:",{daily:s.length,parks:r.length,methods:x.length,weather:S.length,parksData:r}),{daily:s,parks:r,methods:x,weather:S}},[m]);return ee?e.jsx(I,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(i,{className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((s,r)=>e.jsx(i,{className:"animate-pulse",children:e.jsxs(d,{className:"p-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})},r))})]})}):e.jsx(I,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx(i,{className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"AnÃ¡lisis y estadÃ­sticas del conteo de visitantes"})]})]})}),e.jsxs(i,{children:[e.jsx(j,{children:e.jsxs(u,{className:"flex items-center",children:[e.jsx(te,{className:"w-5 h-5 mr-2"}),"Filtros"]})}),e.jsx(d,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parque"}),e.jsxs(E,{value:v,onValueChange:z,children:[e.jsx(F,{children:e.jsx(U,{placeholder:"Seleccionar parque"})}),e.jsxs(O,{children:[e.jsx(g,{value:"all",children:"Todos los parques"}),T&&Array.isArray(T)&&T.map(s=>e.jsx(g,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"PerÃ­odo"}),e.jsxs(E,{value:k,onValueChange:X,children:[e.jsx(F,{children:e.jsx(U,{placeholder:"Seleccionar perÃ­odo"})}),e.jsxs(O,{children:[e.jsx(g,{value:"7",children:"Ãšltimos 7 dÃ­as"}),e.jsx(g,{value:"30",children:"Ãšltimos 30 dÃ­as"}),e.jsx(g,{value:"90",children:"Ãšltimos 90 dÃ­as"}),e.jsx(g,{value:"all",children:"Todo el tiempo"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsx(re,{placeholder:"Buscar en notas...",value:J,onChange:s=>Z(s.target.value)})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Visitantes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Number((a==null?void 0:a.totalVisitors)||0).toLocaleString()})]}),e.jsx("div",{className:"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(le,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(i,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Promedio Diario"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Number((a==null?void 0:a.avgDailyVisitors)||0).toLocaleString()})]}),e.jsx("div",{className:"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(ie,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(i,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Registros"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Number((a==null?void 0:a.totalRecords)||0).toLocaleString()})]}),e.jsx("div",{className:"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6 text-purple-600"})})]})})}),e.jsx(i,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Parques Activos"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Number((a==null?void 0:a.uniqueParks)||0).toLocaleString()})]}),e.jsx("div",{className:"h-12 w-12 bg-orange-100 rounded-lg flex items-center justify-center",children:e.jsx(de,{className:"w-6 h-6 text-orange-600"})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(i,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Adultos"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:Number((a==null?void 0:a.totalAdults)||0).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a!=null&&a.totalVisitors?Math.round(a.totalAdults/a.totalVisitors*100):0,"% del total"]})]})})}),e.jsx(i,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"NiÃ±os"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:Number((a==null?void 0:a.totalChildren)||0).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a!=null&&a.totalVisitors?Math.round(a.totalChildren/a.totalVisitors*100):0,"% del total"]})]})})}),e.jsx(i,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Adultos Mayores"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:Number((a==null?void 0:a.totalSeniors)||0).toLocaleString()}),e.jsxs("p",{className:"text-xs text-gray-500",children:[a!=null&&a.totalVisitors?Math.round(a.totalSeniors/a.totalVisitors*100):0,"% del total"]})]})})}),e.jsx(i,{children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Mascotas"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:Number((a==null?void 0:a.totalPets)||0).toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500",children:"AcompaÃ±antes"})]})})})]}),e.jsxs(oe,{defaultValue:"trends",className:"w-full",children:[e.jsxs(ce,{className:"grid w-full grid-cols-4",children:[e.jsx(C,{value:"trends",children:"Tendencias"}),e.jsx(C,{value:"parks",children:"Por Parques"}),e.jsx(C,{value:"methods",children:"MÃ©todos"}),e.jsx(C,{value:"summary",children:"Resumen"})]}),e.jsxs(D,{value:"trends",className:"space-y-4",children:[e.jsxs(i,{children:[e.jsx(j,{children:e.jsx(u,{children:"Tendencia de Visitantes"})}),e.jsx(d,{children:e.jsx("div",{className:"h-80",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(xe,{data:c.daily,children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"formattedDate"}),e.jsx(K,{}),e.jsx(b,{formatter:s=>[Number(s).toLocaleString(),"Visitantes"]}),e.jsx(he,{type:"monotone",dataKey:"visitors",stackId:"1",stroke:"#00a587",fill:"#00a587",fillOpacity:.6})]})})})})]}),e.jsxs(i,{children:[e.jsx(j,{children:e.jsx(u,{children:"Desglose DemogrÃ¡fico por DÃ­a"})}),e.jsx(d,{children:e.jsx("div",{className:"h-80",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(G,{data:c.daily,children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"formattedDate"}),e.jsx(K,{}),e.jsx(b,{formatter:s=>[Number(s).toLocaleString()]}),e.jsx(L,{dataKey:"adults",stackId:"a",fill:"#00a587",name:"Adultos"}),e.jsx(L,{dataKey:"children",stackId:"a",fill:"#bcd256",name:"NiÃ±os"}),e.jsx(L,{dataKey:"seniors",stackId:"a",fill:"#8498a5",name:"Adultos Mayores"})]})})})})]})]}),e.jsx(D,{value:"parks",children:e.jsxs(i,{children:[e.jsx(j,{children:e.jsx(u,{children:"Visitantes por Parque"})}),e.jsx(d,{children:c.parks&&c.parks.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"h-80",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(G,{data:c.parks,margin:{top:20,right:30,left:20,bottom:40},children:[e.jsx(R,{strokeDasharray:"3 3",stroke:"#e0e7ff"}),e.jsx(q,{dataKey:"parkNumber",tick:{fontSize:14,fill:"#374151",fontWeight:"bold"},height:40,interval:0}),e.jsx(K,{tick:{fontSize:12},axisLine:{stroke:"#6b7280"},tickLine:{stroke:"#6b7280"}}),e.jsx(b,{formatter:s=>[`${Number(s).toLocaleString()} visitantes`,"Total"],labelFormatter:s=>{const r=c.parks.find(x=>x.parkNumber===s);return r?`${s}. ${r.parkName}`:`Parque ${s}`},labelStyle:{color:"#374151",fontWeight:"bold"},contentStyle:{backgroundColor:"white",border:"1px solid #d1d5db",borderRadius:"6px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)"}}),e.jsx(L,{dataKey:"visitors",fill:"#00a587",radius:[4,4,0,0],strokeWidth:0})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.parks.map((s,r)=>e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-green-600",children:r+1})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:s.parkName}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.records," registro",s.records!==1?"s":""]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s.visitors.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500",children:"visitantes"})]})]})},s.parkName))})]}):e.jsx("div",{className:"h-80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx(P,{className:"mx-auto h-12 w-12"})}),e.jsx("p",{className:"text-gray-500",children:"No hay datos disponibles para mostrar"}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Datos esperados: ",(($=c.parks)==null?void 0:$.length)||0," parques"]})]})})})]})}),e.jsx(D,{value:"methods",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(i,{children:[e.jsx(j,{children:e.jsx(u,{children:"MÃ©todos de Conteo"})}),e.jsx(d,{children:e.jsx("div",{className:"h-64",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(H,{children:[e.jsx(Q,{data:c.methods,cx:"50%",cy:"50%",labelLine:!1,label:({method:s,percent:r})=>`${s} (${(r*100).toFixed(0)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:c.methods.map((s,r)=>e.jsx(W,{fill:V[r%V.length]},`cell-${r}`))}),e.jsx(b,{formatter:(s,r,x)=>[`${Number(s).toLocaleString()} registros`,x.payload.method]})]})})})})]}),e.jsxs(i,{children:[e.jsx(j,{children:e.jsx(u,{children:"Condiciones ClimÃ¡ticas"})}),e.jsx(d,{children:e.jsx("div",{className:"h-64",children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(H,{children:[e.jsx(Q,{data:c.weather,cx:"50%",cy:"50%",labelLine:!1,label:({weather:s,percent:r})=>`${s} (${(r*100).toFixed(0)}%)`,outerRadius:80,fill:"#8884d8",dataKey:"count",children:c.weather.map((s,r)=>e.jsx(W,{fill:V[r%V.length]},`cell-${r}`))}),e.jsx(b,{formatter:(s,r,x)=>[`${Number(s).toLocaleString()} registros`,x.payload.weather]})]})})})})]})]})}),e.jsx(D,{value:"summary",children:e.jsxs(i,{children:[e.jsx(j,{children:e.jsx(u,{children:"Resumen por Parques"})}),e.jsx(d,{children:e.jsx("div",{className:"space-y-4",children:w.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-green-600",children:r+1})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.parkName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Ãšltimo conteo: ",M(Y(s.lastCountDate),"dd/MM/yyyy",{locale:_})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-bold text-gray-900",children:s.totalVisitors.toLocaleString()}),e.jsxs("p",{className:"text-sm text-gray-500",children:[Number(s.avgDailyVisitors).toLocaleString()," promedio diario (",Number(s.totalRecords).toLocaleString()," registros)"]})]})]},s.parkId))})})]})})]})]})})}export{ye as default};
