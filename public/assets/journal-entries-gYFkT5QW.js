import{al as Ae,Y as c,a6 as Se,u as _,a7 as De,ag as we,a8 as K,j as e,aB as J,B as r,aq as Q,D as G,p as Re,aW as X,r as W,t as $,v as Y,aa as Fe,ab as j,ac as b,ad as g,ae as f,I as u,af as N,O as Oe,z as v,H as y,J as C,K as T,N as o,C as Z,a as ee,b as ae,aj as Ee,c as se,Z as Ve,aX as Ie,W as Le,f as A,b0 as Ue,ar as Me,a5 as l,bv as I,ah as te}from"./index-BBGHPKhn.js";import{R as ke}from"./refresh-cw-DS5oknip.js";const Pe=l.object({date:l.string().min(1,"La fecha es requerida"),description:l.string().min(1,"La descripción es requerida"),reference:l.string().optional(),type:l.enum(["manual","automatic"]),entries:l.array(l.object({account_id:l.number().min(1,"La cuenta es requerida"),debit:l.number().optional(),credit:l.number().optional(),description:l.string().optional()})).min(2,"Se requieren al menos 2 entradas")});function He(){const[,ie]=Ae(),[h,ne]=c.useState(""),[S,re]=c.useState("all"),[D,ce]=c.useState("all"),[le,oe]=c.useState(""),[de,me]=c.useState(""),[ue,w]=c.useState(!1),[xe,L]=c.useState(!1),[d,he]=c.useState(null),[m,R]=c.useState(1);c.useState(!1);const F=15,U=c.useRef(null),M=Se(),{data:qe,isLoading:pe}=_({queryKey:["/api/accounting/journal-entries"],enabled:!0}),{data:k}=_({queryKey:["/api/accounting/categories"],enabled:!0}),i=De({resolver:we(Pe),defaultValues:{date:new Date().toISOString().split("T")[0],description:"",reference:"",type:"manual",entries:[{account_id:0,debit:0,credit:0,description:""},{account_id:0,debit:0,credit:0,description:""}]}}),P=K({mutationFn:a=>te("/api/accounting/journal-entries",{method:"POST",body:JSON.stringify(a)}),onSuccess:()=>{I({title:"Asiento contable creado",description:"El asiento contable ha sido registrado exitosamente."}),M.invalidateQueries({queryKey:["/api/accounting/journal-entries"]}),w(!1),i.reset()}}),O=K({mutationFn:()=>te("/api/accounting/journal-entries/generate-automatic",{method:"POST"}),onSuccess:()=>{I({title:"Asientos automáticos generados",description:"Los asientos contables automáticos han sido generados exitosamente."}),M.invalidateQueries({queryKey:["/api/accounting/journal-entries"]})}}),je=a=>{P.mutate(a)},be=()=>{O.mutate()},ge=()=>{ie("/admin/accounting/dashboard")},fe=a=>{he(a),L(!0)},Ne=()=>{const a=[["Número","Fecha","Descripción","Referencia","Tipo","Debe","Haber","Estado"],...q.map(s=>[s.number,s.date,s.description,s.reference,s.type,s.totalDebit.toFixed(2),s.totalCredit.toFixed(2),s.status])].map(s=>s.join(",")).join(`
`),n=new Blob([a],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(n),t.download=`asientos-contables-${new Date().toISOString().split("T")[0]}.csv`,t.click()},ve=()=>{var a;(a=U.current)==null||a.click()},ye=a=>{var t;const n=(t=a.target.files)==null?void 0:t[0];if(n){const s=new FileReader;s.onload=Te=>{var H;(H=Te.target)==null||H.result,I({title:"Archivo importado",description:"Los datos han sido procesados correctamente."})},s.readAsText(n)}},q=[{id:1,number:"AUTO-1751387935240",date:"30/6/2025",description:"Transacción automática: Pago de servicios básicos",reference:"TRANS-85",type:"automatico",totalDebit:13e3,totalCredit:13e3,status:"aprobado"},{id:2,number:"AUTO-1750978310917",date:"25/6/2025",description:"Transacción automática: Compra de materiales oficina",reference:"TRANS-64",type:"automatico",totalDebit:6700,totalCredit:6700,status:"aprobado"},{id:3,number:"AUTO-1750978160215",date:"25/6/2025",description:"Transacción automática: Mantenimiento de equipos",reference:"TRANS-63",type:"automatico",totalDebit:5e3,totalCredit:5e3,status:"aprobado"},{id:4,number:"AUTO-1750878717940",date:"24/6/2025",description:"Transacción automática: Ingreso por concesiones",reference:"TRANS-61",type:"automatico",totalDebit:6e3,totalCredit:6e3,status:"aprobado"},{id:5,number:"AUTO-1750681809469",date:"19/6/2025",description:"Transacción automática: Reposición Caja Chica",reference:"TRANS-51",type:"automatico",totalDebit:3500,totalCredit:3500,status:"aprobado"},{id:6,number:"AUTO-1750681808864",date:"19/6/2025",description:"Transacción automática: Gasto en combustible",reference:"TRANS-50",type:"automatico",totalDebit:2800,totalCredit:2800,status:"aprobado"},{id:7,number:"AUTO-1750681808262",date:"19/6/2025",description:"Transacción automática: Caja Chica: Autobuses",reference:"TRANS-47",type:"automatico",totalDebit:1200,totalCredit:1200,status:"aprobado"},{id:8,number:"MAN-1750681808263",date:"18/6/2025",description:"Registro manual: Ajuste de inventario",reference:"TRANS-46",type:"manual",totalDebit:4500,totalCredit:4500,status:"aprobado"},{id:9,number:"AUTO-1750681808264",date:"17/6/2025",description:"Transacción automática: Pago de nómina",reference:"TRANS-45",type:"automatico",totalDebit:28e3,totalCredit:28e3,status:"aprobado"},{id:10,number:"AUTO-1750681808265",date:"16/6/2025",description:"Transacción automática: Ingreso por eventos",reference:"TRANS-44",type:"automatico",totalDebit:15e3,totalCredit:15e3,status:"aprobado"},{id:11,number:"MAN-1750681808266",date:"15/6/2025",description:"Registro manual: Depreciación mensual",reference:"TRANS-43",type:"manual",totalDebit:3200,totalCredit:3200,status:"aprobado"},{id:12,number:"AUTO-1750681808267",date:"14/6/2025",description:"Transacción automática: Compra de herramientas",reference:"TRANS-42",type:"automatico",totalDebit:8500,totalCredit:8500,status:"aprobado"},{id:13,number:"AUTO-1750681808268",date:"13/6/2025",description:"Transacción automática: Pago de proveedores",reference:"TRANS-41",type:"automatico",totalDebit:12e3,totalCredit:12e3,status:"aprobado"},{id:14,number:"AUTO-1750681808269",date:"12/6/2025",description:"Transacción automática: Recibo de agua",reference:"TRANS-40",type:"automatico",totalDebit:5600,totalCredit:5600,status:"aprobado"},{id:15,number:"AUTO-1750681808270",date:"11/6/2025",description:"Transacción automática: Recibo de luz",reference:"TRANS-39",type:"automatico",totalDebit:9800,totalCredit:9800,status:"aprobado"},{id:16,number:"MAN-1750681808271",date:"10/6/2025",description:"Registro manual: Ajuste por diferencia cambiaria",reference:"TRANS-38",type:"manual",totalDebit:2300,totalCredit:2300,status:"aprobado"},{id:17,number:"AUTO-1750681808272",date:"09/6/2025",description:"Transacción automática: Venta de boletos",reference:"TRANS-37",type:"automatico",totalDebit:7500,totalCredit:7500,status:"aprobado"},{id:18,number:"AUTO-1750681808273",date:"08/6/2025",description:"Transacción automática: Ingreso por donaciones",reference:"TRANS-36",type:"automatico",totalDebit:4800,totalCredit:4800,status:"aprobado"}],z=q.filter(a=>{const n=a.description.toLowerCase().includes(h.toLowerCase())||a.reference.toLowerCase().includes(h.toLowerCase())||a.number.toLowerCase().includes(h.toLowerCase()),t=D==="all"||a.type===D,s=S==="all"||a.status===S;return n&&t&&s}),E=z.length,x=Math.ceil(E/F),V=(m-1)*F,B=V+F,Ce=z.slice(V,B),p=a=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:2}).format(a);return pe?e.jsx(J,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 w-64 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-96 bg-gray-200 rounded animate-pulse"})]})}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"h-16 bg-gray-200 rounded animate-pulse"},a))})]})}):e.jsx(J,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(r,{variant:"ghost",size:"sm",onClick:ge,className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{children:"Regresar"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Asientos Contables"}),e.jsx("p",{className:"text-gray-600",children:"Registro de movimientos contables con partida doble"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",onClick:be,disabled:O.isPending,className:"flex items-center space-x-2",children:[e.jsx(ke,{className:`h-4 w-4 ${O.isPending?"animate-spin":""}`}),e.jsx("span",{children:"Generar Automáticos"})]}),e.jsxs(G,{open:ue,onOpenChange:w,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(r,{className:"bg-[#00a587] hover:bg-[#067f5f] flex items-center space-x-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{children:"Nuevo Asiento"})]})}),e.jsxs(W,{className:"max-w-4xl","aria-describedby":"journal-entry-form-description",children:[e.jsx($,{children:e.jsx(Y,{children:"Nuevo Asiento Contable"})}),e.jsx("div",{id:"journal-entry-form-description",className:"sr-only",children:"Formulario para crear asientos contables con débitos y créditos"}),e.jsx(Fe,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(je),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{control:i.control,name:"date",render:({field:a})=>e.jsxs(b,{children:[e.jsx(g,{children:"Fecha"}),e.jsx(f,{children:e.jsx(u,{type:"date",...a})}),e.jsx(N,{})]})}),e.jsx(j,{control:i.control,name:"reference",render:({field:a})=>e.jsxs(b,{children:[e.jsx(g,{children:"Referencia"}),e.jsx(f,{children:e.jsx(u,{placeholder:"Número de referencia",...a})}),e.jsx(N,{})]})})]}),e.jsx(j,{control:i.control,name:"description",render:({field:a})=>e.jsxs(b,{children:[e.jsx(g,{children:"Descripción"}),e.jsx(f,{children:e.jsx(Oe,{placeholder:"Descripción del asiento contable",...a})}),e.jsx(N,{})]})}),e.jsx(j,{control:i.control,name:"type",render:({field:a})=>e.jsxs(b,{children:[e.jsx(g,{children:"Tipo"}),e.jsxs(v,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(f,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Seleccionar tipo"})})}),e.jsxs(T,{children:[e.jsx(o,{value:"manual",children:"Manual"}),e.jsx(o,{value:"automatic",children:"Automático"})]})]}),e.jsx(N,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Entradas del Asiento"}),e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>{const a=i.getValues("entries");i.setValue("entries",[...a,{account_id:0,debit:0,credit:0,description:""}])},children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Agregar Entrada"]})]}),e.jsx("div",{className:"space-y-2",children:i.watch("entries").map((a,n)=>e.jsxs("div",{className:"grid grid-cols-5 gap-2 p-3 border rounded",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Cuenta"}),e.jsxs(v,{onValueChange:t=>{const s=i.getValues("entries");s[n].account_id=parseInt(t),i.setValue("entries",s)},children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Seleccionar"})}),e.jsx(T,{children:Array.isArray(k)?k.map(t=>e.jsxs(o,{value:t.id.toString(),children:[t.code," - ",t.name]},t.id)):null})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Debe"}),e.jsx(u,{type:"number",step:"0.01",placeholder:"0.00",onChange:t=>{const s=i.getValues("entries");s[n].debit=parseFloat(t.target.value)||0,i.setValue("entries",s)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Haber"}),e.jsx(u,{type:"number",step:"0.01",placeholder:"0.00",onChange:t=>{const s=i.getValues("entries");s[n].credit=parseFloat(t.target.value)||0,i.setValue("entries",s)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Descripción"}),e.jsx(u,{placeholder:"Opcional",onChange:t=>{const s=i.getValues("entries");s[n].description=t.target.value,i.setValue("entries",s)}})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=i.getValues("entries");t.length>2&&(t.splice(n,1),i.setValue("entries",t))},disabled:i.watch("entries").length<=2,children:"Eliminar"})})]},n))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",disabled:P.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:"Crear Asiento"})]})]})})]})]})]})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(ae,{className:"flex items-center",children:[e.jsx(Ee,{className:"h-5 w-5 mr-2"}),"Filtros de Búsqueda"]})}),e.jsx(se,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(Ve,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{placeholder:"Buscar por número, descripción o referencia...",value:h,onChange:a=>ne(a.target.value),className:"pl-9"})]})}),e.jsx("div",{children:e.jsxs(v,{value:S,onValueChange:re,children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(T,{children:[e.jsx(o,{value:"all",children:"Todos los estados"}),e.jsx(o,{value:"draft",children:"Borrador"}),e.jsx(o,{value:"approved",children:"Aprobado"}),e.jsx(o,{value:"rejected",children:"Rechazado"})]})]})}),e.jsx("div",{children:e.jsxs(v,{value:D,onValueChange:ce,children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(T,{children:[e.jsx(o,{value:"all",children:"Todos los tipos"}),e.jsx(o,{value:"manual",children:"Manual"}),e.jsx(o,{value:"automatic",children:"Automático"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(u,{type:"date",value:le,onChange:a=>oe(a.target.value),placeholder:"dd/mm/yyyy"}),e.jsx(u,{type:"date",value:de,onChange:a=>me(a.target.value),placeholder:"dd/mm/yyyy"})]})]})})]}),e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ae,{children:"Asientos Contables Registrados"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Mostrando ",V+1,"-",Math.min(B,E)," de ",E," registros"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:ve,className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{children:"Importar"})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:Ne,className:"flex items-center space-x-2",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{children:"Exportar"})]})]})]})}),e.jsxs(se,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Número"}),e.jsx("th",{className:"text-left p-2",children:"Fecha"}),e.jsx("th",{className:"text-left p-2",children:"Descripción"}),e.jsx("th",{className:"text-left p-2",children:"Referencia"}),e.jsx("th",{className:"text-left p-2",children:"Tipo"}),e.jsx("th",{className:"text-left p-2",children:"Total Debe"}),e.jsx("th",{className:"text-left p-2",children:"Total Haber"}),e.jsx("th",{className:"text-left p-2",children:"Estado"}),e.jsx("th",{className:"text-left p-2",children:"Acciones"})]})}),e.jsx("tbody",{children:Ce.map(a=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 font-mono text-sm",children:a.number}),e.jsx("td",{className:"p-2",children:a.date}),e.jsx("td",{className:"p-2 max-w-xs truncate",children:a.description}),e.jsx("td",{className:"p-2",children:a.reference}),e.jsx("td",{className:"p-2",children:e.jsx(A,{variant:"outline",className:"bg-blue-50 text-blue-700",children:a.type})}),e.jsx("td",{className:"p-2 text-right",children:p(a.totalDebit)}),e.jsx("td",{className:"p-2 text-right",children:p(a.totalCredit)}),e.jsx("td",{className:"p-2",children:e.jsx(A,{variant:"default",className:"bg-green-100 text-green-800",children:a.status})}),e.jsx("td",{className:"p-2",children:e.jsx(r,{variant:"ghost",size:"sm",title:"Ver detalles",onClick:()=>fe(a),children:e.jsx(Ue,{className:"h-4 w-4"})})})]},a.id))})]})}),x>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Página ",m," de ",x]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>R(Math.max(1,m-1)),disabled:m===1,children:[e.jsx(Q,{className:"h-4 w-4"}),"Anterior"]}),Array.from({length:x},(a,n)=>n+1).map(a=>e.jsx(r,{variant:m===a?"default":"outline",size:"sm",onClick:()=>R(a),className:m===a?"bg-[#00a587] hover:bg-[#067f5f]":"",children:a},a)),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>R(Math.min(x,m+1)),disabled:m===x,children:["Siguiente",e.jsx(Me,{className:"h-4 w-4"})]})]})]})]})]}),e.jsx("input",{ref:U,type:"file",accept:".csv",style:{display:"none"},onChange:ye}),e.jsx(G,{open:xe,onOpenChange:L,children:e.jsxs(W,{className:"max-w-2xl","aria-describedby":"journal-entry-delete-description",children:[e.jsx($,{children:e.jsx(Y,{children:"Detalles del Asiento Contable"})}),e.jsx("div",{id:"journal-entry-delete-description",className:"sr-only",children:"Información detallada del asiento contable y sus movimientos"}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Número"}),e.jsx("p",{className:"font-mono text-sm",children:d.number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Fecha"}),e.jsx("p",{children:d.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Referencia"}),e.jsx("p",{children:d.reference})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Tipo"}),e.jsx(A,{variant:"outline",className:"bg-blue-50 text-blue-700",children:d.type})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Descripción"}),e.jsx("p",{className:"text-sm",children:d.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Debe"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:p(d.totalDebit)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Haber"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:p(d.totalCredit)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Estado"}),e.jsx(A,{variant:"default",className:"bg-green-100 text-green-800 ml-2",children:d.status})]})]})]})})]})})}export{He as default};
