import{am as Z,Y as v,u as k,R as I,ap as ee,aq as se,j as e,aI as ae,B as n,at as re,l,au as te,bB as le,bC as ie,h as H,bE as ne,bF as ce,C as z,a as L,b as O,as as de,a3 as V,c as $,z as b,H as f,J as C,K as D,N as c,f as w,D as oe,r as me,t as xe,v as he,w as ue,M as je,bS as ge,m as pe,i as ve,be as ye,aw as Ne,bD as B,X as g}from"./index-Dzu3mJf5.js";import{e as be}from"./eachDayOfInterval-DXiyoVfy.js";import{g as fe}from"./getDay-BGvNE9nu.js";import{s as Ce}from"./subMonths-AhCjVDFT.js";const M={"Arte y Cultura":"bg-green-100 text-green-800 hover:bg-green-200","Recreación y Bienestar":"bg-blue-100 text-blue-800 hover:bg-blue-200","Eventos de Temporada":"bg-orange-100 text-orange-800 hover:bg-orange-200",Deportivo:"bg-red-100 text-red-800 hover:bg-red-200",Comunidad:"bg-purple-100 text-purple-800 hover:bg-purple-200","Naturaleza y Ciencia":"bg-teal-100 text-teal-800 hover:bg-teal-200",default:"bg-gray-100 text-gray-800 hover:bg-gray-200"};function Ie(){var E;const[,A]=Z(),[d,y]=v.useState(new Date),[o,S]=v.useState(void 0),[r,F]=v.useState(null),[R,m]=v.useState(!1),[t,p]=v.useState({category:"all",parkId:"all",instructorId:"all",isFree:"all"}),{data:x=[],isLoading:K}=k({queryKey:["/api/activities"],retry:1}),{data:T}=k({queryKey:["/api/parks"],retry:1}),{data:P}=k({queryKey:["/api/instructors"],retry:1}),q=I.useMemo(()=>(Array.isArray(x)?x:[]).filter(a=>{const i=t.category==="all"||a.category===t.category,h=t.parkId==="all"||a.parkId===parseInt(t.parkId),u=t.instructorId==="all"||a.instructorId===parseInt(t.instructorId),j=t.isFree==="all"||t.isFree==="free"&&(!a.price||a.price===0)||t.isFree==="paid"&&a.price&&a.price>0;return i&&h&&u&&j}),[x,t]),_=I.useMemo(()=>{const s=ee(d),a=se(d),i=be({start:s,end:a}),h=fe(s);return[...Array(h).fill(null),...i]},[d]),G=I.useMemo(()=>{const s=Array.isArray(x)?x:[],a=new Set;return s.forEach(i=>{i.category&&a.add(i.category)}),Array.from(a)},[x]),N=s=>{if(!s||!q)return[];const a=l(s,"yyyy-MM-dd");return q.filter(i=>(i.startDate?i.startDate.substring(0,10):null)===a)},J=()=>{y(Ce(d,1))},X=()=>{y(Ne(d,1))},Q=()=>{y(new Date),S(new Date)},U=(s,a)=>{if(!s)return e.jsx("div",{className:"h-28 bg-gray-50 border border-gray-200"},`empty-${a}`);const i=l(s,"yyyy-MM-dd")===l(new Date,"yyyy-MM-dd"),h=o&&l(s,"yyyy-MM-dd")===l(o,"yyyy-MM-dd"),u=N(s);return e.jsxs("div",{className:B("h-28 min-h-[7rem] border border-gray-200 p-1 overflow-hidden",i?"bg-blue-50":"bg-white",h?"ring-2 ring-blue-400 ring-inset":""),onClick:()=>S(s),children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:B("text-sm font-medium",i?"text-blue-600":""),children:l(s,"d")}),e.jsx("span",{className:"text-xs text-gray-500",children:l(s,"EEE",{locale:g})})]}),e.jsxs("div",{className:"mt-1 space-y-1 overflow-y-auto max-h-20",children:[u.slice(0,3).map(j=>e.jsx("div",{className:"text-xs truncate cursor-pointer",onClick:W=>{W.stopPropagation(),F(j),m(!0)},children:e.jsx(w,{className:M[j.category||"default"],variant:"outline",children:j.title})},j.id)),u.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",u.length-3," más"]})]})]},l(s,"yyyy-MM-dd"))},Y=()=>{p({category:"all",parkId:"all",instructorId:"all",isFree:"all"})};return e.jsx(ae,{children:e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Calendario de Actividades"}),e.jsx("p",{className:"text-muted-foreground",children:"Consulta las actividades programadas en el calendario mensual."})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:J,children:e.jsx(re,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-lg font-medium min-w-[200px] text-center",children:l(d,"MMMM yyyy",{locale:g})}),e.jsx(n,{variant:"outline",size:"sm",onClick:X,children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:Q,children:"Hoy"}),e.jsxs(le,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Elegir mes"]})}),e.jsx(ne,{className:"w-auto p-0",align:"end",children:e.jsx(ce,{mode:"single",selected:d,onSelect:s=>s&&y(s)})})]}),e.jsx(n,{onClick:()=>A("/admin/organizador/catalogo/crear"),className:"ml-2 bg-blue-600 hover:bg-blue-700 text-white",children:"Nueva Actividad"})]})]}),e.jsxs(z,{className:"mb-6",children:[e.jsxs(L,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(O,{className:"text-lg",children:"Filtros"}),e.jsxs(n,{variant:"ghost",size:"sm",onClick:Y,children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Limpiar filtros"]})]}),e.jsx(V,{children:"Filtra las actividades mostradas en el calendario"})]}),e.jsx($,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Categoría"}),e.jsxs(b,{value:t.category,onValueChange:s=>p({...t,category:s}),children:[e.jsx(f,{children:e.jsx(C,{placeholder:"Todas las categorías"})}),e.jsxs(D,{children:[e.jsx(c,{value:"all",children:"Todas las categorías"}),G.map(s=>e.jsx(c,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Parque"}),e.jsxs(b,{value:t.parkId,onValueChange:s=>p({...t,parkId:s}),children:[e.jsx(f,{children:e.jsx(C,{placeholder:"Todos los parques"})}),e.jsxs(D,{children:[e.jsx(c,{value:"all",children:"Todos los parques"}),Array.isArray(T)&&T.map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Instructor"}),e.jsxs(b,{value:t.instructorId,onValueChange:s=>p({...t,instructorId:s}),children:[e.jsx(f,{children:e.jsx(C,{placeholder:"Todos los instructores"})}),e.jsxs(D,{children:[e.jsx(c,{value:"all",children:"Todos los instructores"}),Array.isArray(P)&&P.map(s=>e.jsx(c,{value:s.id.toString(),children:s.full_name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"Precio"}),e.jsxs(b,{value:t.isFree,onValueChange:s=>p({...t,isFree:s}),children:[e.jsx(f,{children:e.jsx(C,{placeholder:"Todas las actividades"})}),e.jsxs(D,{children:[e.jsx(c,{value:"all",children:"Todas las actividades"}),e.jsx(c,{value:"free",children:"Gratuitas"}),e.jsx(c,{value:"paid",children:"De pago"})]})]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border shadow",children:[e.jsx("div",{className:"grid grid-cols-7 gap-0",children:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"].map(s=>e.jsx("div",{className:"py-2 text-center font-medium text-gray-600 border-b",children:s},s))}),e.jsx("div",{className:"grid grid-cols-7 gap-0",children:K?e.jsx("div",{className:"col-span-7 py-12 text-center text-gray-500",children:"Cargando actividades..."}):_.map((s,a)=>U(s,a))})]}),e.jsxs("div",{className:"mt-6 flex flex-wrap gap-2",children:[e.jsx("div",{className:"text-sm font-medium mr-2",children:"Categorías:"}),Object.entries(M).map(([s,a])=>s==="default"?null:e.jsx(w,{className:a,variant:"outline",children:s},s))]}),e.jsx(oe,{open:R,onOpenChange:m,children:e.jsx(me,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:r?e.jsxs(e.Fragment,{children:[e.jsxs(xe,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(he,{className:"text-2xl font-bold",children:r.title}),e.jsx(w,{className:M[r.category||"default"],variant:"outline",children:r.category})]}),e.jsxs(ue,{children:[e.jsxs("div",{className:"mt-2 flex items-center text-gray-500",children:[e.jsx(H,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"mr-3",children:r.startDate?l(new Date(r.startDate),"dd/MM/yyyy HH:mm",{locale:g}):"Fecha no disponible"}),r.location&&e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:r.location})]})]}),r.parkName&&e.jsxs("div",{className:"mt-1 text-gray-500",children:["Parque: ",r.parkName]})]})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Descripción"}),e.jsx("p",{className:"text-gray-700",children:r.description||"Sin descripción disponible"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[r.price!==void 0&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(ge,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Precio"}),e.jsx("p",{children:r.price>0?`$${r.price}`:"Gratuita"})]})]}),((E=r.instructor)==null?void 0:E.full_name)&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(pe,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Instructor"}),e.jsx("p",{children:r.instructor.full_name})]})]}),r.startDate&&r.endDate&&e.jsxs("div",{className:"flex items-start",children:[e.jsx(ve,{className:"h-5 w-5 mr-2 text-gray-500 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Duración"}),e.jsxs("p",{children:[l(new Date(r.startDate),"HH:mm",{locale:g})," -",l(new Date(r.endDate),"HH:mm",{locale:g})]})]})]})]})]}),e.jsxs(ye,{className:"flex gap-2",children:[e.jsx(n,{variant:"outline",onClick:()=>m(!1),children:"Cerrar"}),e.jsx(n,{className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>{m(!1),A("/admin/organizador/catalogo/ver")},children:"Ver todas las actividades"})]})]}):e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("p",{children:"No se encontraron detalles de la actividad"}),e.jsx(n,{variant:"outline",className:"mt-4",onClick:()=>m(!1),children:"Cerrar"})]})})}),o&&e.jsxs(z,{className:"mt-6",children:[e.jsxs(L,{children:[e.jsxs(O,{children:["Actividades para el ",l(o,"d MMMM yyyy",{locale:g})]}),e.jsxs(V,{children:[N(o).length," actividades programadas"]})]}),e.jsx($,{children:N(o).length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No hay actividades programadas para este día"}):e.jsx("div",{className:"space-y-3",children:N(o).map(s=>{var a;return e.jsxs("div",{className:"p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",onClick:()=>{F(s),m(!0)},children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("h3",{className:"font-medium",children:s.title}),e.jsx(w,{className:M[s.category||"default"],variant:"outline",children:s.category})]}),e.jsxs("div",{className:"text-sm text-gray-500 mt-1",children:[(a=s.description)==null?void 0:a.substring(0,100),s.description&&s.description.length>100?"...":""]}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Parque:"})," ",s.parkName||`Parque #${s.parkId}`]}),s.instructor&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Instructor:"})," ",s.instructor.full_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Precio:"})," ",s.price&&s.price>0?`$${s.price}`:"Gratuita"]})]})]},s.id)})})})]})]})})}export{Ie as default};
