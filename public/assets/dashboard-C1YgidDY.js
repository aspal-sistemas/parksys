import{u as f,j as e,aX as C,f as i,aT as A,B as Y,bQ as F,g as n,h as c,i as d,aY as I,aS as P,ar as M,ah as U,dw as Z,n as J,o as j,aw as V,aW as _,ay as ee,b5 as S,bd as se,be as ae,bf as te,ba as T,b7 as re,b8 as le,b9 as ie,bc as ne,M as ce,aZ as de}from"./index-D5qLf1ib.js";import{P as xe}from"./progress-CD1SWYCP.js";import{B as oe}from"./BarChart-BX_xVycl.js";const ge=()=>{var v,w;const{data:x,isLoading:B,refetch:L}=f({queryKey:["/api/trees"],suspense:!1,retry:1}),{data:o,isLoading:k,refetch:q}=f({queryKey:["/api/trees/maintenances"],suspense:!1,retry:1}),{data:m,isLoading:D,refetch:E}=f({queryKey:["/api/tree-species"],suspense:!1,retry:1}),r=Array.isArray(x)?x:(x==null?void 0:x.data)||[],l=Array.isArray(o)?o:(o==null?void 0:o.data)||[],g=Array.isArray(m)?m:(m==null?void 0:m.data)||[],K=async()=>{await Promise.all([L(),q(),E()])};if(B||k||D)return e.jsx(C,{children:e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-green-500 border-t-transparent"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando datos del arbolado..."})]})})});const u=(r==null?void 0:r.length)||0,R=(g==null?void 0:g.length)||0,O=(l==null?void 0:l.length)||0,b=(r==null?void 0:r.reduce((s,a)=>{const t=(a==null?void 0:a.healthStatus)||"Desconocido";return s[t]=(s[t]||0)+1,s},{}))||{},z=(l==null?void 0:l.reduce((s,a)=>{const t=(a==null?void 0:a.urgency)||"media";return s[t]=(s[t]||0)+1,s},{}))||{},$=(r==null?void 0:r.reduce((s,a)=>{const t=(a==null?void 0:a.parkName)||"Sin parque";return s[t]=(s[t]||0)+1,s},{}))||{},G=Object.entries($).sort(([,s],[,a])=>a-s).slice(0,3),H=(r==null?void 0:r.reduce((s,a)=>{const t=(a==null?void 0:a.speciesName)||"Especie desconocida";return s[t]=(s[t]||0)+1,s},{}))||{},Q=Object.entries(H).sort(([,s],[,a])=>a-s).slice(0,5),N=Object.entries(b).map(([s,a])=>({name:s,value:a,color:s==="Excelente"?"#22c55e":s==="Bueno"?"#84cc16":s==="Regular"?"#eab308":s==="Malo"?"#f97316":"#ef4444"})),W=Q.map(([s,a])=>({species:s.length>15?s.substring(0,15)+"...":s,count:a})),X=(b.Excelente||0)+(b.Bueno||0),p=u>0?Math.round(X/u*100):0,y=((v=l==null?void 0:l.filter(s=>(s==null?void 0:s.status)==="pending"))==null?void 0:v.length)||0,h=((w=l==null?void 0:l.filter(s=>(s==null?void 0:s.urgency)==="alta"))==null?void 0:w.length)||0;return e.jsx(C,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(i,{className:"p-4 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard de Arbolado"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Análisis y estadísticas del arbolado urbano"})]}),e.jsxs(Y,{onClick:K,variant:"outline",children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Actualizar"]})]})}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(i,{className:"bg-gradient-to-br from-green-50 to-emerald-50 border-green-200",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-green-800",children:"Total de Árboles"}),e.jsx(A,{className:"h-5 w-5 text-green-600"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold text-green-900",children:u}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(I,{className:"h-4 w-4 text-green-600 mr-1"}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Inventario activo"})]})]})]}),e.jsxs(i,{className:"bg-gradient-to-br from-blue-50 to-cyan-50 border-blue-200",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-blue-800",children:"Especies Registradas"}),e.jsx(P,{className:"h-5 w-5 text-blue-600"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold text-blue-900",children:R}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(M,{className:"h-4 w-4 text-blue-600 mr-1"}),e.jsx("span",{className:"text-sm text-blue-600 font-medium",children:"Biodiversidad"})]})]})]}),e.jsxs(i,{className:"bg-gradient-to-br from-amber-50 to-orange-50 border-amber-200",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-amber-800",children:"Salud General"}),e.jsx(U,{className:"h-5 w-5 text-amber-600"})]}),e.jsxs(d,{children:[e.jsxs("div",{className:"text-3xl font-bold text-amber-900",children:[p,"%"]}),e.jsx("div",{className:"flex items-center mt-2",children:e.jsx(xe,{value:p,className:"w-full mt-2"})}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:"Árboles en buen estado"})]})]}),e.jsxs(i,{className:"bg-gradient-to-br from-red-50 to-pink-50 border-red-200",children:[e.jsxs(n,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-red-800",children:"Mantenimientos"}),e.jsx(Z,{className:"h-5 w-5 text-red-600"})]}),e.jsxs(d,{children:[e.jsx("div",{className:"text-3xl font-bold text-red-900",children:y}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(J,{className:"h-4 w-4 text-red-600 mr-1"}),e.jsx("span",{className:"text-sm text-red-600 font-medium",children:"Pendientes"})]}),h>0&&e.jsxs(j,{variant:"destructive",className:"mt-2",children:[h," urgentes"]})]})]})]}),h>0&&e.jsxs(V,{className:"border-red-200 bg-red-50",children:[e.jsx(_,{className:"h-4 w-4"}),e.jsxs(ee,{className:"text-red-800",children:[e.jsx("strong",{children:"Atención:"})," Hay ",h," mantenimientos urgentes que requieren atención inmediata."]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Estado de Salud de Árboles"]})}),e.jsx(d,{children:e.jsx(S,{width:"100%",height:300,children:e.jsxs(se,{children:[e.jsx(ae,{data:N,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:a})=>`${s}: ${(a*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:N.map((s,a)=>e.jsx(te,{fill:s.color},`cell-${a}`))}),e.jsx(T,{})]})})})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5"}),"Especies Más Comunes"]})}),e.jsx(d,{children:e.jsx(S,{width:"100%",height:300,children:e.jsxs(oe,{data:W,children:[e.jsx(re,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:"species",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(ie,{}),e.jsx(T,{}),e.jsx(ne,{dataKey:"count",fill:"#22c55e"})]})})})]})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Parques con Más Árboles"]})}),e.jsx(d,{className:"space-y-4",children:G.map(([s,a],t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"secondary",children:t+1}),e.jsx("span",{className:"font-medium",children:s})]}),e.jsxs(j,{variant:"outline",children:[a," árboles"]})]},s))})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Resumen de Mantenimientos"]})}),e.jsxs(d,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:O}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total registrados"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:y}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pendientes"})]})]}),e.jsx("div",{className:"space-y-2",children:Object.entries(z).map(([s,a])=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"capitalize",children:s}),e.jsx(j,{variant:s==="alta"?"destructive":s==="media"?"default":"secondary",children:a})]},s))})]})]})]})]})})};export{ge as default};
