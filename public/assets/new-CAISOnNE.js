import{am as Q,e as U,a6 as Y,Y as _,a7 as G,u as W,a8 as X,j as e,aI as Z,B as I,A as ee,aa as se,C as p,a as u,b as g,M as $,c as f,ab as i,ac as c,ad as l,ae as o,z as ae,H as re,J as te,K as ne,N as ie,af as d,I as h,cY as ce,x as P,O as le,ag as oe,a9 as de,f as me,U as xe,al as he,i as je,a5 as n,ah as pe}from"./index-VG22aPDC.js";import{S as B}from"./separator-D_IPDq0v.js";const ue=n.object({space_id:n.string().min(1,"Selecciona un espacio"),customer_name:n.string().min(2,"El nombre debe tener al menos 2 caracteres"),customer_email:n.string().email("Email inválido"),customer_phone:n.string().min(10,"El teléfono debe tener al menos 10 dígitos"),start_date:n.string().min(1,"Selecciona fecha de inicio"),end_date:n.string().min(1,"Selecciona fecha de fin"),start_time:n.string().min(1,"Selecciona hora de inicio"),end_time:n.string().min(1,"Selecciona hora de fin"),special_requests:n.string().optional(),deposit_paid:n.boolean().default(!1)}).refine(S=>{const y=new Date(S.start_date);return new Date(S.end_date)>=y},{message:"La fecha de fin debe ser igual o posterior a la fecha de inicio",path:["end_date"]}),ge={playground:"Área de Juegos",kiosk:"Kiosco",picnic_area:"Área de Picnic",open_area:"Área Abierta",pavilion:"Pabellón"};function we(){const[S,y]=Q(),{toast:D}=U(),V=Y(),[a,K]=_.useState(null),[C,q]=_.useState(0),[v,M]=_.useState(0),z=new URLSearchParams(window.location.search).get("space_id"),r=G({resolver:pe(ue),defaultValues:{space_id:z||"",customer_name:"",customer_email:"",customer_phone:"",start_date:"",end_date:"",start_time:"",end_time:"",special_requests:"",deposit_paid:!1}}),{data:T=[],isLoading:ve}=W({queryKey:["/api/reservable-spaces"],queryFn:async()=>{const s=await fetch("/api/reservable-spaces?active_only=true");if(!s.ok)throw new Error("Error al cargar los espacios");return s.json()}}),E=X({mutationFn:async s=>{const t={spaceId:parseInt(s.space_id),contactName:s.customer_name,contactEmail:s.customer_email,contactPhone:s.customer_phone,startDate:s.start_date,endDate:s.end_date,startTime:s.start_time,endTime:s.end_time,specialRequests:s.special_requests||"",expectedAttendees:(a==null?void 0:a.capacity)||1,purpose:"Evento privado - Múltiples días",totalCost:C,depositPaid:s.deposit_paid,eventId:null,activityId:null},m=await fetch("/api/space-reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!m.ok){const x=await m.json();throw new Error(x.message||"Error al crear la reserva")}return m.json()},onSuccess:()=>{D({title:"Reserva creada",description:"La reserva se ha creado exitosamente"}),V.invalidateQueries({queryKey:["/api/space-reservations"]}),y("/admin/space-reservations")},onError:s=>{D({title:"Error",description:s.message,variant:"destructive"})}}),F=r.watch("space_id"),j=r.watch("start_date"),N=r.watch("end_date"),b=r.watch("start_time"),w=r.watch("end_time");_.useEffect(()=>{if(F){const s=T.find(t=>t.id.toString()===F);K(s||null)}},[F,T]),_.useEffect(()=>{if(a&&j&&N&&b&&w){const s=new Date(j),m=new Date(N).getTime()-s.getTime(),x=Math.max(1,Math.ceil(m/(1e3*3600*24))+1),k=new Date(`2000-01-01T${b}`),A=(new Date(`2000-01-01T${w}`).getTime()-k.getTime())/(1e3*60*60);if(A>0){const O=A*x;M(O),q(O*parseFloat(a.hourly_rate))}else M(0),q(0)}},[a,j,N,b,w]);const J=s=>{E.mutate(s)},R=()=>{y("/admin/space-reservations")},L=()=>{if(!a||!b||!w)return!0;const s=v;return s>=a.minimum_hours&&s<=a.maximum_hours},H=()=>{if(!a)return new Date().toISOString().split("T")[0];const s=new Date;return s.setDate(s.getDate()+a.advance_booking_days),s.toISOString().split("T")[0]};return e.jsx(Z,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(I,{variant:"outline",size:"sm",onClick:R,children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Volver"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Nueva Reserva"}),e.jsx("p",{className:"text-gray-600",children:"Crear una nueva reserva de espacio"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(se,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(J),className:"space-y-6",children:[e.jsxs(p,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Seleccionar Espacio"]})}),e.jsx(f,{children:e.jsx(i,{control:r.control,name:"space_id",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Espacio a Reservar"}),e.jsx(o,{children:e.jsxs(ae,{value:s.value,onValueChange:s.onChange,children:[e.jsx(re,{children:e.jsx(te,{placeholder:"Selecciona un espacio"})}),e.jsx(ne,{children:T.map(t=>e.jsx(ie,{value:t.id.toString(),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.park_name," - $",t.hourly_rate,"/hora"]})]})},t.id))})]})}),e.jsx(d,{})]})})})]}),e.jsxs(p,{children:[e.jsx(u,{children:e.jsx(g,{children:"Información del Cliente"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"customer_name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Nombre Completo"}),e.jsx(o,{children:e.jsx(h,{placeholder:"Nombre del cliente",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"customer_email",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Email"}),e.jsx(o,{children:e.jsx(h,{type:"email",placeholder:"cliente@email.com",...s})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"customer_phone",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Teléfono"}),e.jsx(o,{children:e.jsx(h,{placeholder:"(33) 1234-5678",...s})}),e.jsx(d,{})]})})]})]})]}),e.jsxs(p,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Fecha y Horario"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"start_date",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Fecha de Inicio"}),e.jsx(o,{children:e.jsx(h,{type:"date",min:H(),...s})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"end_date",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Fecha de Fin"}),e.jsx(o,{children:e.jsx(h,{type:"date",min:j||H(),...s})}),e.jsx(d,{})]})})]}),a&&a.advance_booking_days>0&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-amber-600",children:[e.jsx(P,{className:"h-3 w-3 inline mr-1"}),"Requiere reserva con ",a.advance_booking_days," días de anticipación"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"start_time",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Hora de Inicio"}),e.jsx(o,{children:e.jsx(h,{type:"time",...s})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"end_time",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Hora de Fin"}),e.jsx(o,{children:e.jsx(h,{type:"time",...s})}),e.jsx(d,{})]})})]}),a&&!L()&&v>0&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-red-600",children:[e.jsx(P,{className:"h-3 w-3 inline mr-1"}),"La duración debe ser entre ",a.minimum_hours," y ",a.maximum_hours," horas"]})})]})]}),e.jsxs(p,{children:[e.jsx(u,{children:e.jsx(g,{children:"Información Adicional"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"special_requests",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Solicitudes Especiales (Opcional)"}),e.jsx(o,{children:e.jsx(le,{placeholder:"Describe cualquier solicitud especial o requerimiento adicional...",className:"min-h-[100px]",...s})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"deposit_paid",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(oe,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(l,{children:"Depósito Pagado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Marcar si el cliente ya ha pagado el depósito requerido"})]})]})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(I,{type:"button",variant:"outline",onClick:R,children:"Cancelar"}),e.jsxs(I,{type:"submit",className:"bg-[#00a587] hover:bg-[#067f5f]",disabled:E.isPending||!L(),children:[E.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(de,{className:"h-4 w-4 mr-2"}),"Crear Reserva"]})]})]})})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-6 space-y-4",children:[a&&e.jsxs(p,{children:[e.jsx(u,{children:e.jsx(g,{className:"text-lg",children:"Resumen de Reserva"})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:a.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600 mb-2",children:[e.jsx($,{className:"h-3 w-3"}),a.park_name]}),e.jsx(me,{className:"bg-blue-100 text-blue-800",children:ge[a.space_type]})]}),e.jsx(B,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),"Capacidad:"]}),e.jsxs("span",{children:[a.capacity," personas"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),"Precio/hora:"]}),e.jsxs("span",{children:["$",a.hourly_rate]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),"Duración mín/máx:"]}),e.jsxs("span",{children:[a.minimum_hours,"h - ",a.maximum_hours,"h"]})]})]}),v>0&&j&&N&&e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx("div",{className:"space-y-2",children:(()=>{const s=new Date(j),m=new Date(N).getTime()-s.getTime(),x=Math.max(1,Math.ceil(m/(1e3*3600*24))+1),k=v/x;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Período:"}),e.jsxs("span",{children:[x," ",x===1?"día":"días"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Horas por día:"}),e.jsxs("span",{children:[k.toFixed(1)," hrs"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total horas:"}),e.jsxs("span",{children:[v.toFixed(1)," hrs"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",C.toFixed(2)]})]})]})})()}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-[#00a587]",children:["$",C.toFixed(2)]})]})]}),a.requires_approval&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-amber-600",children:[e.jsx(P,{className:"h-3 w-3 inline mr-1"}),"Este espacio requiere aprobación administrativa"]})})]})]}),a&&e.jsxs(p,{children:[e.jsx(u,{children:e.jsx(g,{className:"text-base",children:"Reglas del Espacio"})}),e.jsx(f,{children:e.jsx("p",{className:"text-sm text-gray-600",children:a.rules})})]})]})})]})]})})}export{we as default};
