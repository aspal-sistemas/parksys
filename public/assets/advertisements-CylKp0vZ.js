import{a2 as x,l as ke,ae as qe,u as re,ag as $,j as e,aX as ne,f as b,i as N,bZ as le,B as m,bQ as Le,bh as Pe,w as oe,y as de,z as ce,I as me,N as r,O as u,Q as j,V as f,W as y,Y as _,_ as d,$ as ue,ar as Re,au as Oe,b0 as Be,a6 as $e,a5 as Ge,bq as xe,bn as pe,d8 as Ke,aq as he,aM as Qe,aN as We}from"./index-D5qLf1ib.js";const ge=({src:A,alt:w})=>{const[V,C]=x.useState(!1);return!A||V?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-blue-50 to-blue-100 flex items-center justify-center border border-blue-200",children:e.jsx(Ke,{className:"w-6 h-6 text-blue-500"})}):e.jsx("img",{src:A,alt:w,className:"w-full h-full object-cover",onError:()=>C(!0)})},Ze=()=>{const[A,w]=x.useState(!1),[V,C]=x.useState(!1),[G,K]=x.useState(null),[U,ve]=x.useState(""),[z,je]=x.useState("all"),[F,fe]=x.useState("all"),[Q,ye]=x.useState(Date.now()),[W,_e]=x.useState(Date.now()),[T,be]=x.useState(null),[D,E]=x.useState(!1),[v,J]=x.useState(1),[S,Z]=x.useState("list"),k=12,[a,s]=x.useState({title:"",description:"",image_url:"",content:"",button_text:"",campaign_id:0,is_active:!0,media_type:"image",storage_type:"url",duration:0,alt_text:""}),{toast:o}=ke(),h=qe(),H=async t=>{E(!0);try{const i=new FormData;i.append("file",t),console.log("游늬 Subiendo archivo:",t.name,t.type,t.size);const n=await fetch("/api/advertising/upload",{method:"POST",body:i,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});console.log("游늬 Response status:",n.status);const p=await n.text();if(console.log("游늬 Response text:",p),!n.ok){let c="Error al subir el archivo";try{const M=JSON.parse(p);c=M.error||M.message||c}catch(M){console.error("Error parsing response:",M),c=`Error del servidor: ${n.status}`}throw new Error(c)}const l=JSON.parse(p);if(l.success)return l.url;throw new Error(l.error||"Error desconocido")}catch(i){throw console.error("Error uploading file:",i),i}finally{E(!1)}},{data:Ne,isLoading:we,refetch:Ce}=re({queryKey:["/api/advertising-management/advertisements"],staleTime:10*1e3,gcTime:30*1e3}),g=Ne||[],{data:Ee}=re({queryKey:["/api/advertising-management/campaigns"],staleTime:5*60*1e3}),I=Ee||[];x.useEffect(()=>{if(!g||g.length===0)return;const t=g.find(i=>i.id===13);t&&t.updatedAt&&t.updatedAt!==T&&(console.log("游꿢 ANUNCIO 13 DETECTADO - Cambio en timestamp:",{anterior:T,nuevo:t.updatedAt,diferencia:T?"CAMBIO DETECTADO":"PRIMER CARGA"}),be(t.updatedAt),Se())},[g,T]);const Se=()=>{console.log("游꿢 FORZANDO ACTUALIZACI칍N DEL ANUNCIO 13..."),h.invalidateQueries({queryKey:["/api/advertising-management/advertisements"]}),ye(Date.now()),_e(Date.now()),Ce()},Ae=$({mutationFn:async t=>{const i=new FormData;return i.append("campaign_id",t.campaign_id.toString()),i.append("title",t.title),i.append("description",t.description||""),i.append("content",t.content||""),i.append("image_url",t.image_url||""),i.append("media_type",t.media_type||"image"),i.append("storage_type",t.storage_type||"url"),i.append("duration",t.duration.toString()),i.append("alt_text",t.alt_text||""),i.append("is_active",t.is_active.toString()),await fetch("/api/advertising-management/advertisements",{method:"POST",body:i}).then(n=>n.json())},onSuccess:()=>{o({title:"칄xito",description:"Anuncio creado correctamente"}),w(!1),s({title:"",description:"",image_url:"",content:"",campaign_id:0,is_active:!0,media_type:"image",storage_type:"url",duration:0,alt_text:""}),h.invalidateQueries({queryKey:["/api/advertising-management/advertisements"]}),localStorage.setItem("adForceUpdate",Date.now().toString()),window.dispatchEvent(new CustomEvent("adForceUpdate")),window.dispatchEvent(new StorageEvent("storage",{key:"adForceUpdate",newValue:Date.now().toString(),oldValue:null,url:window.location.href})),console.log("游깷 Eventos globales disparados para actualizar todas las p치ginas (CREATE)")},onError:t=>{o({title:"Error",description:t.message||"Error al crear el anuncio",variant:"destructive"})}}),q=$({mutationFn:async t=>await he(`/api/advertising-management/advertisements/${t.id}`,{method:"PUT",data:t}),onSuccess:()=>{o({title:"칄xito",description:"Anuncio actualizado correctamente"}),C(!1),K(null),h.invalidateQueries({queryKey:["/api/advertising-management/advertisements"]}),h.invalidateQueries({queryKey:["/api/advertising/placements"]}),h.invalidateQueries({queryKey:["/api/advertising"]});const t=[0,500,1e3,1500,2e3,3e3,4e3];t.forEach((i,n)=>{setTimeout(()=>{h.invalidateQueries({queryKey:["/api/advertising/placements"]}),h.refetchQueries({queryKey:["/api/advertising/placements"]}),document.querySelectorAll('img[src*="unsplash"]').forEach(l=>{const c=l.getAttribute("src");c&&l.setAttribute("src",c+"&reload="+Date.now())}),console.log(`游댃 Cache de publicidad invalidado - Iteraci칩n ${n+1}/${t.length}`)},i)}),console.log("游댃 Cache de publicidad invalidado completamente"),localStorage.setItem("adForceUpdate",Date.now().toString()),window.dispatchEvent(new CustomEvent("adForceUpdate")),window.dispatchEvent(new StorageEvent("storage",{key:"adForceUpdate",newValue:Date.now().toString(),oldValue:null,url:window.location.href})),console.log("游깷 Eventos globales disparados para actualizar todas las p치ginas")},onError:t=>{o({title:"Error",description:t.message||"Error al actualizar el anuncio",variant:"destructive"})}}),Fe=$({mutationFn:async t=>await he(`/api/advertising-management/advertisements/${t}`,{method:"DELETE"}),onSuccess:()=>{o({title:"칄xito",description:"Anuncio eliminado correctamente"}),h.invalidateQueries({queryKey:["/api/advertising-management/advertisements"]}),localStorage.setItem("adForceUpdate",Date.now().toString()),window.dispatchEvent(new CustomEvent("adForceUpdate")),window.dispatchEvent(new StorageEvent("storage",{key:"adForceUpdate",newValue:Date.now().toString(),oldValue:null,url:window.location.href})),console.log("游깷 Eventos globales disparados para actualizar todas las p치ginas (DELETE)")},onError:t=>{o({title:"Error",description:t.message||"Error al eliminar el anuncio",variant:"destructive"})}}),Te=t=>{if(t.preventDefault(),!a.title||!a.image_url||a.campaign_id===0){o({title:"Error",description:"Por favor completa todos los campos requeridos",variant:"destructive"});return}Ae.mutate(a)},De=t=>{if(t.preventDefault(),!G){o({title:"Error",description:"No se ha seleccionado un anuncio para editar",variant:"destructive"});return}if(!a.title||!a.image_url||a.campaign_id===0){o({title:"Error",description:"Por favor completa todos los campos requeridos",variant:"destructive"});return}const i={id:G.id,title:a.title,description:a.description||"",image_url:a.image_url,link_url:"",alt_text:a.alt_text||"",button_text:a.button_text||"",ad_type:"institutional",media_type:a.media_type,frequency:"always",priority:5,is_active:a.is_active,video_url:null,html_content:a.content||"",carousel_images:[],scheduled_days:[],scheduled_hours:[],target_pages:[],target_positions:[],campaign_id:a.campaign_id,content:a.content||"",storage_type:a.storage_type||"url",media_file_id:null,duration:a.duration||0,type:a.media_type,status:"active"};console.log("Datos para actualizar:",i),q.mutate(i)},X=t=>{console.log("Editando anuncio:",t),K(t),s({title:t.title||"",description:t.description||"",image_url:t.imageUrl||"",content:t.content||"",button_text:t.button_text||"",campaign_id:t.campaignId||0,is_active:t.isActive||!1,media_type:t.mediaType||"image",storage_type:t.storageType||"url",duration:t.duration||0,alt_text:t.altText||""}),C(!0)},Y=t=>{window.confirm("쮼st치s seguro de que quieres eliminar este anuncio?")&&Fe.mutate(t)},ee=g.filter(t=>{const i=t.title.toLowerCase().includes(U.toLowerCase())||t.description.toLowerCase().includes(U.toLowerCase()),n=z==="all"||t.campaignId&&t.campaignId.toString()===z,p=F==="all"||F==="active"&&t.isActive||F==="inactive"&&!t.isActive;return i&&n&&p}),L=ee.length,P=Math.ceil(L/k),R=(v-1)*k,te=Math.min(R+k,L),ae=ee.slice(R,te),O=t=>{t(),J(1)},B=t=>{J(t)},Ie=()=>{if(P<=1)return null;const t=[],i=5;let n=Math.max(1,v-Math.floor(i/2)),p=Math.min(P,n+i-1);p-n<i-1&&(n=Math.max(1,p-i+1));for(let l=n;l<=p;l++)t.push(l);return e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Mostrando ",R+1," a ",te," de ",L," anuncios"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>B(v-1),disabled:v===1,children:[e.jsx(Qe,{className:"h-4 w-4"}),"Anterior"]}),t.map(l=>e.jsx(m,{variant:v===l?"default":"outline",size:"sm",onClick:()=>B(l),className:v===l?"bg-[#00a587] hover:bg-[#067f5f]":"",children:l},l)),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>B(v+1),disabled:v===P,children:["Siguiente",e.jsx(We,{className:"h-4 w-4"})]})]})]})},Me=g.length,Ve=g.filter(t=>t.isActive).length,Ue=g.reduce((t,i)=>t+i.id*150,0),ze=g.reduce((t,i)=>t+i.id*25,0),ie=t=>new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"short",day:"numeric"}),se=t=>{const i=I.find(n=>n.id===t);return(i==null?void 0:i.name)||"Sin campa침a"};return we?e.jsx(ne,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-[#00a587]"})})}):e.jsx(ne,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(b,{className:"bg-gray-50",children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gesti칩n de Anuncios"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Crea y gestiona el contenido publicitario para tus espacios"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{onClick:()=>{localStorage.setItem("adForceUpdate",Date.now().toString()),window.dispatchEvent(new CustomEvent("adForceUpdate")),window.dispatchEvent(new StorageEvent("storage",{key:"adForceUpdate",newValue:Date.now().toString(),oldValue:null,url:window.location.href})),[0,500,1e3,1500,2e3].forEach(i=>{setTimeout(()=>{h.invalidateQueries({queryKey:["/api/advertising/placements"]}),h.refetchQueries({queryKey:["/api/advertising/placements"]})},i)}),console.log("游댃 Actualizaci칩n manual de todas las im치genes publicitarias disparada"),o({title:"Actualizaci칩n enviada",description:"Se ha disparado la actualizaci칩n de todas las im치genes publicitarias en las p치ginas"})},variant:"outline",className:"bg-blue-50 hover:bg-blue-100 text-blue-700",children:[e.jsx(Le,{className:"h-4 w-4 mr-2"}),"Actualizar Todas las Im치genes"]}),e.jsxs(m,{onClick:()=>w(!0),className:"bg-[#00a587] hover:bg-[#067f5f]",children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Nuevo Anuncio"]})]})]})})}),e.jsx(oe,{open:A,onOpenChange:w,children:e.jsxs(de,{className:"max-w-2xl",children:[e.jsx(ce,{children:e.jsx(me,{children:"Crear Nuevo Anuncio"})}),e.jsxs("form",{onSubmit:Te,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"title",children:"T칤tulo *"}),e.jsx(u,{id:"title",value:a.title,onChange:t=>s({...a,title:t.target.value}),required:!0,placeholder:"T칤tulo del anuncio"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"campaign",children:"Campa침a *"}),e.jsxs(j,{value:a.campaign_id?a.campaign_id.toString():"",onValueChange:t=>s({...a,campaign_id:parseInt(t)}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar campa침a"})}),e.jsx(_,{children:I.map(t=>e.jsx(d,{value:t.id.toString(),children:t.name},t.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"description",children:"Descripci칩n"}),e.jsx(ue,{id:"description",value:a.description,onChange:t=>s({...a,description:t.target.value}),placeholder:"Descripci칩n del anuncio",rows:3})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"media_type",children:"Tipo de Contenido *"}),e.jsxs(j,{value:a.media_type,onValueChange:t=>s({...a,media_type:t}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar tipo de contenido"})}),e.jsxs(_,{children:[e.jsx(d,{value:"image",children:"Imagen"}),e.jsx(d,{value:"video",children:"Video"}),e.jsx(d,{value:"gif",children:"GIF Animado"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"storage_type",children:"M칠todo de Almacenamiento *"}),e.jsxs(j,{value:a.storage_type,onValueChange:t=>s({...a,storage_type:t}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar m칠todo"})}),e.jsxs(_,{children:[e.jsx(d,{value:"url",children:"URL Externa"}),e.jsx(d,{value:"upload",children:"Subir Archivo"})]})]})]}),a.storage_type==="url"?e.jsxs("div",{children:[e.jsx(r,{htmlFor:"image_url",children:"URL del Contenido *"}),e.jsx(u,{id:"image_url",value:a.image_url,onChange:t=>s({...a,image_url:t.target.value}),required:!0,placeholder:"https://ejemplo.com/imagen.jpg"})]}):e.jsxs("div",{children:[e.jsx(r,{htmlFor:"file_upload",children:"Subir Archivo *"}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:[a.media_type==="image"&&"Formatos: JPG, PNG, WEBP (m치x 5MB)",a.media_type==="video"&&"Formatos: MP4, WEBM, OGG, AVI, MOV (m치x 10MB, 30 segundos recomendado)",a.media_type==="gif"&&"Formato: GIF animado (m치x 3MB)"]}),e.jsx(u,{id:"file_upload",type:"file",accept:a.media_type==="image"?"image/*":a.media_type==="video"?"video/*":a.media_type==="gif"?"image/gif":"*/*",onChange:async t=>{var n;const i=(n=t.target.files)==null?void 0:n[0];if(i){if(!(a.media_type==="image"&&i.type.startsWith("image/")||a.media_type==="video"&&i.type.startsWith("video/")||a.media_type==="gif"&&i.type==="image/gif")){o({title:"Error",description:`Tipo de archivo inv치lido. Se esperaba ${a.media_type==="video"?"un video":"una imagen"}.`,variant:"destructive"});return}const l=a.media_type==="video"?10*1024*1024:5*1024*1024;if(i.size>l){o({title:"Error",description:`Archivo demasiado grande. M치ximo ${a.media_type==="video"?"10MB":"5MB"}.`,variant:"destructive"});return}try{E(!0);const c=await H(i);s({...a,image_url:c}),o({title:"칄xito",description:"Archivo subido correctamente"})}catch(c){console.error("Error uploading file:",c),o({title:"Error",description:"Error al subir el archivo",variant:"destructive"})}finally{E(!1)}}},disabled:D,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#00a587] file:text-white hover:file:bg-[#067f5f] disabled:opacity-50"}),D&&e.jsxs("div",{className:"flex items-center mt-2 text-sm text-gray-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#00a587] mr-2"}),"Subiendo archivo..."]}),a.image_url&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vista previa:"}),e.jsx("div",{className:"mt-1 border border-gray-300 rounded-lg p-2",children:a.media_type==="image"||a.media_type==="gif"?e.jsx("img",{src:a.image_url,alt:"Vista previa",className:"max-w-full h-32 object-cover rounded"}):a.media_type==="video"?e.jsxs("video",{src:a.image_url,controls:!0,muted:!0,className:"max-w-full h-32 rounded",children:[e.jsx("source",{src:a.image_url,type:"video/mp4"}),"Tu navegador no soporta videos."]}):null})]})]}),a.media_type==="video"&&e.jsxs("div",{children:[e.jsx(r,{htmlFor:"duration",children:"Duraci칩n (segundos)"}),e.jsx(u,{id:"duration",type:"number",value:a.duration,onChange:t=>s({...a,duration:parseInt(t.target.value)||0}),placeholder:"30",min:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"alt_text",children:"Texto Alternativo"}),e.jsx(u,{id:"alt_text",value:a.alt_text,onChange:t=>s({...a,alt_text:t.target.value}),placeholder:"Descripci칩n del contenido para accesibilidad"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"content",children:"URL de Contenido"}),e.jsx(u,{id:"content",value:a.content,onChange:t=>s({...a,content:t.target.value}),placeholder:"https://ejemplo.com/destino - Liga donde ir치 el usuario al hacer clic"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta es la URL donde ser치 dirigido el usuario cuando haga clic en el banner publicitario"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"button_text",children:"Texto del Bot칩n"}),e.jsx(u,{id:"button_text",value:a.button_text,onChange:t=>s({...a,button_text:t.target.value}),placeholder:"Ej: Inscr칤bete Ahora, Ver M치s, Obtener Info",maxLength:50}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Texto personalizado que aparecer치 en el bot칩n del anuncio (m치x. 50 caracteres)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"is_active",checked:a.is_active,onChange:t=>s({...a,is_active:t.target.checked})}),e.jsx(r,{htmlFor:"is_active",children:"Anuncio activo"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(m,{type:"submit",className:"bg-[#00a587] hover:bg-[#067f5f]",children:"Crear Anuncio"})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(b,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Anuncios"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Me})]}),e.jsx(le,{className:"h-8 w-8 text-[#00a587]"})]})})}),e.jsx(b,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Anuncios Activos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Ve})]}),e.jsx(Re,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(b,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Impresiones"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:Ue.toLocaleString()})]}),e.jsx(Oe,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(b,{children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Clicks"}),e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:ze.toLocaleString()})]}),e.jsx(Be,{className:"h-8 w-8 text-purple-600"})]})})})]}),e.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsx("div",{className:"flex-1 min-w-[250px]",children:e.jsx(u,{placeholder:"Buscar anuncios...",value:U,onChange:t=>O(()=>ve(t.target.value))})}),e.jsx("div",{className:"min-w-[150px]",children:e.jsxs(j,{value:z,onValueChange:t=>O(()=>je(t)),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Filtrar por campa침a"})}),e.jsxs(_,{children:[e.jsx(d,{value:"all",children:"Todas las campa침as"}),I.map(t=>e.jsx(d,{value:t.id.toString(),children:t.name},t.id))]})]})}),e.jsx("div",{className:"min-w-[120px]",children:e.jsxs(j,{value:F,onValueChange:t=>O(()=>fe(t)),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Estado"})}),e.jsxs(_,{children:[e.jsx(d,{value:"all",children:"Todos"}),e.jsx(d,{value:"active",children:"Activos"}),e.jsx(d,{value:"inactive",children:"Inactivos"})]})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{variant:S==="list"?"default":"outline",size:"sm",onClick:()=>Z("list"),className:S==="list"?"bg-[#00a587] hover:bg-[#067f5f]":"",children:e.jsx($e,{className:"h-4 w-4"})}),e.jsx(m,{variant:S==="grid"?"default":"outline",size:"sm",onClick:()=>Z("grid"),className:S==="grid"?"bg-[#00a587] hover:bg-[#067f5f]":"",children:e.jsx(Ge,{className:"h-4 w-4"})})]})]}),S==="grid"?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ae.map(t=>e.jsxs(b,{className:"overflow-hidden","data-ad-id":t.id,children:[e.jsxs("div",{className:"aspect-video relative overflow-hidden",children:[e.jsx(ge,{src:t.imageUrl,alt:t.title}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Activo":"Inactivo"})})]}),e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsx("span",{children:se(t.campaignId)}),e.jsx("span",{children:ie(t.createdAt)})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>X(t),children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Editar"]}),e.jsxs(m,{variant:"destructive",size:"sm",onClick:()=>Y(t.id),children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]})})]},`${t.id}-${Q}-${W}`))}):e.jsx("div",{className:"space-y-4",children:ae.map(t=>e.jsx(b,{className:"overflow-hidden","data-ad-id":t.id,children:e.jsx(N,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("div",{className:"flex-shrink-0 w-32 h-24 relative overflow-hidden rounded-lg",children:e.jsx(ge,{src:t.imageUrl,alt:t.title})}),e.jsx("div",{className:"flex-grow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:t.title}),e.jsx("p",{className:"text-gray-600 mb-3",children:t.description}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["Campa침a: ",e.jsx("span",{className:"font-medium",children:se(t.campaignId)})]}),e.jsxs("span",{children:["Creado: ",ie(t.createdAt)]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.isActive?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.isActive?"Activo":"Inactivo"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>X(t),children:[e.jsx(xe,{className:"h-4 w-4 mr-1"}),"Editar"]}),e.jsxs(m,{variant:"destructive",size:"sm",onClick:()=>Y(t.id),children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]})})]})})},`${t.id}-${Q}-${W}`))}),Ie(),e.jsx(oe,{open:V,onOpenChange:C,children:e.jsxs(de,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ce,{children:e.jsx(me,{children:"Editar Anuncio"})}),e.jsxs("form",{onSubmit:De,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_title",children:"T칤tulo *"}),e.jsx(u,{id:"edit_title",value:a.title||"",onChange:t=>s({...a,title:t.target.value}),required:!0,placeholder:"T칤tulo del anuncio"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_campaign",children:"Campa침a *"}),e.jsxs(j,{value:a.campaign_id?a.campaign_id.toString():"",onValueChange:t=>s({...a,campaign_id:parseInt(t)}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar campa침a"})}),e.jsx(_,{children:I.map(t=>e.jsx(d,{value:t.id.toString(),children:t.name},t.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_description",children:"Descripci칩n"}),e.jsx(ue,{id:"edit_description",value:a.description||"",onChange:t=>s({...a,description:t.target.value}),placeholder:"Descripci칩n del anuncio",rows:3})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_media_type",children:"Tipo de Contenido *"}),e.jsxs(j,{value:a.media_type,onValueChange:t=>s({...a,media_type:t}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar tipo de contenido"})}),e.jsxs(_,{children:[e.jsx(d,{value:"image",children:"Imagen"}),e.jsx(d,{value:"video",children:"Video"}),e.jsx(d,{value:"gif",children:"GIF Animado"})]})]})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_storage_type",children:"M칠todo de Almacenamiento *"}),e.jsxs(j,{value:a.storage_type,onValueChange:t=>s({...a,storage_type:t}),children:[e.jsx(f,{children:e.jsx(y,{placeholder:"Seleccionar m칠todo"})}),e.jsxs(_,{children:[e.jsx(d,{value:"url",children:"URL Externa"}),e.jsx(d,{value:"upload",children:"Subir Archivo"})]})]})]}),a.storage_type==="url"?e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_image_url",children:"URL del Contenido *"}),e.jsx(u,{id:"edit_image_url",value:a.image_url||"",onChange:t=>s({...a,image_url:t.target.value}),required:!0,placeholder:"https://ejemplo.com/imagen.jpg"})]}):e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_file_upload",children:"Subir Archivo *"}),e.jsxs("div",{className:"text-xs text-gray-600 mb-2",children:[a.media_type==="image"&&"Formatos: JPG, PNG, WEBP (m치x 5MB)",a.media_type==="video"&&"Formatos: MP4, WEBM, OGG (m치x 10MB, 30 segundos recomendado)",a.media_type==="gif"&&"Formato: GIF animado (m치x 3MB)"]}),e.jsx(u,{id:"edit_file_upload",type:"file",accept:a.media_type==="video"?"video/*,.mp4,.webm,.ogg,.avi,.mov":a.media_type==="image"?"image/*":a.media_type==="gif"?"image/gif":"*/*",onChange:async t=>{var n;const i=(n=t.target.files)==null?void 0:n[0];if(i){if(!(a.media_type==="image"&&i.type.startsWith("image/")||a.media_type==="video"&&i.type.startsWith("video/")||a.media_type==="gif"&&i.type==="image/gif")){o({title:"Error",description:`Tipo de archivo inv치lido. Se esperaba ${a.media_type==="video"?"un video":"una imagen"}.`,variant:"destructive"});return}const l=a.media_type==="video"?10*1024*1024:5*1024*1024;if(i.size>l){o({title:"Error",description:`Archivo demasiado grande. M치ximo ${a.media_type==="video"?"10MB":"5MB"}.`,variant:"destructive"});return}try{E(!0);const c=await H(i);s({...a,image_url:c}),o({title:"칄xito",description:"Archivo subido correctamente"})}catch(c){console.error("Error uploading file:",c),o({title:"Error",description:"Error al subir el archivo",variant:"destructive"})}finally{E(!1)}}},disabled:D,className:"file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-[#00a587] file:text-white hover:file:bg-[#067f5f] disabled:opacity-50"}),D&&e.jsxs("div",{className:"flex items-center mt-2 text-sm text-gray-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#00a587] mr-2"}),"Subiendo archivo..."]}),a.image_url&&e.jsxs("div",{className:"mt-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Vista previa actual:"}),e.jsx("div",{className:"mt-1 border border-gray-300 rounded-lg p-2",children:a.media_type==="image"||a.media_type==="gif"?e.jsx("img",{src:a.image_url,alt:"Vista previa",className:"max-w-full h-32 object-cover rounded"}):a.media_type==="video"?e.jsxs("video",{src:a.image_url,controls:!0,muted:!0,className:"max-w-full h-32 rounded",children:[e.jsx("source",{src:a.image_url,type:"video/mp4"}),"Tu navegador no soporta videos."]}):null})]})]}),a.media_type==="video"&&e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_duration",children:"Duraci칩n (segundos)"}),e.jsx(u,{id:"edit_duration",type:"number",value:a.duration||0,onChange:t=>s({...a,duration:parseInt(t.target.value)||0}),placeholder:"30",min:"0"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_alt_text",children:"Texto Alternativo"}),e.jsx(u,{id:"edit_alt_text",value:a.alt_text||"",onChange:t=>s({...a,alt_text:t.target.value}),placeholder:"Descripci칩n del contenido para accesibilidad"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_content",children:"URL de Contenido"}),e.jsx(u,{id:"edit_content",value:a.content||"",onChange:t=>s({...a,content:t.target.value}),placeholder:"https://ejemplo.com/destino - Liga donde ir치 el usuario al hacer clic"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Esta es la URL donde ser치 dirigido el usuario cuando haga clic en el banner publicitario"})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"edit_button_text",children:"Texto del Bot칩n"}),e.jsx(u,{id:"edit_button_text",value:a.button_text||"",onChange:t=>s({...a,button_text:t.target.value}),placeholder:"Ej: Inscr칤bete Ahora, Ver M치s, Obtener Info",maxLength:50}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Texto personalizado que aparecer치 en el bot칩n del anuncio (m치x. 50 caracteres)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"edit_is_active",checked:a.is_active||!1,onChange:t=>s({...a,is_active:t.target.checked})}),e.jsx(r,{htmlFor:"edit_is_active",children:"Anuncio activo"})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(m,{type:"submit",className:"bg-[#00a587] hover:bg-[#067f5f]",disabled:q.isPending,children:q.isPending?"Actualizando...":"Actualizar Anuncio"})]})]})]})})]})})};export{Ze as default};
