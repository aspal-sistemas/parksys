import{a2 as l,ae as ye,u as H,af as Ce,ap as Te,ag as Q,j as e,aX as K,d0 as Ae,B as r,bQ as Se,w as G,x as De,bh as J,y as X,z as $,I as W,ai as we,aj as j,ak as b,al as g,am as f,O as u,an as N,$ as Re,Q as v,V as y,W as C,Y as T,_ as o,f as Y,g as Z,h as ee,a7 as Fe,i as te,a4 as Oe,aR as Ve,D as Ee,o as A,au as Ue,aM as Ie,aN as Le,ad as c,cb as U,aq as ae}from"./index-D5qLf1ib.js";const Me=c.object({date:c.string().min(1,"La fecha es requerida"),description:c.string().min(1,"La descripción es requerida"),reference:c.string().optional(),type:c.enum(["manual","automatic"]),entries:c.array(c.object({account_id:c.number().min(1,"La cuenta es requerida"),debit:c.number().optional(),credit:c.number().optional(),description:c.string().optional()})).min(2,"Se requieren al menos 2 entradas")});function qe(){const[h,se]=l.useState(""),[S,ie]=l.useState("all"),[D,ne]=l.useState("all"),[re,le]=l.useState(""),[ce,oe]=l.useState(""),[de,w]=l.useState(!1),[me,I]=l.useState(!1),[d,ue]=l.useState(null),[m,R]=l.useState(1);l.useState(!1);const F=15,L=l.useRef(null),M=ye(),{data:ke,isLoading:xe}=H({queryKey:["/api/accounting/journal-entries"],enabled:!0}),{data:k}=H({queryKey:["/api/accounting/categories"],enabled:!0}),i=Ce({resolver:Te(Me),defaultValues:{date:new Date().toISOString().split("T")[0],description:"",reference:"",type:"manual",entries:[{account_id:0,debit:0,credit:0,description:""},{account_id:0,debit:0,credit:0,description:""}]}}),P=Q({mutationFn:t=>ae("/api/accounting/journal-entries",{method:"POST",body:JSON.stringify(t)}),onSuccess:()=>{U({title:"Asiento contable creado",description:"El asiento contable ha sido registrado exitosamente."}),M.invalidateQueries({queryKey:["/api/accounting/journal-entries"]}),w(!1),i.reset()}}),O=Q({mutationFn:()=>ae("/api/accounting/journal-entries/generate-automatic",{method:"POST"}),onSuccess:()=>{U({title:"Asientos automáticos generados",description:"Los asientos contables automáticos han sido generados exitosamente."}),M.invalidateQueries({queryKey:["/api/accounting/journal-entries"]})}}),he=t=>{P.mutate(t)},pe=()=>{O.mutate()},je=t=>{ue(t),I(!0)},be=()=>{const t=[["Número","Fecha","Descripción","Referencia","Tipo","Debe","Haber","Estado"],...q.map(a=>[a.number,a.date,a.description,a.reference,a.type,a.totalDebit.toFixed(2),a.totalCredit.toFixed(2),a.status])].map(a=>a.join(",")).join(`
`),n=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(n),s.download=`asientos-contables-${new Date().toISOString().split("T")[0]}.csv`,s.click()},ge=()=>{var t;(t=L.current)==null||t.click()},fe=t=>{var s;const n=(s=t.target.files)==null?void 0:s[0];if(n){const a=new FileReader;a.onload=ve=>{var B;(B=ve.target)==null||B.result,U({title:"Archivo importado",description:"Los datos han sido procesados correctamente."})},a.readAsText(n)}},q=[{id:1,number:"AUTO-1751387935240",date:"30/6/2025",description:"Transacción automática: Pago de servicios básicos",reference:"TRANS-85",type:"automatico",totalDebit:13e3,totalCredit:13e3,status:"aprobado"},{id:2,number:"AUTO-1750978310917",date:"25/6/2025",description:"Transacción automática: Compra de materiales oficina",reference:"TRANS-64",type:"automatico",totalDebit:6700,totalCredit:6700,status:"aprobado"},{id:3,number:"AUTO-1750978160215",date:"25/6/2025",description:"Transacción automática: Mantenimiento de equipos",reference:"TRANS-63",type:"automatico",totalDebit:5e3,totalCredit:5e3,status:"aprobado"},{id:4,number:"AUTO-1750878717940",date:"24/6/2025",description:"Transacción automática: Ingreso por concesiones",reference:"TRANS-61",type:"automatico",totalDebit:6e3,totalCredit:6e3,status:"aprobado"},{id:5,number:"AUTO-1750681809469",date:"19/6/2025",description:"Transacción automática: Reposición Caja Chica",reference:"TRANS-51",type:"automatico",totalDebit:3500,totalCredit:3500,status:"aprobado"},{id:6,number:"AUTO-1750681808864",date:"19/6/2025",description:"Transacción automática: Gasto en combustible",reference:"TRANS-50",type:"automatico",totalDebit:2800,totalCredit:2800,status:"aprobado"},{id:7,number:"AUTO-1750681808262",date:"19/6/2025",description:"Transacción automática: Caja Chica: Autobuses",reference:"TRANS-47",type:"automatico",totalDebit:1200,totalCredit:1200,status:"aprobado"},{id:8,number:"MAN-1750681808263",date:"18/6/2025",description:"Registro manual: Ajuste de inventario",reference:"TRANS-46",type:"manual",totalDebit:4500,totalCredit:4500,status:"aprobado"},{id:9,number:"AUTO-1750681808264",date:"17/6/2025",description:"Transacción automática: Pago de nómina",reference:"TRANS-45",type:"automatico",totalDebit:28e3,totalCredit:28e3,status:"aprobado"},{id:10,number:"AUTO-1750681808265",date:"16/6/2025",description:"Transacción automática: Ingreso por eventos",reference:"TRANS-44",type:"automatico",totalDebit:15e3,totalCredit:15e3,status:"aprobado"},{id:11,number:"MAN-1750681808266",date:"15/6/2025",description:"Registro manual: Depreciación mensual",reference:"TRANS-43",type:"manual",totalDebit:3200,totalCredit:3200,status:"aprobado"},{id:12,number:"AUTO-1750681808267",date:"14/6/2025",description:"Transacción automática: Compra de herramientas",reference:"TRANS-42",type:"automatico",totalDebit:8500,totalCredit:8500,status:"aprobado"},{id:13,number:"AUTO-1750681808268",date:"13/6/2025",description:"Transacción automática: Pago de proveedores",reference:"TRANS-41",type:"automatico",totalDebit:12e3,totalCredit:12e3,status:"aprobado"},{id:14,number:"AUTO-1750681808269",date:"12/6/2025",description:"Transacción automática: Recibo de agua",reference:"TRANS-40",type:"automatico",totalDebit:5600,totalCredit:5600,status:"aprobado"},{id:15,number:"AUTO-1750681808270",date:"11/6/2025",description:"Transacción automática: Recibo de luz",reference:"TRANS-39",type:"automatico",totalDebit:9800,totalCredit:9800,status:"aprobado"},{id:16,number:"MAN-1750681808271",date:"10/6/2025",description:"Registro manual: Ajuste por diferencia cambiaria",reference:"TRANS-38",type:"manual",totalDebit:2300,totalCredit:2300,status:"aprobado"},{id:17,number:"AUTO-1750681808272",date:"09/6/2025",description:"Transacción automática: Venta de boletos",reference:"TRANS-37",type:"automatico",totalDebit:7500,totalCredit:7500,status:"aprobado"},{id:18,number:"AUTO-1750681808273",date:"08/6/2025",description:"Transacción automática: Ingreso por donaciones",reference:"TRANS-36",type:"automatico",totalDebit:4800,totalCredit:4800,status:"aprobado"}],z=q.filter(t=>{const n=t.description.toLowerCase().includes(h.toLowerCase())||t.reference.toLowerCase().includes(h.toLowerCase())||t.number.toLowerCase().includes(h.toLowerCase()),s=D==="all"||t.type===D,a=S==="all"||t.status===S;return n&&s&&a}),V=z.length,x=Math.ceil(V/F),E=(m-1)*F,_=E+F,Ne=z.slice(E,_),p=t=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:2}).format(t);return xe?e.jsx(K,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 w-64 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-96 bg-gray-200 rounded animate-pulse"})]})}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-16 bg-gray-200 rounded animate-pulse"},t))})]})}):e.jsx(K,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Asientos Contables"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Registro de movimientos contables con partida doble"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",onClick:pe,disabled:O.isPending,className:"flex items-center space-x-2",children:[e.jsx(Se,{className:`h-4 w-4 ${O.isPending?"animate-spin":""}`}),e.jsx("span",{children:"Generar Automáticos"})]}),e.jsxs(G,{open:de,onOpenChange:w,children:[e.jsx(De,{asChild:!0,children:e.jsxs(r,{className:"bg-[#00a587] hover:bg-[#067f5f] flex items-center space-x-2",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:"Nuevo Asiento"})]})}),e.jsxs(X,{className:"max-w-4xl",children:[e.jsx($,{children:e.jsx(W,{children:"Nuevo Asiento Contable"})}),e.jsx(we,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(he),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(j,{control:i.control,name:"date",render:({field:t})=>e.jsxs(b,{children:[e.jsx(g,{children:"Fecha"}),e.jsx(f,{children:e.jsx(u,{type:"date",...t})}),e.jsx(N,{})]})}),e.jsx(j,{control:i.control,name:"reference",render:({field:t})=>e.jsxs(b,{children:[e.jsx(g,{children:"Referencia"}),e.jsx(f,{children:e.jsx(u,{placeholder:"Número de referencia",...t})}),e.jsx(N,{})]})})]}),e.jsx(j,{control:i.control,name:"description",render:({field:t})=>e.jsxs(b,{children:[e.jsx(g,{children:"Descripción"}),e.jsx(f,{children:e.jsx(Re,{placeholder:"Descripción del asiento contable",...t})}),e.jsx(N,{})]})}),e.jsx(j,{control:i.control,name:"type",render:({field:t})=>e.jsxs(b,{children:[e.jsx(g,{children:"Tipo"}),e.jsxs(v,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(f,{children:e.jsx(y,{children:e.jsx(C,{placeholder:"Seleccionar tipo"})})}),e.jsxs(T,{children:[e.jsx(o,{value:"manual",children:"Manual"}),e.jsx(o,{value:"automatic",children:"Automático"})]})]}),e.jsx(N,{})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Entradas del Asiento"}),e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=i.getValues("entries");i.setValue("entries",[...t,{account_id:0,debit:0,credit:0,description:""}])},children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Agregar Entrada"]})]}),e.jsx("div",{className:"space-y-2",children:i.watch("entries").map((t,n)=>e.jsxs("div",{className:"grid grid-cols-5 gap-2 p-3 border rounded",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Cuenta"}),e.jsxs(v,{onValueChange:s=>{const a=i.getValues("entries");a[n].account_id=parseInt(s),i.setValue("entries",a)},children:[e.jsx(y,{children:e.jsx(C,{placeholder:"Seleccionar"})}),e.jsx(T,{children:Array.isArray(k)?k.map(s=>e.jsxs(o,{value:s.id.toString(),children:[s.code," - ",s.name]},s.id)):null})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Debe"}),e.jsx(u,{type:"number",step:"0.01",placeholder:"0.00",onChange:s=>{const a=i.getValues("entries");a[n].debit=parseFloat(s.target.value)||0,i.setValue("entries",a)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Haber"}),e.jsx(u,{type:"number",step:"0.01",placeholder:"0.00",onChange:s=>{const a=i.getValues("entries");a[n].credit=parseFloat(s.target.value)||0,i.setValue("entries",a)}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Descripción"}),e.jsx(u,{placeholder:"Opcional",onChange:s=>{const a=i.getValues("entries");a[n].description=s.target.value,i.setValue("entries",a)}})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(r,{type:"button",variant:"outline",size:"sm",onClick:()=>{const s=i.getValues("entries");s.length>2&&(s.splice(n,1),i.setValue("entries",s))},disabled:i.watch("entries").length<=2,children:"Eliminar"})})]},n))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(r,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancelar"}),e.jsx(r,{type:"submit",disabled:P.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:"Crear Asiento"})]})]})})]})]})]})]}),e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs(ee,{className:"flex items-center",children:[e.jsx(Fe,{className:"h-5 w-5 mr-2"}),"Filtros de Búsqueda"]})}),e.jsx(te,{children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(u,{placeholder:"Buscar por número, descripción o referencia...",value:h,onChange:t=>se(t.target.value),className:"pl-9"})]})}),e.jsx("div",{children:e.jsxs(v,{value:S,onValueChange:ie,children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(T,{children:[e.jsx(o,{value:"all",children:"Todos los estados"}),e.jsx(o,{value:"draft",children:"Borrador"}),e.jsx(o,{value:"approved",children:"Aprobado"}),e.jsx(o,{value:"rejected",children:"Rechazado"})]})]})}),e.jsx("div",{children:e.jsxs(v,{value:D,onValueChange:ne,children:[e.jsx(y,{children:e.jsx(C,{})}),e.jsxs(T,{children:[e.jsx(o,{value:"all",children:"Todos los tipos"}),e.jsx(o,{value:"manual",children:"Manual"}),e.jsx(o,{value:"automatic",children:"Automático"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(u,{type:"date",value:re,onChange:t=>le(t.target.value),placeholder:"dd/mm/yyyy"}),e.jsx(u,{type:"date",value:ce,onChange:t=>oe(t.target.value),placeholder:"dd/mm/yyyy"})]})]})})]}),e.jsxs(Y,{children:[e.jsx(Z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ee,{children:"Asientos Contables Registrados"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Mostrando ",E+1,"-",Math.min(_,V)," de ",V," registros"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:ge,className:"flex items-center space-x-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),e.jsx("span",{children:"Importar"})]}),e.jsxs(r,{variant:"outline",size:"sm",onClick:be,className:"flex items-center space-x-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{children:"Exportar"})]})]})]})}),e.jsxs(te,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Número"}),e.jsx("th",{className:"text-left p-2",children:"Fecha"}),e.jsx("th",{className:"text-left p-2",children:"Descripción"}),e.jsx("th",{className:"text-left p-2",children:"Referencia"}),e.jsx("th",{className:"text-left p-2",children:"Tipo"}),e.jsx("th",{className:"text-left p-2",children:"Total Debe"}),e.jsx("th",{className:"text-left p-2",children:"Total Haber"}),e.jsx("th",{className:"text-left p-2",children:"Estado"}),e.jsx("th",{className:"text-left p-2",children:"Acciones"})]})}),e.jsx("tbody",{children:Ne.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 font-mono text-sm",children:t.number}),e.jsx("td",{className:"p-2",children:t.date}),e.jsx("td",{className:"p-2 max-w-xs truncate",children:t.description}),e.jsx("td",{className:"p-2",children:t.reference}),e.jsx("td",{className:"p-2",children:e.jsx(A,{variant:"outline",className:"bg-blue-50 text-blue-700",children:t.type})}),e.jsx("td",{className:"p-2 text-right",children:p(t.totalDebit)}),e.jsx("td",{className:"p-2 text-right",children:p(t.totalCredit)}),e.jsx("td",{className:"p-2",children:e.jsx(A,{variant:"default",className:"bg-green-100 text-green-800",children:t.status})}),e.jsx("td",{className:"p-2",children:e.jsx(r,{variant:"ghost",size:"sm",title:"Ver detalles",onClick:()=>je(t),children:e.jsx(Ue,{className:"h-4 w-4"})})})]},t.id))})]})}),x>1&&e.jsxs("div",{className:"flex items-center justify-between pt-4",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Página ",m," de ",x]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>R(Math.max(1,m-1)),disabled:m===1,children:[e.jsx(Ie,{className:"h-4 w-4"}),"Anterior"]}),Array.from({length:x},(t,n)=>n+1).map(t=>e.jsx(r,{variant:m===t?"default":"outline",size:"sm",onClick:()=>R(t),className:m===t?"bg-[#00a587] hover:bg-[#067f5f]":"",children:t},t)),e.jsxs(r,{variant:"outline",size:"sm",onClick:()=>R(Math.min(x,m+1)),disabled:m===x,children:["Siguiente",e.jsx(Le,{className:"h-4 w-4"})]})]})]})]})]}),e.jsx("input",{ref:L,type:"file",accept:".csv",style:{display:"none"},onChange:fe}),e.jsx(G,{open:me,onOpenChange:I,children:e.jsxs(X,{className:"max-w-2xl",children:[e.jsx($,{children:e.jsx(W,{children:"Detalles del Asiento Contable"})}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Número"}),e.jsx("p",{className:"font-mono text-sm",children:d.number})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Fecha"}),e.jsx("p",{children:d.date})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Referencia"}),e.jsx("p",{children:d.reference})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Tipo"}),e.jsx(A,{variant:"outline",className:"bg-blue-50 text-blue-700",children:d.type})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Descripción"}),e.jsx("p",{className:"text-sm",children:d.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Debe"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:p(d.totalDebit)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Total Haber"}),e.jsx("p",{className:"text-lg font-semibold text-red-600",children:p(d.totalCredit)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-600",children:"Estado"}),e.jsx(A,{variant:"default",className:"bg-green-100 text-green-800 ml-2",children:d.status})]})]})]})})]})})}export{qe as default};
