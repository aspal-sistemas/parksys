import{a2 as S,l as Me,ae as ze,u as R,af as je,ag as se,j as e,aX as Oe,f as ae,F as z,w as ne,x as Ue,B as j,bh as ue,y as ie,z as re,I as le,J as oe,ai as pe,b1 as ge,b2 as fe,b3 as V,b4 as L,aj as r,ak as l,al as o,Q as v,am as c,V as N,W as b,Y as y,_ as i,an as t,O as f,aF as A,$ as P,K as Xe,bC as ce,i as ve,a4 as Be,g as Re,h as Ke,ab as He,bH as Qe,bI as $e,bJ as Ne,bK as C,bL as Ge,bM as D,bq as be,b$ as _e,c0 as Je,bn as Ye,c1 as We,c2 as Ze,c3 as es,c4 as ss,c5 as as,c6 as ns,c7 as is,D as ye,t as rs,a as ls,m as Ce,as as os,n as cs,ad as u,r as ts,a1 as ds,o as O,ap as De}from"./index-D5qLf1ib.js";import{H as xs}from"./Helmet-BNepwt1P.js";import{S as K}from"./separator-Bek7HtsH.js";const we=u.object({parkId:u.string().min(1,"Debes seleccionar un parque"),concessionaireId:u.string().min(1,"Debes seleccionar un concesionario"),concessionTypeId:u.string().min(1,"Debes seleccionar un tipo de concesión"),startDate:u.string().min(1,"La fecha de inicio es obligatoria"),endDate:u.string().min(1,"La fecha de vencimiento es obligatoria"),fee:u.string().min(1,"El canon o tarifa es obligatorio"),exclusivityClauses:u.string().optional(),restrictions:u.string().optional(),contractFile:u.instanceof(File).optional(),status:u.enum(["active","pending","expired","terminated"]).default("active"),hasExtension:u.boolean().default(!1),extensionDate:u.string().optional(),notes:u.string().optional()});function us(){const[Se,U]=S.useState(!1),[Fe,X]=S.useState(!1),[Ee,B]=S.useState(!1),[Ie,H]=S.useState(!1),[n,Q]=S.useState(null),[w,te]=S.useState(""),[M,de]=S.useState("all"),{toast:F}=Me(),$=ze(),{data:xe,isLoading:Te}=R({queryKey:["/api/concession-contracts"]}),{data:E,isLoading:G}=R({queryKey:["/api/parks"]}),{data:I,isLoading:_}=R({queryKey:["/api/concessionaires"]}),{data:T,isLoading:J}=R({queryKey:["/api/concession-types"]}),x=je({resolver:De(we),defaultValues:{parkId:"",concessionaireId:"",concessionTypeId:"",startDate:"",endDate:"",fee:"",exclusivityClauses:"",restrictions:"",status:"active",hasExtension:!1,extensionDate:"",notes:""}}),d=je({resolver:De(we),defaultValues:{parkId:"",concessionaireId:"",concessionTypeId:"",startDate:"",endDate:"",fee:"",exclusivityClauses:"",restrictions:"",status:"active",hasExtension:!1,extensionDate:"",notes:""}}),Y=se({mutationFn:async s=>{const a=new FormData;Object.entries(s).forEach(([m,h])=>{m!=="contractFile"&&a.append(m,(h==null?void 0:h.toString())||"")}),s.contractFile&&a.append("contractFile",s.contractFile);const p=await fetch("/api/concession-contracts",{method:"POST",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:a});if(!p.ok){const m=await p.json();throw new Error(m.message||"Error al crear el contrato")}return await p.json()},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/concession-contracts"]}),F({title:"Contrato creado",description:"El contrato ha sido creado exitosamente."}),x.reset(),U(!1)},onError:s=>{F({title:"Error",description:s.message,variant:"destructive"})}}),W=se({mutationFn:async s=>{const{id:a,...p}=s,m=new FormData;Object.entries(p).forEach(([g,ee])=>{g!=="contractFile"&&m.append(g,(ee==null?void 0:ee.toString())||"")}),s.contractFile&&m.append("contractFile",s.contractFile);const h=await fetch(`/api/concession-contracts/${a}`,{method:"PUT",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:m});if(!h.ok){const g=await h.json();throw new Error(g.message||"Error al actualizar el contrato")}return await h.json()},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/concession-contracts"]}),F({title:"Contrato actualizado",description:"El contrato ha sido actualizado exitosamente."}),d.reset(),X(!1)},onError:s=>{F({title:"Error",description:s.message,variant:"destructive"})}}),ke=se({mutationFn:async s=>{const a=await fetch(`/api/concession-contracts/${s}`,{method:"DELETE",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""}});if(!a.ok){const p=await a.json();throw new Error(p.message||"Error al eliminar el contrato")}return await a.json()},onSuccess:()=>{$.invalidateQueries({queryKey:["/api/concession-contracts"]}),F({title:"Contrato eliminado",description:"El contrato ha sido eliminado exitosamente."}),H(!1)},onError:s=>{F({title:"Error",description:s.message,variant:"destructive"})}}),qe=s=>{Y.mutate(s)},Ve=s=>{n&&W.mutate({...s,id:n.id})},he=s=>{Q(s),d.reset({parkId:s.parkId.toString(),concessionaireId:s.concessionaireId.toString(),concessionTypeId:s.concessionTypeId.toString(),startDate:s.startDate,endDate:s.endDate,fee:s.fee.toString(),exclusivityClauses:s.exclusivityClauses||"",restrictions:s.restrictions||"",status:s.status,hasExtension:s.hasExtension,extensionDate:s.extensionDate||"",notes:s.notes||""}),X(!0)},Le=s=>{Q(s),B(!0)},Ae=s=>{Q(s),H(!0)},Pe=()=>{n&&ke.mutate(n.id)},Z=xe?xe.filter(s=>{var m,h,g;const a=w===""||((m=s.parkName)==null?void 0:m.toLowerCase().includes(w.toLowerCase()))||((h=s.concessionaireName)==null?void 0:h.toLowerCase().includes(w.toLowerCase()))||((g=s.concessionTypeName)==null?void 0:g.toLowerCase().includes(w.toLowerCase())),p=M==="all"||s.status===M;return a&&p}):[],k=s=>{if(!s)return"N/A";try{return ts(new Date(s),"dd 'de' MMMM 'de' yyyy",{locale:ds})}catch{return"Fecha inválida"}},me=s=>{switch(s){case"active":return e.jsx(O,{className:"bg-green-100 text-green-800",children:"Activo"});case"pending":return e.jsx(O,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"});case"expired":return e.jsx(O,{className:"bg-red-100 text-red-800",children:"Vencido"});case"terminated":return e.jsx(O,{className:"bg-gray-100 text-gray-800",children:"Terminado"});default:return e.jsx(O,{children:s})}},q=G||_||J;return e.jsxs(Oe,{children:[e.jsxs(xs,{children:[e.jsx("title",{children:"Contratos de Concesiones | Bosques Urbanos"}),e.jsx("meta",{name:"description",content:"Gestiona los contratos de concesiones para los parques"})]}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsx(ae,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-8 h-8 text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Contratos de Concesiones"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Administra los contratos de concesiones para los espacios de los parques"})]})]}),e.jsxs(ne,{open:Se,onOpenChange:U,children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(j,{className:"gap-2",children:[e.jsx(ue,{size:16}),"Nuevo Contrato"]})}),e.jsxs(ie,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(le,{children:"Crear nuevo contrato de concesión"}),e.jsx(oe,{children:"Introduce la información del nuevo contrato de concesión"})]}),e.jsx(pe,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(qe),className:"space-y-4",children:[e.jsxs(ge,{defaultValue:"basic",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-3",children:[e.jsx(V,{value:"basic",children:"Información Básica"}),e.jsx(V,{value:"details",children:"Detalles"}),e.jsx(V,{value:"document",children:"Documento"})]}),e.jsxs(L,{value:"basic",className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:x.control,name:"parkId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Parque / Espacio"}),e.jsxs(v,{onValueChange:s.onChange,defaultValue:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un parque"})})}),e.jsx(y,{children:G?e.jsx(i,{value:"loading",children:"Cargando parques..."}):E&&E.length>0?E.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsx(i,{value:"empty",children:"No hay parques disponibles"})})]}),e.jsx(t,{})]})}),e.jsx(r,{control:x.control,name:"concessionaireId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Concesionario"}),e.jsxs(v,{onValueChange:s.onChange,defaultValue:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un concesionario"})})}),e.jsx(y,{children:_?e.jsx(i,{value:"loading",children:"Cargando concesionarios..."}):I&&I.length>0?I.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name||a.fullName},a.id)):e.jsx(i,{value:"loading",children:"No hay concesionarios disponibles"})})]}),e.jsx(t,{})]})})]}),e.jsx(r,{control:x.control,name:"concessionTypeId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Tipo de Concesión"}),e.jsxs(v,{onValueChange:s.onChange,defaultValue:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un tipo de concesión"})})}),e.jsx(y,{children:J?e.jsx(i,{value:"loading",children:"Cargando tipos de concesiones..."}):T&&T.length>0?T.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsx(i,{value:"loading",children:"No hay tipos de concesiones disponibles"})})]}),e.jsx(t,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:x.control,name:"startDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de inicio"}),e.jsx(c,{children:e.jsx(f,{type:"date",...s})}),e.jsx(t,{})]})}),e.jsx(r,{control:x.control,name:"endDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de vencimiento"}),e.jsx(c,{children:e.jsx(f,{type:"date",...s})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:x.control,name:"status",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Estado del contrato"}),e.jsxs(v,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona el estado del contrato"})})}),e.jsxs(y,{children:[e.jsx(i,{value:"active",children:"Activo"}),e.jsx(i,{value:"pending",children:"Pendiente"}),e.jsx(i,{value:"expired",children:"Vencido"}),e.jsx(i,{value:"terminated",children:"Terminado"})]})]}),e.jsx(t,{})]})})]}),e.jsxs(L,{value:"details",className:"space-y-4 py-4",children:[e.jsx(r,{control:x.control,name:"fee",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Canon o tarifa (MXN)"}),e.jsx(c,{children:e.jsx(f,{placeholder:"Ej: 5000.00",...s})}),e.jsx(A,{children:"Ingresa la cantidad en pesos mexicanos sin símbolos ni separadores"}),e.jsx(t,{})]})}),e.jsx(r,{control:x.control,name:"exclusivityClauses",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Cláusulas de exclusividad"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Describe las cláusulas de exclusividad que aplican a esta concesión",...s,rows:3})}),e.jsx(t,{})]})}),e.jsx(r,{control:x.control,name:"restrictions",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Restricciones"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Describe las restricciones que aplican a esta concesión",...s,rows:3})}),e.jsx(t,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:x.control,name:"hasExtension",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-x-3 space-y-0 p-4 border rounded-md",children:[e.jsx(c,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:a=>s.onChange(a.target.checked),className:"w-4 h-4 mt-1"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(o,{children:"Tiene prórroga"}),e.jsx(A,{children:"Marcar si el contrato tiene una prórroga aprobada"})]})]})}),x.watch("hasExtension")&&e.jsx(r,{control:x.control,name:"extensionDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de prórroga"}),e.jsx(c,{children:e.jsx(f,{type:"date",...s})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:x.control,name:"notes",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Notas adicionales"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Notas adicionales sobre el contrato",...s,rows:3})}),e.jsx(t,{})]})})]}),e.jsxs(L,{value:"document",className:"space-y-4 py-4",children:[e.jsx(r,{control:x.control,name:"contractFile",render:({field:{value:s,onChange:a,...p}})=>e.jsxs(l,{children:[e.jsx(o,{children:"Documento del contrato (PDF)"}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(f,{type:"file",accept:".pdf",onChange:m=>{var g;const h=(g=m.target.files)==null?void 0:g[0];h&&a(h)},...p}),e.jsx(A,{children:"Sube el contrato en formato PDF. Tamaño máximo: 10MB."})]})}),e.jsx(t,{})]})}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Xe,{className:"h-5 w-5 text-amber-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-amber-800",children:"Información importante"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"El documento del contrato debe estar firmado por todas las partes involucradas y debe contener todos los términos y condiciones acordados."}),e.jsx("p",{className:"text-sm text-amber-700 mt-2",children:"La subida del documento es obligatoria para formalizar el contrato de concesión."})]})]})})]})]}),e.jsxs(ce,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>U(!1),children:"Cancelar"}),e.jsx(j,{type:"submit",disabled:Y.isPending,children:Y.isPending?"Guardando...":"Guardar contrato"})]})]})})]})]})]})}),e.jsx(ae,{className:"mb-6",children:e.jsx(ve,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative w-full md:w-96",children:[e.jsx(Be,{className:"absolute left-2.5 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(f,{type:"search",placeholder:"Buscar por parque o concesionario...",className:"pl-8 w-full",value:w,onChange:s=>te(s.target.value)})]}),e.jsxs(v,{value:M,onValueChange:de,children:[e.jsx(N,{className:"w-full md:w-[180px]",children:e.jsx(b,{placeholder:"Filtrar por estado"})}),e.jsxs(y,{children:[e.jsx(i,{value:"all",children:"Todos los estados"}),e.jsx(i,{value:"active",children:"Activos"}),e.jsx(i,{value:"pending",children:"Pendientes"}),e.jsx(i,{value:"expired",children:"Vencidos"}),e.jsx(i,{value:"terminated",children:"Terminados"})]})]})]})})}),e.jsxs(ae,{children:[e.jsxs(Re,{children:[e.jsx(Ke,{children:"Contratos de concesiones"}),e.jsx(He,{children:"Lista de contratos de concesiones para los espacios de los parques"})]}),e.jsx(ve,{children:Te?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("p",{children:"Cargando contratos..."})}):Z&&Z.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Qe,{children:[e.jsx($e,{children:e.jsxs(Ne,{children:[e.jsx(C,{children:"Parque / Espacio"}),e.jsx(C,{children:"Concesionario"}),e.jsx(C,{children:"Tipo de concesión"}),e.jsx(C,{children:"Inicio"}),e.jsx(C,{children:"Vencimiento"}),e.jsx(C,{children:"Canon (MXN)"}),e.jsx(C,{children:"Estado"}),e.jsx(C,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ge,{children:Z.map(s=>e.jsxs(Ne,{children:[e.jsx(D,{className:"font-medium",children:s.parkName}),e.jsx(D,{children:s.concessionaireName}),e.jsx(D,{children:s.concessionTypeName}),e.jsx(D,{children:k(s.startDate)}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:k(s.endDate)}),s.hasExtension&&e.jsxs("span",{className:"text-xs text-muted-foreground mt-1",children:["Prórroga: ",k(s.extensionDate)]})]})}),e.jsxs(D,{children:["$",parseFloat(s.fee).toLocaleString("es-MX")]}),e.jsx(D,{children:me(s.status)}),e.jsx(D,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>Le(s),title:"Ver detalles",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>he(s),title:"Editar",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsxs(_e,{open:Ie&&(n==null?void 0:n.id)===s.id,onOpenChange:H,children:[e.jsx(Je,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>Ae(s),title:"Eliminar",children:e.jsx(Ye,{className:"h-4 w-4"})})}),e.jsxs(We,{children:[e.jsxs(Ze,{children:[e.jsx(es,{children:"¿Estás seguro?"}),e.jsx(ss,{children:"Esta acción eliminará permanentemente el contrato de concesión y no se puede deshacer."})]}),e.jsxs(as,{children:[e.jsx(ns,{children:"Cancelar"}),e.jsx(is,{onClick:Pe,children:"Eliminar"})]})]})]}),s.contractFileUrl&&e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>window.open(s.contractFileUrl,"_blank"),title:"Descargar contrato",children:e.jsx(ye,{className:"h-4 w-4"})})]})})]},s.id))})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(z,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No hay contratos de concesión"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:w||M!=="all"?"No se encontraron contratos con los criterios de búsqueda aplicados.":"Aún no hay contratos de concesión registrados en el sistema."}),w||M!=="all"?e.jsx(j,{variant:"outline",onClick:()=>{te(""),de("all")},children:"Limpiar filtros"}):e.jsxs(j,{onClick:()=>U(!0),children:[e.jsx(ue,{className:"h-4 w-4 mr-2"}),"Crear nuevo contrato"]})]})})]})]}),n&&e.jsx(ne,{open:Ee,onOpenChange:B,children:e.jsxs(ie,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(le,{children:"Detalles del contrato de concesión"}),e.jsx(oe,{children:"Información completa del contrato de concesión"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:n.parkName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Espacio concesionado"})]}),me(n.status)]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(rs,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Concesionario"]}),e.jsx("p",{children:n.concessionaireName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(ls,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Tipo de concesión"]}),e.jsx("p",{children:n.concessionTypeName})]})]}),e.jsx(K,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Fecha de inicio"]}),e.jsx("p",{children:k(n.startDate)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Fecha de vencimiento"]}),e.jsx("p",{children:k(n.endDate)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(os,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Canon o tarifa"]}),e.jsxs("p",{children:["$",parseFloat(n.fee).toLocaleString("es-MX")," MXN"]})]})]}),n.hasExtension&&e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(cs,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Prórroga de contrato"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Este contrato cuenta con una prórroga hasta:",e.jsxs("span",{className:"font-medium",children:[" ",k(n.extensionDate)]})]})]})]})}),(n.exclusivityClauses||n.restrictions)&&e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsxs("div",{className:"space-y-4",children:[n.exclusivityClauses&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Cláusulas de exclusividad"}),e.jsx("p",{className:"text-sm",children:n.exclusivityClauses})]}),n.restrictions&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Restricciones"}),e.jsx("p",{className:"text-sm",children:n.restrictions})]})]})]}),n.notes&&e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Notas adicionales"}),e.jsx("p",{className:"text-sm",children:n.notes})]})]}),n.contractFileUrl&&e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Documento del contrato"]}),e.jsx("p",{className:"text-sm",children:"Contrato digital en formato PDF"})]}),e.jsxs(j,{onClick:()=>window.open(n.contractFileUrl,"_blank"),className:"gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Descargar"]})]})]})]}),e.jsxs(ce,{children:[e.jsx(j,{onClick:()=>B(!1),variant:"outline",children:"Cerrar"}),e.jsxs(j,{onClick:()=>{B(!1),he(n)},className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Editar contrato"]})]})]})}),n&&e.jsx(ne,{open:Fe,onOpenChange:X,children:e.jsxs(ie,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(re,{children:[e.jsx(le,{children:"Editar contrato de concesión"}),e.jsx(oe,{children:"Modifica la información del contrato de concesión"})]}),e.jsx(pe,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(Ve),className:"space-y-4",children:[e.jsxs(ge,{defaultValue:"basic",className:"w-full",children:[e.jsxs(fe,{className:"grid w-full grid-cols-3",children:[e.jsx(V,{value:"basic",children:"Información Básica"}),e.jsx(V,{value:"details",children:"Detalles"}),e.jsx(V,{value:"document",children:"Documento"})]}),e.jsxs(L,{value:"basic",className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:d.control,name:"parkId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Parque / Espacio"}),e.jsxs(v,{onValueChange:s.onChange,value:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un parque"})})}),e.jsx(y,{children:G?e.jsx(i,{value:"loading",children:"Cargando parques..."}):E&&E.length>0?E.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsx(i,{value:"loading",children:"No hay parques disponibles"})})]}),e.jsx(t,{})]})}),e.jsx(r,{control:d.control,name:"concessionaireId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Concesionario"}),e.jsxs(v,{onValueChange:s.onChange,value:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un concesionario"})})}),e.jsx(y,{children:_?e.jsx(i,{value:"loading",children:"Cargando concesionarios..."}):I&&I.length>0?I.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name||a.fullName},a.id)):e.jsx(i,{value:"loading",children:"No hay concesionarios disponibles"})})]}),e.jsx(t,{})]})})]}),e.jsx(r,{control:d.control,name:"concessionTypeId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Tipo de Concesión"}),e.jsxs(v,{onValueChange:s.onChange,value:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un tipo de concesión"})})}),e.jsx(y,{children:J?e.jsx(i,{value:"loading",children:"Cargando tipos de concesiones..."}):T&&T.length>0?T.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsx(i,{value:"loading",children:"No hay tipos de concesiones disponibles"})})]}),e.jsx(t,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:d.control,name:"startDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de inicio"}),e.jsx(c,{children:e.jsx(f,{type:"date",...s})}),e.jsx(t,{})]})}),e.jsx(r,{control:d.control,name:"endDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de vencimiento"}),e.jsx(c,{children:e.jsx(f,{type:"date",...s})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:d.control,name:"status",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Estado del contrato"}),e.jsxs(v,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona el estado del contrato"})})}),e.jsxs(y,{children:[e.jsx(i,{value:"active",children:"Activo"}),e.jsx(i,{value:"pending",children:"Pendiente"}),e.jsx(i,{value:"expired",children:"Vencido"}),e.jsx(i,{value:"terminated",children:"Terminado"})]})]}),e.jsx(t,{})]})})]}),e.jsxs(L,{value:"details",className:"space-y-4 py-4",children:[e.jsx(r,{control:d.control,name:"fee",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Canon o tarifa (MXN)"}),e.jsx(c,{children:e.jsx(f,{placeholder:"Ej: 5000.00",...s})}),e.jsx(A,{children:"Ingresa la cantidad en pesos mexicanos sin símbolos ni separadores"}),e.jsx(t,{})]})}),e.jsx(r,{control:d.control,name:"exclusivityClauses",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Cláusulas de exclusividad"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Describe las cláusulas de exclusividad que aplican a esta concesión",...s,rows:3})}),e.jsx(t,{})]})}),e.jsx(r,{control:d.control,name:"restrictions",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Restricciones"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Describe las restricciones que aplican a esta concesión",...s,rows:3})}),e.jsx(t,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:d.control,name:"hasExtension",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-x-3 space-y-0 p-4 border rounded-md",children:[e.jsx(c,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:a=>s.onChange(a.target.checked),className:"w-4 h-4 mt-1"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(o,{children:"Tiene prórroga"}),e.jsx(A,{children:"Marcar si el contrato tiene una prórroga aprobada"})]})]})}),d.watch("hasExtension")&&e.jsx(r,{control:d.control,name:"extensionDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de prórroga"}),e.jsx(c,{children:e.jsx(f,{type:"date",...s})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:d.control,name:"notes",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Notas adicionales"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Notas adicionales sobre el contrato",...s,rows:3})}),e.jsx(t,{})]})})]}),e.jsxs(L,{value:"document",className:"space-y-4 py-4",children:[n.contractFileUrl&&e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted rounded-lg mb-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Documento actual"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ya hay un contrato cargado en el sistema"})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>window.open(n.contractFileUrl,"_blank"),className:"gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),"Ver documento"]})]}),e.jsx(r,{control:d.control,name:"contractFile",render:({field:{value:s,onChange:a,...p}})=>e.jsxs(l,{children:[e.jsx(o,{children:"Actualizar documento del contrato (PDF)"}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(f,{type:"file",accept:".pdf",onChange:m=>{var g;const h=(g=m.target.files)==null?void 0:g[0];h&&a(h)},...p}),e.jsx(A,{children:n.contractFileUrl?"Sube un nuevo archivo para reemplazar el documento actual":"Sube el contrato en formato PDF. Tamaño máximo: 10MB."})]})}),e.jsx(t,{})]})})]})]}),e.jsxs(ce,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>X(!1),children:"Cancelar"}),e.jsx(j,{type:"submit",disabled:W.isPending,children:W.isPending?"Guardando...":"Actualizar contrato"})]})]})})]})})]})}export{us as default};
