import{l as me,ae as ue,a2 as x,af as V,u as he,ag as O,j as e,aX as je,f as H,F as pe,O as L,Q as E,V as D,W as F,Y as M,_ as a,w as _,x as ge,B as i,bh as ve,y as Q,z as K,I as G,J,ai as U,aj as t,ak as r,al as c,am as l,an as h,$ as W,bC as $,i as be,bH as ye,bI as Ce,bJ as X,bK as p,bL as Ne,bM as g,o as Y,bq as fe,aW as we,aM as Se,aN as Te,ad as o,ap as Z,aq as ee}from"./index-D5qLf1ib.js";import{H as qe}from"./Helmet-BNepwt1P.js";const se=o.object({name:o.string().min(3,"El nombre debe tener al menos 3 caracteres"),description:o.string().min(10,"La descripción debe tener al menos 10 caracteres"),technicalRequirements:o.string().optional(),legalRequirements:o.string().optional(),operatingRules:o.string().optional(),impactLevel:o.enum(["bajo","medio","alto","muy_alto"]),isActive:o.boolean().default(!0)});function Ee(){const{toast:v}=me(),R=ue(),[ae,f]=x.useState(!1),[ne,b]=x.useState(!1),[I,P]=x.useState(null),[m,z]=x.useState(1),[j,ie]=x.useState(""),[u,te]=x.useState("all"),y=10,d=V({resolver:Z(se),defaultValues:{name:"",description:"",technicalRequirements:"",legalRequirements:"",operatingRules:"",impactLevel:"bajo",isActive:!0}}),n=V({resolver:Z(se)}),{data:k=[],isLoading:re}=he({queryKey:["/api/concession-types"],suspense:!1,retry:1}),w=O({mutationFn:async s=>await ee("/api/concession-types",{method:"POST",data:s}),onSuccess:()=>{R.invalidateQueries({queryKey:["/api/concession-types"]}),f(!1),d.reset(),v({title:"Tipo de concesión creado",description:"El nuevo tipo de concesión ha sido agregado exitosamente."})},onError:()=>{v({title:"Error",description:"No se pudo crear el tipo de concesión.",variant:"destructive"})}}),S=O({mutationFn:async s=>{const{id:q,...A}=s;return await ee(`/api/concession-types/${q}`,{method:"PUT",data:A})},onSuccess:()=>{R.invalidateQueries({queryKey:["/api/concession-types"]}),b(!1),P(null),n.reset(),v({title:"Tipo de concesión actualizado",description:"Los cambios han sido guardados exitosamente."})},onError:()=>{v({title:"Error",description:"No se pudo actualizar el tipo de concesión.",variant:"destructive"})}}),C=x.useMemo(()=>k.filter(s=>{const q=s.name.toLowerCase().includes(j.toLowerCase())||s.description.toLowerCase().includes(j.toLowerCase()),A=u==="all"||u==="active"&&s.isActive||u==="inactive"&&!s.isActive;return q&&A}),[k,j,u]),T=Math.ceil(C.length/y),N=(m-1)*y,B=C.slice(N,N+y),ce=s=>{w.mutate(s)},le=s=>{I&&S.mutate({...s,id:I.id})},oe=s=>{P(s),n.reset({name:s.name,description:s.description,technicalRequirements:s.technicalRequirements||"",legalRequirements:s.legalRequirements||"",operatingRules:s.operatingRules||"",impactLevel:s.impactLevel,isActive:s.isActive}),b(!0)},de=s=>{switch(s){case"bajo":return"bg-green-100 text-green-800";case"medio":return"bg-yellow-100 text-yellow-800";case"alto":return"bg-orange-100 text-orange-800";case"muy_alto":return"bg-red-100 text-red-800";default:return""}},xe=s=>{switch(s){case"bajo":return"Bajo";case"medio":return"Medio";case"alto":return"Alto";case"muy_alto":return"Muy alto";default:return s}};return e.jsxs(je,{children:[e.jsxs(qe,{children:[e.jsx("title",{children:"Catálogo de Concesiones | Bosques Urbanos"}),e.jsx("meta",{name:"description",content:"Gestiona el catálogo de tipos de concesiones disponibles para los parques"})]}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs(H,{className:"p-4 bg-gray-50 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Catálogo de Concesiones"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Administra los tipos de concesiones disponibles para los parques"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(L,{placeholder:"Buscar tipos de concesión...",value:j,onChange:s=>ie(s.target.value),className:"w-64"}),e.jsxs(E,{value:u,onValueChange:te,children:[e.jsx(D,{className:"w-40",children:e.jsx(F,{placeholder:"Estado"})}),e.jsxs(M,{children:[e.jsx(a,{value:"all",children:"Todos"}),e.jsx(a,{value:"active",children:"Activos"}),e.jsx(a,{value:"inactive",children:"Inactivos"})]})]})]}),e.jsxs(_,{open:ae,onOpenChange:f,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(i,{className:"gap-2",children:[e.jsx(ve,{size:16}),"Nuevo tipo de concesión"]})}),e.jsxs(Q,{className:"sm:max-w-[600px]",children:[e.jsxs(K,{children:[e.jsx(G,{children:"Crear nuevo tipo de concesión"}),e.jsx(J,{children:"Introduce la información del nuevo tipo de concesión para el catálogo"})]}),e.jsx(U,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(ce),className:"space-y-4",children:[e.jsx(t,{control:d.control,name:"name",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Nombre"}),e.jsx(l,{children:e.jsx(L,{placeholder:"Ej: Venta de alimentos",...s})}),e.jsx(h,{})]})}),e.jsx(t,{control:d.control,name:"description",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Descripción"}),e.jsx(l,{children:e.jsx(W,{placeholder:"Describe en qué consiste este tipo de concesión",...s,rows:3})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(t,{control:d.control,name:"impactLevel",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Nivel de impacto"}),e.jsxs(E,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(l,{children:e.jsx(D,{children:e.jsx(F,{placeholder:"Selecciona el nivel"})})}),e.jsxs(M,{children:[e.jsx(a,{value:"bajo",children:"Bajo"}),e.jsx(a,{value:"medio",children:"Medio"}),e.jsx(a,{value:"alto",children:"Alto"}),e.jsx(a,{value:"muy_alto",children:"Muy alto"})]})]}),e.jsx(h,{})]})}),e.jsx(t,{control:d.control,name:"isActive",render:({field:s})=>e.jsxs(r,{className:"flex flex-row items-center space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(l,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:s.onChange,className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"})}),e.jsx("div",{className:"leading-none",children:e.jsx(c,{children:"Activo"})})]})})]}),e.jsxs($,{children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>f(!1),children:"Cancelar"}),e.jsx(i,{type:"submit",disabled:w.isPending,children:w.isPending?"Creando...":"Crear tipo"})]})]})})]})]})]}),e.jsx(H,{children:e.jsxs(be,{className:"p-0",children:[re?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{children:"Cargando tipos de concesión..."})}):B.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ye,{children:[e.jsx(Ce,{children:e.jsxs(X,{children:[e.jsx(p,{children:"Nombre"}),e.jsx(p,{children:"Descripción"}),e.jsx(p,{children:"Nivel de impacto"}),e.jsx(p,{children:"Estado"}),e.jsx(p,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ne,{children:B.map(s=>e.jsxs(X,{children:[e.jsx(g,{className:"font-medium",children:s.name}),e.jsx(g,{className:"max-w-xs truncate",children:s.description}),e.jsx(g,{children:e.jsx(Y,{className:de(s.impactLevel),children:xe(s.impactLevel)})}),e.jsx(g,{children:e.jsx(Y,{variant:s.isActive?"default":"secondary",children:s.isActive?"Activo":"Inactivo"})}),e.jsx(g,{className:"text-right",children:e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(i,{variant:"outline",size:"sm",onClick:()=>oe(s),children:e.jsx(fe,{size:16})})})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No hay tipos de concesión"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:j||u!=="all"?"No se encontraron tipos que coincidan con los filtros.":"Comienza creando tu primer tipo de concesión."})]}),T>1&&e.jsxs("div",{className:"flex items-center justify-between px-2 py-4",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Mostrando ",N+1," a ",Math.min(N+y,C.length)," de ",C.length," tipos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>z(m-1),disabled:m<=1,children:e.jsx(Se,{size:16})}),e.jsxs("span",{className:"text-sm font-medium",children:["Página ",m," de ",T]}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>z(m+1),disabled:m>=T,children:e.jsx(Te,{size:16})})]})]})]})}),e.jsx(_,{open:ne,onOpenChange:b,children:e.jsxs(Q,{className:"sm:max-w-[600px]",children:[e.jsxs(K,{children:[e.jsx(G,{children:"Editar tipo de concesión"}),e.jsx(J,{children:"Modifica la información del tipo de concesión"})]}),e.jsx(U,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(le),className:"space-y-4",children:[e.jsx(t,{control:n.control,name:"name",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Nombre"}),e.jsx(l,{children:e.jsx(L,{placeholder:"Ej: Venta de alimentos",...s})}),e.jsx(h,{})]})}),e.jsx(t,{control:n.control,name:"description",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Descripción"}),e.jsx(l,{children:e.jsx(W,{placeholder:"Describe en qué consiste este tipo de concesión",...s,rows:3})}),e.jsx(h,{})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(t,{control:n.control,name:"impactLevel",render:({field:s})=>e.jsxs(r,{children:[e.jsx(c,{children:"Nivel de impacto"}),e.jsxs(E,{onValueChange:s.onChange,value:s.value,children:[e.jsx(l,{children:e.jsx(D,{children:e.jsx(F,{placeholder:"Selecciona el nivel"})})}),e.jsxs(M,{children:[e.jsx(a,{value:"bajo",children:"Bajo"}),e.jsx(a,{value:"medio",children:"Medio"}),e.jsx(a,{value:"alto",children:"Alto"}),e.jsx(a,{value:"muy_alto",children:"Muy alto"})]})]}),e.jsx(h,{})]})})}),e.jsx(t,{control:n.control,name:"isActive",render:({field:s})=>e.jsxs(r,{className:"flex flex-row items-center space-x-3 space-y-0",children:[e.jsx(l,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:s.onChange,className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"})}),e.jsx("div",{className:"leading-none",children:e.jsx(c,{children:"Activo"})})]})}),e.jsxs($,{children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(i,{type:"submit",disabled:S.isPending,children:S.isPending?"Guardando...":"Guardar cambios"})]})]})})]})})]})]})}export{Ee as default};
