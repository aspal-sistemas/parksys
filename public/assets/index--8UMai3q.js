import{l as ge,ae as be,a2 as r,u as U,ag as k,j as e,aX as W,f as M,aZ as Y,g as X,h as Z,a7 as Ne,i as ee,a4 as ye,O as E,Q as d,V as c,W as o,Y as m,_ as l,B as n,bh as we,bH as Te,bI as Ce,bJ as L,bK as h,bL as Se,bM as x,o as se,au as Me,bq as Ee,bn as De,w as D,y as F,z as A,I,J as q,$ as ae,r as Fe,a1 as Ae,aq as R}from"./index-D5qLf1ib.js";import{p as Ie}from"./parseISO-DQfTOoXY.js";const v=[{value:"preventivo",label:"Preventivo"},{value:"correctivo",label:"Correctivo"},{value:"emergencia",label:"Emergencia"},{value:"mejora",label:"Mejora"}],f=[{value:"programado",label:"Programado",color:"bg-blue-100 text-blue-800"},{value:"en_progreso",label:"En Progreso",color:"bg-yellow-100 text-yellow-800"},{value:"completado",label:"Completado",color:"bg-green-100 text-green-800"},{value:"cancelado",label:"Cancelado",color:"bg-red-100 text-red-800"}],$=i=>{try{const j=Ie(i);return Fe(j,"dd 'de' MMMM, yyyy",{locale:Ae})}catch{return i}},ze=()=>{var Q,H,G,_,J;const{toast:i}=ge(),j=be(),[te,g]=r.useState(!1),[le,O]=r.useState(!1),[ne,b]=r.useState(!1),[ie,N]=r.useState(!1),[a,V]=r.useState(null),[y,re]=r.useState(""),[w,de]=r.useState(""),[T,ce]=r.useState(""),{data:C=[],isLoading:qe}=U({queryKey:["/api/assets"],suspense:!1,retry:1}),{data:oe=[],isLoading:me,refetch:xe}=U({queryKey:["/api/assets/maintenances"],suspense:!1,retry:1}),P=k({mutationFn:s=>R("/api/assets/maintenances","POST"),onSuccess:()=>{i({title:"Éxito",description:"Mantenimiento registrado correctamente"}),g(!1),j.invalidateQueries({queryKey:["/api/assets/maintenances"]}),xe()},onError:s=>{console.error("Error creating maintenance:",s),i({title:"Error",description:"Error al registrar el mantenimiento",variant:"destructive"})}}),z=k({mutationFn:({id:s,data:t})=>R(`/api/assets/maintenances/${s}`,"PUT"),onSuccess:()=>{i({title:"Éxito",description:"Mantenimiento actualizado correctamente"}),b(!1),j.invalidateQueries({queryKey:["/api/assets/maintenances"]})},onError:()=>{i({title:"Error",description:"Error al actualizar el mantenimiento",variant:"destructive"})}}),B=k({mutationFn:s=>R(`/api/assets/maintenances/${s}`,"DELETE"),onSuccess:()=>{i({title:"Éxito",description:"Mantenimiento eliminado correctamente"}),N(!1),j.invalidateQueries({queryKey:["/api/assets/maintenances"]})},onError:()=>{i({title:"Error",description:"Error al eliminar el mantenimiento",variant:"destructive"})}}),ue=s=>{s.preventDefault();const t=new FormData(s.currentTarget),u={assetId:parseInt(t.get("assetId")),maintenanceType:t.get("maintenanceType"),description:t.get("description"),date:t.get("date"),status:t.get("status")||"programado",cost:t.get("cost")?parseFloat(t.get("cost")):null,performedBy:t.get("performedBy")||null,notes:t.get("notes")||null};P.mutate(u)},he=s=>{if(s.preventDefault(),!a)return;const t=new FormData(s.currentTarget),u={assetId:parseInt(t.get("assetId")),maintenanceType:t.get("maintenanceType"),description:t.get("description"),date:t.get("date"),status:t.get("status"),cost:t.get("cost")?parseFloat(t.get("cost")):null,performedBy:t.get("performedBy")||null,notes:t.get("notes")||null};z.mutate({id:a.id,data:u})},je=s=>{V(s),O(!0)},pe=s=>{V(s),b(!0)},ve=s=>{V(s),N(!0)},fe=()=>{a&&B.mutate(a.id)},K=oe.filter(s=>{var p;const t=!y||((p=s.assetName)==null?void 0:p.toLowerCase().includes(y.toLowerCase()))||s.description.toLowerCase().includes(y.toLowerCase()),u=!w||w==="all"||s.maintenanceType===w,S=!T||T==="all"||s.status===T;return t&&u&&S});return me?e.jsx(W,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs(M,{className:"p-4 bg-gray-50 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestión de Mantenimientos"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Registra y gestiona el mantenimiento de activos"})]}),e.jsx("div",{className:"text-center",children:"Cargando mantenimientos..."})]})}):e.jsx(W,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs(M,{className:"p-4 bg-gray-50 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestión de Mantenimientos"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Registra y gestiona el mantenimiento de activos"})]}),e.jsxs(M,{className:"mb-6",children:[e.jsx(X,{children:e.jsxs(Z,{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"}),"Filtros"]})}),e.jsx(ee,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(E,{placeholder:"Buscar por activo o descripción...",value:y,onChange:s=>re(s.target.value),className:"pl-10"})]})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(d,{value:w,onValueChange:de,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Tipo de mantenimiento"})}),e.jsxs(m,{children:[e.jsx(l,{value:"all",children:"Todos los tipos"}),v.filter(s=>s&&s.value).map(s=>e.jsx(l,{value:s.value,children:s.label},s.value))]})]})}),e.jsx("div",{className:"w-full md:w-48",children:e.jsxs(d,{value:T,onValueChange:ce,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Estado"})}),e.jsxs(m,{children:[e.jsx(l,{value:"all",children:"Todos los estados"}),f.filter(s=>s&&s.value).map(s=>e.jsx(l,{value:s.value,children:s.label},s.value))]})]})}),e.jsxs(n,{onClick:()=>g(!0),children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Registrar Mantenimiento"]})]})})]}),e.jsxs(M,{children:[e.jsx(X,{children:e.jsx(Z,{children:"Mantenimientos Registrados"})}),e.jsx(ee,{children:e.jsxs(Te,{children:[e.jsx(Ce,{children:e.jsxs(L,{children:[e.jsx(h,{children:"Activo"}),e.jsx(h,{children:"Tipo"}),e.jsx(h,{children:"Descripción"}),e.jsx(h,{children:"Fecha"}),e.jsx(h,{children:"Estado"}),e.jsx(h,{children:"Costo"}),e.jsx(h,{children:"Acciones"})]})}),e.jsx(Se,{children:K.length===0?e.jsx(L,{children:e.jsx(x,{colSpan:7,className:"text-center py-8 text-gray-500",children:"No se encontraron mantenimientos"})}):K.map(s=>{var S;const t=f.find(p=>p.value===s.status),u=(S=v.find(p=>p.value===s.maintenanceType))==null?void 0:S.label;return e.jsxs(L,{children:[e.jsx(x,{className:"font-medium",children:s.assetName||`Activo #${s.assetId}`}),e.jsx(x,{children:u||s.maintenanceType}),e.jsx(x,{className:"max-w-xs truncate",children:s.description}),e.jsx(x,{children:$(s.date)}),e.jsx(x,{children:e.jsx(se,{className:(t==null?void 0:t.color)||"bg-gray-100 text-gray-800",children:(t==null?void 0:t.label)||s.status})}),e.jsx(x,{children:s.cost&&!isNaN(parseFloat(s.cost))?`$${parseFloat(s.cost).toFixed(2)}`:"-"}),e.jsx(x,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>je(s),children:e.jsx(Me,{className:"h-4 w-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>pe(s),children:e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>ve(s),children:e.jsx(De,{className:"h-4 w-4"})})]})})]},s.id)})})]})})]}),e.jsx(D,{open:te,onOpenChange:g,children:e.jsxs(F,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Registrar Nuevo Mantenimiento"}),e.jsx(q,{children:"Complete los datos del mantenimiento realizado"})]}),e.jsxs("form",{onSubmit:ue,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Activo"}),e.jsxs(d,{name:"assetId",required:!0,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Seleccionar activo"})}),e.jsx(m,{children:Array.isArray(C)?C.filter(s=>s&&s.id&&s.name).map(s=>e.jsxs(l,{value:s.id.toString(),children:[s.name," - ",s.parkName||"Sin parque"]},s.id)):e.jsx(l,{value:"no-data",disabled:!0,children:"No hay activos disponibles"})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tipo de Mantenimiento"}),e.jsxs(d,{name:"maintenanceType",required:!0,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Seleccionar tipo"})}),e.jsx(m,{children:v.filter(s=>s&&s.value&&s.value.trim()!=="").map(s=>e.jsx(l,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Descripción"}),e.jsx(ae,{name:"description",placeholder:"Descripción del mantenimiento realizado...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha"}),e.jsx(E,{name:"date",type:"date",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Estado"}),e.jsxs(d,{name:"status",defaultValue:"completado",children:[e.jsx(c,{children:e.jsx(o,{})}),e.jsx(m,{children:f.filter(s=>s&&s.value&&s.value.trim()!=="").map(s=>e.jsx(l,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Costo (opcional)"}),e.jsx(E,{name:"cost",type:"number",step:"0.01",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Realizado por"}),e.jsx(E,{name:"performedBy",placeholder:"Nombre del responsable"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notas adicionales"}),e.jsx(ae,{name:"notes",placeholder:"Notas u observaciones adicionales..."})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(n,{type:"submit",disabled:P.isPending,children:P.isPending?"Guardando...":"Guardar"})]})]})]})}),e.jsx(D,{open:le,onOpenChange:O,children:e.jsxs(F,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Detalles del Mantenimiento"}),e.jsx(q,{children:"Información completa del mantenimiento registrado"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Activo"}),e.jsx("p",{className:"text-sm",children:a.assetName||`Activo #${a.assetId}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Tipo de Mantenimiento"}),e.jsx("p",{className:"text-sm",children:((Q=v.find(s=>s.value===a.maintenanceType))==null?void 0:Q.label)||a.maintenanceType})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Descripción"}),e.jsx("p",{className:"text-sm",children:a.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Fecha"}),e.jsx("p",{className:"text-sm",children:$(a.date)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Estado"}),e.jsx("div",{className:"mt-1",children:e.jsx(se,{className:((H=f.find(s=>s.value===a.status))==null?void 0:H.color)||"bg-gray-100 text-gray-800",children:((G=f.find(s=>s.value===a.status))==null?void 0:G.label)||a.status})})]}),a.cost&&!isNaN(parseFloat(a.cost))&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Costo"}),e.jsxs("p",{className:"text-sm",children:["$",parseFloat(a.cost).toFixed(2)]})]}),a.performedBy&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Realizado por"}),e.jsx("p",{className:"text-sm",children:a.performedBy})]}),a.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Notas"}),e.jsx("p",{className:"text-sm",children:a.notes})]})]})]})}),e.jsx(D,{open:ne,onOpenChange:b,children:e.jsxs(F,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Editar Mantenimiento"}),e.jsx(q,{children:"Modifique los datos del mantenimiento"})]}),a&&e.jsxs("form",{onSubmit:he,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Activo"}),e.jsxs(d,{name:"assetId",defaultValue:(_=a.assetId)==null?void 0:_.toString(),children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Seleccionar activo"})}),e.jsx(m,{children:Array.isArray(C)?C.filter(s=>s&&s.id&&s.name).map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id)):null})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tipo de Mantenimiento"}),e.jsxs(d,{name:"maintenanceType",defaultValue:a.maintenanceType,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Seleccionar tipo"})}),e.jsx(m,{children:v.filter(s=>s&&s.value&&s.label).map(s=>e.jsx(l,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Descripción"}),e.jsx("textarea",{name:"description",className:"w-full min-h-[80px] p-2 border border-gray-300 rounded-md",defaultValue:a.description,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha"}),e.jsx("input",{type:"date",name:"date",className:"w-full p-2 border border-gray-300 rounded-md",defaultValue:a.date,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Estado"}),e.jsxs(d,{name:"status",defaultValue:a.status,children:[e.jsx(c,{children:e.jsx(o,{placeholder:"Seleccionar estado"})}),e.jsx(m,{children:f.filter(s=>s&&s.value&&s.label).map(s=>e.jsx(l,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Costo (opcional)"}),e.jsx("input",{type:"number",step:"0.01",name:"cost",className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"0.00",defaultValue:a.cost||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Realizado por (opcional)"}),e.jsx("input",{type:"text",name:"performedBy",className:"w-full p-2 border border-gray-300 rounded-md",placeholder:"Nombre del responsable",defaultValue:a.performedBy||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notas adicionales (opcional)"}),e.jsx("textarea",{name:"notes",className:"w-full min-h-[60px] p-2 border border-gray-300 rounded-md",placeholder:"Observaciones, materiales utilizados, etc.",defaultValue:a.notes||""})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(n,{type:"submit",disabled:z.isPending,children:z.isPending?"Actualizando...":"Actualizar"})]})]})]})}),e.jsx(D,{open:ie,onOpenChange:N,children:e.jsxs(F,{className:"max-w-md",children:[e.jsxs(A,{children:[e.jsx(I,{children:"Eliminar Mantenimiento"}),e.jsx(q,{children:"¿Está seguro de que desea eliminar este registro de mantenimiento? Esta acción no se puede deshacer."})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("p",{className:"text-sm font-medium",children:["Activo: ",a.assetName||`Activo #${a.assetId}`]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Tipo: ",(J=v.find(s=>s.value===a.maintenanceType))==null?void 0:J.label]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Fecha: ",$(a.date)]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(n,{type:"button",variant:"destructive",onClick:fe,disabled:B.isPending,children:B.isPending?"Eliminando...":"Eliminar"})]})]})]})})]})})};export{ze as default};
