import{a5 as i,am as R,u as I,a7 as V,a8 as L,j as e,aI as z,B as k,C as H,a as O,b as $,a3 as B,c as G,aa as K,ab as n,ac as c,ad as t,ae as l,I as p,af as o,z as T,H as A,J as M,K as F,N as S,O as q,aA as m,ag as y,bd as _,ah as J,bG as P,bA as U}from"./index-Dzu3mJf5.js";import{L as Q}from"./LocationSelector-Bce2HPkj.js";const X=[{id:"lunes",label:"Lunes"},{id:"martes",label:"Martes"},{id:"miercoles",label:"Miércoles"},{id:"jueves",label:"Jueves"},{id:"viernes",label:"Viernes"},{id:"sabado",label:"Sábado"},{id:"domingo",label:"Domingo"}],W=[{id:"preescolar",label:"Preescolar - 0 a 5 años"},{id:"ninos",label:"Niños - 6 a 12 años"},{id:"adolescentes",label:"Adolescentes - 13 a 18 años"},{id:"adultos",label:"Adultos - 19 a 65 años"},{id:"adultosmayores",label:"Adultos Mayores - +65 años"}],Y=[{id:"fisica",label:"Física / Motriz"},{id:"visual",label:"Visual"},{id:"auditiva",label:"Auditiva"},{id:"intelectual",label:"Intelectual / Cognitiva"},{id:"psicosocial",label:"Psicosocial / Mental"},{id:"neurodivergencias",label:"Neurodivergencias"},{id:"multiple",label:"Múltiple / Combinada"},{id:"temporal",label:"Temporal"}],Z=i.object({title:i.string().min(3,"El título debe tener al menos 3 caracteres"),description:i.string().min(10,"La descripción debe tener al menos 10 caracteres"),category:i.string().min(1,"Debes seleccionar una categoría"),parkId:i.string().min(1,"Debes seleccionar un parque"),startDate:i.string().min(1,"La fecha de inicio es obligatoria"),endDate:i.string().optional(),startTime:i.string().min(1,"La hora de inicio es obligatoria"),endTime:i.string().min(1,"La hora de finalización es obligatoria"),location:i.string().optional(),capacity:i.coerce.number().int().positive().optional(),duration:i.coerce.number().int().positive().optional(),price:i.coerce.number().min(0).optional(),isPriceRandom:i.boolean().default(!1),isFree:i.boolean().default(!1),materials:i.string().optional(),requirements:i.string().optional(),isRecurring:i.boolean().default(!1),recurringDays:i.array(i.string()).optional(),targetMarket:i.array(i.string()).optional(),specialNeeds:i.array(i.string()).optional(),instructorId:i.string().optional()});function E(C,g){if(!C||!g)return 0;try{const[N,D]=C.split(":").map(Number),[b,s]=g.split(":").map(Number);if(isNaN(N)||isNaN(D)||isNaN(b)||isNaN(s))return console.error("Error en formato de horas:",{horaInicio:C,horaFin:g}),0;const v=N*60+D,f=b*60+s;return f<v?24*60-v+f:f-v}catch(N){return console.error("Error al calcular duración:",N),0}}const re=()=>{const[C,g]=R(),{data:N=[]}=I({queryKey:["/api/parks"]}),{data:D=[]}=I({queryKey:["/api/activity-categories"]}),{data:b=[]}=I({queryKey:["/api/users"],select:a=>a.filter(r=>r.role==="instructor")}),s=V({resolver:J(Z),defaultValues:{title:"",description:"",category:"",parkId:"",startDate:"",endDate:"",startTime:"09:00",endTime:"10:00",location:"",capacity:void 0,duration:void 0,price:0,isPriceRandom:!1,isFree:!1,materials:"",requirements:"",isRecurring:!1,recurringDays:[],targetMarket:[],specialNeeds:[],instructorId:""}}),v=L({mutationFn:async a=>{const r=parseInt(a.parkId);let d={};if(a.instructorId){const j=b.find(w=>w.id.toString()===a.instructorId);j&&(d={instructorId:j.id,instructorName:`${j.fullName||j.username||""}`.trim(),instructorContact:j.email||""})}let x=a.duration;a.startTime&&a.endTime&&(x=E(a.startTime,a.endTime));const h={title:a.title,description:a.description,parkId:r,startDate:a.startDate,endDate:a.endDate||null,startTime:a.startTime,endTime:a.endTime,category_id:parseInt(a.category),location:a.location||null,capacity:a.capacity||null,duration:x||null,price:a.price||0,isPriceRandom:a.isPriceRandom||!1,isFree:a.isFree||!1,materials:a.materials||"",requirements:a.requirements||"",isRecurring:a.isRecurring||!1,recurringDays:a.recurringDays||[],targetMarket:a.targetMarket||[],specialNeeds:a.specialNeeds||[],...d};console.log("Enviando datos a la API:",h);const u=await fetch("/api/activities",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(h)});if(!u.ok){const j=await u.text();throw console.error("Error en la respuesta:",j),new Error(`Error al crear actividad: ${u.status} ${j}`)}return await u.json()},onSuccess:a=>{P({title:"Actividad creada",description:"La actividad ha sido creada exitosamente. Ahora puedes agregar imágenes.",variant:"default"}),U.invalidateQueries(),setTimeout(()=>{g(`/admin/activities/${a.id}/images`)},500)},onError:a=>{console.error("Error al crear actividad:",a),P({title:"Error",description:"Hubo un problema al crear la actividad. Por favor, intenta nuevamente.",variant:"destructive"})}}),f=a=>{v.mutate(a)};return e.jsxs(z,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Crear Nueva Actividad"}),e.jsx(k,{variant:"outline",onClick:()=>g("/admin/organizador/catalogo/ver"),children:"Actividades Disponibles"})]}),e.jsx("p",{className:"text-gray-500",children:"Completa el formulario para crear una nueva actividad para el catálogo"})]}),e.jsxs(H,{children:[e.jsxs(O,{children:[e.jsx($,{children:"Formulario de Actividad"}),e.jsx(B,{children:"Ingresa la información completa de la actividad. Los campos marcados con * son obligatorios."})]}),e.jsx(G,{children:e.jsx(K,{...s,children:e.jsxs("form",{onSubmit:s.handleSubmit(f),className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Información Básica"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:s.control,name:"title",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Título *"}),e.jsx(l,{children:e.jsx(p,{placeholder:"Ej: Taller de Pintura",...a})}),e.jsx(o,{})]})}),e.jsx(n,{control:s.control,name:"category",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Categoría *"}),e.jsxs(T,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(l,{children:e.jsx(A,{children:e.jsx(M,{placeholder:"Selecciona una categoría"})})}),e.jsx(F,{children:D.map(r=>e.jsx(S,{value:r.id.toString(),children:r.name},r.id))})]}),e.jsx(o,{})]})})]}),e.jsx(n,{control:s.control,name:"description",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Descripción *"}),e.jsx(l,{children:e.jsx(q,{placeholder:"Describe la actividad en detalle",className:"min-h-[120px]",...a})}),e.jsx(m,{children:"Incluye detalles importantes sobre lo que los participantes harán y aprenderán."}),e.jsx(o,{})]})}),e.jsx(n,{control:s.control,name:"parkId",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Parque *"}),e.jsxs(T,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(l,{children:e.jsx(A,{children:e.jsx(M,{placeholder:"Selecciona un parque"})})}),e.jsx(F,{children:N.map(r=>e.jsx(S,{value:r.id.toString(),children:r.name},r.id))})]}),e.jsx(o,{})]})}),e.jsx(n,{control:s.control,name:"location",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Ubicación dentro del parque"}),e.jsx(l,{children:e.jsx(Q,{parkId:s.watch("parkId")?Number(s.watch("parkId")):void 0,value:a.value,onChange:a.onChange,placeholder:"Seleccionar ubicación"})}),e.jsx(m,{children:"Especifica dónde dentro del parque se realizará la actividad"}),e.jsx(o,{})]})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Segmentación"}),e.jsx(n,{control:s.control,name:"targetMarket",render:()=>e.jsxs(c,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{children:"Mercado Meta"}),e.jsx(m,{children:"Selecciona los grupos de edad a los que está dirigida esta actividad"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:W.map(a=>e.jsx(n,{control:s.control,name:"targetMarket",render:({field:r})=>{var d;return e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(l,{children:e.jsx(y,{checked:(d=r.value)==null?void 0:d.includes(a.id),onCheckedChange:x=>{var h;return x?r.onChange([...r.value||[],a.id]):r.onChange((h=r.value)==null?void 0:h.filter(u=>u!==a.id))}})}),e.jsx(t,{className:"font-normal",children:a.label})]},a.id)}},a.id))}),e.jsx(o,{})]})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Capacidades Diferentes"}),e.jsx(n,{control:s.control,name:"specialNeeds",render:()=>e.jsxs(c,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{children:"Accesibilidad para personas con capacidades diferentes"}),e.jsx(m,{children:"Selecciona los tipos de discapacidad para los que esta actividad está adaptada"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:Y.map(a=>e.jsx(n,{control:s.control,name:"specialNeeds",render:({field:r})=>{var d;return e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(l,{children:e.jsx(y,{checked:(d=r.value)==null?void 0:d.includes(a.id),onCheckedChange:x=>{var h;return x?r.onChange([...r.value||[],a.id]):r.onChange((h=r.value)==null?void 0:h.filter(u=>u!==a.id))}})}),e.jsx(t,{className:"font-normal",children:a.label})]},a.id)}},a.id))}),e.jsx(o,{})]})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Fecha y Horario"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:s.control,name:"startDate",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Fecha de inicio *"}),e.jsx(l,{children:e.jsx(p,{type:"date",...a})}),e.jsx(o,{})]})}),e.jsx(n,{control:s.control,name:"endDate",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Fecha de finalización"}),e.jsx(l,{children:e.jsx(p,{type:"date",...a})}),e.jsx(m,{children:"Opcional para actividades de un solo día"}),e.jsx(o,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:s.control,name:"startTime",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Hora de inicio *"}),e.jsx(l,{children:e.jsx(p,{type:"time",...a,onChange:r=>{a.onChange(r);const d=s.getValues("endTime");if(d){const x=E(r.target.value,d);s.setValue("duration",x)}}})}),e.jsx(m,{children:"Hora a la que comenzará la actividad"}),e.jsx(o,{})]})}),e.jsx(n,{control:s.control,name:"endTime",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Hora de finalización *"}),e.jsx(l,{children:e.jsx(p,{type:"time",...a,onChange:r=>{a.onChange(r);const d=s.getValues("startTime");if(d){const x=E(d,r.target.value);s.setValue("duration",x)}}})}),e.jsx(m,{children:"Hora a la que terminará la actividad"}),e.jsx(o,{})]})})]}),e.jsx(n,{control:s.control,name:"duration",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Duración (minutos)"}),e.jsx(l,{children:e.jsx(p,{type:"number",min:"0",placeholder:"Se calcula automáticamente",...a,disabled:!0})}),e.jsx(m,{children:"Se calcula automáticamente basado en la hora de inicio y finalización"}),e.jsx(o,{})]})}),e.jsx(n,{control:s.control,name:"isRecurring",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(t,{children:"Actividad recurrente"}),e.jsx(m,{children:"Marca esta opción si la actividad se repite en días específicos"})]}),e.jsx(l,{children:e.jsx(_,{checked:a.value,onCheckedChange:a.onChange})})]})}),s.watch("isRecurring")&&e.jsx(n,{control:s.control,name:"recurringDays",render:()=>e.jsxs(c,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(t,{children:"Días de la semana"}),e.jsx(m,{children:"Selecciona los días en que se repite la actividad"})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:X.map(a=>e.jsx(n,{control:s.control,name:"recurringDays",render:({field:r})=>{var d;return e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(l,{children:e.jsx(y,{checked:(d=r.value)==null?void 0:d.includes(a.id),onCheckedChange:x=>{var h;return x?r.onChange([...r.value||[],a.id]):r.onChange((h=r.value)==null?void 0:h.filter(u=>u!==a.id))}})}),e.jsx(t,{className:"font-normal",children:a.label})]},a.id)}},a.id))}),e.jsx(o,{})]})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Capacidad y Materiales"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(n,{control:s.control,name:"capacity",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Capacidad máxima"}),e.jsx(l,{children:e.jsx(p,{type:"number",min:"0",placeholder:"Ej: 20",...a})}),e.jsx(m,{children:"Número máximo de participantes permitidos"}),e.jsx(o,{})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(n,{control:s.control,name:"price",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Precio (MXN)"}),e.jsx(l,{children:e.jsx(p,{type:"number",min:"0",step:"0.01",placeholder:"Ej: 50.00",...a,disabled:s.watch("isFree")||s.watch("isPriceRandom")})}),e.jsx(m,{children:s.watch("isFree")?"Actividad gratuita":s.watch("isPriceRandom")?"El precio será variable o por donativo":"Precio fijo por persona"}),e.jsx(o,{})]})}),e.jsxs("div",{className:"flex flex-col gap-2 mt-2",children:[e.jsx(n,{control:s.control,name:"isFree",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-center space-x-3 space-y-0",children:[e.jsx(l,{children:e.jsx(y,{checked:a.value,onCheckedChange:r=>{a.onChange(r),r&&(s.setValue("price",0),s.setValue("isPriceRandom",!1))}})}),e.jsx(t,{className:"font-medium",children:"Actividad Gratuita"})]})}),e.jsx(n,{control:s.control,name:"isPriceRandom",render:({field:a})=>e.jsxs(c,{className:"flex flex-row items-center space-x-3 space-y-0",children:[e.jsx(l,{children:e.jsx(y,{checked:a.value,onCheckedChange:r=>{a.onChange(r),r&&s.setValue("isFree",!1)}})}),e.jsx(t,{className:"font-medium",children:"Precio Aleatorio (Donativo/Variable)"})]})})]})]})]}),e.jsx(n,{control:s.control,name:"materials",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Materiales necesarios"}),e.jsx(l,{children:e.jsx(q,{placeholder:"Lista de materiales que se usarán o que deben traer los participantes",...a})}),e.jsx(o,{})]})}),e.jsx(n,{control:s.control,name:"requirements",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Requisitos para participantes"}),e.jsx(l,{children:e.jsx(q,{placeholder:"Requisitos especiales, rango de edad, condiciones físicas, etc.",...a})}),e.jsx(o,{})]})})]}),e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Datos del Instructor o Facilitador"}),e.jsx(n,{control:s.control,name:"instructorId",render:({field:a})=>e.jsxs(c,{children:[e.jsx(t,{children:"Seleccionar Instructor"}),e.jsxs(T,{onValueChange:a.onChange,defaultValue:a.value,children:[e.jsx(l,{children:e.jsx(A,{children:e.jsx(M,{placeholder:"Selecciona un instructor"})})}),e.jsx(F,{children:b.length===0?e.jsx(S,{value:"no-instructors",disabled:!0,children:"No hay instructores disponibles"}):b.map(r=>e.jsxs(S,{value:r.id.toString(),children:[r.firstName," ",r.lastName," (",r.email,")"]},r.id))})]}),e.jsx(m,{children:"Selecciona un instructor registrado en el sistema. Si el instructor que buscas no está en la lista, primero debes registrarlo en la sección de Usuarios."}),e.jsx(o,{})]})}),b.length===0&&e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4 my-4",children:e.jsx("p",{className:"text-amber-800",children:"No hay instructores registrados en el sistema. Dirígete a la sección de Usuarios para crear un usuario con rol de Instructor primero."})})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(k,{type:"button",variant:"outline",onClick:()=>g("/admin/organizador/catalogo/ver"),children:"Cancelar"}),e.jsx(k,{type:"submit",disabled:v.isPending,children:v.isPending?"Guardando...":"Guardar Actividad"})]})})]})})})]})]})};export{re as default};
