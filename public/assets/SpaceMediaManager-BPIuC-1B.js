import{a2 as l,l as K,j as e,f as $,g as C,h as S,bZ as M,i as k,o as V,b as Z,B as P,bn as U,N as u,O as F,ao as A,F as G,$ as Q}from"./index-D5qLf1ib.js";function X({spaceId:t,isEditMode:g=!1}){const[j,L]=l.useState([]),[w,I]=l.useState([]),[y,E]=l.useState(""),[v,N]=l.useState(!1),[c,b]=l.useState(""),[D,T]=l.useState(""),[m,p]=l.useState(!1),{toast:o}=K(),O=a=>a||"";l.useEffect(()=>{t&&g&&(h(),x())},[t,g]);const h=async()=>{if(t)try{const a=await fetch(`/api/spaces/${t}/images`);if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);const s=await a.json();L(s)}catch(a){console.error("Error al cargar imágenes:",a)}},x=async()=>{if(t)try{const a=await fetch(`/api/spaces/${t}/documents`);if(!a.ok)throw new Error(`Error ${a.status}: ${a.statusText}`);const s=await a.json();I(s)}catch(a){console.error("Error al cargar documentos:",a)}},z=async a=>{var d;const s=(d=a.target.files)==null?void 0:d[0];if(!(!s||!t)){p(!0);try{const r=new FormData;r.append("file",s);const i=await fetch("/api/spaces/upload",{method:"POST",body:r});if(!i.ok)throw new Error(`Error ${i.status}: ${i.statusText}`);const f=(await i.json()).uploadURL,n=await fetch(`/api/spaces/${t}/images`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:f,caption:y,isPrimary:v})});if(!n.ok){const H=await n.text();throw new Error(`Error ${n.status}: ${n.statusText} - ${H}`)}await h(),E(""),N(!1),o({title:"Imagen agregada",description:"La imagen se ha agregado exitosamente al espacio."}),a.target.value=""}catch(r){console.error("Error uploading image:",r),o({title:"Error",description:`Error al agregar la imagen: ${r instanceof Error?r.message:"Error desconocido"}`,variant:"destructive"})}finally{p(!1)}}},R=async a=>{var d;const s=(d=a.target.files)==null?void 0:d[0];if(!(!s||!t||!c)){p(!0);try{const r=new FormData;r.append("file",s);const i=await fetch("/api/spaces/upload",{method:"POST",body:r});if(!i.ok)throw new Error(`Error ${i.status}: ${i.statusText}`);const f=(await i.json()).uploadURL,n=await fetch(`/api/spaces/${t}/documents`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({documentUrl:f,title:c,description:D,fileSize:s.size})});if(!n.ok)throw new Error(`Error ${n.status}: ${n.statusText}`);await x(),b(""),T(""),o({title:"Documento agregado",description:"El documento se ha agregado exitosamente al espacio."}),a.target.value=""}catch(r){console.error("Error uploading document:",r),o({title:"Error",description:"Error al agregar el documento.",variant:"destructive"})}finally{p(!1)}}},B=async a=>{try{const s=await fetch(`/api/spaces/images/${a}`,{method:"DELETE"});if(!s.ok)throw new Error(`Error ${s.status}: ${s.statusText}`);await h(),o({title:"Imagen eliminada",description:"La imagen ha sido eliminada exitosamente."})}catch(s){console.error("Error deleting image:",s),o({title:"Error",description:"Error al eliminar la imagen.",variant:"destructive"})}},J=async a=>{try{const s=await fetch(`/api/spaces/documents/${a}`,{method:"DELETE"});if(!s.ok)throw new Error(`Error ${s.status}: ${s.statusText}`);await x(),o({title:"Documento eliminado",description:"El documento ha sido eliminado exitosamente."})}catch(s){console.error("Error deleting document:",s),o({title:"Error",description:"Error al eliminar el documento.",variant:"destructive"})}};return!t&&g?e.jsx("div",{className:"text-center p-8 text-gray-500",children:"Primero crea el espacio para poder agregar multimedia"}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs($,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-5 h-5"}),"Imágenes del Espacio"]})}),e.jsxs(k,{className:"space-y-4",children:[j.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(a=>e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:O(a.imageUrl),alt:a.caption||"Imagen del espacio",className:"w-full h-48 object-contain bg-gray-100 rounded-lg"}),a.isPrimary&&e.jsxs(V,{className:"absolute top-2 left-2 bg-yellow-500",children:[e.jsx(Z,{className:"w-3 h-3 mr-1"}),"Principal"]}),e.jsx(P,{size:"sm",variant:"destructive",className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>B(a.id),children:e.jsx(U,{className:"w-4 h-4"})}),a.caption&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:a.caption})]},a.id))}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"imageCaption",children:"Descripción de la imagen"}),e.jsx(F,{id:"imageCaption",value:y,onChange:a=>E(a.target.value),placeholder:"Ej: Vista principal del espacio"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:"isPrimary",checked:v,onCheckedChange:a=>N(a)}),e.jsx(u,{htmlFor:"isPrimary",children:"Imagen principal"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:z,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",disabled:m}),m&&e.jsx("div",{className:"text-sm text-blue-600",children:"Subiendo imagen..."})]})]})]})]}),e.jsxs($,{children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5"}),"Documentos del Espacio"]})}),e.jsxs(k,{className:"space-y-4",children:[w.length>0&&e.jsx("div",{className:"space-y-3",children:w.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:a.title}),a.description&&e.jsx("p",{className:"text-sm text-gray-600",children:a.description}),a.fileSize&&e.jsxs("p",{className:"text-xs text-gray-400",children:[Math.round(a.fileSize/1024)," KB"]})]}),e.jsx(P,{size:"sm",variant:"destructive",onClick:()=>J(a.id),children:e.jsx(U,{className:"w-4 h-4"})})]},a.id))}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"documentTitle",children:"Título del documento *"}),e.jsx(F,{id:"documentTitle",value:c,onChange:a=>b(a.target.value),placeholder:"Ej: Reglamento del espacio",required:!0})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"documentDescription",children:"Descripción"}),e.jsx(Q,{id:"documentDescription",value:D,onChange:a=>T(a.target.value),placeholder:"Descripción opcional del documento",rows:1})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:R,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-green-50 file:text-green-700 hover:file:bg-green-100",disabled:m||!c}),!c&&e.jsx("p",{className:"text-sm text-red-500",children:"Primero ingresa un título para el documento"}),m&&e.jsx("div",{className:"text-sm text-green-600",children:"Subiendo documento..."})]})]})]})]})]})}export{X as S};
