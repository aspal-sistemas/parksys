import{a2 as f,l as T,ae as G,u as q,ag as N,j as e,f as o,i as h,g as u,h as g,aR as C,N as S,O as I,B as p,bZ as b,o as K,b as F,bn as D,k as Q,aX as y,L,A as $}from"./index-D5qLf1ib.js";const U=({concessionId:n})=>{const[a,r]=f.useState(null),[x,d]=f.useState(""),[m,l]=f.useState(!1),{toast:c}=T(),j=G(),{data:v=[],isLoading:z}=q({queryKey:[`/api/active-concessions/${n}/images`],queryFn:async()=>{const s=await fetch(`/api/active-concessions/${n}/images`);if(!s.ok)throw new Error("Error al cargar imágenes");return s.json()}}),P=N({mutationFn:async({file:s,caption:i})=>{l(!0);const t=new FormData;t.append("image",s),t.append("caption",i);const M=localStorage.getItem("token")||"direct-token-1750522117022",k=await fetch(`/api/active-concessions/${n}/images`,{method:"POST",headers:{Authorization:`Bearer ${M}`},body:t});if(!k.ok)throw new Error("Error al subir imagen");return k.json()},onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/active-concessions/${n}/images`]}),r(null),d(""),l(!1),c({title:"Imagen subida",description:"La imagen se ha subido correctamente"})},onError:s=>{l(!1),c({title:"Error al subir imagen",description:s instanceof Error?s.message:"Error desconocido",variant:"destructive"})}}),w=N({mutationFn:async s=>{const i=localStorage.getItem("token")||"direct-token-1750522117022";if(!(await fetch(`/api/concession-images/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).ok)throw new Error("Error al eliminar imagen")},onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/active-concessions/${n}/images`]}),c({title:"Imagen eliminada",description:"La imagen se ha eliminado correctamente"})},onError:s=>{c({title:"Error al eliminar imagen",description:s instanceof Error?s.message:"Error desconocido",variant:"destructive"})}}),E=N({mutationFn:async s=>{const i=localStorage.getItem("token")||"direct-token-1750522117022";if(!(await fetch(`/api/concession-images/${s}/set-primary`,{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).ok)throw new Error("Error al establecer imagen principal")},onSuccess:()=>{j.invalidateQueries({queryKey:[`/api/active-concessions/${n}/images`]}),c({title:"Imagen principal actualizada",description:"La imagen principal se ha actualizado correctamente"})},onError:s=>{c({title:"Error al actualizar imagen principal",description:s instanceof Error?s.message:"Error desconocido",variant:"destructive"})}}),B=s=>{var t;const i=(t=s.target.files)==null?void 0:t[0];if(i){if(i.size>5*1024*1024){c({title:"Archivo muy grande",description:"El archivo debe ser menor a 5MB",variant:"destructive"});return}r(i)}},A=()=>{a&&P.mutate({file:a,caption:x})};return z?e.jsx(o,{children:e.jsx(h,{className:"flex justify-center items-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500"})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Subir Nueva Imagen"]})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(S,{htmlFor:"imageFile",children:"Seleccionar imagen (máx. 5MB)"}),e.jsx(I,{id:"imageFile",type:"file",accept:"image/*",onChange:B,className:"mt-1"})]}),a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Archivo seleccionado: ",a.name," (",Math.round(a.size/1024)," KB)"]}),e.jsxs("div",{children:[e.jsx(S,{htmlFor:"caption",children:"Descripción (opcional)"}),e.jsx(I,{id:"caption",value:x,onChange:s=>d(s.target.value),placeholder:"Descripción de la imagen...",className:"mt-1"})]}),e.jsx(p,{onClick:A,disabled:m,className:"w-full",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Subir Imagen"]})})]})]})]}),e.jsxs(o,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(b,{className:"h-5 w-5"}),"Galería de Imágenes (",v.length,")"]})}),e.jsx(h,{children:v.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-4 opacity-30"}),e.jsx("p",{children:"No hay imágenes subidas"}),e.jsx("p",{className:"text-sm",children:"Sube la primera imagen para comenzar"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:v.map(s=>e.jsxs("div",{className:"relative border rounded-lg hover:shadow-lg transition-shadow bg-white",children:[e.jsx("div",{className:"p-4",children:e.jsx("img",{src:s.image_url,alt:s.caption||"Imagen de concesión",className:"w-full h-auto rounded"})}),s.is_primary&&e.jsxs(K,{className:"absolute top-2 left-2 bg-yellow-500 hover:bg-yellow-600",children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Principal"]}),e.jsxs("div",{className:"p-3",children:[s.caption&&e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.caption}),e.jsxs("div",{className:"flex gap-2",children:[!s.is_primary&&e.jsxs(p,{size:"sm",variant:"outline",onClick:()=>E.mutate(s.id),disabled:E.isPending,children:[e.jsx(F,{className:"h-3 w-3 mr-1"}),"Hacer principal"]}),e.jsxs(p,{size:"sm",variant:"destructive",onClick:()=>w.mutate(s.id),disabled:w.isPending,children:[e.jsx(D,{className:"h-3 w-3 mr-1"}),"Eliminar"]})]})]})]},s.id))})})]})]})},O=()=>{var d,m;const{id:n}=Q(),a=parseInt(n||"0"),{data:r,isLoading:x}=q({queryKey:[`/api/active-concessions/${a}`],queryFn:async()=>{const l=await fetch(`/api/active-concessions/${a}`);if(!l.ok)throw new Error("Error al cargar concesión");return l.json()},enabled:!!a});return x?e.jsx(y,{title:"Gestión de Imágenes - Concesión",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})}):r?e.jsx(y,{title:"Gestión de Imágenes - Concesión",children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(o,{children:e.jsx(u,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(b,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{children:[e.jsx(g,{className:"text-2xl",children:"Gestión de Imágenes"}),e.jsxs("p",{className:"text-gray-600 mt-1",children:[((d=r.data)==null?void 0:d.name)||r.name," - ",((m=r.data)==null?void 0:m.description)||r.description]})]})]}),e.jsx(L,{href:"/admin/concessions/active",children:e.jsxs(p,{variant:"outline",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Volver al listado"]})})]})})}),e.jsx(U,{concessionId:a}),e.jsxs(o,{children:[e.jsx(u,{children:e.jsx(g,{children:"Información Importante"})}),e.jsxs(h,{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{children:"Las imágenes subidas aquí aparecerán automáticamente en las landing pages de parques y en las páginas públicas de concesiones."})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{children:"La primera imagen subida se establecerá automáticamente como imagen principal."})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{children:'Puedes cambiar la imagen principal en cualquier momento haciendo clic en "Hacer principal".'})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-1.5 flex-shrink-0"}),e.jsx("p",{children:"Formatos soportados: JPG, PNG, WebP. Tamaño máximo: 5MB por imagen."})]})]})]})]})}):e.jsx(y,{title:"Concesión no encontrada",children:e.jsx(o,{children:e.jsxs(h,{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"La concesión solicitada no existe"}),e.jsx(L,{href:"/admin/concessions/active",children:e.jsxs(p,{children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Volver a Concesiones Activas"]})})]})})})};export{O as default};
