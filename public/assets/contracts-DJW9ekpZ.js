import{a2 as h,l as ce,ae as de,u as j,s as m,ag as oe,j as e,aX as Q,f as o,i as x,F as p,B as g,bh as xe,O as v,Q as N,V as y,W as f,Y as b,_ as n,ah as R,as as me,n as G,o as D,au as he,bq as je,w as Y,y as H,z as J,I as W,N as t,$ as A,b1 as ue,b2 as pe,b3 as F,b4 as T,bo as U}from"./index-D5qLf1ib.js";const ve=()=>{const[w,Z]=h.useState(""),[I,ee]=h.useState("all"),[a,se]=h.useState(null),[ae,C]=h.useState(!1),[te,O]=h.useState(!1),[r,B]=h.useState({sponsorId:0,packageId:0,campaignId:0,contractNumber:"",title:"",description:"",startDate:"",endDate:"",totalAmount:0,paymentSchedule:"monthly",status:"draft",termsConditions:"",deliverables:"",performanceMetrics:"",contactPerson:"",contactEmail:"",contactPhone:""}),{toast:K}=ce(),le=de(),{data:P,isLoading:ne}=j({queryKey:["sponsorship-contracts"],queryFn:()=>m("/api/sponsorship-contracts")}),{data:q}=j({queryKey:["sponsors"],queryFn:()=>m("/api/sponsors")}),{data:M}=j({queryKey:["sponsorship-packages"],queryFn:()=>m("/api/sponsorship-packages")}),{data:V}=j({queryKey:["sponsorship-campaigns"],queryFn:()=>m("/api/sponsorship-campaigns")}),{data:E}=j({queryKey:["contract-payments",a==null?void 0:a.id],queryFn:()=>m(`/api/sponsorship-contracts/${a==null?void 0:a.id}/payments`),enabled:!!(a!=null&&a.id)}),{data:k}=j({queryKey:["contract-events",a==null?void 0:a.id],queryFn:()=>m(`/api/sponsorship-contracts/${a==null?void 0:a.id}/events`),enabled:!!(a!=null&&a.id)}),L=oe({mutationFn:s=>m("/api/sponsorship-contracts",{method:"POST",body:JSON.stringify(s)}),onSuccess:()=>{le.invalidateQueries({queryKey:["sponsorship-contracts"]}),C(!1),K({title:"Contrato creado",description:"El contrato ha sido creado exitosamente."}),B({sponsorId:0,packageId:0,campaignId:0,contractNumber:"",title:"",description:"",startDate:"",endDate:"",totalAmount:0,paymentSchedule:"monthly",status:"draft",termsConditions:"",deliverables:"",performanceMetrics:"",contactPerson:"",contactEmail:"",contactPhone:""})},onError:s=>{K({title:"Error",description:"No se pudo crear el contrato. Por favor, intente nuevamente.",variant:"destructive"})}}),l=P==null?void 0:P.filter(s=>{var _;const c=s.title.toLowerCase().includes(w.toLowerCase())||((_=s.sponsor_name)==null?void 0:_.toLowerCase().includes(w.toLowerCase()))||s.contract_number.toLowerCase().includes(w.toLowerCase()),u=I==="all"||s.status===I;return c&&u}),z=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"draft":return"bg-yellow-100 text-yellow-800";case"pending":return"bg-orange-100 text-orange-800";case"expired":return"bg-red-100 text-red-800";case"cancelled":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}},X=s=>{switch(s){case"active":return e.jsx(R,{className:"h-4 w-4"});case"draft":return e.jsx(p,{className:"h-4 w-4"});case"pending":return e.jsx(G,{className:"h-4 w-4"});case"expired":return e.jsx(U,{className:"h-4 w-4"});case"cancelled":return e.jsx(U,{className:"h-4 w-4"});default:return e.jsx(p,{className:"h-4 w-4"})}},S=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),d=s=>new Date(s).toLocaleDateString("es-MX",{year:"numeric",month:"short",day:"numeric"}),re=s=>{se(s),O(!0)},ie=()=>{const s=`CTR-${new Date().getFullYear()}-${String(Math.floor(Math.random()*1e3)).padStart(3,"0")}`,c={...r,contractNumber:s};L.mutate(c)},i=(s,c)=>{B(u=>({...u,[s]:c}))};return ne?e.jsx(Q,{children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#00a587] mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando contratos..."})]})})}):e.jsx(Q,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx(o,{className:"bg-gray-50",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Contratos de Patrocinio"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestión de contratos, pagos y compromisos"})]}),e.jsxs(g,{onClick:()=>C(!0),className:"bg-[#00a587] hover:bg-[#067f5f] text-white",children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Nuevo Contrato"]})]})})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(v,{placeholder:"Buscar por título, patrocinador o número de contrato...",value:w,onChange:s=>Z(s.target.value),className:"max-w-md"})}),e.jsxs(N,{value:I,onValueChange:ee,children:[e.jsx(y,{className:"w-48",children:e.jsx(f,{placeholder:"Filtrar por estado"})}),e.jsxs(b,{children:[e.jsx(n,{value:"all",children:"Todos los estados"}),e.jsx(n,{value:"active",children:"Activos"}),e.jsx(n,{value:"draft",children:"Borradores"}),e.jsx(n,{value:"pending",children:"Pendientes"}),e.jsx(n,{value:"expired",children:"Expirados"}),e.jsx(n,{value:"cancelled",children:"Cancelados"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Contratos Activos"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:(l==null?void 0:l.filter(s=>s.status==="active").length)||0})]}),e.jsx(R,{className:"h-8 w-8 text-green-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Borradores"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:(l==null?void 0:l.filter(s=>s.status==="draft").length)||0})]}),e.jsx(p,{className:"h-8 w-8 text-yellow-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Valor Total"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:S((l==null?void 0:l.reduce((s,c)=>s+c.total_amount,0))||0)})]}),e.jsx(me,{className:"h-8 w-8 text-blue-500"})]})})}),e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Próximos a Vencer"}),e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:(l==null?void 0:l.filter(s=>{const c=new Date(s.end_date),u=new Date,_=c.getTime()-u.getTime(),$=Math.ceil(_/(1e3*60*60*24));return $<=30&&$>0}).length)||0})]}),e.jsx(G,{className:"h-8 w-8 text-orange-500"})]})})})]}),e.jsx("div",{className:"grid gap-4",children:l==null?void 0:l.map(s=>e.jsx(o,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(x,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.title}),e.jsxs(D,{className:z(s.status),children:[X(s.status),e.jsx("span",{className:"ml-1 capitalize",children:s.status})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.description}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-500",children:[e.jsxs("span",{children:["#",s.contract_number]}),e.jsxs("span",{children:["🏢 ",s.sponsor_name]}),e.jsxs("span",{children:["📦 ",s.package_name]}),e.jsxs("span",{children:["🎯 ",s.campaign_name]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-[#00a587]",children:S(s.total_amount)}),e.jsx("p",{className:"text-sm text-gray-500 capitalize",children:s.payment_schedule})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:["📅 ",d(s.start_date)," - ",d(s.end_date)]}),s.signed_date&&e.jsxs("span",{children:["✅ Firmado: ",d(s.signed_date)]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>re(s),children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"Ver Detalles"]}),e.jsxs(g,{variant:"outline",size:"sm",className:"text-blue-600 hover:text-blue-700",children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"Editar"]})]})]})]})},s.id))}),e.jsx(Y,{open:ae,onOpenChange:C,children:e.jsxs(H,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(W,{children:"Crear Nuevo Contrato"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Patrocinador"}),e.jsxs(N,{value:String(r.sponsorId),onValueChange:s=>i("sponsorId",parseInt(s)),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Seleccionar patrocinador"})}),e.jsx(b,{children:q==null?void 0:q.map(s=>e.jsx(n,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Paquete"}),e.jsxs(N,{value:String(r.packageId),onValueChange:s=>i("packageId",parseInt(s)),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Seleccionar paquete"})}),e.jsx(b,{children:M==null?void 0:M.map(s=>e.jsx(n,{value:String(s.id),children:s.name},s.id))})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Campaña"}),e.jsxs(N,{value:String(r.campaignId),onValueChange:s=>i("campaignId",parseInt(s)),children:[e.jsx(y,{children:e.jsx(f,{placeholder:"Seleccionar campaña"})}),e.jsx(b,{children:V==null?void 0:V.map(s=>e.jsx(n,{value:String(s.id),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Título del Contrato"}),e.jsx(v,{value:r.title,onChange:s=>i("title",s.target.value),placeholder:"Título del contrato"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Descripción"}),e.jsx(A,{value:r.description,onChange:s=>i("description",s.target.value),placeholder:"Descripción del contrato",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Fecha de Inicio"}),e.jsx(v,{type:"date",value:r.startDate,onChange:s=>i("startDate",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Fecha de Fin"}),e.jsx(v,{type:"date",value:r.endDate,onChange:s=>i("endDate",s.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{children:"Monto Total"}),e.jsx(v,{type:"number",value:r.totalAmount,onChange:s=>i("totalAmount",parseFloat(s.target.value)),placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Frecuencia de Pago"}),e.jsxs(N,{value:r.paymentSchedule,onValueChange:s=>i("paymentSchedule",s),children:[e.jsx(y,{children:e.jsx(f,{})}),e.jsxs(b,{children:[e.jsx(n,{value:"monthly",children:"Mensual"}),e.jsx(n,{value:"quarterly",children:"Trimestral"}),e.jsx(n,{value:"biannual",children:"Semestral"}),e.jsx(n,{value:"annual",children:"Anual"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Términos y Condiciones"}),e.jsx(A,{value:r.termsConditions,onChange:s=>i("termsConditions",s.target.value),placeholder:"Términos y condiciones del contrato",rows:3})]}),e.jsxs("div",{children:[e.jsx(t,{children:"Entregables"}),e.jsx(A,{value:r.deliverables,onChange:s=>i("deliverables",s.target.value),placeholder:"Descripción de los entregables",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(g,{variant:"outline",onClick:()=>C(!1),children:"Cancelar"}),e.jsx(g,{onClick:ie,className:"bg-[#00a587] hover:bg-[#067f5f]",disabled:L.isPending,children:L.isPending?"Creando...":"Crear Contrato"})]})]})]})}),e.jsx(Y,{open:te,onOpenChange:O,children:e.jsxs(H,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(J,{children:e.jsx(W,{children:"Detalles del Contrato"})}),a&&e.jsxs(ue,{defaultValue:"general",className:"w-full",children:[e.jsxs(pe,{className:"grid w-full grid-cols-4",children:[e.jsx(F,{value:"general",children:"General"}),e.jsx(F,{value:"payments",children:"Pagos"}),e.jsx(F,{value:"events",children:"Eventos"}),e.jsx(F,{value:"documents",children:"Documentos"})]}),e.jsxs(T,{value:"general",className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Número de Contrato"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.contract_number})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Estado"}),e.jsxs(D,{className:z(a.status),children:[X(a.status),e.jsx("span",{className:"ml-1 capitalize",children:a.status})]})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Patrocinador"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.sponsor_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Paquete"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.package_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Campaña"}),e.jsx("p",{className:"text-sm text-gray-600",children:a.campaign_name})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Valor Total"}),e.jsx("p",{className:"text-sm text-gray-600",children:S(a.total_amount)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Fecha de Inicio"}),e.jsx("p",{className:"text-sm text-gray-600",children:d(a.start_date)})]}),e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Fecha de Fin"}),e.jsx("p",{className:"text-sm text-gray-600",children:d(a.end_date)})]})]}),a.terms_conditions&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Términos y Condiciones"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.terms_conditions})]}),a.deliverables&&e.jsxs("div",{children:[e.jsx(t,{className:"text-sm font-medium",children:"Entregables"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.deliverables})]})]}),e.jsx(T,{value:"payments",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:E==null?void 0:E.map(s=>e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Pago #",s.payment_number]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Vencimiento: ",d(s.due_date),s.payment_date&&e.jsxs("span",{className:"ml-2 text-green-600",children:["(Pagado: ",d(s.payment_date),")"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-bold",children:S(s.amount)}),e.jsx(D,{className:s.status==="paid"?"bg-green-100 text-green-800":s.status==="overdue"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800",children:s.status})]})]})})},s.id))})}),e.jsx(T,{value:"events",className:"space-y-4",children:e.jsx("div",{className:"space-y-3",children:k==null?void 0:k.map(s=>e.jsx(o,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.event_title}),e.jsx("p",{className:"text-sm text-gray-600",children:s.description}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-500",children:[e.jsxs("span",{children:["📅 ",d(s.event_date)]}),e.jsxs("span",{children:["🏛️ ",s.park_name]}),e.jsxs("span",{children:["👥 ",s.expected_attendance," personas"]})]})]}),e.jsx(D,{className:s.status==="completed"?"bg-green-100 text-green-800":s.status==="cancelled"?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800",children:s.status})]})})},s.id))})}),e.jsx(T,{value:"documents",className:"space-y-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(p,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Funcionalidad de documentos en desarrollo"})]})})]})]})})]})})};export{ve as default};
