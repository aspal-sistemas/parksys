import{ad as r,k as M,az as z,l as B,ae as K,u as I,af as Q,a2 as U,ag as $,j as e,aX as D,L as _,B as T,A as G,ai as X,f as m,g as h,h as p,aQ as W,i as u,aj as i,ak as c,al as o,am as t,O as x,an as l,Q as C,V as N,W as b,Y as f,_ as j,$ as P,U as J,m as Y,as as Z,P as ee,aW as se,aB as ne,bG as ae,ap as re,aq as w}from"./index-D5qLf1ib.js";const ie=r.object({name:r.string().min(1,"El nombre es requerido"),description:r.string().min(1,"La descripción es requerida"),concessionTypeId:r.number().min(1,"Selecciona un tipo de concesión"),concessionaireId:r.number().min(1,"Selecciona un concesionario"),parkId:r.number().min(1,"Selecciona un parque"),specificLocation:r.string().min(1,"La ubicación específica es requerida"),coordinates:r.string().optional(),area:r.number().min(0,"El área debe ser mayor a 0").optional(),startDate:r.string().min(1,"La fecha de inicio es requerida"),endDate:r.string().min(1,"La fecha de fin es requerida"),operatingHours:r.string().optional(),operatingDays:r.string().optional(),status:r.string().default("activa"),priority:r.string().default("normal"),specificTerms:r.string().optional(),specialRequirements:r.string().optional(),contractNumber:r.string().optional(),monthlyPayment:r.number().min(0,"El pago mensual debe ser mayor a 0").optional(),revenuePercentage:r.number().min(0).max(100,"El porcentaje no puede ser mayor a 100").optional(),deposit:r.number().min(0,"El depósito debe ser mayor a 0").optional(),emergencyContact:r.string().optional(),emergencyPhone:r.string().optional(),notes:r.string().optional(),internalNotes:r.string().optional()});function te(){const{id:S}=M(),[,E]=z(),{toast:F}=B(),A=K(),d=!!S,{data:g}=I({queryKey:["/api/concession-types-active"]}),{data:L}=I({queryKey:["/api/concessionaires"]}),{data:v}=I({queryKey:["/api/parks?simple=true"]}),{data:y,isLoading:O}=I({queryKey:[`/api/active-concessions/${S}`],enabled:d,staleTime:0}),a=Q({resolver:re(ie),defaultValues:{name:"",description:"",concessionTypeId:0,concessionaireId:0,parkId:0,specificLocation:"",coordinates:"",area:0,startDate:"",endDate:"",operatingHours:"",operatingDays:"",status:"activa",priority:"normal",specificTerms:"",specialRequirements:"",contractNumber:"",monthlyPayment:0,revenuePercentage:0,deposit:0,emergencyContact:"",emergencyPhone:"",notes:"",internalNotes:""}});U.useEffect(()=>{if(d&&(y!=null&&y.data)){const s=y.data;console.log("🔍 Datos JSON parseados:",s),a.reset({name:s.name||"",description:s.description||"",concessionTypeId:s.concession_type_id||0,concessionaireId:s.concessionaire_id||0,parkId:s.park_id||0,specificLocation:s.specific_location||"",coordinates:s.coordinates||"",area:parseFloat(s.area)||0,startDate:s.start_date?s.start_date.split("T")[0]:"",endDate:s.end_date?s.end_date.split("T")[0]:"",operatingHours:s.operating_hours||"",operatingDays:s.operating_days||"",status:s.status||"activa",priority:s.priority||"normal",specificTerms:s.specific_terms||"",specialRequirements:s.special_requirements||"",contractNumber:s.contract_number||"",monthlyPayment:parseFloat(s.monthly_payment)||0,revenuePercentage:parseFloat(s.revenue_percentage)||0,deposit:parseFloat(s.deposit)||0,emergencyContact:s.emergency_contact||"",emergencyPhone:s.emergency_phone||"",notes:s.notes||"",internalNotes:s.internal_notes||""})}},[y,a,d]);const q=$({mutationFn:s=>d?w(`/api/active-concessions/${S}`,{method:"PUT",data:s}):w("/api/active-concessions",{method:"POST",data:s}),onSuccess:s=>{var n;F({title:d?"Concesión actualizada":"Concesión creada",description:`La concesión ${d?"se ha actualizado":"se ha creado"} exitosamente.`}),A.invalidateQueries({queryKey:["/api/active-concessions"]}),!d&&((n=s==null?void 0:s.data)!=null&&n.id)?E(`/admin/concessions/active/${s.data.id}/images`):E("/admin/concessions/active")},onError:s=>{F({title:"Error",description:s.message||"Ocurrió un error al guardar la concesión.",variant:"destructive"})}}),R=s=>{const n={name:s.name,description:s.description,concessionTypeId:s.concessionTypeId,concessionaireId:s.concessionaireId,parkId:s.parkId,specificLocation:s.specificLocation,coordinates:s.coordinates,area:s.area,startDate:s.startDate,endDate:s.endDate,status:s.status,priority:s.priority,operatingHours:s.operatingHours,operatingDays:s.operatingDays,specificTerms:s.specificTerms,specialRequirements:s.specialRequirements,contractNumber:s.contractNumber,monthlyPayment:s.monthlyPayment,revenuePercentage:s.revenuePercentage,deposit:s.deposit,emergencyContact:s.emergencyContact,emergencyPhone:s.emergencyPhone,notes:s.notes,internalNotes:s.internalNotes};q.mutate(n)};if(d&&O)return e.jsx(D,{title:d?"Editar Concesión Activa":"Nueva Concesión Activa",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})});const V=(g==null?void 0:g.data)||g||[],k=L||[],H=(v==null?void 0:v.data)||v||[];return!g||!L||!v?e.jsx(D,{title:d?"Editar Concesión Activa":"Nueva Concesión Activa",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})}):e.jsx(D,{title:d?"Editar Concesión Activa":"Nueva Concesión Activa",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(_,{href:"/admin/concessions/active",children:e.jsxs(T,{variant:"outline",size:"sm",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:d?"Editar Concesión Activa":"Nueva Concesión Activa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:d?"Modifica los datos de la concesión":"Crea una nueva concesión operativa"})]})]}),e.jsx(X,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(R),className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-green-600"}),"Información Básica"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:a.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Nombre de la Concesión *"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. Cafetería Central",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"concessionTypeId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Tipo de Concesión *"}),e.jsx(t,{children:e.jsxs(C,{value:s.value.toString(),onValueChange:n=>s.onChange(parseInt(n)),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un tipo"})}),e.jsx(f,{children:V.map(n=>e.jsx(j,{value:n.id.toString(),children:n.name},n.id))})]})}),e.jsx(l,{})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(i,{control:a.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Descripción *"}),e.jsx(t,{children:e.jsx(P,{placeholder:"Describe la concesión, sus servicios y características principales...",rows:3,...s})}),e.jsx(l,{})]})})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-blue-600"}),"Concesionario y Ubicación"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:a.control,name:"concessionaireId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Concesionario *"}),e.jsx(t,{children:e.jsxs(C,{value:s.value.toString(),onValueChange:n=>s.onChange(parseInt(n)),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un concesionario"})}),e.jsx(f,{children:k.map(n=>e.jsxs(j,{value:n.id.toString(),children:[n.fullName||n.name||n.username," (",n.email,")"]},n.id))})]})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"parkId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Parque *"}),e.jsx(t,{children:e.jsxs(C,{value:s.value.toString(),onValueChange:n=>s.onChange(parseInt(n)),children:[e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un parque"})}),e.jsx(f,{children:H.map(n=>e.jsx(j,{value:n.id.toString(),children:n.name},n.id))})]})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"specificLocation",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Ubicación Específica *"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. Entrada principal, Zona deportiva",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"area",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Área (m²)"}),e.jsx(t,{children:e.jsx(x,{type:"number",placeholder:"0",...s,onChange:n=>s.onChange(parseFloat(n.target.value)||0)})}),e.jsx(l,{})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(i,{control:a.control,name:"coordinates",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Coordenadas GPS (opcional)"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. 20.6767, -103.3475",...s})}),e.jsx(l,{})]})})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-purple-600"}),"Vigencia y Operación"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:a.control,name:"startDate",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Fecha de Inicio *"}),e.jsx(t,{children:e.jsx(x,{type:"date",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"endDate",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Fecha de Fin *"}),e.jsx(t,{children:e.jsx(x,{type:"date",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"operatingHours",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Horarios de Operación"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. 8:00-18:00",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"operatingDays",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Días de Operación"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. Lunes a Domingo",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"status",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Estado"}),e.jsx(t,{children:e.jsxs(C,{value:s.value,onValueChange:s.onChange,children:[e.jsx(N,{children:e.jsx(b,{})}),e.jsxs(f,{children:[e.jsx(j,{value:"activa",children:"Activa"}),e.jsx(j,{value:"suspendida",children:"Suspendida"}),e.jsx(j,{value:"vencida",children:"Vencida"}),e.jsx(j,{value:"renovacion",children:"En Renovación"})]})]})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"priority",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Prioridad"}),e.jsx(t,{children:e.jsxs(C,{value:s.value,onValueChange:s.onChange,children:[e.jsx(N,{children:e.jsx(b,{})}),e.jsxs(f,{children:[e.jsx(j,{value:"alta",children:"Alta"}),e.jsx(j,{value:"normal",children:"Normal"}),e.jsx(j,{value:"baja",children:"Baja"})]})]})}),e.jsx(l,{})]})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-green-600"}),"Información Financiera"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(i,{control:a.control,name:"monthlyPayment",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Pago Mensual (MXN)"}),e.jsx(t,{children:e.jsx(x,{type:"number",step:"0.01",placeholder:"0.00",...s,onChange:n=>s.onChange(parseFloat(n.target.value)||0)})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"revenuePercentage",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Porcentaje de Ingresos (%)"}),e.jsx(t,{children:e.jsx(x,{type:"number",step:"0.01",placeholder:"0.00",...s,onChange:n=>s.onChange(parseFloat(n.target.value)||0)})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"deposit",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Depósito en Garantía (MXN)"}),e.jsx(t,{children:e.jsx(x,{type:"number",step:"0.01",placeholder:"0.00",...s,onChange:n=>s.onChange(parseFloat(n.target.value)||0)})}),e.jsx(l,{})]})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(i,{control:a.control,name:"contractNumber",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Número de Contrato"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. CON-2025-001",...s})}),e.jsx(l,{})]})})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-red-600"}),"Contacto de Emergencia"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:a.control,name:"emergencyContact",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Nombre del Contacto"}),e.jsx(t,{children:e.jsx(x,{placeholder:"Nombre completo",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"emergencyPhone",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Teléfono de Emergencia"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. +52 33 1234 5678",...s})}),e.jsx(l,{})]})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-yellow-600"}),"Términos y Observaciones"]})}),e.jsxs(u,{className:"space-y-6",children:[e.jsx(i,{control:a.control,name:"specificTerms",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Términos Específicos"}),e.jsx(t,{children:e.jsx(P,{placeholder:"Condiciones particulares de la concesión...",rows:3,...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"specialRequirements",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Requisitos Especiales"}),e.jsx(t,{children:e.jsx(P,{placeholder:"Requisitos específicos que debe cumplir la concesión...",rows:3,...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"notes",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Notas Públicas"}),e.jsx(t,{children:e.jsx(P,{placeholder:"Observaciones generales...",rows:3,...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:a.control,name:"internalNotes",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Notas Internas (Solo Administradores)"}),e.jsx(t,{children:e.jsx(P,{placeholder:"Observaciones internas del sistema...",rows:3,...s})}),e.jsx(l,{})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t",children:[e.jsx(_,{href:"/admin/concessions/active",children:e.jsx(T,{variant:"outline",children:"Cancelar"})}),e.jsx(T,{type:"submit",disabled:q.isPending,className:"bg-green-600 hover:bg-green-700",children:q.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),d?"Actualizar Concesión":"Crear Concesión"]})})]})]})})]})})}export{te as default};
