import{a5 as a,d as z,am as M,e as K,a6 as B,u as I,a7 as U,Y as $,a8 as G,j as e,aI as q,L,B as S,A as J,aa as Q,C as m,a as h,b as p,ay as X,c as u,ab as i,ac as c,ad as o,ae as t,I as x,af as l,z as f,H as C,J as N,K as b,N as j,O as E,U as Y,h as Z,al as W,P as ee,aJ as se,cA as ne,bz as re,ah as ae,ai as _}from"./index-Dzu3mJf5.js";const ie=a.object({name:a.string().min(1,"El nombre es requerido"),description:a.string().min(1,"La descripción es requerida"),concessionTypeId:a.number().min(1,"Selecciona un tipo de concesión"),concessionaireId:a.number().min(1,"Selecciona un concesionario"),parkId:a.number().min(1,"Selecciona un parque"),specificLocation:a.string().min(1,"La ubicación específica es requerida"),coordinates:a.string().optional(),area:a.number().min(0,"El área debe ser mayor a 0").optional(),startDate:a.string().min(1,"La fecha de inicio es requerida"),endDate:a.string().min(1,"La fecha de fin es requerida"),operatingHours:a.string().optional(),operatingDays:a.string().optional(),status:a.string().default("activa"),priority:a.string().default("normal"),specificTerms:a.string().optional(),specialRequirements:a.string().optional(),contractNumber:a.string().optional(),monthlyPayment:a.number().min(0,"El pago mensual debe ser mayor a 0").optional(),revenuePercentage:a.number().min(0).max(100,"El porcentaje no puede ser mayor a 100").optional(),deposit:a.number().min(0,"El depósito debe ser mayor a 0").optional(),emergencyContact:a.string().optional(),emergencyPhone:a.string().optional(),notes:a.string().optional(),internalNotes:a.string().optional()});function te(){const{id:w}=z(),[,F]=M(),{toast:D}=K(),A=B(),d=!!w,{data:g}=I({queryKey:["/api/concession-types-active"],queryFn:async()=>{const s=await fetch("/api/concession-types-active");if(!s.ok)throw new Error("Error fetching concession types");return s.json()}}),{data:T}=I({queryKey:["/api/concessionaires"],queryFn:async()=>{const s=await fetch("/api/concessionaires");if(!s.ok)throw new Error("Error fetching concessionaires");return s.json()}}),{data:y}=I({queryKey:["/api/parks"],queryFn:async()=>{const s=await fetch("/api/parks");if(!s.ok)throw new Error("Error fetching parks");return s.json()}}),{data:v,isLoading:k}=I({queryKey:["active-concession-edit",w],queryFn:async()=>{const s=await fetch(`/api/active-concessions/${w}`);if(!s.ok)throw new Error("Error fetching concession data");return s.json()},enabled:d,staleTime:0}),r=U({resolver:ae(ie),defaultValues:{name:"",description:"",concessionTypeId:0,concessionaireId:0,parkId:0,specificLocation:"",coordinates:"",area:0,startDate:"",endDate:"",operatingHours:"",operatingDays:"",status:"activa",priority:"normal",specificTerms:"",specialRequirements:"",contractNumber:"",monthlyPayment:0,revenuePercentage:0,deposit:0,emergencyContact:"",emergencyPhone:"",notes:"",internalNotes:""}});$.useEffect(()=>{if(d&&(v!=null&&v.data)){const s=v.data;console.log("🔍 Datos JSON parseados:",s),r.reset({name:s.name||"",description:s.description||"",concessionTypeId:s.concession_type_id||0,concessionaireId:s.concessionaire_id||0,parkId:s.park_id||0,specificLocation:s.specific_location||"",coordinates:s.coordinates||"",area:parseFloat(s.area)||0,startDate:s.start_date?s.start_date.split("T")[0]:"",endDate:s.end_date?s.end_date.split("T")[0]:"",operatingHours:s.operating_hours||"",operatingDays:s.operating_days||"",status:s.status||"activa",priority:s.priority||"normal",specificTerms:s.specific_terms||"",specialRequirements:s.special_requirements||"",contractNumber:s.contract_number||"",monthlyPayment:parseFloat(s.monthly_payment)||0,revenuePercentage:parseFloat(s.revenue_percentage)||0,deposit:parseFloat(s.deposit)||0,emergencyContact:s.emergency_contact||"",emergencyPhone:s.emergency_phone||"",notes:s.notes||"",internalNotes:s.internal_notes||""})}},[v,r,d]);const P=G({mutationFn:s=>d?_(`/api/active-concessions/${w}`,{method:"PUT",data:s}):_("/api/active-concessions",{method:"POST",data:s}),onSuccess:s=>{var n;D({title:d?"Concesión actualizada":"Concesión creada",description:`La concesión ${d?"se ha actualizado":"se ha creado"} exitosamente.`}),A.invalidateQueries({queryKey:["/api/active-concessions"]}),!d&&((n=s==null?void 0:s.data)!=null&&n.id)?F(`/admin/concessions/active/${s.data.id}/images`):F("/admin/concessions/active")},onError:s=>{D({title:"Error",description:s.message||"Ocurrió un error al guardar la concesión.",variant:"destructive"})}}),O=s=>{const n={name:s.name,description:s.description,concessionTypeId:s.concessionTypeId,concessionaireId:s.concessionaireId,parkId:s.parkId,specificLocation:s.specificLocation,coordinates:s.coordinates,area:s.area,startDate:s.startDate,endDate:s.endDate,status:s.status,priority:s.priority,operatingHours:s.operatingHours,operatingDays:s.operatingDays,specificTerms:s.specificTerms,specialRequirements:s.specialRequirements,contractNumber:s.contractNumber,monthlyPayment:s.monthlyPayment,revenuePercentage:s.revenuePercentage,deposit:s.deposit,emergencyContact:s.emergencyContact,emergencyPhone:s.emergencyPhone,notes:s.notes,internalNotes:s.internalNotes};P.mutate(n)};if(d&&k)return e.jsx(q,{title:d?"Editar Concesión Activa":"Nueva Concesión Activa",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})});const R=(g==null?void 0:g.data)||g||[],V=T||[],H=(y==null?void 0:y.data)||y||[];return!g||!T||!y?e.jsx(q,{title:d?"Editar Concesión Activa":"Nueva Concesión Activa",children:e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-green-500"})})}):e.jsx(q,{title:d?"Editar Concesión Activa":"Nueva Concesión Activa",children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(L,{href:"/admin/concessions/active",children:e.jsxs(S,{variant:"outline",size:"sm",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Volver"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:d?"Editar Concesión Activa":"Nueva Concesión Activa"}),e.jsx("p",{className:"text-gray-600 mt-1",children:d?"Modifica los datos de la concesión":"Crea una nueva concesión operativa"})]})]}),e.jsx(Q,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(O),className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-green-600"}),"Información Básica"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:r.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Nombre de la Concesión *"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. Cafetería Central",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"concessionTypeId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Tipo de Concesión *"}),e.jsx(t,{children:e.jsxs(f,{value:s.value.toString(),onValueChange:n=>s.onChange(parseInt(n)),children:[e.jsx(C,{children:e.jsx(N,{placeholder:"Selecciona un tipo"})}),e.jsx(b,{children:R.map(n=>e.jsx(j,{value:n.id.toString(),children:n.name},n.id))})]})}),e.jsx(l,{})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(i,{control:r.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Descripción *"}),e.jsx(t,{children:e.jsx(E,{placeholder:"Describe la concesión, sus servicios y características principales...",rows:3,...s})}),e.jsx(l,{})]})})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-blue-600"}),"Concesionario y Ubicación"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:r.control,name:"concessionaireId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Concesionario *"}),e.jsx(t,{children:e.jsxs(f,{value:s.value.toString(),onValueChange:n=>s.onChange(parseInt(n)),children:[e.jsx(C,{children:e.jsx(N,{placeholder:"Selecciona un concesionario"})}),e.jsx(b,{children:V.map(n=>e.jsxs(j,{value:n.id.toString(),children:[n.fullName||n.name||n.username," (",n.email,")"]},n.id))})]})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"parkId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Parque *"}),e.jsx(t,{children:e.jsxs(f,{value:s.value.toString(),onValueChange:n=>s.onChange(parseInt(n)),children:[e.jsx(C,{children:e.jsx(N,{placeholder:"Selecciona un parque"})}),e.jsx(b,{children:H.map(n=>e.jsx(j,{value:n.id.toString(),children:n.name},n.id))})]})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"specificLocation",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Ubicación Específica *"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. Entrada principal, Zona deportiva",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"area",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Área (m²)"}),e.jsx(t,{children:e.jsx(x,{type:"number",placeholder:"0",...s,onChange:n=>s.onChange(parseFloat(n.target.value)||0)})}),e.jsx(l,{})]})}),e.jsx("div",{className:"md:col-span-2",children:e.jsx(i,{control:r.control,name:"coordinates",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Coordenadas GPS (opcional)"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. 20.6767, -103.3475",...s})}),e.jsx(l,{})]})})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-purple-600"}),"Vigencia y Operación"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:r.control,name:"startDate",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Fecha de Inicio *"}),e.jsx(t,{children:e.jsx(x,{type:"date",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"endDate",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Fecha de Fin *"}),e.jsx(t,{children:e.jsx(x,{type:"date",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"operatingHours",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Horarios de Operación"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. 8:00-18:00",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"operatingDays",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Días de Operación"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. Lunes a Domingo",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"status",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Estado"}),e.jsx(t,{children:e.jsxs(f,{value:s.value,onValueChange:s.onChange,children:[e.jsx(C,{children:e.jsx(N,{})}),e.jsxs(b,{children:[e.jsx(j,{value:"activa",children:"Activa"}),e.jsx(j,{value:"suspendida",children:"Suspendida"}),e.jsx(j,{value:"vencida",children:"Vencida"}),e.jsx(j,{value:"renovacion",children:"En Renovación"})]})]})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"priority",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Prioridad"}),e.jsx(t,{children:e.jsxs(f,{value:s.value,onValueChange:s.onChange,children:[e.jsx(C,{children:e.jsx(N,{})}),e.jsxs(b,{children:[e.jsx(j,{value:"alta",children:"Alta"}),e.jsx(j,{value:"normal",children:"Normal"}),e.jsx(j,{value:"baja",children:"Baja"})]})]})}),e.jsx(l,{})]})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-green-600"}),"Información Financiera"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(i,{control:r.control,name:"monthlyPayment",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Pago Mensual (MXN)"}),e.jsx(t,{children:e.jsx(x,{type:"number",step:"0.01",placeholder:"0.00",...s,onChange:n=>s.onChange(parseFloat(n.target.value)||0)})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"revenuePercentage",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Porcentaje de Ingresos (%)"}),e.jsx(t,{children:e.jsx(x,{type:"number",step:"0.01",placeholder:"0.00",...s,onChange:n=>s.onChange(parseFloat(n.target.value)||0)})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"deposit",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Depósito en Garantía (MXN)"}),e.jsx(t,{children:e.jsx(x,{type:"number",step:"0.01",placeholder:"0.00",...s,onChange:n=>s.onChange(parseFloat(n.target.value)||0)})}),e.jsx(l,{})]})}),e.jsx("div",{className:"md:col-span-3",children:e.jsx(i,{control:r.control,name:"contractNumber",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Número de Contrato"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. CON-2025-001",...s})}),e.jsx(l,{})]})})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-red-600"}),"Contacto de Emergencia"]})}),e.jsxs(u,{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(i,{control:r.control,name:"emergencyContact",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Nombre del Contacto"}),e.jsx(t,{children:e.jsx(x,{placeholder:"Nombre completo",...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"emergencyPhone",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Teléfono de Emergencia"}),e.jsx(t,{children:e.jsx(x,{placeholder:"ej. +52 33 1234 5678",...s})}),e.jsx(l,{})]})})]})]}),e.jsxs(m,{children:[e.jsx(h,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-yellow-600"}),"Términos y Observaciones"]})}),e.jsxs(u,{className:"space-y-6",children:[e.jsx(i,{control:r.control,name:"specificTerms",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Términos Específicos"}),e.jsx(t,{children:e.jsx(E,{placeholder:"Condiciones particulares de la concesión...",rows:3,...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"specialRequirements",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Requisitos Especiales"}),e.jsx(t,{children:e.jsx(E,{placeholder:"Requisitos específicos que debe cumplir la concesión...",rows:3,...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"notes",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Notas Públicas"}),e.jsx(t,{children:e.jsx(E,{placeholder:"Observaciones generales...",rows:3,...s})}),e.jsx(l,{})]})}),e.jsx(i,{control:r.control,name:"internalNotes",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Notas Internas (Solo Administradores)"}),e.jsx(t,{children:e.jsx(E,{placeholder:"Observaciones internas del sistema...",rows:3,...s})}),e.jsx(l,{})]})})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-6 border-t",children:[e.jsx(L,{href:"/admin/concessions/active",children:e.jsx(S,{variant:"outline",children:"Cancelar"})}),e.jsx(S,{type:"submit",disabled:P.isPending,className:"bg-green-600 hover:bg-green-700",children:P.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"h-4 w-4 mr-2 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),d?"Actualizar Concesión":"Crear Concesión"]})})]})]})})]})})}export{te as default};
