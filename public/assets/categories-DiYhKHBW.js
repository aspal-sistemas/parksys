import{c as pe,az as je,l as be,ae as ye,a2 as c,u as G,ag as v,j as e,aX as z,B as l,f as V,av as fe,bh as W,a4 as ve,O as q,X as Ne,g as Ce,h as we,ci as Z,bn as Y,ab as Se,i as Ee,bH as Le,bI as ke,bJ as _,bK as L,bL as ze,bM as k,w as F,y as T,z as I,I as A,J as P,N,$ as ee,aW as Fe,bC as Te,r as Ie,a1 as Ae}from"./index-D5qLf1ib.js";import{F as D}from"./folder-plus-DFwVL9m-.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=pe("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),qe=({mode:t,initialData:a,onClose:o,onSubmit:p,isSubmitting:j})=>{const[n,y]=c.useState((a==null?void 0:a.name)||""),[d,g]=c.useState((a==null?void 0:a.description)||""),[u,x]=c.useState((a==null?void 0:a.color)||"#3b82f6"),m=h=>{h.preventDefault(),p({id:a==null?void 0:a.id,name:n,description:d,color:u})};return e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Nombre de la categoría"}),e.jsx(q,{id:"name",value:n,onChange:h=>y(h.target.value),placeholder:"Ej: Daños, Mantenimiento, Seguridad",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Descripción"}),e.jsx(ee,{id:"description",value:d,onChange:h=>g(h.target.value),placeholder:"Describe el propósito de esta categoría...",rows:3})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"color",children:"Color"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"color",id:"color",value:u,onChange:h=>x(h.target.value),className:"w-12 h-8 rounded border"}),e.jsx("span",{className:"text-sm text-gray-500",children:u})]})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:o,children:"Cancelar"}),e.jsx(l,{type:"submit",disabled:j||!n.trim(),children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t==="create"?"Creando...":"Actualizando..."]}):t==="create"?"Crear categoría":"Actualizar categoría"})]})]})},Me=({mode:t,initialData:a,parentCategoryId:o,categories:p,onClose:j,onSubmit:n,isSubmitting:y})=>{var E;const[d,g]=c.useState((a==null?void 0:a.name)||""),[u,x]=c.useState((a==null?void 0:a.description)||""),[m,h]=c.useState(((E=a==null?void 0:a.categoryId)==null?void 0:E.toString())||(o==null?void 0:o.toString())||""),C=i=>{i.preventDefault(),n({id:a==null?void 0:a.id,name:d,description:u,categoryId:parseInt(m)})};return e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"category",children:"Categoría principal"}),e.jsxs("select",{id:"category",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",value:m,onChange:i=>h(i.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Selecciona una categoría"}),p.map(i=>e.jsx("option",{value:i.id.toString(),children:i.name},i.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"name",children:"Nombre de la subcategoría"}),e.jsx(q,{id:"name",value:d,onChange:i=>g(i.target.value),placeholder:"Ej: Juegos infantiles, Iluminación, Baños",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"description",children:"Descripción"}),e.jsx(ee,{id:"description",value:u,onChange:i=>x(i.target.value),placeholder:"Describe el propósito de esta subcategoría...",rows:3})]}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(l,{type:"button",variant:"outline",onClick:j,children:"Cancelar"}),e.jsx(l,{type:"submit",disabled:y||!d.trim()||!m,children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),t==="create"?"Creando...":"Actualizando..."]}):t==="create"?"Crear subcategoría":"Actualizar subcategoría"})]})]})},Be=({isOpen:t,onClose:a,onConfirm:o,isDeleting:p,itemType:j,itemName:n})=>e.jsx(F,{open:t,onOpenChange:a,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(A,{children:"Confirmar eliminación"}),e.jsx(P,{children:j==="category"?"Esta acción eliminará la categoría y todas sus subcategorías. Las incidencias asociadas se mantendrán pero perderán su categorización.":"Esta acción eliminará la subcategoría. Las incidencias asociadas se mantendrán pero perderán su subcategorización."})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex items-center p-4 bg-amber-50 text-amber-800 rounded-md",children:[e.jsx(Fe,{className:"h-5 w-5 mr-2 text-amber-600"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["¿Estás seguro de eliminar ",j==="category"?"la categoría":"la subcategoría",' "',n,'"?']}),e.jsx("p",{className:"text-sm",children:"Esta acción no se puede deshacer."})]})]})}),e.jsxs(Te,{children:[e.jsx(l,{variant:"outline",onClick:a,children:"Cancelar"}),e.jsx(l,{variant:"destructive",onClick:o,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Eliminando..."]}):"Eliminar"})]})]})}),Ue=()=>{je();const{toast:t}=be(),a=ye(),[o,p]=c.useState(""),[j,n]=c.useState(!1),[y,d]=c.useState(!1),[g,u]=c.useState(null),[x,m]=c.useState(null),[h,C]=c.useState(void 0),[E,i]=c.useState(!1),[b,w]=c.useState(null),[S,M]=c.useState("category"),{data:B=[],isLoading:re,isError:ae,refetch:se}=G({queryKey:["/api/incident-categories"],onError:r=>{console.error("Error al cargar categorías:",r),t({title:"Error",description:"No se pudieron cargar las categorías",variant:"destructive"})}}),{data:te=[],isLoading:oe,refetch:Oe}=G({queryKey:["/api/incident-subcategories"],onError:r=>{console.error("Error al cargar subcategorías:",r),t({title:"Error",description:"No se pudieron cargar las subcategorías",variant:"destructive"})}}),O=v({mutationFn:async r=>{const s=await fetch("/api/incident-categories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify(r)});if(!s.ok)throw new Error("Error al crear la categoría");return await s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-categories"]}),n(!1),t({title:"Categoría creada",description:"La categoría ha sido creada correctamente"})},onError:r=>{console.error("Error al crear categoría:",r),t({title:"Error",description:"No se pudo crear la categoría",variant:"destructive"})}}),Q=v({mutationFn:async r=>{const s=await fetch(`/api/incident-categories/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify({name:r.name,description:r.description,color:r.color})});if(!s.ok)throw new Error("Error al actualizar la categoría");return await s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-categories"]}),u(null),n(!1),t({title:"Categoría actualizada",description:"La categoría ha sido actualizada correctamente"})},onError:r=>{console.error("Error al actualizar categoría:",r),t({title:"Error",description:"No se pudo actualizar la categoría",variant:"destructive"})}}),K=v({mutationFn:async r=>{if(!(await fetch(`/api/incident-categories/${r}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-admin","X-User-Id":"1"}})).ok)throw new Error("Error al eliminar la categoría");return!0},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-categories"]}),a.invalidateQueries({queryKey:["/api/incident-subcategories"]}),i(!1),w(null),t({title:"Categoría eliminada",description:"La categoría ha sido eliminada correctamente"})},onError:r=>{console.error("Error al eliminar categoría:",r),t({title:"Error",description:"No se pudo eliminar la categoría",variant:"destructive"})}}),U=v({mutationFn:async r=>{const s=await fetch("/api/incident-subcategories",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify(r)});if(!s.ok)throw new Error("Error al crear la subcategoría");return await s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-subcategories"]}),d(!1),C(void 0),t({title:"Subcategoría creada",description:"La subcategoría ha sido creada correctamente"})},onError:r=>{console.error("Error al crear subcategoría:",r),t({title:"Error",description:"No se pudo crear la subcategoría",variant:"destructive"})}}),X=v({mutationFn:async r=>{const s=await fetch(`/api/incident-subcategories/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer direct-token-admin","X-User-Id":"1"},body:JSON.stringify({name:r.name,description:r.description,categoryId:r.categoryId})});if(!s.ok)throw new Error("Error al actualizar la subcategoría");return await s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-subcategories"]}),m(null),d(!1),t({title:"Subcategoría actualizada",description:"La subcategoría ha sido actualizada correctamente"})},onError:r=>{console.error("Error al actualizar subcategoría:",r),t({title:"Error",description:"No se pudo actualizar la subcategoría",variant:"destructive"})}}),J=v({mutationFn:async r=>{if(!(await fetch(`/api/incident-subcategories/${r}`,{method:"DELETE",headers:{Authorization:"Bearer direct-token-admin","X-User-Id":"1"}})).ok)throw new Error("Error al eliminar la subcategoría");return!0},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/incident-subcategories"]}),i(!1),w(null),t({title:"Subcategoría eliminada",description:"La subcategoría ha sido eliminada correctamente"})},onError:r=>{console.error("Error al eliminar subcategoría:",r),t({title:"Error",description:"No se pudo eliminar la subcategoría",variant:"destructive"})}}),H=B.filter(r=>r.name.toLowerCase().includes(o.toLowerCase())||r.description&&r.description.toLowerCase().includes(o.toLowerCase())),$=te.reduce((r,s)=>(r[s.categoryId]||(r[s.categoryId]=[]),r[s.categoryId].push(s),r),{}),ie=r=>$[r]?$[r].filter(s=>s.name.toLowerCase().includes(o.toLowerCase())||s.description&&s.description.toLowerCase().includes(o.toLowerCase())):[],ne=r=>{O.mutate(r)},ce=r=>{Q.mutate(r)},le=r=>{w(r),M("category"),i(!0)},de=()=>{b&&S==="category"&&K.mutate(b.id)},ue=r=>{U.mutate(r)},me=r=>{X.mutate(r)},he=r=>{w(r),M("subcategory"),i(!0)},ge=()=>{b&&S==="subcategory"&&J.mutate(b.id)},xe=r=>Ie(new Date(r),"d MMM yyyy",{locale:Ae});return re||oe?e.jsx(z,{children:e.jsx("div",{className:"container mx-auto py-8",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"})})})}):ae?e.jsx(z,{children:e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Error al cargar categorías"}),e.jsx("p",{className:"mb-4",children:"No se pudieron cargar las categorías de incidencias."}),e.jsx(l,{onClick:()=>se(),children:"Reintentar"})]})})}):e.jsxs(z,{children:[e.jsxs("div",{className:"p-6",children:[e.jsx(V,{className:"p-4 bg-gray-50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Categorías de incidencias"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestión de categorías y subcategorías para clasificar incidencias"})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(l,{variant:"outline",onClick:()=>{m(null),d(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Nueva subcategoría"]}),e.jsxs(l,{onClick:()=>{u(null),n(!0)},children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Nueva categoría"]})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-gray-500"}),e.jsx(q,{type:"search",placeholder:"Buscar categorías y subcategorías...",className:"pl-8",value:o,onChange:r=>p(r.target.value)}),o&&e.jsx("button",{onClick:()=>p(""),className:"absolute right-2.5 top-2.5 text-gray-500 hover:text-gray-700",children:e.jsx(Ne,{className:"h-4 w-4"})})]})}),e.jsx("div",{className:"space-y-6",children:H.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-100 mb-4",children:e.jsx(Pe,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No hay categorías"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"No se encontraron categorías con los criterios de búsqueda."}),e.jsxs(l,{onClick:()=>n(!0),children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Crear primera categoría"]})]}):H.map(r=>{var R;const s=ie(r.id);return o&&s.length===0&&!r.name.toLowerCase().includes(o.toLowerCase())&&!((R=r.description)!=null&&R.toLowerCase().includes(o.toLowerCase()))?null:e.jsxs(V,{className:"overflow-hidden",children:[e.jsxs(Ce,{className:"bg-gray-50 pb-3",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 rounded",style:{backgroundColor:r.color||"#3b82f6"}}),e.jsx(we,{children:r.name})]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 md:mt-0",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>{C(r.id),m(null),d(!0)},children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Añadir subcategoría"]}),e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>{u(r),n(!0)},children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Editar"]}),e.jsxs(l,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>le(r),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Eliminar"]})]})]}),r.description&&e.jsx(Se,{className:"mt-2",children:r.description})]}),e.jsx(Ee,{children:s.length===0?e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No hay subcategorías definidas"}):e.jsxs(Le,{children:[e.jsx(ke,{children:e.jsxs(_,{children:[e.jsx(L,{children:"Nombre"}),e.jsx(L,{children:"Descripción"}),e.jsx(L,{children:"Creada"}),e.jsx(L,{className:"text-right",children:"Acciones"})]})}),e.jsx(ze,{children:s.map(f=>e.jsxs(_,{children:[e.jsx(k,{className:"font-medium",children:f.name}),e.jsx(k,{className:"max-w-md truncate",children:f.description||"-"}),e.jsx(k,{children:xe(f.createdAt)}),e.jsx(k,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{m(f),d(!0)},children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(l,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50",onClick:()=>he(f),children:e.jsx(Y,{className:"h-4 w-4"})})]})})]},f.id))})]})})]},r.id)})})]}),e.jsx(F,{open:j,onOpenChange:n,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(A,{children:g?"Editar categoría":"Nueva categoría"}),e.jsx(P,{children:g?"Actualiza los detalles de esta categoría de incidencias":"Crea una nueva categoría para clasificar incidencias"})]}),e.jsx(qe,{mode:g?"edit":"create",initialData:g,onClose:()=>{n(!1),u(null)},onSubmit:g?ce:ne,isSubmitting:g?Q.isPending:O.isPending})]})}),e.jsx(F,{open:y,onOpenChange:d,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(A,{children:x?"Editar subcategoría":"Nueva subcategoría"}),e.jsx(P,{children:x?"Actualiza los detalles de esta subcategoría":"Crea una nueva subcategoría para clasificar incidencias de forma más específica"})]}),e.jsx(Me,{mode:x?"edit":"create",initialData:x,parentCategoryId:h,categories:B,onClose:()=>{d(!1),m(null),C(void 0)},onSubmit:x?me:ue,isSubmitting:x?X.isPending:U.isPending})]})}),e.jsx(Be,{isOpen:E,onClose:()=>{i(!1),w(null)},onConfirm:S==="category"?de:ge,isDeleting:S==="category"?K.isPending:J.isPending,itemType:S,itemName:(b==null?void 0:b.name)||""})]})};export{Ue as default};
