import{al as se,Y as x,a6 as ae,e as le,u as re,a8 as te,R as E,j as e,aB as ie,bh as ne,bj as ce,bk as oe,bl as de,bm as xe,bn as he,bo as me,bp as je,B as h,aW as ue,cx as pe,cy as ge,W as Ne,cK as ve,cz as fe,cA as be,cB as we,cC as P,C as N,a as v,b as f,c as b,U as Ce,aF as ye,cD as Ae,cp as De,Z as Se,I as Ee,z,H,J as V,K as $,N as m,x as Pe,ba as Le,bb as Me,bc as K,bd as t,cL as Te,be as Fe,bf as i,b0 as Ie,b3 as ke,l as Be,X as Re,f as n,ah as qe}from"./index-BBGHPKhn.js";import{P as ze,a as He,b as L,c as Ve,d as $e,e as Ke}from"./pagination-CzVsvTQG.js";import{F as M}from"./file-pen-D_-T9Sgx.js";import{R as U}from"./refresh-cw-DS5oknip.js";import"./ellipsis-DJvwf0dh.js";function We(){const[,w]=se(),[r,T]=x.useState(1),[c,F]=x.useState(""),[j,I]=x.useState("all"),[o,k]=x.useState("all"),[Y,C]=x.useState(!1),u=10,O=ae(),{toast:B}=le(),{data:l,isLoading:Q,isError:G,refetch:W}=re({queryKey:["/api/instructors"],retry:1,enabled:!0}),y=te({mutationFn:async()=>await qe("/api/instructors/batch/all",{method:"DELETE"}),onSuccess:s=>{B({title:"Instructores inactivados",description:`${s.count} instructores han sido inactivados correctamente`,variant:"default"}),O.invalidateQueries({queryKey:["/api/instructors"]}),C(!1)},onError:s=>{console.error("Error al eliminar todos los instructores:",s),B({title:"Error",description:"No se pudieron eliminar los instructores. Por favor, inténtalo de nuevo.",variant:"destructive"}),C(!1)}}),A=E.useMemo(()=>l?l.filter(s=>{var q;const a=c===""||`${s.firstName} ${s.lastName}`.toLowerCase().includes(c.toLowerCase())||((q=s.email)==null?void 0:q.toLowerCase().includes(c.toLowerCase())),d=j==="all"||s.status===j,S=o==="all"||s.specialties&&(Array.isArray(s.specialties)?s.specialties.some(ee=>ee.toLowerCase().includes(o.toLowerCase())):s.specialties.toLowerCase().includes(o.toLowerCase()));return a&&d&&S}):[],[l,c,j,o]),p=E.useMemo(()=>{const s=(r-1)*u;return A.slice(s,s+u)},[A,r,u]),g=Math.ceil(A.length/u),D=s=>{T(s)},J=()=>{y.mutate()};x.useEffect(()=>{T(1)},[c,j,o]);const R=E.useMemo(()=>{if(!l)return[];const s=new Set;return l.forEach(a=>{a.specialties&&Array.isArray(a.specialties)?a.specialties.forEach(d=>{s.add(d.trim())}):a.specialties&&typeof a.specialties=="string"&&a.specialties.split(",").forEach(S=>{s.add(S.trim())})}),Array.from(s)},[l]),X=s=>{if(!s)return"Fecha desconocida";try{const a=new Date(s);return Be(a,"dd MMM yyyy",{locale:Re})}catch{return"Fecha inválida"}},Z=s=>{switch(s){case"active":return e.jsx(n,{className:"bg-green-100 text-green-800 hover:bg-green-200",children:"Activo"});case"inactive":return e.jsx(n,{className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:"Inactivo"});case"pending":return e.jsx(n,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",children:"Pendiente"});default:return e.jsx(n,{children:s})}},_=s=>!s||!Array.isArray(s)||s.length===0?e.jsx("span",{className:"text-gray-400 italic",children:"No especificado"}):s.length<=2?s.map((a,d)=>e.jsx(n,{variant:"outline",className:"mr-1",children:a},d)):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"outline",className:"mr-1",children:s[0]}),e.jsxs(n,{variant:"outline",className:"mr-1",children:["+",s.length-1," más"]})]});return e.jsxs(ie,{children:[e.jsx(ne,{open:Y,onOpenChange:C,children:e.jsxs(ce,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:"¿Estás seguro?"}),e.jsx(xe,{children:"Esta acción desactivará a todos los instructores en el sistema y no se puede deshacer. Los instructores marcados como inactivos ya no aparecerán en las listas públicas ni podrán ser asignados a actividades."})]}),e.jsxs(he,{children:[e.jsx(me,{children:"Cancelar"}),e.jsx(je,{onClick:J,disabled:y.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:y.isPending?"Procesando...":"Confirmar eliminación"})]})]})}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Instructores"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestiona la lista de instructores registrados en la plataforma."})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(h,{onClick:()=>w("/admin/activities/instructors/new"),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Nuevo Instructor"]}),e.jsxs(pe,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(h,{variant:"outline",children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Exportar",e.jsx(ve,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(fe,{children:[e.jsx(be,{children:"Formato"}),e.jsx(we,{}),e.jsxs(P,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"Excel"]}),e.jsxs(P,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"CSV"]}),e.jsxs(P,{children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"PDF"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs(N,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Total"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:l?l.length:0})]})})]}),e.jsxs(N,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Activos"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:l?l.filter(s=>s.status==="active").length:0})]})})]}),e.jsxs(N,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Experiencia promedio"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-5 w-5 text-amber-600 mr-2"}),e.jsxs("span",{className:"text-2xl font-bold",children:[l&&l.length>0?Math.round(l.reduce((s,a)=>s+(a.experienceYears||0),0)/l.length):0," años"]})]})})]}),e.jsxs(N,{children:[e.jsx(v,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Especialidades"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{className:"h-5 w-5 text-purple-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:R.length})]})})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4 items-end",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs("div",{className:"relative",children:[e.jsx(Se,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Buscar por nombre o email...",className:"pl-8",value:c,onChange:s=>F(s.target.value)})]})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsxs(z,{value:j,onValueChange:I,children:[e.jsx(H,{children:e.jsx(V,{placeholder:"Filtrar por estado"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"Todos los estados"}),e.jsx(m,{value:"active",children:"Activos"}),e.jsx(m,{value:"inactive",children:"Inactivos"}),e.jsx(m,{value:"pending",children:"Pendientes"})]})]})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsxs(z,{value:o,onValueChange:k,children:[e.jsx(H,{children:e.jsx(V,{placeholder:"Filtrar por especialidad"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"Todas las especialidades"}),R.map((s,a)=>e.jsx(m,{value:s,children:s},a))]})]})}),e.jsxs(h,{variant:"outline",className:"w-full md:w-auto",onClick:()=>{F(""),I("all"),k("all")},children:[e.jsx(U,{className:"mr-2 h-4 w-4"}),"Limpiar filtros"]})]}),e.jsxs("div",{className:"bg-white rounded-md shadow",children:[Q?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(U,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Cargando instructores..."})]}):G?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Pe,{className:"h-8 w-8 mx-auto text-red-500"}),e.jsx("p",{className:"mt-2 text-red-500",children:"Error al cargar los instructores"}),e.jsx(h,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>W(),children:"Reintentar"})]}):(p==null?void 0:p.length)===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:l?"No se encontraron instructores que coincidan con los criterios de búsqueda.":"Haz clic en 'Cargar instructores' para ver los datos."})}):e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs(Le,{children:[e.jsx(Me,{children:e.jsxs(K,{children:[e.jsx(t,{children:"Nombre"}),e.jsx(t,{children:"Contacto"}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center",children:["Estado",e.jsx(Te,{className:"ml-2 h-4 w-4"})]})}),e.jsx(t,{children:"Especialidades"}),e.jsx(t,{children:"Experiencia"}),e.jsx(t,{children:"Inicio"}),e.jsx(t,{className:"text-right",children:"Acciones"})]})}),e.jsx(Fe,{children:p.map(s=>e.jsxs(K,{children:[e.jsxs(i,{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsxs(i,{children:[e.jsx("div",{children:s.email}),s.phone&&e.jsx("div",{className:"text-muted-foreground text-xs",children:s.phone})]}),e.jsx(i,{children:Z(s.status)}),e.jsx(i,{children:_(s.specialties)}),e.jsxs(i,{children:[s.experienceYears," ",s.experienceYears===1?"año":"años"]}),e.jsx(i,{children:X(s.createdAt)}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>w(`/admin/instructors/detail/${s.id}`),title:"Ver detalles",children:e.jsx(Ie,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>w(`/admin/instructors/edit/${s.id}`),title:"Editar instructor",children:e.jsx(ke,{className:"h-4 w-4"})})]})})]},s.id))})]})}),g>1&&e.jsx("div",{className:"mt-4",children:e.jsx(ze,{children:e.jsxs(He,{children:[e.jsx(L,{children:e.jsx(Ve,{onClick:()=>D(Math.max(1,r-1)),className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:g},(s,a)=>a+1).map(s=>e.jsx(L,{children:e.jsx($e,{onClick:()=>D(s),isActive:r===s,children:s})},s)),e.jsx(L,{children:e.jsx(Ke,{onClick:()=>D(Math.min(g,r+1)),className:r===g?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]})]})}export{We as default};
