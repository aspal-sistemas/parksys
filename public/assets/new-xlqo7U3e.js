import{az as G,l as J,ae as Y,a2 as v,af as W,u as X,ag as Z,j as e,aX as ee,f as m,bh as $,ai as se,g as j,h as p,M as A,i as u,aj as i,ak as c,al as l,am as o,Q as ae,V as re,W as te,Y as ne,_ as ie,an as d,O as g,cY as ce,K as M,$ as le,ao as oe,B as O,ah as de,ab as me,o as xe,U as he,as as je,n as pe,ad as n,ap as ue}from"./index-D5qLf1ib.js";import{S as B}from"./separator-Bek7HtsH.js";import{S as ge}from"./SpaceMediaManager-BPIuC-1B.js";const fe=n.object({space_id:n.string().min(1,"Selecciona un espacio"),customer_name:n.string().min(2,"El nombre debe tener al menos 2 caracteres"),customer_email:n.string().email("Email inválido"),customer_phone:n.string().min(10,"El teléfono debe tener al menos 10 dígitos"),start_date:n.string().min(1,"Selecciona fecha de inicio"),end_date:n.string().min(1,"Selecciona fecha de fin"),start_time:n.string().min(1,"Selecciona hora de inicio"),end_time:n.string().min(1,"Selecciona hora de fin"),special_requests:n.string().optional(),deposit_paid:n.boolean().default(!1)}).refine(S=>{const _=new Date(S.start_date);return new Date(S.end_date)>=_},{message:"La fecha de fin debe ser igual o posterior a la fecha de inicio",path:["end_date"]}),Ne={playground:"Área de Juegos",kiosk:"Kiosco",picnic_area:"Área de Picnic",open_area:"Área Abierta",pavilion:"Pabellón"};function Ce(){const[S,_]=G(),{toast:D}=J(),V=Y(),[a,K]=v.useState(null),[C,P]=v.useState(0),[N,I]=v.useState(0),Q=new URLSearchParams(window.location.search).get("space_id"),r=W({resolver:ue(fe),defaultValues:{space_id:Q||"",customer_name:"",customer_email:"",customer_phone:"",start_date:"",end_date:"",start_time:"",end_time:"",special_requests:"",deposit_paid:!1}}),{data:T=[],isLoading:ve}=X({queryKey:["/api/reservable-spaces"],queryFn:async()=>{const s=await fetch("/api/reservable-spaces?active_only=true");if(!s.ok)throw new Error("Error al cargar los espacios");return s.json()}}),E=Z({mutationFn:async s=>{const t={spaceId:parseInt(s.space_id),contactName:s.customer_name,contactEmail:s.customer_email,contactPhone:s.customer_phone,startDate:s.start_date,endDate:s.end_date,startTime:s.start_time,endTime:s.end_time,specialRequests:s.special_requests||"",expectedAttendees:(a==null?void 0:a.capacity)||1,purpose:"Evento privado - Múltiples días",totalCost:C,depositPaid:s.deposit_paid,eventId:null,activityId:null},x=await fetch("/api/space-reservations",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!x.ok){const h=await x.json();throw new Error(h.message||"Error al crear la reserva")}return x.json()},onSuccess:()=>{D({title:"Reserva creada",description:"La reserva se ha creado exitosamente"}),V.invalidateQueries({queryKey:["/api/space-reservations"]}),_("/admin/space-reservations")},onError:s=>{D({title:"Error",description:s.message,variant:"destructive"})}}),F=r.watch("space_id"),f=r.watch("start_date"),y=r.watch("end_date"),b=r.watch("start_time"),w=r.watch("end_time");v.useEffect(()=>{if(F){const s=T.find(t=>t.id.toString()===F);K(s||null)}},[F,T]),v.useEffect(()=>{if(a&&f&&y&&b&&w){const s=new Date(f),x=new Date(y).getTime()-s.getTime(),h=Math.max(1,Math.ceil(x/(1e3*3600*24))+1),k=new Date(`2000-01-01T${b}`),L=(new Date(`2000-01-01T${w}`).getTime()-k.getTime())/(1e3*60*60);if(L>0){const H=L*h;I(H),P(H*parseFloat(a.hourly_rate))}else I(0),P(0)}},[a,f,y,b,w]);const U=s=>{E.mutate(s)},z=()=>{_("/admin/space-reservations")},q=()=>{if(!a||!b||!w)return!0;const s=N;return s>=a.minimum_hours&&s<=a.maximum_hours},R=()=>{if(!a)return new Date().toISOString().split("T")[0];const s=new Date,t=a.advance_booking_days||0;return s.setDate(s.getDate()+t),s.toISOString().split("T")[0]};return e.jsx(ee,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs(m,{className:"p-4 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Nueva Reserva"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Crear una nueva reserva de espacio"})]}),e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"xl:col-span-3",children:[e.jsx(se,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(U),className:"space-y-6",children:[e.jsxs(m,{className:"w-full",children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Seleccionar Espacio"]})}),e.jsx(u,{children:e.jsx(i,{control:r.control,name:"space_id",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Espacio a Reservar"}),e.jsx(o,{children:e.jsxs(ae,{value:s.value,onValueChange:s.onChange,children:[e.jsx(re,{children:e.jsx(te,{placeholder:"Selecciona un espacio"})}),e.jsx(ne,{children:T.map(t=>e.jsx(ie,{value:t.id.toString(),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:t.name}),e.jsxs("span",{className:"text-sm text-gray-500",children:[t.park_name," - $",t.hourly_rate,"/hora"]})]})},t.id))})]})}),e.jsx(d,{})]})})})]}),e.jsxs(m,{className:"w-full",children:[e.jsx(j,{children:e.jsx(p,{children:"Información del Cliente"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"customer_name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Nombre Completo"}),e.jsx(o,{children:e.jsx(g,{placeholder:"Nombre del cliente",...s})}),e.jsx(d,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"customer_email",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Email"}),e.jsx(o,{children:e.jsx(g,{type:"email",placeholder:"cliente@email.com",...s})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"customer_phone",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Teléfono"}),e.jsx(o,{children:e.jsx(g,{placeholder:"(33) 1234-5678",...s})}),e.jsx(d,{})]})})]})]})]}),e.jsxs(m,{className:"w-full",children:[e.jsx(j,{children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Fecha y Horario"]})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"start_date",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Fecha de Inicio"}),e.jsx(o,{children:e.jsx(g,{type:"date",min:R(),...s})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"end_date",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Fecha de Fin"}),e.jsx(o,{children:e.jsx(g,{type:"date",min:f||R(),...s})}),e.jsx(d,{})]})})]}),a&&a.advance_booking_days>0&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-amber-600",children:[e.jsx(M,{className:"h-3 w-3 inline mr-1"}),"Requiere reserva con ",a.advance_booking_days," días de anticipación"]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(i,{control:r.control,name:"start_time",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Hora de Inicio"}),e.jsx(o,{children:e.jsx(g,{type:"time",...s})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"end_time",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Hora de Fin"}),e.jsx(o,{children:e.jsx(g,{type:"time",...s})}),e.jsx(d,{})]})})]}),a&&!q()&&N>0&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-red-600",children:[e.jsx(M,{className:"h-3 w-3 inline mr-1"}),"La duración debe ser entre ",a.minimum_hours," y ",a.maximum_hours," horas"]})})]})]}),e.jsxs(m,{className:"w-full",children:[e.jsx(j,{children:e.jsx(p,{children:"Información Adicional"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsx(i,{control:r.control,name:"special_requests",render:({field:s})=>e.jsxs(c,{children:[e.jsx(l,{children:"Solicitudes Especiales (Opcional)"}),e.jsx(o,{children:e.jsx(le,{placeholder:"Describe cualquier solicitud especial o requerimiento adicional...",className:"min-h-[100px]",...s})}),e.jsx(d,{})]})}),e.jsx(i,{control:r.control,name:"deposit_paid",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(o,{children:e.jsx(oe,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(l,{children:"Depósito Pagado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Marcar si el cliente ya ha pagado el depósito requerido"})]})]})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(O,{type:"button",variant:"outline",onClick:z,children:"Cancelar"}),e.jsxs(O,{type:"submit",className:"bg-[#00a587] hover:bg-[#067f5f]",disabled:E.isPending||!q(),children:[E.isPending?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}):e.jsx(de,{className:"h-4 w-4 mr-2"}),"Crear Reserva"]})]})]})}),e.jsxs(m,{className:"w-full",children:[e.jsxs(j,{children:[e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Gestión Multimedia"]}),e.jsx(me,{children:"Agrega imágenes y documentos relacionados con esta reserva"})]}),e.jsx(u,{children:a?e.jsx(ge,{spaceId:a.id,isEditMode:!0}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Selecciona un espacio primero para gestionar multimedia"})})]})]}),e.jsx("div",{className:"xl:col-span-1",children:e.jsxs("div",{className:"sticky top-6 space-y-4",children:[a&&e.jsxs(m,{className:"w-full",children:[e.jsx(j,{children:e.jsx(p,{className:"text-lg",children:"Resumen de Reserva"})}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:a.name}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-gray-600 mb-2",children:[e.jsx(A,{className:"h-3 w-3"}),a.park_name]}),e.jsx(xe,{className:"bg-blue-100 text-blue-800",children:Ne[a.space_type]})]}),e.jsx(B,{}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),"Capacidad:"]}),e.jsxs("span",{children:[a.capacity," personas"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(je,{className:"h-3 w-3"}),"Precio/hora:"]}),e.jsxs("span",{children:["$",a.hourly_rate]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(pe,{className:"h-3 w-3"}),"Duración mín/máx:"]}),e.jsxs("span",{children:[a.minimum_hours,"h - ",a.maximum_hours,"h"]})]})]}),N>0&&f&&y&&e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx("div",{className:"space-y-2",children:(()=>{const s=new Date(f),x=new Date(y).getTime()-s.getTime(),h=Math.max(1,Math.ceil(x/(1e3*3600*24))+1),k=N/h;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Período:"}),e.jsxs("span",{children:[h," ",h===1?"día":"días"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Horas por día:"}),e.jsxs("span",{children:[k.toFixed(1)," hrs"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total horas:"}),e.jsxs("span",{children:[N.toFixed(1)," hrs"]})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",C.toFixed(2)]})]})]})})()}),e.jsxs("div",{className:"flex justify-between font-medium",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{className:"text-[#00a587]",children:["$",C.toFixed(2)]})]})]}),a.requires_approval&&e.jsx("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-amber-600",children:[e.jsx(M,{className:"h-3 w-3 inline mr-1"}),"Este espacio requiere aprobación administrativa"]})})]})]}),a&&e.jsxs(m,{className:"w-full",children:[e.jsx(j,{children:e.jsx(p,{className:"text-base",children:"Reglas del Espacio"})}),e.jsx(u,{children:e.jsx("p",{className:"text-sm text-gray-600",children:a.rules})})]})]})})]})]})})}export{Ce as default};
