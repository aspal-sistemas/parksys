import{am as de,Y as d,e as oe,a6 as me,u as N,a8 as K,R as ue,j as e,aI as z,B as i,A as xe,D as I,p as he,b2 as je,r as T,t as E,v as M,w as L,z as o,H as m,J as u,K as x,N as c,I as h,O as Q,C as $,c as G,Z as ve,a as pe,b as ge,bh as Ne,bi as fe,bj as q,bk as r,bl as be,bm as n,l as f,f as b,b7 as ye,ba as Ce,i as Ae,a9 as Se,aJ as we,ai as _,X as y}from"./index-Dzu3mJf5.js";import{R as De}from"./rotate-ccw-BcSbzPyE.js";const J=[{value:"excellent",label:"Excelente"},{value:"good",label:"Bueno"},{value:"fair",label:"Regular"},{value:"poor",label:"Malo"}],Y=C=>({excellent:"Excelente",good:"Bueno",fair:"Regular",poor:"Malo",critical:"Crítico",excelente:"Excelente",bueno:"Bueno",regular:"Regular",malo:"Malo",crítico:"Crítico"})[C.toLowerCase()]||C,P=[{value:"active",label:"Activa",color:"bg-blue-100 text-blue-800",icon:Ae},{value:"returned",label:"Devuelto",color:"bg-green-100 text-green-800",icon:Se},{value:"overdue",label:"Vencida",color:"bg-red-100 text-red-800",icon:we}],Ee=()=>{const[C,k]=de(),[j,U]=d.useState(""),[p,X]=d.useState("all"),[Z,A]=d.useState(!1),[W,S]=d.useState(!1),[ee,g]=d.useState(!1),[t,F]=d.useState(null),{toast:v}=oe(),V=me(),{data:R=[],isLoading:se}=N({queryKey:["/api/asset-assignments"],staleTime:6e4}),{data:ae=[]}=N({queryKey:["/api/assets"],staleTime:6e4}),{data:te=[]}=N({queryKey:["/api/instructors"],staleTime:6e4}),{data:ie=[]}=N({queryKey:["/api/activities"],staleTime:6e4}),w=K({mutationFn:async s=>_("/api/asset-assignments",{method:"POST",data:s}),onSuccess:()=>{V.invalidateQueries({queryKey:["/api/asset-assignments"]}),v({title:"Asignación creada",description:"La asignación de activo se ha creado correctamente."}),A(!1)},onError:()=>{v({title:"Error",description:"No se pudo crear la asignación.",variant:"destructive"})}}),le=K({mutationFn:async({id:s,condition:a,notes:l})=>_(`/api/asset-assignments/${s}/return`,{method:"POST",data:{condition:a,notes:l}}),onSuccess:()=>{V.invalidateQueries({queryKey:["/api/asset-assignments"]}),v({title:"Activo devuelto",description:"El activo se ha marcado como devuelto."})},onError:()=>{v({title:"Error",description:"No se pudo procesar la devolución.",variant:"destructive"})}}),B=ue.useMemo(()=>R.filter(s=>{var O,H;const a=((O=s.assetName)==null?void 0:O.toLowerCase().includes(j.toLowerCase()))||((H=s.instructorName)==null?void 0:H.toLowerCase().includes(j.toLowerCase()))||s.purpose.toLowerCase().includes(j.toLowerCase()),l=p==="all"||s.status===p;return a&&l}),[R,j,p]),ne=s=>{s.preventDefault();const a=new FormData(s.currentTarget),l={assetId:parseInt(a.get("assetId")),instructorId:a.get("instructorId")?parseInt(a.get("instructorId")):null,activityId:a.get("activityId")?parseInt(a.get("activityId")):null,assignmentDate:a.get("assignmentDate"),purpose:a.get("purpose"),condition:a.get("condition"),notes:a.get("notes")};w.mutate(l)},D=s=>P.find(a=>a.value===s)||P[0],re=s=>{F(s),S(!0)},ce=s=>{F(s),g(!0)};return se?e.jsx(z,{children:e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"text-center",children:"Cargando asignaciones..."})})}):e.jsx(z,{children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(i,{variant:"outline",onClick:()=>k("/admin/assets"),children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),"Volver a Activos"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Gestión de Asignaciones"}),e.jsx("p",{className:"text-muted-foreground",children:"Asigna activos a instructores y actividades"})]})]}),e.jsxs(I,{open:Z,onOpenChange:A,children:[e.jsx(he,{asChild:!0,children:e.jsxs(i,{children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Nueva Asignación"]})}),e.jsxs(T,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(E,{children:[e.jsx(M,{children:"Crear Nueva Asignación"}),e.jsx(L,{children:"Asigna un activo a un instructor o actividad"})]}),e.jsxs("form",{onSubmit:ne,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Activo"}),e.jsxs(o,{name:"assetId",required:!0,children:[e.jsx(m,{children:e.jsx(u,{placeholder:"Seleccionar activo"})}),e.jsx(x,{children:ae.filter(s=>s.status==="active").map(s=>e.jsxs(c,{value:s.id.toString(),children:[s.name," - ",s.parkName]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Instructor (opcional)"}),e.jsxs(o,{name:"instructorId",children:[e.jsx(m,{children:e.jsx(u,{placeholder:"Seleccionar instructor"})}),e.jsx(x,{children:te.map(s=>e.jsxs(c,{value:s.id.toString(),children:[s.firstName," ",s.lastName]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Actividad (opcional)"}),e.jsxs(o,{name:"activityId",children:[e.jsx(m,{children:e.jsx(u,{placeholder:"Seleccionar actividad"})}),e.jsx(x,{children:ie.map(s=>e.jsx(c,{value:s.id.toString(),children:s.title},s.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Fecha de Asignación"}),e.jsx(h,{name:"assignmentDate",type:"date",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Propósito"}),e.jsx(h,{name:"purpose",placeholder:"Propósito de la asignación",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Condición al Asignar"}),e.jsxs(o,{name:"condition",required:!0,children:[e.jsx(m,{children:e.jsx(u,{placeholder:"Seleccionar condición"})}),e.jsx(x,{children:J.map(s=>e.jsx(c,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notas"}),e.jsx(Q,{name:"notes",placeholder:"Notas adicionales"})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Cancelar"}),e.jsx(i,{type:"submit",disabled:w.isPending,children:w.isPending?"Creando...":"Crear Asignación"})]})]})]})]})]}),e.jsx($,{className:"mb-6",children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(ve,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(h,{placeholder:"Buscar por activo, instructor o propósito...",value:j,onChange:s=>U(s.target.value),className:"pl-10"})]})}),e.jsxs(o,{value:p,onValueChange:X,children:[e.jsx(m,{className:"w-[180px]",children:e.jsx(u,{placeholder:"Estado"})}),e.jsxs(x,{children:[e.jsx(c,{value:"all",children:"Todos los estados"}),P.map(s=>e.jsx(c,{value:s.value,children:s.label},s.value))]})]})]})})}),e.jsxs($,{children:[e.jsx(pe,{children:e.jsx(ge,{children:"Lista de Asignaciones"})}),e.jsx(G,{children:e.jsxs(Ne,{children:[e.jsx(fe,{children:e.jsxs(q,{children:[e.jsx(r,{children:"Activo"}),e.jsx(r,{children:"Instructor"}),e.jsx(r,{children:"Actividad"}),e.jsx(r,{children:"Fecha Asignación"}),e.jsx(r,{children:"Propósito"}),e.jsx(r,{children:"Estado"}),e.jsx(r,{children:"Condición"}),e.jsx(r,{className:"text-right",children:"Acciones"})]})}),e.jsx(be,{children:B.length===0?e.jsx(q,{children:e.jsx(n,{colSpan:8,className:"text-center py-6 text-muted-foreground",children:"No se encontraron asignaciones registradas"})}):B.map(s=>{const a=D(s.status),l=a.icon;return e.jsxs(q,{children:[e.jsx(n,{className:"font-medium",children:s.assetName||`Activo #${s.assetId}`}),e.jsx(n,{children:s.instructorName||"-"}),e.jsx(n,{children:s.activityName||"-"}),e.jsx(n,{children:f(new Date(s.assignmentDate),"dd/MM/yyyy",{locale:y})}),e.jsx(n,{className:"max-w-xs truncate",children:s.purpose}),e.jsx(n,{children:e.jsxs(b,{className:a.color,children:[e.jsx(l,{className:"w-3 h-3 mr-1"}),a.label]})}),e.jsx(n,{children:e.jsx(b,{variant:"outline",children:Y(s.condition)})}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:()=>re(s),title:"Ver detalles",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx(i,{variant:"outline",size:"sm",onClick:()=>ce(s),title:"Editar asignación",children:e.jsx(Ce,{className:"h-4 w-4"})}),s.status==="active"&&e.jsx(i,{variant:"outline",size:"sm",onClick:()=>le.mutate({id:s.id,condition:s.condition}),title:"Devolver activo",children:e.jsx(De,{className:"h-4 w-4"})})]})})]},s.id)})})]})})]}),e.jsx(I,{open:W,onOpenChange:S,children:e.jsxs(T,{className:"max-w-2xl",children:[e.jsxs(E,{children:[e.jsx(M,{children:"Detalles de la Asignación"}),e.jsx(L,{children:"Información completa de la asignación de activo"})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Activo"}),e.jsx("p",{className:"font-medium",children:t.assetName||`Activo #${t.assetId}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Instructor"}),e.jsx("p",{className:"font-medium",children:t.instructorName||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Actividad"}),e.jsx("p",{className:"font-medium",children:t.activityName||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Fecha de Asignación"}),e.jsx("p",{className:"font-medium",children:f(new Date(t.assignmentDate),"dd/MM/yyyy",{locale:y})})]}),t.returnDate&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Fecha de Devolución"}),e.jsx("p",{className:"font-medium",children:f(new Date(t.returnDate),"dd/MM/yyyy",{locale:y})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Estado"}),e.jsx("div",{className:"mt-1",children:e.jsx(b,{className:D(t.status).color,children:D(t.status).label})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Condición"}),e.jsx("div",{className:"mt-1",children:e.jsx(b,{variant:"outline",children:Y(t.condition)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Creado"}),e.jsx("p",{className:"font-medium",children:f(new Date(t.createdAt),"dd/MM/yyyy HH:mm",{locale:y})})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Propósito"}),e.jsx("p",{className:"mt-1 p-3 bg-gray-50 rounded-md",children:t.purpose})]}),t.notes&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Notas"}),e.jsx("p",{className:"mt-1 p-3 bg-gray-50 rounded-md",children:t.notes})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(i,{variant:"outline",onClick:()=>S(!1),children:"Cerrar"})})]})}),e.jsx(I,{open:ee,onOpenChange:g,children:e.jsxs(T,{className:"max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs(E,{children:[e.jsx(M,{children:"Editar Asignación"}),e.jsx(L,{children:"Modifica los datos de la asignación"})]}),t&&e.jsxs("form",{onSubmit:s=>{s.preventDefault();const a=new FormData(s.currentTarget),l={purpose:a.get("purpose"),condition:a.get("condition"),notes:a.get("notes")};console.log("Datos a actualizar:",l),v({title:"Función en desarrollo",description:"La edición de asignaciones estará disponible próximamente."}),g(!1)},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Activo"}),e.jsx(h,{value:t.assetName||`Activo #${t.assetId}`,disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Instructor"}),e.jsx(h,{value:t.instructorName||"Sin asignar",disabled:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Propósito"}),e.jsx(h,{name:"purpose",defaultValue:t.purpose,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Condición"}),e.jsxs(o,{name:"condition",defaultValue:t.condition,required:!0,children:[e.jsx(m,{children:e.jsx(u,{})}),e.jsx(x,{children:J.map(s=>e.jsx(c,{value:s.value,children:s.label},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Notas"}),e.jsx(Q,{name:"notes",defaultValue:t.notes||""})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(i,{type:"submit",children:"Guardar Cambios"})]})]})]})})]})})};export{Ee as default};
