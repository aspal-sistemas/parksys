import{aD as We,e as Ye,a6 as Qe,Y as h,u as we,l as Q,a8 as He,j as e,aI as Xe,B as m,b2 as Ce,aO as Ze,aP as Je,aQ as De,aR as Se,C as j,a as F,b as P,ak as H,c as u,y as o,I as k,z as I,H as V,J as q,K as A,N as d,_ as es,$ as ss,W as ke,az as as,F as X,U as Me,M as Z,h as J,f as $,i as ee,at as ts,au as rs,aK as ls,b3 as is,aS as se,a_ as ns,a$ as ds,b0 as cs,aX as ae,aj as os,b4 as xs,aU as Te,aV as Fe,aW as Pe,b5 as te,b6 as hs,aZ as ms,O as js,X as re,ai as Ie}from"./index-Dzu3mJf5.js";import{B as us}from"./BarChart-Bu_4ahC_.js";import{S as le}from"./sun-DppBKBLo.js";import{C as ps}from"./cloud-rain-Dn0xoP_L.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=We("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);function bs(){var ge,ve,Ne,ye,fe,be;const{toast:y}=Ye(),ie=Qe(),ne=h.useRef(null),[E,de]=h.useState(""),[Ve,G]=h.useState(!1),[g,ce]=h.useState("daily"),[qe,Ae]=h.useState("month"),[B,Re]=h.useState("all"),[f,z]=h.useState(1),[O,oe]=h.useState("grid"),[M,xe]=h.useState(""),[K,he]=h.useState(""),[T,me]=h.useState("all");h.useState(!1);const R=10,[a,p]=h.useState({parkId:0,date:new Date().toISOString().split("T")[0],startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],adults:0,children:0,seniors:0,pets:0,groups:0,countingMethod:"estimation",dayType:"weekday",weather:"sunny",notes:""}),{data:w}=we({queryKey:["/api/parks"]}),{data:t,isLoading:Le}=we({queryKey:["/api/visitor-counts",E,f,M,K,T],queryFn:async()=>{const s=new URLSearchParams;return E&&E!=="all"&&s.set("parkId",E),s.set("limit",R.toString()),s.set("offset",((f-1)*R).toString()),M&&s.set("search",M),K&&s.set("startDate",K),T&&s.set("method",T),(await fetch(`/api/visitor-counts?${s}`)).json()}});h.useMemo(()=>{if(!(t!=null&&t.data))return[];let s=[...t.data];return M&&(s=s.filter(r=>{var c;return r.parkName.toLowerCase().includes(M.toLowerCase())||((c=r.notes)==null?void 0:c.toLowerCase().includes(M.toLowerCase()))})),T&&T!=="all"&&(s=s.filter(r=>r.countingMethod===T)),s},[t==null?void 0:t.data,M,T]);const Ee=()=>{xe(""),de("all"),he(""),me("all"),z(1)},U=Math.ceil((((ge=t==null?void 0:t.pagination)==null?void 0:ge.total)||0)/R),je=(f-1)*R,Oe=Math.min(je+R,((ve=t==null?void 0:t.pagination)==null?void 0:ve.total)||0),$e=()=>{var b;if(!((b=t==null?void 0:t.data)!=null&&b.length)){y({title:"No hay datos",description:"No hay registros para exportar",variant:"destructive"});return}const s=t.data.map(i=>({Fecha:i.date,Parque:i.parkName,Adultos:i.adults,NiÃ±os:i.children,"Adultos Mayores":i.seniors,Mascotas:i.pets,Grupos:i.groups,"Total Visitantes":i.totalVisitors,"MÃ©todo de Conteo":i.countingMethod,"Tipo de DÃ­a":i.dayType,Clima:i.weather,Notas:i.notes||""})),r=Object.keys(s[0]),c=[r.join(","),...s.map(i=>r.map(L=>`"${i[L]}"`).join(","))].join(`
`),N="\uFEFF",C=new Blob([N+c],{type:"text/csv;charset=utf-8;"}),x=document.createElement("a");x.href=URL.createObjectURL(C),x.download=`conteo-visitantes-${new Date().toISOString().split("T")[0]}.csv`,x.click(),y({title:"ExportaciÃ³n exitosa",description:"Los datos se han exportado correctamente"})},Be=()=>{const s=[{Fecha:"2025-01-15",Parque:"Bosque Los Colomos",Adultos:"150",NiÃ±os:"75","Adultos Mayores":"30",Mascotas:"20",Grupos:"5","MÃ©todo de Conteo":"counting","Tipo de DÃ­a":"normal",Clima:"sunny",Notas:"DÃ­a regular, buen clima"},{Fecha:"2025-01-16",Parque:"Parque Metropolitano",Adultos:"200",NiÃ±os:"100","Adultos Mayores":"40",Mascotas:"25",Grupos:"8","MÃ©todo de Conteo":"estimation","Tipo de DÃ­a":"weekend",Clima:"cloudy",Notas:"Fin de semana, mucha actividad"}],c=[...[{Fecha:"--- INSTRUCCIONES ---",Parque:"Formato: YYYY-MM-DD",Adultos:"Nombre del parque",NiÃ±os:"NÃºmero entero","Adultos Mayores":"NÃºmero entero",Mascotas:"NÃºmero entero",Grupos:"NÃºmero entero","MÃ©todo de Conteo":"counting/estimation/survey","Tipo de DÃ­a":"normal/weekend/holiday",Clima:"sunny/cloudy/rainy",Notas:"Opcional - Observaciones"},{Fecha:"--- ELIMINAR ESTA FILA ---",Parque:"Eliminar filas de instrucciones",Adultos:"antes de importar",NiÃ±os:"","Adultos Mayores":"",Mascotas:"",Grupos:"","MÃ©todo de Conteo":"","Tipo de DÃ­a":"",Clima:"",Notas:""}],...s],N=Object.keys(c[0]),C=[N.join(","),...c.map(L=>N.map(W=>`"${L[W]}"`).join(","))].join(`
`),x="\uFEFF",b=new Blob([x+C],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");i.href=URL.createObjectURL(b),i.download=`plantilla-conteo-visitantes-${new Date().toISOString().split("T")[0]}.csv`,i.click(),y({title:"Plantilla descargada",description:"La plantilla CSV se ha descargado correctamente. Completa los datos y vuelve a importar."})},ze=s=>{var N;const r=(N=s.target.files)==null?void 0:N[0];if(!r)return;const c=new FileReader;c.onload=C=>{var x;try{const i=((x=C.target)==null?void 0:x.result).split(`
`),L=i[0].split(",");y({title:"ImportaciÃ³n exitosa",description:`Se procesaron ${i.length-1} registros`}),ie.invalidateQueries({queryKey:["/api/visitor-counts"]})}catch{y({title:"Error en importaciÃ³n",description:"Error al procesar el archivo CSV",variant:"destructive"})}},c.readAsText(r)},v=h.useMemo(()=>{if(!(t!=null&&t.data)||t.data.length===0)return null;const s=B==="all"?t.data:t.data.filter(l=>l.parkId.toString()===B),r=s.reduce((l,n)=>l+n.totalVisitors,0),c=s.reduce((l,n)=>l+n.adults,0),N=s.reduce((l,n)=>l+n.children,0),C=s.reduce((l,n)=>l+n.seniors,0),x=s.reduce((l,n)=>l+n.pets,0),b=s.length>0?Math.round(r/s.length):0,i=[{name:"Adultos",value:c,color:"#067f5f"},{name:"NiÃ±os",value:N,color:"#bcd256"},{name:"Seniors",value:C,color:"#8498a5"},{name:"Mascotas",value:x,color:"#00a587"}],L=s.reduce((l,n)=>{const D=l.find(S=>S.parkName===n.parkName);return D?(D.visitors+=n.totalVisitors,D.records+=1):l.push({parkName:n.parkName,visitors:n.totalVisitors,records:1}),l},[]),W=s.reduce((l,n)=>{const D=n.countingMethod,S=l.find(Y=>Y.method===D);return S?(S.count+=1,S.visitors+=n.totalVisitors):l.push({method:D,count:1,visitors:n.totalVisitors}),l},[]),Ue=s.reduce((l,n)=>{const D=n.weather||"No especificado",S=l.find(Y=>Y.weather===D);return S?(S.count+=1,S.visitors+=n.totalVisitors):l.push({weather:D,count:1,visitors:n.totalVisitors}),l},[]),_e=s.sort((l,n)=>new Date(l.date).getTime()-new Date(n.date).getTime()).slice(-7).map(l=>({date:Q(new Date(l.date),"dd/MM",{locale:re}),visitors:l.totalVisitors,adults:l.adults,children:l.children}));return{summary:{totalVisitors:r,totalAdults:c,totalChildren:N,totalSeniors:C,totalPets:x,avgDaily:b,totalRecords:s.length,uniqueParks:[...new Set(s.map(l=>l.parkName))].length},charts:{demographic:i,parks:L,methods:W,weather:Ue,trend:_e}}},[t,B]),_=He({mutationFn:async s=>{if(console.log("Datos del formulario de conteo de visitantes:",s),console.log("Modo de conteo:",g),g==="range"){const r=[],c=new Date(s.startDate),N=new Date(s.endDate);for(let x=new Date(c);x<=N;x.setDate(x.getDate()+1)){const b=x.toISOString().split("T")[0],i={parkId:s.parkId,date:b,adults:s.adults,children:s.children,seniors:s.seniors,pets:s.pets,groups:s.groups,countingMethod:s.countingMethod,dayType:g==="daily"?s.dayType:void 0,weather:g==="daily"?s.weather:void 0,notes:s.notes,registeredBy:1};console.log("Registro individual para rango:",i),r.push(i)}return await Promise.all(r.map(x=>Ie("/api/visitor-counts",{method:"POST",body:x})))}else{const r={parkId:s.parkId,date:s.date,adults:s.adults,children:s.children,seniors:s.seniors,pets:s.pets,groups:s.groups,countingMethod:s.countingMethod,dayType:s.dayType,weather:s.weather,notes:s.notes,registeredBy:1};return console.log("Datos para enviar (conteo diario):",r),Ie("/api/visitor-counts",{method:"POST",body:r})}},onSuccess:()=>{const s=g==="range"?Math.ceil((new Date(a.endDate)-new Date(a.startDate))/864e5)+1:1;y({title:"Registro exitoso",description:`${s} registro(s) de visitantes creado(s) correctamente`}),ie.invalidateQueries({queryKey:["/api/visitor-counts"]}),G(!1),p({parkId:0,date:new Date().toISOString().split("T")[0],startDate:new Date().toISOString().split("T")[0],endDate:new Date().toISOString().split("T")[0],adults:0,children:0,seniors:0,pets:0,groups:0,countingMethod:"estimation",dayType:"weekday",weather:"sunny",notes:""})},onError:s=>{y({title:"Error",description:"No se pudo registrar el conteo de visitantes",variant:"destructive"})}}),Ke=s=>{if(s.preventDefault(),console.log("ðŸ” Datos del formulario antes de enviar:",a),console.log("ðŸ” Modo de conteo:",g),a.parkId===0){y({title:"Error",description:"Por favor selecciona un parque",variant:"destructive"});return}if(g==="range"){if(!a.startDate||!a.endDate){y({title:"Error",description:"Por favor selecciona las fechas de inicio y fin",variant:"destructive"});return}if(new Date(a.startDate)>new Date(a.endDate)){y({title:"Error",description:"La fecha de inicio debe ser anterior a la fecha de fin",variant:"destructive"});return}}_.mutate(a)},ue=s=>({estimation:"EstimaciÃ³n",manual_counter:"Contador manual",event_based:"Basado en eventos",entrance_control:"Control de acceso"})[s]||s,Ge=s=>({weekday:"DÃ­a laborable",weekend:"Fin de semana",holiday:"DÃ­a festivo"})[s]||s,pe=s=>{switch(s){case"sunny":return e.jsx(le,{className:"h-4 w-4"});case"cloudy":return e.jsx(gs,{className:"h-4 w-4"});case"rainy":return e.jsx(ps,{className:"h-4 w-4"});default:return e.jsx(le,{className:"h-4 w-4"})}};return e.jsx(Xe,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Conteo de Visitantes"}),e.jsx("p",{className:"text-gray-600",children:"GestiÃ³n diaria de visitantes por parque"})]}),e.jsx("div",{className:"flex items-center space-x-3",children:e.jsxs(m,{onClick:()=>G(!0),className:"bg-emerald-600 hover:bg-emerald-700",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Nuevo Registro"]})})]}),e.jsxs(Ze,{defaultValue:"registros",className:"w-full",children:[e.jsxs(Je,{className:"grid w-full grid-cols-2",children:[e.jsx(De,{value:"registros",children:"Registros Diarios"}),e.jsx(De,{value:"reportes",children:"Reportes"})]}),e.jsxs(Se,{value:"registros",className:"space-y-4",children:[e.jsxs(j,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Filtros y Controles"]})}),e.jsxs(u,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"search",children:"Buscar"}),e.jsx(k,{id:"search",placeholder:"Buscar parque o notas...",value:M,onChange:s=>xe(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"park-filter",children:"Parque"}),e.jsxs(I,{value:E,onValueChange:de,children:[e.jsx(V,{children:e.jsx(q,{placeholder:"Todos los parques"})}),e.jsxs(A,{children:[e.jsx(d,{value:"all",children:"Todos los parques"}),w&&Array.isArray(w)&&w.filter(s=>s.id&&s.name).map(s=>e.jsx(d,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"date-filter",children:"Fecha"}),e.jsx(k,{id:"date-filter",type:"date",value:K,onChange:s=>he(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"method-filter",children:"MÃ©todo"}),e.jsxs(I,{value:T,onValueChange:me,children:[e.jsx(V,{children:e.jsx(q,{placeholder:"Todos los mÃ©todos"})}),e.jsxs(A,{children:[e.jsx(d,{value:"all",children:"Todos los mÃ©todos"}),e.jsx(d,{value:"counting",children:"Conteo directo"}),e.jsx(d,{value:"estimation",children:"EstimaciÃ³n"}),e.jsx(d,{value:"survey",children:"Encuesta"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Vista"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(m,{variant:O==="grid"?"default":"outline",size:"sm",onClick:()=>oe("grid"),children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx(m,{variant:O==="list"?"default":"outline",size:"sm",onClick:()=>oe("list"),children:e.jsx(ss,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:$e,className:"text-green-600 hover:text-green-700",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Exportar CSV"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{var s;return(s=ne.current)==null?void 0:s.click()},className:"text-blue-600 hover:text-blue-700",children:[e.jsx(as,{className:"h-4 w-4 mr-2"}),"Importar CSV"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:Be,className:"text-purple-600 hover:text-purple-700",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Plantilla CSV"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:Ee,className:"text-gray-600 hover:text-gray-700",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Limpiar Filtros"]}),e.jsx("input",{ref:ne,type:"file",accept:".csv",onChange:ze,className:"hidden"})]}),e.jsx("div",{className:"text-sm text-gray-500",children:(Ne=t==null?void 0:t.pagination)!=null&&Ne.total?`PÃ¡gina ${f} de ${U} - Mostrando ${je+1}-${Oe} de ${t.pagination.total} registros`:"Sin registros"})]})]})]}),e.jsx("div",{className:`${O==="grid"?"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4":"space-y-4"}`,children:Le?e.jsxs("div",{className:"text-center py-8 col-span-full",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-emerald-600 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Cargando registros..."})]}):((ye=t==null?void 0:t.data)==null?void 0:ye.length)===0?e.jsx(j,{className:"col-span-full",children:e.jsxs(u,{className:"text-center py-8",children:[e.jsx(Me,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay registros de visitantes"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Comienza registrando el conteo diario de visitantes"})]})}):(fe=t==null?void 0:t.data)==null?void 0:fe.map(s=>e.jsx(j,{className:"hover:shadow-lg transition-shadow",children:e.jsx(u,{className:`${O==="grid"?"p-4":"p-6"}`,children:O==="grid"?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(Z,{className:"h-4 w-4 text-emerald-600"}),e.jsx("h3",{className:"font-semibold text-sm",children:s.parkName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[e.jsx(J,{className:"h-3 w-3"}),e.jsx("span",{children:Q(new Date(s.date),"dd/MM/yyyy",{locale:re})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-xl font-bold text-emerald-600",children:s.totalVisitors}),e.jsx("div",{className:"text-xs text-gray-500",children:"visitantes"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:"text-center p-2 bg-blue-50 rounded",children:[e.jsx("div",{className:"text-sm font-semibold text-blue-700",children:s.adults}),e.jsx("div",{className:"text-xs text-blue-600",children:"Adultos"})]}),e.jsxs("div",{className:"text-center p-2 bg-green-50 rounded",children:[e.jsx("div",{className:"text-sm font-semibold text-green-700",children:s.children}),e.jsx("div",{className:"text-xs text-green-600",children:"NiÃ±os"})]}),e.jsxs("div",{className:"text-center p-2 bg-orange-50 rounded",children:[e.jsx("div",{className:"text-sm font-semibold text-orange-700",children:s.seniors}),e.jsx("div",{className:"text-xs text-orange-600",children:"Mayores"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx($,{variant:"outline",className:"text-xs",children:ue(s.countingMethod)}),s.weather&&e.jsxs($,{variant:"outline",className:"text-xs flex items-center gap-1",children:[pe(s.weather),s.weather]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"h-4 w-4 text-emerald-600"}),e.jsx("h3",{className:"font-semibold text-lg",children:s.parkName})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(J,{className:"h-4 w-4"}),e.jsx("span",{children:Q(new Date(s.date),"dd/MM/yyyy",{locale:re})})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:s.totalVisitors}),e.jsx("div",{className:"text-sm text-gray-500",children:"visitantes"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-blue-700",children:s.adults}),e.jsx("div",{className:"text-sm text-blue-600",children:"Adultos"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-green-700",children:s.children}),e.jsx("div",{className:"text-sm text-green-600",children:"NiÃ±os"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-orange-700",children:s.seniors}),e.jsx("div",{className:"text-sm text-orange-600",children:"Adultos mayores"})]}),e.jsxs("div",{className:"text-center p-3 bg-pink-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-pink-700",children:s.pets}),e.jsx("div",{className:"text-sm text-pink-600",children:"Mascotas"})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-lg font-semibold text-purple-700",children:s.groups}),e.jsx("div",{className:"text-sm text-purple-600",children:"Grupos"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs($,{variant:"outline",className:"flex items-center gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),Ge(s.dayType)]}),e.jsx($,{variant:"outline",children:ue(s.countingMethod)}),s.weather&&e.jsxs($,{variant:"outline",className:"flex items-center gap-1",children:[pe(s.weather),s.weather]})]}),s.notes&&e.jsxs("div",{className:"text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:[e.jsx("strong",{children:"Notas:"})," ",s.notes]})]})})},s.id))}),((be=t==null?void 0:t.pagination)==null?void 0:be.total)>R&&e.jsxs("div",{className:"flex justify-center items-center space-x-2 mt-6",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>z(f-1),disabled:f===1,children:[e.jsx(ts,{className:"h-4 w-4"}),"Anterior"]}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,U)},(s,r)=>{const c=r+1;return e.jsx(m,{variant:f===c?"default":"outline",size:"sm",onClick:()=>z(c),className:f===c?"bg-emerald-600 hover:bg-emerald-700":"",children:c},c)})}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>z(f+1),disabled:f===U,children:["Siguiente",e.jsx(rs,{className:"h-4 w-4"})]})]})]}),e.jsx(Se,{value:"reportes",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Filtros de Reporte"]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:"Parque"}),e.jsxs(I,{value:B,onValueChange:Re,children:[e.jsx(V,{children:e.jsx(q,{placeholder:"Selecciona un parque"})}),e.jsxs(A,{children:[e.jsx(d,{value:"all",children:"Todos los parques"}),w&&Array.isArray(w)&&w.filter(s=>s.id&&s.name).map(s=>e.jsx(d,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:"PerÃ­odo"}),e.jsxs(I,{value:qe,onValueChange:s=>Ae(s),children:[e.jsx(V,{children:e.jsx(q,{})}),e.jsxs(A,{children:[e.jsx(d,{value:"week",children:"Ãšltima semana"}),e.jsx(d,{value:"month",children:"Ãšltimo mes"}),e.jsx(d,{value:"quarter",children:"Ãšltimo trimestre"}),e.jsx(d,{value:"year",children:"Ãšltimo aÃ±o"})]})]})]})]})})]}),v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(j,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Visitantes"}),e.jsx("p",{className:"text-2xl font-bold text-[#067f5f]",children:v.summary.totalVisitors.toLocaleString()})]}),e.jsx(Me,{className:"h-8 w-8 text-[#067f5f]"})]})})}),e.jsx(j,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Promedio Diario"}),e.jsx("p",{className:"text-2xl font-bold text-[#00a587]",children:v.summary.avgDaily})]}),e.jsx(ls,{className:"h-8 w-8 text-[#00a587]"})]})})}),e.jsx(j,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Registros"}),e.jsx("p",{className:"text-2xl font-bold text-[#bcd256]",children:v.summary.totalRecords})]}),e.jsx(X,{className:"h-8 w-8 text-[#bcd256]"})]})})}),e.jsx(j,{children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Parques Ãšnicos"}),e.jsx("p",{className:"text-2xl font-bold text-[#8498a5]",children:v.summary.uniqueParks})]}),e.jsx(Z,{className:"h-8 w-8 text-[#8498a5]"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(j,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(is,{className:"h-5 w-5"}),"DistribuciÃ³n DemogrÃ¡fica"]})}),e.jsx(u,{children:e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(ns,{children:[e.jsx(ds,{data:v.charts.demographic,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,percent:r})=>`${s} ${(r*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:v.charts.demographic.map((s,r)=>e.jsx(cs,{fill:s.color},`cell-${r}`))}),e.jsx(ae,{})]})})})})]}),e.jsxs(j,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(os,{className:"h-5 w-5"}),"Tendencia Ãšltimos 7 DÃ­as"]})}),e.jsx(u,{children:e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(xs,{data:v.charts.trend,children:[e.jsx(Te,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"date"}),e.jsx(Pe,{}),e.jsx(ae,{}),e.jsx(te,{type:"monotone",dataKey:"visitors",stroke:"#067f5f",strokeWidth:2}),e.jsx(te,{type:"monotone",dataKey:"adults",stroke:"#00a587",strokeWidth:2}),e.jsx(te,{type:"monotone",dataKey:"children",stroke:"#bcd256",strokeWidth:2})]})})})})]}),e.jsxs(j,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(hs,{className:"h-5 w-5"}),"Visitantes por Parque"]})}),e.jsx(u,{children:e.jsx("div",{className:"h-64",children:e.jsx(se,{width:"100%",height:"100%",children:e.jsxs(us,{data:v.charts.parks,children:[e.jsx(Te,{strokeDasharray:"3 3"}),e.jsx(Fe,{dataKey:"parkName",angle:-45,textAnchor:"end",height:100}),e.jsx(Pe,{}),e.jsx(ae,{}),e.jsx(ms,{dataKey:"visitors",fill:"#067f5f"})]})})})})]}),e.jsxs(j,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"MÃ©todos de Conteo"]})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-3",children:v.charts.methods.map((s,r)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.method}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.count," registros"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-lg font-semibold text-[#067f5f]",children:s.visitors.toLocaleString()}),e.jsx("p",{className:"text-sm text-gray-600",children:"visitantes"})]})]},r))})})]})]}),e.jsxs(j,{children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"AnÃ¡lisis por Condiciones ClimÃ¡ticas"]})}),e.jsx(u,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Clima"}),e.jsx("th",{className:"text-center p-2",children:"Registros"}),e.jsx("th",{className:"text-center p-2",children:"Total Visitantes"}),e.jsx("th",{className:"text-center p-2",children:"Promedio"})]})}),e.jsx("tbody",{children:v.charts.weather.map((s,r)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2 font-medium",children:s.weather}),e.jsx("td",{className:"text-center p-2",children:s.count}),e.jsx("td",{className:"text-center p-2",children:s.visitors.toLocaleString()}),e.jsx("td",{className:"text-center p-2",children:Math.round(s.visitors/s.count)})]},r))})]})})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(m,{className:"bg-[#067f5f] hover:bg-[#00a587]",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Exportar Reporte"]})})]}),!v&&e.jsx(j,{children:e.jsx(u,{className:"p-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay datos disponibles para generar reportes"}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"AsegÃºrate de tener registros de visitantes para visualizar los anÃ¡lisis"})]})})})]})})]}),Ve&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs(j,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(F,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Nuevo Registro de Visitantes"]})}),e.jsx(u,{children:e.jsxs("form",{onSubmit:Ke,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Modo de conteo *"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(m,{type:"button",variant:g==="daily"?"default":"outline",onClick:()=>ce("daily"),className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Conteo diario"]}),e.jsxs(m,{type:"button",variant:g==="range"?"default":"outline",onClick:()=>ce("range"),className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Rango de fechas"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"parkId",children:"Parque *"}),e.jsxs(I,{value:a.parkId.toString(),onValueChange:s=>p({...a,parkId:parseInt(s)}),children:[e.jsx(V,{children:e.jsx(q,{placeholder:"Selecciona un parque"})}),e.jsx(A,{children:w&&Array.isArray(w)&&w.filter(s=>s.id&&s.name).map(s=>e.jsx(d,{value:s.id.toString(),children:s.name},s.id))})]})]}),g==="daily"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"date",children:"Fecha *"}),e.jsx(k,{type:"date",value:a.date,onChange:s=>p({...a,date:s.target.value}),required:!0})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Rango de fechas *"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"startDate",className:"text-sm",children:"Desde"}),e.jsx(k,{type:"date",value:a.startDate,onChange:s=>p({...a,startDate:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"endDate",className:"text-sm",children:"Hasta"}),e.jsx(k,{type:"date",value:a.endDate,onChange:s=>p({...a,endDate:s.target.value}),required:!0})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"p-4 border rounded-lg bg-blue-50",children:[e.jsx("h3",{className:"font-semibold text-blue-900 mb-3",children:"Contador de Visitantes"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"adults",children:"Adultos"}),e.jsx(k,{type:"number",min:"0",value:a.adults,onChange:s=>p({...a,adults:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"children",children:"NiÃ±os"}),e.jsx(k,{type:"number",min:"0",value:a.children,onChange:s=>p({...a,children:parseInt(s.target.value)||0})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"seniors",children:"Adultos mayores"}),e.jsx(k,{type:"number",min:"0",value:a.seniors,onChange:s=>p({...a,seniors:parseInt(s.target.value)||0})})]})]})]}),e.jsxs("div",{className:"p-4 border rounded-lg bg-pink-50",children:[e.jsx("h3",{className:"font-semibold text-pink-900 mb-3",children:"Contador de Mascotas"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"pets",children:"Mascotas (perros)"}),e.jsx(k,{type:"number",min:"0",value:a.pets,onChange:s=>p({...a,pets:parseInt(s.target.value)||0})})]}),e.jsx("div",{className:"text-sm text-pink-700 mt-2",children:"Conteo separado para mascotas que ingresan al parque"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("div",{className:"p-4 bg-emerald-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-700",children:a.adults+a.children+a.seniors}),e.jsx("div",{className:"text-sm text-emerald-600",children:"Total de visitantes"})]})}),e.jsx("div",{className:"p-4 bg-pink-50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-pink-700",children:a.pets}),e.jsx("div",{className:"text-sm text-pink-600",children:"Total de mascotas"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"countingMethod",children:"MÃ©todo de conteo *"}),e.jsxs(I,{value:a.countingMethod,onValueChange:s=>p({...a,countingMethod:s}),children:[e.jsx(V,{children:e.jsx(q,{})}),e.jsxs(A,{children:[e.jsx(d,{value:"estimation",children:"EstimaciÃ³n"}),e.jsx(d,{value:"manual_counter",children:"Contador manual"}),e.jsx(d,{value:"event_based",children:"Basado en eventos"}),e.jsx(d,{value:"entrance_control",children:"Control de acceso"})]})]})]}),g==="daily"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"dayType",children:"Tipo de dÃ­a *"}),e.jsxs(I,{value:a.dayType,onValueChange:s=>p({...a,dayType:s}),children:[e.jsx(V,{children:e.jsx(q,{})}),e.jsxs(A,{children:[e.jsx(d,{value:"weekday",children:"DÃ­a laborable"}),e.jsx(d,{value:"weekend",children:"Fin de semana"}),e.jsx(d,{value:"holiday",children:"DÃ­a festivo"})]})]})]})]}),g==="daily"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"weather",children:"Clima"}),e.jsxs(I,{value:a.weather,onValueChange:s=>p({...a,weather:s}),children:[e.jsx(V,{children:e.jsx(q,{})}),e.jsxs(A,{children:[e.jsx(d,{value:"sunny",children:"Soleado"}),e.jsx(d,{value:"cloudy",children:"Nublado"}),e.jsx(d,{value:"rainy",children:"Lluvioso"}),e.jsx(d,{value:"other",children:"Otro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"notes",children:"Notas adicionales"}),e.jsx(js,{value:a.notes,onChange:s=>p({...a,notes:s.target.value}),placeholder:"Observaciones, eventos especiales, etc.",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>G(!1),children:"Cancelar"}),e.jsx(m,{type:"submit",className:"bg-emerald-600 hover:bg-emerald-700",disabled:_.isPending,children:_.isPending?"Guardando...":"Guardar Registro"})]})]})})]})})]})})}export{bs as default};
