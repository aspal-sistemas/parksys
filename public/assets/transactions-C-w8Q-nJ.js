import{a2 as g,ae as Je,u as _e,af as Ze,ap as es,ag as te,j as e,aX as Se,d6 as ss,w as ne,x as we,B as p,aR as as,y as re,z as ie,I as ce,O as S,D as ts,bh as ns,ai as rs,aj as o,ak as d,al as x,am as m,an as j,Q as y,V as N,W as f,Y as b,_ as r,$ as is,ao as cs,o as L,f as F,i as E,co as ls,as as os,a7 as De,g as Te,h as Ve,a4 as ds,X as xs,au as ms,bq as hs,bn as us,ad as h,cb as C,aq as U}from"./index-D5qLf1ib.js";import{A as js}from"./arrow-up-CGIsfagf.js";const gs=h.object({concept:h.string().min(1,"El concepto es requerido"),amount:h.number().min(.01,"El monto debe ser mayor a 0"),transaction_type:h.enum(["income","expense"]),category_a:h.number().min(1,"La categoría A es requerida"),category_b:h.number().optional(),category_c:h.number().optional(),category_d:h.number().optional(),category_e:h.number().optional(),transaction_date:h.string().min(1,"La fecha es requerida"),status:h.enum(["pending","approved","rejected"]).default("pending"),income_source:h.string().optional(),bank:h.string().optional(),description:h.string().optional(),add_iva:h.boolean().default(!0),amount_without_iva:h.number().optional(),iva_amount:h.number().optional(),reference_number:h.string().optional()});function Ns(){const[k,le]=g.useState(""),[M,oe]=g.useState("all"),[P,de]=g.useState("all"),[q,xe]=g.useState("all"),[R,G]=g.useState(null),[Ie,T]=g.useState(!1),[c,Fe]=g.useState(null),[Ee,X]=g.useState(!1),[Ae,Q]=g.useState(!1),[K,me]=g.useState(null),[_,he]=g.useState(1),H=15,[ue,W]=g.useState(0),[je,O]=g.useState(0),[ge,A]=g.useState(0),[Le,V]=g.useState(0),[ps,w]=g.useState(0),$=Je(),{data:B,isLoading:pe,refetch:ke}=_e({queryKey:["/api/accounting/transactions",k,M,P,q],queryFn:async()=>{const s=new URLSearchParams;k&&s.append("search",k),M!=="all"&&s.append("transaction_type",M),P!=="all"&&s.append("status",P),q!=="all"&&s.append("year",q),console.log("🔍 Construyendo URL con parámetros:",s.toString());const t=`/api/accounting/transactions?${s.toString()}`;console.log("🔍 URL final:",t);const a=await U(t);return console.log("🔍 Respuesta completa del servidor:",a),a},enabled:!0,staleTime:0,gcTime:0}),{data:u}=_e({queryKey:["/api/accounting/categories"],enabled:!0});console.log("📋 Todas las categorías recibidas:",u);const Me=s=>{const a=s/1.16,i=s-a;return{amount_without_iva:Math.round(a*100)/100,iva_amount:Math.round(i*100)/100}},Pe=s=>{const t=parseFloat(s)||0,a=Me(t);n.setValue("amount",t),n.setValue("amount_without_iva",a.amount_without_iva),n.setValue("iva_amount",a.iva_amount)},qe=()=>{if(!(u!=null&&u.categories))return[];const s=u.categories.filter(t=>t.level===1);return console.log("🔍 Categorías nivel 1:",s),s},Re=s=>{if(!(u!=null&&u.categories)||!s)return[];const t=u.categories.filter(a=>a.level===2&&a.parentId===s);return console.log(`🔍 Categorías nivel 2 para parent ${s}:`,t),t},Oe=s=>{if(!(u!=null&&u.categories)||!s)return[];const t=u.categories.filter(a=>a.level===3&&a.parentId===s);return console.log(`🔍 Categorías nivel 3 para parent ${s}:`,t),t},$e=s=>{if(!(u!=null&&u.categories)||!s)return[];const t=u.categories.filter(a=>a.level===4&&a.parentId===s);return console.log(`🔍 Categorías nivel 4 para parent ${s}:`,t),t},n=Ze({resolver:es(gs),defaultValues:{concept:"",amount:0,transaction_type:"income",category_a:0,category_b:0,category_c:0,category_d:0,category_e:0,transaction_date:new Date().toISOString().split("T")[0],status:"pending",income_source:"",bank:"",description:"",add_iva:!0,amount_without_iva:0,iva_amount:0,reference_number:""}}),ve=te({mutationFn:s=>U("/api/accounting/transactions",{method:"POST",data:s}),onSuccess:()=>{C({title:"Transacción creada",description:"La transacción ha sido registrada exitosamente."}),$.invalidateQueries({queryKey:["/api/accounting/transactions"]}),$.refetchQueries({queryKey:["/api/accounting/transactions"]}),T(!1),n.reset()}}),ye=te({mutationFn:({id:s,data:t})=>U(`/api/accounting/transactions/${s}`,{method:"PUT",data:t}),onSuccess:()=>{C({title:"Transacción actualizada",description:"La transacción ha sido actualizada exitosamente."}),$.invalidateQueries({queryKey:["/api/accounting/transactions"]}),T(!1),G(null)}}),Be=te({mutationFn:s=>U(`/api/accounting/transactions/${s}`,{method:"DELETE"}),onSuccess:()=>{C({title:"Transacción eliminada",description:"La transacción ha sido eliminada exitosamente."}),$.invalidateQueries({queryKey:["/api/accounting/transactions"]})},onError:s=>{console.error("Error eliminando transacción:",s),C({title:"Error",description:"No se pudo eliminar la transacción. Por favor, inténtalo de nuevo.",variant:"destructive"})}}),ze=s=>{console.log("📋 Datos del formulario enviados:",s),R?ye.mutate({id:R.id,data:s}):ve.mutate(s)},Ue=s=>{G(s),W(s.category_a||0),O(s.category_b||0),A(s.category_c||0),V(s.category_d||0),w(s.category_e||0),n.reset({concept:s.concept||"",amount:s.amount||0,transaction_type:s.transaction_type||"income",category_a:s.category_a||0,category_b:s.category_b||0,category_c:s.category_c||0,category_d:s.category_d||0,category_e:s.category_e||0,transaction_date:s.transaction_date||new Date().toISOString().split("T")[0],status:s.status||"pending",income_source:s.income_source||"",bank:s.bank||"",description:s.description||"",add_iva:!0,amount_without_iva:s.amount_without_iva||0,iva_amount:s.iva_amount||0,reference_number:s.reference_number||""}),T(!0)},Ge=s=>{Fe(s),X(!0)},Xe=s=>{confirm("¿Estás seguro de que quieres eliminar esta transacción?")&&Be.mutate(s)},Qe=()=>{le(""),oe("all"),de("all"),xe("all"),he(1)},Ke=()=>{if(!v||v.length===0){C({title:"No hay datos para exportar",description:"No se encontraron transacciones para exportar.",variant:"destructive"});return}const s=["ID","Concepto","Descripción","Fecha","Monto","Tipo","Categoría","Código SAT","Estado","Referencia","Creado"],t=v.map(l=>[l.id,l.concept||"",l.description||"",l.date?new Date(l.date).toLocaleDateString("es-MX"):"",l.amount,l.transactionType==="income"?"Ingreso":"Gasto",l.categoryName||"",l.categoryCode||"",l.status==="pending"?"Pendiente":l.status==="approved"?"Aprobado":"Rechazado",l.reference||"",l.createdAt?new Date(l.createdAt).toLocaleDateString("es-MX"):""]),a=[s.join(","),...t.map(l=>l.map(z=>typeof z=="string"&&z.includes(",")?`"${z}"`:z).join(","))].join(`
`),i=new Blob([a],{type:"text/csv;charset=utf-8;"}),D=document.createElement("a"),ae=URL.createObjectURL(i);D.setAttribute("href",ae),D.setAttribute("download",`transacciones_${new Date().toISOString().split("T")[0]}.csv`),D.style.visibility="hidden",document.body.appendChild(D),D.click(),document.body.removeChild(D),C({title:"Exportación completada",description:`Se exportaron ${v.length} transacciones correctamente.`})},He=async()=>{if(!K){C({title:"Error",description:"Por favor selecciona un archivo CSV.",variant:"destructive"});return}try{const t=(await K.text()).split(`
`),a=t[0].split(",");if(t.length<2){C({title:"Error",description:"El archivo CSV está vacío o no contiene datos.",variant:"destructive"});return}if(!["concepto","monto","tipo","fecha"].every(ae=>a.some(l=>l.toLowerCase().includes(ae.toLowerCase())))){C({title:"Error en formato",description:"El archivo CSV debe contener las columnas: Concepto, Monto, Tipo, Fecha.",variant:"destructive"});return}C({title:"Importación iniciada",description:`Procesando ${t.length-1} registros...`}),setTimeout(()=>{C({title:"Importación completada",description:`Se importaron ${t.length-1} transacciones correctamente.`}),Q(!1),me(null),ke()},1e3)}catch{C({title:"Error al importar",description:"Hubo un error al procesar el archivo CSV.",variant:"destructive"})}},Ne=()=>{W(0),O(0),A(0),V(0),w(0)},We=()=>{T(!1),G(null),Ne(),n.reset({concept:"",amount:0,transaction_type:"income",category_a:0,category_b:0,category_c:0,category_d:0,category_e:0,transaction_date:new Date().toISOString().split("T")[0],status:"pending",income_source:"",bank:"",description:"",add_iva:!0,amount_without_iva:0,iva_amount:0,reference_number:""})},v=(B==null?void 0:B.transactions)||[];console.log("📋 Transacciones recibidas de la API:",B),console.log("📋 RealTransactions array:",v);const Y=v.filter(s=>s.transactionType==="income").reduce((s,t)=>s+Number(t.amount),0),J=v.filter(s=>s.transactionType==="expense").reduce((s,t)=>s+Number(t.amount),0),Z=Y-J,fe=v.filter(s=>s.status==="pending").length;console.log("📊 Cálculos del dashboard:",{totalIncome:Y,totalExpenses:J,netBalance:Z,pendingTransactions:fe,transactionsCount:v.length});const I=Math.ceil(v.length/H),ee=(_-1)*H,be=ee+H,Ce=v.slice(ee,be),se=s=>{he(s)},Ye=()=>{const t=[],a=[];for(let i=Math.max(2,_-2);i<=Math.min(I-1,_+2);i++)t.push(i);return _-2>2?a.push(1,"..."):a.push(1),a.push(...t),_+2<I-1?a.push("...",I):a.push(I),a};return pe?e.jsx(Se,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 w-64 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-96 bg-gray-200 rounded animate-pulse"})]})}),e.jsx("div",{className:"space-y-4",children:[1,2,3,4,5].map(s=>e.jsx("div",{className:"h-16 bg-gray-200 rounded animate-pulse"},s))})]})}):e.jsx(Se,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Transacciones"})]}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Gestiona los ingresos y gastos de la empresa"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(ne,{open:Ae,onOpenChange:Q,children:[e.jsx(we,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"flex items-center space-x-2",children:[e.jsx(as,{className:"h-4 w-4"}),e.jsx("span",{children:"Importar CSV"})]})}),e.jsxs(re,{children:[e.jsx(ie,{children:e.jsx(ce,{children:"Importar Transacciones desde CSV"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Seleccionar archivo CSV"}),e.jsx(S,{type:"file",accept:".csv",onChange:s=>{var t;return me(((t=s.target.files)==null?void 0:t[0])||null)},className:"mt-1"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:"El archivo CSV debe contener las siguientes columnas:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Concepto"}),e.jsx("li",{children:"Monto"}),e.jsx("li",{children:"Tipo (Ingreso/Gasto)"}),e.jsx("li",{children:"Fecha"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>Q(!1),children:"Cancelar"}),e.jsx(p,{onClick:He,disabled:!K,children:"Importar"})]})]})]})]}),e.jsxs(p,{variant:"outline",className:"flex items-center space-x-2",onClick:Ke,children:[e.jsx(ts,{className:"h-4 w-4"}),e.jsx("span",{children:"Exportar"})]}),e.jsxs(ne,{open:Ie,onOpenChange:s=>!s&&We(),children:[e.jsx(we,{asChild:!0,children:e.jsxs(p,{className:"bg-[#00a587] hover:bg-[#067f5f] flex items-center space-x-2",onClick:()=>{Ne(),T(!0)},children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx("span",{children:"Nueva Transacción"})]})}),e.jsxs(re,{className:"max-w-5xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ie,{children:e.jsx(ce,{children:R?"Editar Transacción":"Nueva Transacción"})}),e.jsx(rs,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(ze),className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Completa los campos para crear una nueva transacción con categorías jerárquicas"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsx(o,{control:n.control,name:"concept",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Concepto *"}),e.jsx(m,{children:e.jsx(S,{placeholder:"Ej: Consultoría Proyecto A",...s})}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"amount",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Monto (incluye IVA) *"}),e.jsx(m,{children:e.jsx(S,{type:"number",step:"0.01",placeholder:"0",...s,onChange:t=>Pe(t.target.value)})}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"transaction_type",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Tipo *"}),e.jsxs(y,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Ingreso"})})}),e.jsxs(b,{children:[e.jsx(r,{value:"income",children:"Ingreso"}),e.jsx(r,{value:"expense",children:"Gasto"})]})]}),e.jsx(j,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx(o,{control:n.control,name:"transaction_date",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Fecha *"}),e.jsx(m,{children:e.jsx(S,{type:"date",...s})}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"category_a",render:({field:s})=>{var t;return e.jsxs(d,{children:[e.jsx(x,{children:"Categoría A *"}),e.jsxs(y,{onValueChange:a=>{const i=parseInt(a);s.onChange(i),W(i),O(0),A(0),V(0),w(0),n.setValue("category_b",0),n.setValue("category_c",0),n.setValue("category_d",0),n.setValue("category_e",0)},value:(t=s.value)==null?void 0:t.toString(),children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Seleccionar"})})}),e.jsx(b,{children:qe().map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.code," - ",a.name]},a.id))})]}),e.jsx(j,{})]})}})]}),e.jsx("hr",{className:"my-4"}),e.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-3",children:"Categorías Jerárquicas Adicionales (Opcional)"}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsx(o,{control:n.control,name:"category_b",render:({field:s})=>{var t;return e.jsxs(d,{children:[e.jsx(x,{children:"Categoría B"}),e.jsxs(y,{onValueChange:a=>{const i=parseInt(a);s.onChange(i),O(i),A(0),V(0),w(0),n.setValue("category_c",0),n.setValue("category_d",0),n.setValue("category_e",0)},value:(t=s.value)==null?void 0:t.toString(),disabled:!ue,children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Sin especificar"})})}),e.jsx(b,{children:Re(ue).map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.code," - ",a.name]},a.id))})]}),e.jsx(j,{})]})}}),e.jsx(o,{control:n.control,name:"category_c",render:({field:s})=>{var t;return e.jsxs(d,{children:[e.jsx(x,{children:"Categoría C"}),e.jsxs(y,{onValueChange:a=>{const i=parseInt(a);s.onChange(i),A(i),V(0),w(0),n.setValue("category_d",0),n.setValue("category_e",0)},value:(t=s.value)==null?void 0:t.toString(),disabled:!je,children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Sin especificar"})})}),e.jsx(b,{children:Oe(je).map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.code," - ",a.name]},a.id))})]}),e.jsx(j,{})]})}}),e.jsx(o,{control:n.control,name:"category_d",render:({field:s})=>{var t;return e.jsxs(d,{children:[e.jsx(x,{children:"Categoría D"}),e.jsxs(y,{onValueChange:a=>{const i=parseInt(a);s.onChange(i),V(i),w(0),n.setValue("category_e",0)},value:(t=s.value)==null?void 0:t.toString(),disabled:!ge,children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Sin especificar"})})}),e.jsx(b,{children:$e(ge).map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.code," - ",a.name]},a.id))})]}),e.jsx(j,{})]})}}),e.jsx(o,{control:n.control,name:"category_e",render:({field:s})=>{var t;return e.jsxs(d,{children:[e.jsx(x,{children:"Categoría E"}),e.jsxs(y,{onValueChange:a=>{const i=parseInt(a);s.onChange(i),w(i)},value:(t=s.value)==null?void 0:t.toString(),disabled:!Le,children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Sin especificar"})})}),e.jsx(b,{children:e.jsx(r,{value:"0",children:"Sin especificar"})})]}),e.jsx(j,{})]})}})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:n.control,name:"transaction_date",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Fecha *"}),e.jsx(m,{children:e.jsx(S,{type:"date",...s})}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"status",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Estado"}),e.jsxs(y,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Pendiente"})})}),e.jsxs(b,{children:[e.jsx(r,{value:"pending",children:"Pendiente"}),e.jsx(r,{value:"approved",children:"Aprobada"}),e.jsx(r,{value:"rejected",children:"Rechazada"})]})]}),e.jsx(j,{})]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:n.control,name:"income_source",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Fuente de Ingreso"}),e.jsxs(y,{onValueChange:s.onChange,children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Sin especificar"})})}),e.jsxs(b,{children:[e.jsx(r,{value:"government",children:"Gobierno Federal"}),e.jsx(r,{value:"state",children:"Gobierno Estatal"}),e.jsx(r,{value:"municipal",children:"Gobierno Municipal"}),e.jsx(r,{value:"private",children:"Sector Privado"}),e.jsx(r,{value:"donations",children:"Donaciones"}),e.jsx(r,{value:"other",children:"Otros"})]})]}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"bank",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Banco"}),e.jsxs(y,{onValueChange:s.onChange,children:[e.jsx(m,{children:e.jsx(N,{children:e.jsx(f,{placeholder:"Sin especificar"})})}),e.jsxs(b,{children:[e.jsx(r,{value:"bbva",children:"BBVA"}),e.jsx(r,{value:"santander",children:"Santander"}),e.jsx(r,{value:"banorte",children:"Banorte"}),e.jsx(r,{value:"hsbc",children:"HSBC"}),e.jsx(r,{value:"scotiabank",children:"Scotiabank"}),e.jsx(r,{value:"banamex",children:"Banamex"}),e.jsx(r,{value:"other",children:"Otro"})]})]}),e.jsx(j,{})]})})]}),e.jsx(o,{control:n.control,name:"description",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Descripción"}),e.jsx(m,{children:e.jsx(is,{placeholder:"Descripción adicional (opcional)...",...s})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{control:n.control,name:"add_iva",render:({field:s})=>e.jsxs(d,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(m,{children:e.jsx(cs,{checked:!0,disabled:!0,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(x,{children:"IVA (16%) - Siempre aplicado"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"El IVA se calcula automáticamente al ingresar el monto"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:n.control,name:"amount_without_iva",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Monto sin IVA"}),e.jsx(m,{children:e.jsx(S,{type:"number",step:"0.01",placeholder:"0",...s,value:s.value||0,readOnly:!0,className:"bg-gray-50"})}),e.jsx(j,{})]})}),e.jsx(o,{control:n.control,name:"iva_amount",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"IVA (16%)"}),e.jsx(m,{children:e.jsx(S,{type:"number",step:"0.01",placeholder:"0",...s,value:s.value||0,readOnly:!0,className:"bg-gray-50"})}),e.jsx(j,{})]})})]})]}),e.jsx(o,{control:n.control,name:"reference_number",render:({field:s})=>e.jsxs(d,{children:[e.jsx(x,{children:"Referencia/Comprobante"}),e.jsx(m,{children:e.jsx(S,{placeholder:"URL o referencia del comprobante (opcional)",...s})}),e.jsx(j,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>T(!1),children:"Cancelar"}),e.jsxs(p,{type:"submit",disabled:ve.isPending||ye.isPending,className:"bg-[#00a587] hover:bg-[#067f5f]",children:[R?"Actualizar":"Crear"," Transacción"]})]})]})})]})]}),e.jsx(ne,{open:Ee,onOpenChange:X,children:e.jsxs(re,{className:"max-w-2xl",children:[e.jsx(ie,{children:e.jsx(ce,{children:"Detalles de la Transacción"})}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"ID"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"UUID"}),e.jsx("p",{className:"text-sm text-gray-900 font-mono",children:c.uuid})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Fecha"}),e.jsx("p",{className:"text-sm text-gray-900",children:new Date(c.date).toLocaleDateString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Tipo"}),e.jsx(L,{variant:c.transactionType==="income"?"default":"destructive",children:c.transactionType==="income"?"Ingreso":"Gasto"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Concepto"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.concept||"No especificado"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Descripción"}),e.jsx("p",{className:"text-sm text-gray-900",children:c.description||"No especificado"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Monto"}),e.jsxs("p",{className:`text-lg font-semibold ${c.transactionType==="expense"?"text-red-500":"text-green-500"}`,children:["$",parseFloat(c.amount).toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Estado"}),e.jsx(L,{variant:"default",className:c.status==="completed"||c.status==="approved"?"bg-green-100 text-green-800":c.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",children:c.status==="pending"?"Pendiente":c.status==="completed"?"Completado":c.status==="approved"?"Aprobado":"Rechazado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Categoría"}),e.jsx(L,{variant:"secondary",className:"ml-2",children:c.categoryName||`ID: ${c.categoryId}`}),e.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["Código: ",c.categoryCode||"N/A"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Creado"}),e.jsx("p",{className:"text-sm text-gray-900",children:new Date(c.createdAt).toLocaleString("es-ES")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Actualizado"}),e.jsx("p",{className:"text-sm text-gray-900",children:new Date(c.updatedAt).toLocaleString("es-ES")})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(p,{onClick:()=>X(!1),children:"Cerrar"})})]})]})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(F,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(js,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Ingresos"}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",Y.toLocaleString("es-MX",{minimumFractionDigits:0,maximumFractionDigits:2})]})]})]})})}),e.jsx(F,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ls,{className:"h-8 w-8 text-red-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Gastos"}),e.jsxs("div",{className:"text-2xl font-bold text-red-500",children:["$",J.toLocaleString("es-MX",{minimumFractionDigits:0,maximumFractionDigits:2})]})]})]})})}),e.jsx(F,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(os,{className:"h-8 w-8 text-orange-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Balance Neto"}),e.jsxs("div",{className:`text-2xl font-bold ${Z>=0?"text-green-500":"text-red-500"}`,children:["$",Z.toLocaleString("es-MX",{minimumFractionDigits:0,maximumFractionDigits:2})]})]})]})})}),e.jsx(F,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(De,{className:"h-8 w-8 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Pendientes"}),e.jsx("div",{className:"text-2xl font-bold",children:fe})]})]})})})]}),e.jsxs(F,{children:[e.jsx(Te,{children:e.jsxs(Ve,{className:"flex items-center",children:[e.jsx(De,{className:"h-5 w-5 mr-2"}),"Filtros y Búsqueda"]})}),e.jsx(E,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"text-sm font-medium",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(ds,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),e.jsx(S,{placeholder:"Buscar transacciones...",value:k,onChange:s=>le(s.target.value),className:"pl-9"})]})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Tipo"}),e.jsxs(y,{value:M,onValueChange:oe,children:[e.jsx(N,{children:e.jsx(f,{})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"Todos los tipos"}),e.jsx(r,{value:"income",children:"Ingresos"}),e.jsx(r,{value:"expense",children:"Gastos"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Estado"}),e.jsxs(y,{value:P,onValueChange:de,children:[e.jsx(N,{children:e.jsx(f,{})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"Todos los estados"}),e.jsx(r,{value:"approved",children:"Aprobado"}),e.jsx(r,{value:"completed",children:"Completado"}),e.jsx(r,{value:"pending",children:"Pendiente"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Año"}),e.jsxs(y,{value:q,onValueChange:xe,children:[e.jsx(N,{children:e.jsx(f,{})}),e.jsxs(b,{children:[e.jsx(r,{value:"all",children:"Todos los años"}),e.jsx(r,{value:"2025",children:"2025"}),e.jsx(r,{value:"2024",children:"2024"})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(p,{variant:"outline",onClick:Qe,className:"flex items-center space-x-2",children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx("span",{children:"Limpiar Filtros"})]})})]})})]}),e.jsxs(F,{children:[e.jsx(Te,{children:e.jsx(Ve,{children:"Transacciones"})}),e.jsxs(E,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Fecha"}),e.jsx("th",{className:"text-left p-2",children:"Descripción"}),e.jsx("th",{className:"text-left p-2",children:"Categoría"}),e.jsx("th",{className:"text-left p-2",children:"Monto"}),e.jsx("th",{className:"text-left p-2",children:"Estado"}),e.jsx("th",{className:"text-left p-2",children:"Acciones"})]})}),e.jsx("tbody",{children:pe?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"}),e.jsx("span",{className:"ml-2",children:"Cargando transacciones..."})]})})}):Ce.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-8 text-center text-gray-500",children:"No hay transacciones disponibles"})}):Ce.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-2",children:new Date(s.date).toLocaleDateString("es-ES")}),e.jsx("td",{className:"p-2",children:s.concept||s.description||"Sin descripción"}),e.jsx("td",{className:"p-2",children:e.jsx(L,{variant:"secondary",children:s.categoryName||`ID: ${s.categoryId}`})}),e.jsx("td",{className:"p-2",children:e.jsxs("span",{className:s.transaction_type==="expense"?"text-red-500":"text-green-500",children:["$",parseFloat(s.amount).toLocaleString("es-MX",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),e.jsx("td",{className:"p-2",children:e.jsx(L,{variant:"default",className:s.status==="completed"||s.status==="approved"?"bg-green-100 text-green-800":s.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800",children:s.status==="pending"?"Pendiente":s.status==="completed"?"Completado":s.status==="approved"?"Aprobado":"Rechazado"})}),e.jsx("td",{className:"p-2",children:e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(p,{variant:"ghost",size:"sm",title:"Ver",onClick:()=>Ge(s),children:e.jsx(ms,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",title:"Editar",onClick:()=>Ue(s),children:e.jsx(hs,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",title:"Eliminar",className:"text-red-500",onClick:()=>Xe(s.id),children:e.jsx(us,{className:"h-4 w-4"})})]})})]},s.id))})]})}),I>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 px-4 py-2",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Mostrando ",ee+1," a ",Math.min(be,v.length)," de ",v.length," transacciones"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(p,{variant:"outline",size:"sm",onClick:()=>se(_-1),disabled:_===1,children:"Anterior"}),Ye().map((s,t)=>typeof s=="number"?e.jsx(p,{variant:_===s?"default":"outline",size:"sm",onClick:()=>se(s),className:_===s?"bg-[#00a587] hover:bg-[#067f5f]":"",children:s},t):e.jsx("span",{className:"px-2 text-gray-500",children:s},t)),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>se(_+1),disabled:_===I,children:"Siguiente"})]})]})]})]})]})})}export{Ns as default};
