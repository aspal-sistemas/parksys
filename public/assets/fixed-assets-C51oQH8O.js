import{e as ie,a6 as te,al as ce,Y as d,u as z,a8 as F,j as e,aB as P,B as u,A as re,as as B,D as ne,p as le,aW as oe,r as de,t as ue,v as xe,y as n,I as x,z as b,H as C,J as q,K as D,N as a,O as he,C as p,a as w,b as A,c as v,ak as me,Z as je,aj as pe,ba as ve,bb as ge,bc as I,bd as c,be as fe,bf as r,f as ye,b3 as Ne,b4 as be,ah as E}from"./index-BBGHPKhn.js";import{T as Ce}from"./trending-down-_xwArPfc.js";function we(){const{toast:l}=ie(),S=te(),[,K]=ce(),[k,h]=d.useState(!1),[g,T]=d.useState(null),[m,H]=d.useState(""),[f,Q]=d.useState("all"),[y,R]=d.useState("all"),[i,t]=d.useState({name:"",category:"",acquisitionDate:"",acquisitionCost:0,usefulLife:5,depreciationMethod:"straight-line",location:"",description:""}),{data:N=[],isLoading:U}=z({queryKey:["/api/accounting/fixed-assets"],enabled:!0});z({queryKey:["/api/accounting/asset-categories"],enabled:!0});const L=F({mutationFn:s=>E("/api/accounting/fixed-assets","POST"),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/accounting/fixed-assets"]}),h(!1),V(),l({title:"Activo creado",description:"El activo fijo ha sido registrado exitosamente"})},onError:s=>{l({title:"Error",description:"No se pudo crear el activo fijo",variant:"destructive"})}}),M=F({mutationFn:({id:s,data:o})=>E(`/api/accounting/fixed-assets/${s}`,"PUT"),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/accounting/fixed-assets"]}),h(!1),T(null),V(),l({title:"Activo actualizado",description:"El activo fijo ha sido actualizado exitosamente"})},onError:s=>{l({title:"Error",description:"No se pudo actualizar el activo fijo",variant:"destructive"})}}),X=F({mutationFn:s=>E(`/api/accounting/fixed-assets/${s}`,"DELETE"),onSuccess:()=>{S.invalidateQueries({queryKey:["/api/accounting/fixed-assets"]}),l({title:"Activo eliminado",description:"El activo fijo ha sido eliminado exitosamente"})},onError:s=>{l({title:"Error",description:"No se pudo eliminar el activo fijo",variant:"destructive"})}}),V=()=>{t({name:"",category:"",acquisitionDate:"",acquisitionCost:0,usefulLife:5,depreciationMethod:"straight-line",location:"",description:""})},$=s=>{s.preventDefault(),g?M.mutate({id:g.id,data:i}):L.mutate(i)},G=s=>{T(s),t({name:s.name,category:s.category,acquisitionDate:s.acquisitionDate,acquisitionCost:s.acquisitionCost,usefulLife:s.usefulLife,depreciationMethod:s.depreciationMethod,location:s.location,description:s.description||""}),h(!0)},J=s=>{confirm("¿Está seguro de que desea eliminar este activo fijo?")&&X.mutate(s)},O=N.filter(s=>{const o=s.name.toLowerCase().includes(m.toLowerCase())||s.category.toLowerCase().includes(m.toLowerCase())||s.location.toLowerCase().includes(m.toLowerCase()),se=f==="all"||s.category===f,ae=y==="all"||s.status===y;return o&&se&&ae}),W=N.length,Y=N.reduce((s,o)=>s+o.currentValue,0),Z=N.reduce((s,o)=>s+o.accumulatedDepreciation,0),j=s=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN",minimumFractionDigits:0,maximumFractionDigits:0}).format(s),_=s=>{switch(s){case"active":return"bg-green-100 text-green-800";case"disposed":return"bg-red-100 text-red-800";case"maintenance":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},ee=s=>{switch(s){case"active":return"Activo";case"disposed":return"Dado de baja";case"maintenance":return"Mantenimiento";default:return"Desconocido"}};return U?e.jsx(P,{children:e.jsx("div",{className:"p-6 space-y-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-8 w-64 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-4 w-96 bg-gray-200 rounded animate-pulse"})]})})})}):e.jsx(P,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>K("/admin/accounting/dashboard"),className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Volver al Módulo"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[e.jsx(B,{className:"h-8 w-8 mr-3 text-blue-600"}),"Activos Fijos"]}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Gestión de activos fijos con depreciación automática"})]})]}),e.jsxs(ne,{open:k,onOpenChange:h,children:[e.jsx(le,{asChild:!0,children:e.jsxs(u,{className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Nuevo Activo Fijo"]})}),e.jsxs(de,{className:"max-w-2xl","aria-describedby":"asset-form-description",children:[e.jsx(ue,{children:e.jsx(xe,{children:g?"Editar Activo Fijo":"Nuevo Activo Fijo"})}),e.jsx("div",{id:"asset-form-description",className:"sr-only",children:"Formulario para crear o editar activos fijos con información detallada"}),e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"Nombre del Activo"}),e.jsx(x,{id:"name",value:i.name,onChange:s=>t({...i,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"category",children:"Categoría"}),e.jsxs(b,{value:i.category,onValueChange:s=>t({...i,category:s}),children:[e.jsx(C,{children:e.jsx(q,{placeholder:"Seleccionar categoría"})}),e.jsxs(D,{children:[e.jsx(a,{value:"mobiliario",children:"Mobiliario"}),e.jsx(a,{value:"equipo-computo",children:"Equipo de Cómputo"}),e.jsx(a,{value:"vehiculos",children:"Vehículos"}),e.jsx(a,{value:"maquinaria",children:"Maquinaria"}),e.jsx(a,{value:"edificios",children:"Edificios"}),e.jsx(a,{value:"equipo-oficina",children:"Equipo de Oficina"}),e.jsx(a,{value:"otros",children:"Otros"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"acquisitionDate",children:"Fecha de Adquisición"}),e.jsx(x,{id:"acquisitionDate",type:"date",value:i.acquisitionDate,onChange:s=>t({...i,acquisitionDate:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"acquisitionCost",children:"Costo de Adquisición"}),e.jsx(x,{id:"acquisitionCost",type:"number",min:"0",step:"0.01",value:i.acquisitionCost,onChange:s=>t({...i,acquisitionCost:parseFloat(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"usefulLife",children:"Vida Útil (años)"}),e.jsx(x,{id:"usefulLife",type:"number",min:"1",max:"50",value:i.usefulLife,onChange:s=>t({...i,usefulLife:parseInt(s.target.value)}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"depreciationMethod",children:"Método de Depreciación"}),e.jsxs(b,{value:i.depreciationMethod,onValueChange:s=>t({...i,depreciationMethod:s}),children:[e.jsx(C,{children:e.jsx(q,{})}),e.jsxs(D,{children:[e.jsx(a,{value:"straight-line",children:"Línea Recta"}),e.jsx(a,{value:"declining-balance",children:"Saldos Decrecientes"}),e.jsx(a,{value:"units-production",children:"Unidades de Producción"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"location",children:"Ubicación"}),e.jsx(x,{id:"location",value:i.location,onChange:s=>t({...i,location:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"description",children:"Descripción"}),e.jsx(he,{id:"description",value:i.description,onChange:s=>t({...i,description:s.target.value}),rows:3})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Cancelar"}),e.jsxs(u,{type:"submit",disabled:L.isPending||M.isPending,children:[g?"Actualizar":"Crear"," Activo"]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(p,{children:[e.jsx(w,{className:"pb-2",children:e.jsxs(A,{className:"text-sm font-medium text-gray-600 flex items-center",children:[e.jsx(B,{className:"h-4 w-4 mr-2 text-blue-600"}),"Total de Activos"]})}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:W}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Activos registrados"})]})]}),e.jsxs(p,{children:[e.jsx(w,{className:"pb-2",children:e.jsxs(A,{className:"text-sm font-medium text-gray-600 flex items-center",children:[e.jsx(me,{className:"h-4 w-4 mr-2 text-green-600"}),"Valor Actual"]})}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:j(Y)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Valor neto contable"})]})]}),e.jsxs(p,{children:[e.jsx(w,{className:"pb-2",children:e.jsxs(A,{className:"text-sm font-medium text-gray-600 flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 text-red-600"}),"Depreciación Acumulada"]})}),e.jsxs(v,{children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:j(Z)}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Total depreciado"})]})]})]}),e.jsx(p,{children:e.jsx(v,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2 min-w-[200px]",children:[e.jsx(je,{className:"h-4 w-4 text-gray-400"}),e.jsx(x,{placeholder:"Buscar activos...",value:m,onChange:s=>H(s.target.value)})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(pe,{className:"h-4 w-4 text-gray-400"}),e.jsxs(b,{value:f,onValueChange:Q,children:[e.jsx(C,{className:"w-40",children:e.jsx(q,{})}),e.jsxs(D,{children:[e.jsx(a,{value:"all",children:"Todas las categorías"}),e.jsx(a,{value:"mobiliario",children:"Mobiliario"}),e.jsx(a,{value:"equipo-computo",children:"Equipo de Cómputo"}),e.jsx(a,{value:"vehiculos",children:"Vehículos"}),e.jsx(a,{value:"maquinaria",children:"Maquinaria"}),e.jsx(a,{value:"edificios",children:"Edificios"}),e.jsx(a,{value:"equipo-oficina",children:"Equipo de Oficina"}),e.jsx(a,{value:"otros",children:"Otros"})]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(b,{value:y,onValueChange:R,children:[e.jsx(C,{className:"w-40",children:e.jsx(q,{})}),e.jsxs(D,{children:[e.jsx(a,{value:"all",children:"Todos los estados"}),e.jsx(a,{value:"active",children:"Activo"}),e.jsx(a,{value:"disposed",children:"Dado de baja"}),e.jsx(a,{value:"maintenance",children:"Mantenimiento"})]})]})})]})})}),e.jsxs(p,{children:[e.jsx(w,{children:e.jsx(A,{children:"Listado de Activos Fijos"})}),e.jsxs(v,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ve,{children:[e.jsx(ge,{children:e.jsxs(I,{children:[e.jsx(c,{children:"Nombre"}),e.jsx(c,{children:"Categoría"}),e.jsx(c,{children:"Fecha Adquisición"}),e.jsx(c,{children:"Costo Original"}),e.jsx(c,{children:"Valor Actual"}),e.jsx(c,{children:"Depreciación"}),e.jsx(c,{children:"Ubicación"}),e.jsx(c,{children:"Estado"}),e.jsx(c,{children:"Acciones"})]})}),e.jsx(fe,{children:O.map(s=>e.jsxs(I,{children:[e.jsx(r,{className:"font-medium",children:s.name}),e.jsx(r,{children:s.category}),e.jsx(r,{children:new Date(s.acquisitionDate).toLocaleDateString("es-MX")}),e.jsx(r,{children:j(s.acquisitionCost)}),e.jsx(r,{children:j(s.currentValue)}),e.jsx(r,{children:j(s.accumulatedDepreciation)}),e.jsx(r,{children:s.location}),e.jsx(r,{children:e.jsx(ye,{className:_(s.status),children:ee(s.status)})}),e.jsx(r,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{variant:"outline",size:"sm",onClick:()=>G(s),children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx(u,{variant:"outline",size:"sm",onClick:()=>J(s.id),children:e.jsx(be,{className:"h-4 w-4"})})]})})]},s.id))})]})}),O.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:m||f!=="all"||y!=="all"?"No se encontraron activos con los filtros aplicados":"No hay activos fijos registrados"})]})]})]})})}export{we as default};
