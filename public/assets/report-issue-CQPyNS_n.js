import{az as K,a2 as t,u as w,j as e,aX as O,B as u,A as Q,f as q,g as P,h as k,ab as I,i as A,N as l,Q as h,V as x,W as j,Y as f,dr as G,_ as r,$ as W,O as D,aW as $,bG as H,cb as d,r as J,ca as U}from"./index-D5qLf1ib.js";const Y=()=>{K();const[n,E]=t.useState(""),[v,T]=t.useState("damage"),[b,F]=t.useState("medium"),[c,M]=t.useState(""),[g,R]=t.useState(""),[y,N]=t.useState(!1),[m,V]=t.useState(null),{data:p=[]}=w({queryKey:["/api/assets"],retry:!1});w({queryKey:["/api/volunteers"],retry:!1});const L=[{id:1,name:"Banca Modelo Colonial",parkId:1,parkName:"Parque Central"},{id:2,name:"Juego Infantil Múltiple",parkId:1,parkName:"Parque Central"},{id:3,name:"Fuente Central",parkId:2,parkName:"Parque Metropolitano"},{id:4,name:"Señalización Informativa",parkId:2,parkName:"Parque Metropolitano"}],S=Array.isArray(p)&&p.length>0?p:L,i=S.find(a=>a.id.toString()===n),B=a=>{a.target.files&&a.target.files.length>0&&V(a.target.files)},z=async a=>{if(a.preventDefault(),!n){d({title:"Error",description:"Debes seleccionar un activo para reportar un problema",variant:"destructive"});return}if(!c.trim()){d({title:"Error",description:"Debes proporcionar una descripción del problema",variant:"destructive"});return}N(!0);try{const s=new FormData;if(s.append("assetId",n),s.append("reportType",v),s.append("priority",b),s.append("description",c),s.append("location",g),s.append("reportDate",J(new Date,"yyyy-MM-dd")),m)for(let o=0;o<m.length;o++)s.append("photos",m[o]);const C=await fetch("/api/assets/report-issue",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`},body:s});if(!C.ok){const o=await C.json();throw new Error(o.message||"Error al reportar el problema")}U.invalidateQueries({queryKey:["/api/assets"]}),d({title:"Problema reportado",description:"El problema ha sido reportado correctamente. Se notificará al responsable del activo."}),window.location.href="/admin/assets"}catch(s){console.error("Error al reportar problema:",s),d({title:"Error",description:"No se pudo reportar el problema. Por favor, intenta de nuevo.",variant:"destructive"})}finally{N(!1)}};return e.jsx(O,{children:e.jsxs("div",{className:"container py-6",children:[e.jsx("div",{className:"mb-6 flex justify-between items-center",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs(u,{variant:"outline",onClick:()=>window.location.href="/admin/assets",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),"Volver a Activos"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Reportar Problema"}),e.jsx("p",{className:"text-muted-foreground",children:"Reporta problemas o daños en activos del parque"})]})]})}),e.jsxs("form",{onSubmit:z,children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(q,{children:[e.jsxs(P,{children:[e.jsx(k,{className:"text-lg",children:"Información del Activo"}),e.jsx(I,{children:"Selecciona el activo que presenta problemas"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"asset",children:"Activo*"}),e.jsxs(h,{value:n,onValueChange:E,required:!0,children:[e.jsx(x,{id:"asset",children:e.jsx(j,{placeholder:"Selecciona un activo"})}),e.jsx(f,{children:e.jsx(G,{children:S.map(a=>e.jsxs(r,{value:a.id.toString(),children:[a.name," (",a.parkName||"Sin parque asignado",")"]},a.id))})})]})]}),n&&e.jsxs("div",{className:"border rounded-md p-4 bg-slate-50",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Información del activo"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Nombre:"}),e.jsx("span",{className:"text-sm font-medium",children:i==null?void 0:i.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Parque:"}),e.jsx("span",{className:"text-sm font-medium",children:(i==null?void 0:i.parkName)||"No asignado"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"reportType",children:"Tipo de Problema*"}),e.jsxs(h,{value:v,onValueChange:T,required:!0,children:[e.jsx(x,{id:"reportType",children:e.jsx(j,{placeholder:"Selecciona un tipo de problema"})}),e.jsxs(f,{children:[e.jsx(r,{value:"damage",children:"Daño físico"}),e.jsx(r,{value:"malfunction",children:"Mal funcionamiento"}),e.jsx(r,{value:"vandalism",children:"Vandalismo"}),e.jsx(r,{value:"safety",children:"Problema de seguridad"}),e.jsx(r,{value:"other",children:"Otro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"priority",children:"Prioridad*"}),e.jsxs(h,{value:b,onValueChange:F,required:!0,children:[e.jsx(x,{id:"priority",children:e.jsx(j,{placeholder:"Selecciona la prioridad"})}),e.jsxs(f,{children:[e.jsx(r,{value:"low",children:"Baja - Puede esperar"}),e.jsx(r,{value:"medium",children:"Media - Atención en los próximos días"}),e.jsx(r,{value:"high",children:"Alta - Requiere atención inmediata"})]})]})]})]})]}),e.jsxs(q,{children:[e.jsxs(P,{children:[e.jsx(k,{className:"text-lg",children:"Detalles del Problema"}),e.jsx(I,{children:"Proporciona información detallada sobre el problema"})]}),e.jsxs(A,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"description",children:"Descripción del problema*"}),e.jsx(W,{id:"description",placeholder:"Describe el problema detalladamente",value:c,onChange:a=>M(a.target.value),rows:4,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"location",children:"Ubicación específica"}),e.jsx(D,{id:"location",placeholder:"Ej: Esquina noreste del parque, cerca de los juegos infantiles",value:g,onChange:a=>R(a.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"photos",children:"Fotografías (opcional)"}),e.jsx(D,{id:"photos",type:"file",accept:"image/*",multiple:!0,onChange:B,className:"cursor-pointer"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Puedes subir hasta 3 fotografías para documentar el problema"})]}),e.jsxs("div",{className:"mt-4 p-3 bg-amber-50 border border-amber-200 rounded-md flex items-start space-x-3",children:[e.jsx($,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-amber-800",children:"Información importante"}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:"Al enviar este reporte, se notificará automáticamente al responsable del activo y al administrador del parque. Los problemas de alta prioridad generarán alertas inmediatas."})]})]})]})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(u,{variant:"outline",type:"button",className:"mr-2",onClick:()=>window.location.href="/admin/assets",children:"Cancelar"}),e.jsxs(u,{type:"submit",disabled:y,children:[e.jsx(H,{className:"mr-2 h-4 w-4"}),y?"Enviando...":"Enviar Reporte"]})]})]})]})})};export{Y as default};
