import{d as B,am as Q,e as J,a6 as O,Y as p,a7 as Y,u as q,a8 as G,j as e,aI as E,B as C,A as W,aa as X,C as j,a as u,b as v,M as Z,c as g,ab as c,ac as l,ad as o,z as I,ae as d,H as P,J as D,K as L,N as f,af as m,U as ee,I as h,cY as se,O as ae,al as re,a9 as ne,ag as te,i as ie,bz as ce,a5 as i,ah as le}from"./index-VG22aPDC.js";import{S as oe}from"./separator-D_IPDq0v.js";const de=i.object({space_id:i.string().min(1,"Selecciona un espacio"),customer_name:i.string().min(2,"El nombre debe tener al menos 2 caracteres"),customer_email:i.string().email("Email inválido"),customer_phone:i.string().min(10,"El teléfono debe tener al menos 10 dígitos"),reservation_date:i.string().min(1,"Selecciona una fecha"),start_time:i.string().min(1,"Selecciona hora de inicio"),end_time:i.string().min(1,"Selecciona hora de fin"),special_requests:i.string().optional(),status:i.enum(["pending","confirmed","cancelled","completed"]).default("pending"),deposit_paid:i.boolean().default(!1)});function je(){const _=B().id,[xe,y]=Q(),{toast:b}=J(),M=O(),[r,T]=p.useState(null),[F,z]=p.useState(0),[w,$]=p.useState(0),a=Y({resolver:le(de),defaultValues:{space_id:"",customer_name:"",customer_email:"",customer_phone:"",reservation_date:"",start_time:"",end_time:"",special_requests:"",status:"pending",deposit_paid:!1}}),{data:t,isLoading:A}=q({queryKey:[`/api/space-reservations/${_}`],queryFn:async()=>{const s=await fetch(`/api/space-reservations/${_}`);if(!s.ok)throw new Error("Error al cargar la reserva");return s.json()},enabled:!!_}),{data:N=[],isLoading:H}=q({queryKey:["/api/reservable-spaces"],queryFn:async()=>{const s=await fetch("/api/reservable-spaces?active_only=true");if(!s.ok)throw new Error("Error al cargar los espacios");return s.json()}});p.useEffect(()=>{if(t){a.reset({space_id:t.space_id.toString(),customer_name:t.contact_name,customer_email:t.contact_email,customer_phone:t.contact_phone,reservation_date:t.reservation_date,start_time:t.start_time,end_time:t.end_time,special_requests:t.special_requests||"",status:t.status,deposit_paid:t.deposit_paid});const s=N.find(n=>n.id===t.space_id);s&&T(s)}},[t,N,a]),p.useEffect(()=>{if(r){const s=a.watch("start_time"),n=a.watch("end_time");if(s&&n){const x=new Date(`2000-01-01T${s}:00`),U=new Date(`2000-01-01T${n}:00`).getTime()-x.getTime(),k=Math.max(1,Math.ceil(U/(1e3*60*60)));$(k),z(k*parseFloat(r.hourly_rate))}}},[r,a.watch("start_time"),a.watch("end_time")]);const S=G({mutationFn:async s=>{const n={spaceId:parseInt(s.space_id),contactName:s.customer_name,contactEmail:s.customer_email,contactPhone:s.customer_phone,reservationDate:s.reservation_date,startTime:s.start_time,endTime:s.end_time,specialRequests:s.special_requests||"",status:s.status,expectedAttendees:(r==null?void 0:r.capacity)||1,purpose:"Evento privado",totalCost:F,depositPaid:s.deposit_paid},x=await fetch(`/api/space-reservations/${_}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!x.ok){const R=await x.json();throw new Error(R.message||"Error al actualizar la reserva")}return x.json()},onSuccess:()=>{b({title:"Reserva actualizada",description:"La reserva se ha actualizado exitosamente"}),M.invalidateQueries({queryKey:["/api/space-reservations"]}),y("/admin/space-reservations")},onError:s=>{b({title:"Error",description:s.message,variant:"destructive"})}}),V=s=>{if(!r){b({title:"Error",description:"Por favor selecciona un espacio",variant:"destructive"});return}S.mutate(s)},K=s=>{const n=N.find(x=>x.id===parseInt(s));T(n||null)};return A||H?e.jsx(E,{children:e.jsx("div",{className:"p-8 text-center",children:"Cargando reserva..."})}):t?e.jsx(E,{children:e.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"flex items-center gap-3 mb-4",children:e.jsxs(C,{variant:"ghost",size:"sm",onClick:()=>y("/admin/space-reservations"),children:[e.jsx(W,{className:"h-4 w-4"}),"Volver a Reservas"]})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Editar Reserva"}),e.jsxs("p",{className:"text-gray-600 mt-2",children:["Modifica los detalles de la reserva #",t.id]})]}),e.jsx(X,{...a,children:e.jsxs("form",{onSubmit:a.handleSubmit(V),className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(u,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5"}),"Selección de Espacio"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsx(c,{control:a.control,name:"space_id",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Espacio Reservable"}),e.jsxs(I,{onValueChange:n=>{s.onChange(n),K(n)},value:s.value,children:[e.jsx(d,{children:e.jsx(P,{children:e.jsx(D,{placeholder:"Selecciona un espacio"})})}),e.jsx(L,{children:N.map(n=>e.jsxs(f,{value:n.id.toString(),children:[n.name," - ",n.park_name]},n.id))})]}),e.jsx(m,{})]})}),r&&e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-semibold mb-2",children:r.name}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:r.description}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Capacidad:"})," ",r.capacity," personas"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tarifa:"})," $",r.hourly_rate,"/hora"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tipo:"})," ",r.space_type]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ubicación:"})," ",r.location]})]})]})]})]}),e.jsxs(j,{children:[e.jsx(u,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5"}),"Información del Cliente"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsx(c,{control:a.control,name:"customer_name",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Nombre Completo"}),e.jsx(d,{children:e.jsx(h,{placeholder:"Nombre del responsable",...s})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:a.control,name:"customer_email",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Email"}),e.jsx(d,{children:e.jsx(h,{type:"email",placeholder:"email@ejemplo.com",...s})}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"customer_phone",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Teléfono"}),e.jsx(d,{children:e.jsx(h,{placeholder:"33 1234 5678",...s})}),e.jsx(m,{})]})})]})]})]}),e.jsxs(j,{children:[e.jsx(u,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Detalles de la Reserva"]})}),e.jsxs(g,{className:"space-y-4",children:[e.jsx(c,{control:a.control,name:"reservation_date",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de la Reserva"}),e.jsx(d,{children:e.jsx(h,{type:"date",...s})}),e.jsx(m,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{control:a.control,name:"start_time",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Hora de Inicio"}),e.jsx(d,{children:e.jsx(h,{type:"time",...s})}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"end_time",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Hora de Fin"}),e.jsx(d,{children:e.jsx(h,{type:"time",...s})}),e.jsx(m,{})]})})]}),e.jsx(c,{control:a.control,name:"status",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Estado de la Reserva"}),e.jsxs(I,{onValueChange:s.onChange,value:s.value,children:[e.jsx(d,{children:e.jsx(P,{children:e.jsx(D,{placeholder:"Selecciona el estado"})})}),e.jsxs(L,{children:[e.jsx(f,{value:"pending",children:"Pendiente"}),e.jsx(f,{value:"confirmed",children:"Confirmada"}),e.jsx(f,{value:"cancelled",children:"Cancelada"}),e.jsx(f,{value:"completed",children:"Completada"})]})]}),e.jsx(m,{})]})}),e.jsx(c,{control:a.control,name:"special_requests",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Solicitudes Especiales"}),e.jsx(d,{children:e.jsx(ae,{placeholder:"Detalles adicionales o solicitudes especiales...",rows:3,...s})}),e.jsx(m,{})]})})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(j,{children:[e.jsx(u,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Resumen de Costos"]})}),e.jsx(g,{children:r&&w>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tarifa por hora:"}),e.jsxs("span",{children:["$",r.hourly_rate]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Duración:"}),e.jsxs("span",{children:[w," ",w===1?"hora":"horas"]})]}),e.jsx(oe,{}),e.jsxs("div",{className:"flex justify-between font-semibold text-lg",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",F.toFixed(2)]})]})]}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Selecciona un espacio y horarios para calcular el costo"})})]}),e.jsxs(j,{children:[e.jsx(u,{children:e.jsxs(v,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Estado de Pago"]})}),e.jsx(g,{children:e.jsx(c,{control:a.control,name:"deposit_paid",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(d,{children:e.jsx(te,{checked:s.value,onCheckedChange:s.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(o,{children:"Depósito pagado"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Marcar si el cliente ya pagó el depósito"})]})]})})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-6",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>y("/admin/space-reservations"),children:"Cancelar"}),e.jsx(C,{type:"submit",disabled:S.isPending,children:S.isPending?e.jsxs(e.Fragment,{children:[e.jsx(ie,{className:"h-4 w-4 mr-2 animate-spin"}),"Actualizando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Actualizar Reserva"]})})]})]})})]})}):e.jsx(E,{children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-600",children:"Reserva no encontrada"}),e.jsx(C,{onClick:()=>y("/admin/space-reservations"),className:"mt-4",children:"Volver a Reservas"})]})})}export{je as default};
