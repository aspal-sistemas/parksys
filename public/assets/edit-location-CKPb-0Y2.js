import{cf as L,cg as c,d as E,al as w,e as M,a6 as S,u as A,a7 as P,Y as q,a8 as T,j as a,aB as v,B as o,A as y,C as k,a as D,b as I,a3 as U,c as z,aa as Q,cS as B,M as K,cT as V,ab as d,ac as u,ad as m,ae as x,I as j,bt as h,af as p,bI as $,ag as G,ah as H}from"./index-BBGHPKhn.js";import{S as N}from"./skeleton-DR_YLL_-.js";const R=L({latitude:c().refine(n=>{const s=parseFloat(n);return!isNaN(s)&&s>=-90&&s<=90},{message:"La latitud debe ser un número entre -90 y 90"}),longitude:c().refine(n=>{const s=parseFloat(n);return!isNaN(s)&&s>=-180&&s<=180},{message:"La longitud debe ser un número entre -180 y 180"}),location:c().optional()}),O=()=>{const s=E().id,[Y,i]=w(),{toast:b}=M(),g=S(),{data:t,isLoading:f}=A({queryKey:[`/api/assets/${s}`],enabled:!!s}),r=P({resolver:G(R),defaultValues:{latitude:"",longitude:"",location:""}});q.useEffect(()=>{t&&r.reset({latitude:t.latitude||"",longitude:t.longitude||"",location:t.location||""})},[t,r]);const l=T({mutationFn:e=>{const F=t||{};return H(`/api/assets/${s}`,"PUT",{...F,latitude:e.latitude,longitude:e.longitude,location:e.location})},onSuccess:()=>{g.invalidateQueries({queryKey:[`/api/assets/${s}`]}),g.invalidateQueries({queryKey:["/api/assets"]}),b({title:"Ubicación actualizada",description:"Las coordenadas del activo se han actualizado correctamente."}),i("/admin/assets/map")},onError:e=>{b({title:"Error",description:"Ha ocurrido un error al actualizar las coordenadas.",variant:"destructive"}),console.error("Error al actualizar coordenadas:",e)}}),C=e=>{l.mutate(e)};return f?a.jsx(v,{children:a.jsxs("div",{className:"container py-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),children:[a.jsx(y,{className:"mr-2 h-4 w-4"}),"Volver al Mapa"]})}),a.jsxs("div",{className:"space-y-6",children:[a.jsx(N,{className:"h-8 w-96"}),a.jsx(N,{className:"h-64 w-full"})]})]})}):a.jsx(v,{children:a.jsxs("div",{className:"container py-6",children:[a.jsx("div",{className:"mb-6",children:a.jsxs(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),children:[a.jsx(y,{className:"mr-2 h-4 w-4"}),"Volver al Mapa"]})}),a.jsxs(k,{className:"max-w-lg mx-auto",children:[a.jsxs(D,{children:[a.jsx(I,{className:"text-xl",children:"Editar Ubicación"}),a.jsxs(U,{children:["Activo: ",t==null?void 0:t.name]})]}),a.jsx(z,{children:a.jsx(Q,{...r,children:a.jsxs("form",{onSubmit:r.handleSubmit(C),className:"space-y-6",children:[a.jsxs(B,{className:"bg-blue-50 border-blue-200",children:[a.jsx(K,{className:"h-4 w-4 text-blue-600"}),a.jsx(V,{className:"text-blue-700",children:"Ingresa las coordenadas de ubicación para este activo. Para México, la latitud suele ser positiva (norte) y la longitud negativa (oeste)."})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsx(d,{control:r.control,name:"latitude",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Latitud"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: 19.432608",...e})}),a.jsx(h,{children:"Coordenada norte (+) / sur (-)"}),a.jsx(p,{})]})}),a.jsx(d,{control:r.control,name:"longitude",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Longitud"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: -99.133209",...e})}),a.jsx(h,{children:"Coordenada este (+) / oeste (-)"}),a.jsx(p,{})]})})]}),a.jsx(d,{control:r.control,name:"location",render:({field:e})=>a.jsxs(u,{children:[a.jsx(m,{children:"Descripción de Ubicación"}),a.jsx(x,{children:a.jsx(j,{placeholder:"Ej: Cerca de la entrada principal",...e})}),a.jsx(h,{children:"Describe dónde se encuentra este activo dentro del parque"}),a.jsx(p,{})]})}),a.jsxs("div",{className:"flex items-center justify-end gap-4",children:[a.jsx(o,{variant:"outline",onClick:()=>i("/admin/assets/map"),type:"button",children:"Cancelar"}),a.jsxs(o,{type:"submit",disabled:l.isPending,children:[l.isPending?"Guardando...":"Guardar Ubicación",a.jsx($,{className:"ml-2 h-4 w-4"})]})]})]})})})]})]})})};export{O as default};
