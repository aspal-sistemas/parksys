import{am as se,Y as x,a6 as ae,e as le,u as re,a8 as te,R as E,j as e,aI as ie,bo as ne,bq as ce,br as oe,bs as de,bt as xe,bu as he,bv as me,bw as je,B as h,b2 as ue,cM as pe,cN as ge,W as ve,c_ as Ne,cO as fe,cP as we,cQ as be,cR as P,cr as L,C as v,a as N,b as f,c as w,U as Ce,aM as ye,cS as Ae,cj as Se,Z as De,I as Ee,z as H,H as z,J as V,K as $,N as m,cg as O,x as Pe,bh as Le,bi as Me,bj as Q,bk as t,ce as Te,bl as Ie,bm as i,b7 as ke,ba as Fe,cs as qe,ct as Re,cv as M,cu as Be,cw as He,cx as ze,l as Ve,X as $e,f as n,ai as Oe}from"./index-VG22aPDC.js";function Ue(){const[,b]=se(),[r,T]=x.useState(1),[c,I]=x.useState(""),[j,k]=x.useState("all"),[o,F]=x.useState("all"),[U,C]=x.useState(!1),u=10,Y=ae(),{toast:q}=le(),{data:l,isLoading:K,isError:G,refetch:_}=re({queryKey:["/api/instructors"],retry:1,enabled:!0}),y=te({mutationFn:async()=>await Oe("/api/instructors/batch/all",{method:"DELETE"}),onSuccess:s=>{q({title:"Instructores inactivados",description:`${s.count} instructores han sido inactivados correctamente`,variant:"default"}),Y.invalidateQueries({queryKey:["/api/instructors"]}),C(!1)},onError:s=>{console.error("Error al eliminar todos los instructores:",s),q({title:"Error",description:"No se pudieron eliminar los instructores. Por favor, inténtalo de nuevo.",variant:"destructive"}),C(!1)}}),A=E.useMemo(()=>l?l.filter(s=>{var B;const a=c===""||`${s.firstName} ${s.lastName}`.toLowerCase().includes(c.toLowerCase())||((B=s.email)==null?void 0:B.toLowerCase().includes(c.toLowerCase())),d=j==="all"||s.status===j,D=o==="all"||s.specialties&&(Array.isArray(s.specialties)?s.specialties.some(ee=>ee.toLowerCase().includes(o.toLowerCase())):s.specialties.toLowerCase().includes(o.toLowerCase()));return a&&d&&D}):[],[l,c,j,o]),p=E.useMemo(()=>{const s=(r-1)*u;return A.slice(s,s+u)},[A,r,u]),g=Math.ceil(A.length/u),S=s=>{T(s)},J=()=>{y.mutate()};x.useEffect(()=>{T(1)},[c,j,o]);const R=E.useMemo(()=>{if(!l)return[];const s=new Set;return l.forEach(a=>{a.specialties&&Array.isArray(a.specialties)?a.specialties.forEach(d=>{s.add(d.trim())}):a.specialties&&typeof a.specialties=="string"&&a.specialties.split(",").forEach(D=>{s.add(D.trim())})}),Array.from(s)},[l]),W=s=>{if(!s)return"Fecha desconocida";try{const a=new Date(s);return Ve(a,"dd MMM yyyy",{locale:$e})}catch{return"Fecha inválida"}},X=s=>{switch(s){case"active":return e.jsx(n,{className:"bg-green-100 text-green-800 hover:bg-green-200",children:"Activo"});case"inactive":return e.jsx(n,{className:"bg-gray-100 text-gray-800 hover:bg-gray-200",children:"Inactivo"});case"pending":return e.jsx(n,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",children:"Pendiente"});default:return e.jsx(n,{children:s})}},Z=s=>!s||!Array.isArray(s)||s.length===0?e.jsx("span",{className:"text-gray-400 italic",children:"No especificado"}):s.length<=2?s.map((a,d)=>e.jsx(n,{variant:"outline",className:"mr-1",children:a},d)):e.jsxs(e.Fragment,{children:[e.jsx(n,{variant:"outline",className:"mr-1",children:s[0]}),e.jsxs(n,{variant:"outline",className:"mr-1",children:["+",s.length-1," más"]})]});return e.jsxs(ie,{children:[e.jsx(ne,{open:U,onOpenChange:C,children:e.jsxs(ce,{children:[e.jsxs(oe,{children:[e.jsx(de,{children:"¿Estás seguro?"}),e.jsx(xe,{children:"Esta acción desactivará a todos los instructores en el sistema y no se puede deshacer. Los instructores marcados como inactivos ya no aparecerán en las listas públicas ni podrán ser asignados a actividades."})]}),e.jsxs(he,{children:[e.jsx(me,{children:"Cancelar"}),e.jsx(je,{onClick:J,disabled:y.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:y.isPending?"Procesando...":"Confirmar eliminación"})]})]})}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Instructores"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestiona la lista de instructores registrados en la plataforma."})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(h,{onClick:()=>b("/admin/activities/instructors/new"),children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Nuevo Instructor"]}),e.jsxs(pe,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(h,{variant:"outline",children:[e.jsx(ve,{className:"mr-2 h-4 w-4"}),"Exportar",e.jsx(Ne,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(fe,{children:[e.jsx(we,{children:"Formato"}),e.jsx(be,{}),e.jsxs(P,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"Excel"]}),e.jsxs(P,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"CSV"]}),e.jsxs(P,{children:[e.jsx(L,{className:"mr-2 h-4 w-4"}),"PDF"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs(v,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Total"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"h-5 w-5 text-blue-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:l?l.length:0})]})})]}),e.jsxs(v,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Activos"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ye,{className:"h-5 w-5 text-green-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:l?l.filter(s=>s.status==="active").length:0})]})})]}),e.jsxs(v,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Experiencia promedio"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"h-5 w-5 text-amber-600 mr-2"}),e.jsxs("span",{className:"text-2xl font-bold",children:[l&&l.length>0?Math.round(l.reduce((s,a)=>s+(a.experienceYears||0),0)/l.length):0," años"]})]})})]}),e.jsxs(v,{children:[e.jsx(N,{className:"pb-2",children:e.jsx(f,{className:"text-lg",children:"Especialidades"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Se,{className:"h-5 w-5 text-purple-600 mr-2"}),e.jsx("span",{className:"text-2xl font-bold",children:R.length})]})})]})]}),e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row gap-4 items-end",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsxs("div",{className:"relative",children:[e.jsx(De,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Ee,{placeholder:"Buscar por nombre o email...",className:"pl-8",value:c,onChange:s=>I(s.target.value)})]})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsxs(H,{value:j,onValueChange:k,children:[e.jsx(z,{children:e.jsx(V,{placeholder:"Filtrar por estado"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"Todos los estados"}),e.jsx(m,{value:"active",children:"Activos"}),e.jsx(m,{value:"inactive",children:"Inactivos"}),e.jsx(m,{value:"pending",children:"Pendientes"})]})]})}),e.jsx("div",{className:"w-full md:w-1/4",children:e.jsxs(H,{value:o,onValueChange:F,children:[e.jsx(z,{children:e.jsx(V,{placeholder:"Filtrar por especialidad"})}),e.jsxs($,{children:[e.jsx(m,{value:"all",children:"Todas las especialidades"}),R.map((s,a)=>e.jsx(m,{value:s,children:s},a))]})]})}),e.jsxs(h,{variant:"outline",className:"w-full md:w-auto",onClick:()=>{I(""),k("all"),F("all")},children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),"Limpiar filtros"]})]}),e.jsxs("div",{className:"bg-white rounded-md shadow",children:[K?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(O,{className:"h-8 w-8 animate-spin mx-auto text-gray-400"}),e.jsx("p",{className:"mt-2 text-gray-500",children:"Cargando instructores..."})]}):G?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Pe,{className:"h-8 w-8 mx-auto text-red-500"}),e.jsx("p",{className:"mt-2 text-red-500",children:"Error al cargar los instructores"}),e.jsx(h,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>_(),children:"Reintentar"})]}):(p==null?void 0:p.length)===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"text-gray-500",children:l?"No se encontraron instructores que coincidan con los criterios de búsqueda.":"Haz clic en 'Cargar instructores' para ver los datos."})}):e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs(Le,{children:[e.jsx(Me,{children:e.jsxs(Q,{children:[e.jsx(t,{children:"Nombre"}),e.jsx(t,{children:"Contacto"}),e.jsx(t,{children:e.jsxs("div",{className:"flex items-center",children:["Estado",e.jsx(Te,{className:"ml-2 h-4 w-4"})]})}),e.jsx(t,{children:"Especialidades"}),e.jsx(t,{children:"Experiencia"}),e.jsx(t,{children:"Inicio"}),e.jsx(t,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ie,{children:p.map(s=>e.jsxs(Q,{children:[e.jsxs(i,{className:"font-medium",children:[s.firstName," ",s.lastName]}),e.jsxs(i,{children:[e.jsx("div",{children:s.email}),s.phone&&e.jsx("div",{className:"text-muted-foreground text-xs",children:s.phone})]}),e.jsx(i,{children:X(s.status)}),e.jsx(i,{children:Z(s.specialties)}),e.jsxs(i,{children:[s.experienceYears," ",s.experienceYears===1?"año":"años"]}),e.jsx(i,{children:W(s.createdAt)}),e.jsx(i,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>b(`/admin/instructors/detail/${s.id}`),title:"Ver detalles",children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>b(`/admin/instructors/edit/${s.id}`),title:"Editar instructor",children:e.jsx(Fe,{className:"h-4 w-4"})})]})})]},s.id))})]})}),g>1&&e.jsx("div",{className:"mt-4",children:e.jsx(qe,{children:e.jsxs(Re,{children:[e.jsx(M,{children:e.jsx(Be,{onClick:()=>S(Math.max(1,r-1)),className:r===1?"pointer-events-none opacity-50":"cursor-pointer"})}),Array.from({length:g},(s,a)=>a+1).map(s=>e.jsx(M,{children:e.jsx(He,{onClick:()=>S(s),isActive:r===s,children:s})},s)),e.jsx(M,{children:e.jsx(ze,{onClick:()=>S(Math.min(g,r+1)),className:r===g?"pointer-events-none opacity-50":"cursor-pointer"})})]})})})]})]})]})}export{Ue as default};
