import{l as U,a2 as n,j as e,f as j,g as v,ah as M,h as b,ab as y,i as g,aA as A,aw as S,ay as I,B as u,aB as R,K as O,aq as B,aC as z,u as H,L as T,A as q,as as K,p as _,o as Q,M as X,m as Z,n as G,U as W,t as Y,N as D,O as $}from"./index-D5qLf1ib.js";import{u as J,a as ee,P as se,l as ae,E as te}from"./index-DUfqjTOC.js";function ie({amount:h,currency:r,serviceName:d,serviceDescription:f,onPaymentSuccess:t,onPaymentError:l}){const o=J(),a=ee(),{toast:N}=U(),[s,w]=n.useState(!1),[m,x]=n.useState(null),[P,L]=n.useState(!1),i=async k=>{if(k.preventDefault(),!(!o||!a)){w(!0),x(null);try{const{error:p}=await a.submit();if(p){x(p.message||"Error al procesar el pago");return}const{error:c,paymentIntent:E}=await o.confirmPayment({elements:a,confirmParams:{return_url:`${window.location.origin}/payment-success`},redirect:"if_required"});c?(x(c.message||"Error al confirmar el pago"),l==null||l(c.message||"Error al confirmar el pago")):E&&E.status==="succeeded"&&(L(!0),N({title:"Pago Exitoso",description:`Tu pago de $${h.toLocaleString()} ${r.toUpperCase()} ha sido procesado exitosamente.`}),t==null||t(E.id))}catch(p){const c=p instanceof Error?p.message:"Error inesperado";x(c),l==null||l(c)}finally{w(!1)}}};return P?e.jsxs(j,{className:"w-full max-w-md mx-auto",children:[e.jsxs(v,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(M,{className:"w-6 h-6 text-green-600"})}),e.jsx(b,{className:"text-green-600",children:"¡Pago Exitoso!"}),e.jsx(y,{children:"Tu pago ha sido procesado correctamente"})]}),e.jsx(g,{className:"space-y-4",children:e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Servicio:"}),e.jsx("span",{className:"text-sm",children:d})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total Pagado:"}),e.jsxs("span",{className:"text-sm font-bold",children:["$",h.toLocaleString()," ",r.toUpperCase()]})]})]})})]}):e.jsxs(j,{className:"w-full max-w-md mx-auto",children:[e.jsxs(v,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(A,{className:"w-6 h-6 text-blue-600"})}),e.jsx(b,{children:"Completar Pago"}),e.jsxs(y,{children:[d,f&&e.jsx("span",{className:"block text-xs mt-1 text-gray-500",children:f})]})]}),e.jsxs(g,{className:"space-y-6",children:[e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:"Total a pagar:"}),e.jsxs("span",{className:"text-xl font-bold text-blue-600",children:["$",h.toLocaleString()," ",r.toUpperCase()]})]})}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Información de Pago"}),e.jsx("div",{className:"border rounded-lg p-3 bg-white",children:e.jsx(se,{options:{layout:{type:"tabs",defaultCollapsed:!1}}})})]}),m&&e.jsx(S,{variant:"destructive",children:e.jsx(I,{children:m})}),e.jsx(u,{type:"submit",className:"w-full",disabled:!o||!a||s,children:s?e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 mr-2 animate-spin"}),"Procesando pago..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"Pagar $",h.toLocaleString()," ",r.toUpperCase()]})})]}),e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:[e.jsx("p",{children:"🔒 Tu información está protegida con encriptación SSL"}),e.jsx("p",{children:"Powered by Stripe"})]})]})]})}const re=ae("pk_test_51RMAjuGG6sO0c1pHaEQFnqIV4IlSduHlwslnZ8qDdLto0VkvrEnHK646uRZRiMa5QKZMk7Ruqh7e8stvsN5WOF2Y00P8IDzUm4");function le({serviceType:h,serviceId:r,serviceName:d,serviceDescription:f,amount:t,currency:l="mxn",customerName:o,customerEmail:a,customerPhone:N,metadata:s,onPaymentSuccess:w,onPaymentError:m,onCancel:x}){const[P,L]=n.useState(""),[i,k]=n.useState(!0),[p,c]=n.useState(null);if(n.useEffect(()=>{const V=async()=>{try{k(!0),c(null);const C=await(await B("POST","/api/payments/create-payment-intent",{serviceType:h,serviceId:r,serviceName:d,serviceDescription:f,amount:t,currency:l,customerName:o,customerEmail:a,customerPhone:N,metadata:s})).json();C.success?L(C.clientSecret):c(C.error||"Error al crear el pago")}catch(F){const C=F instanceof Error?F.message:"Error al conectar con el servidor";c(C),m==null||m(C)}finally{k(!1)}};t>0&&o&&a?V():(c("Información de pago incompleta"),k(!1))},[h,r,d,t,l,o,a]),i)return e.jsxs(j,{className:"w-full max-w-md mx-auto",children:[e.jsxs(v,{children:[e.jsx(b,{children:"Preparando Pago"}),e.jsx(y,{children:"Inicializando sistema de pagos seguro..."})]}),e.jsxs(g,{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(R,{className:"w-8 h-8 animate-spin text-blue-600 mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Esto puede tomar unos segundos"})]})]});if(p)return e.jsxs(j,{className:"w-full max-w-md mx-auto",children:[e.jsxs(v,{children:[e.jsx(b,{className:"text-red-600",children:"Error"}),e.jsx(y,{children:"No se pudo inicializar el sistema de pagos"})]}),e.jsxs(g,{children:[e.jsxs(S,{variant:"destructive",children:[e.jsx(O,{className:"h-4 w-4"}),e.jsx(I,{children:p})]}),x&&e.jsx("button",{onClick:x,className:"mt-4 w-full px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors",children:"Cancelar"})]})]});const E={clientSecret:P,appearance:{theme:"stripe",variables:{colorPrimary:"#2563eb",colorBackground:"#ffffff",colorText:"#1f2937",colorDanger:"#dc2626",borderRadius:"8px",fontFamily:"system-ui, sans-serif"}},locale:"es"};return e.jsx("div",{className:"w-full max-w-md mx-auto",children:e.jsx(te,{stripe:re,options:E,children:e.jsx(ie,{amount:t,currency:l,serviceName:d,serviceDescription:f,onPaymentSuccess:w,onPaymentError:m})})})}function de(){const[h,r]=z("/actividad/:id/pagar"),d=r!=null&&r.id?parseInt(r.id):null,[f,t]=n.useState(!1),[l,o]=n.useState(!1),[a,N]=n.useState({name:"",email:"",phone:""}),{data:s,isLoading:w,error:m}=H({queryKey:["/api/activities",d],enabled:!!d}),x=i=>{console.log("Pago exitoso:",i),o(!0),t(!1)},P=i=>{console.error("Error en el pago:",i)},L=()=>a.name.trim()!==""&&a.email.trim()!==""&&a.email.includes("@");return w?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})}):m||!s?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx(S,{variant:"destructive",children:e.jsx(I,{children:"No se pudo cargar la información de la actividad. Por favor intenta nuevamente."})}),e.jsx("div",{className:"mt-4",children:e.jsx(T,{href:"/activities",children:e.jsxs(u,{variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Volver a Actividades"]})})})]})}):s.isFree?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx(S,{children:e.jsx(I,{children:"Esta actividad es gratuita. No se requiere pago para participar."})}),e.jsx("div",{className:"mt-4",children:e.jsx(T,{href:`/actividad/${s.id}`,children:e.jsxs(u,{variant:"outline",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Volver a la Actividad"]})})})]})}):l?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"max-w-2xl mx-auto text-center",children:e.jsxs(j,{children:[e.jsxs(v,{children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(M,{className:"w-8 h-8 text-green-600"})}),e.jsx(b,{className:"text-green-600",children:"¡Pago Completado!"}),e.jsx(y,{children:"Tu inscripción a la actividad ha sido procesada exitosamente"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:s.title}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Monto pagado: $",parseFloat(s.price).toLocaleString()," MXN"]}),e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Participante: ",a.name]})]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.requiresApproval?"Tu inscripción está pendiente de aprobación. Recibirás un email de confirmación en breve.":"Tu inscripción ha sido confirmada. Recibirás un email con los detalles."}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(T,{href:"/activities",className:"flex-1",children:e.jsx(u,{variant:"outline",className:"w-full",children:"Ver más actividades"})}),e.jsx(T,{href:`/actividad/${s.id}`,className:"flex-1",children:e.jsx(u,{className:"w-full",children:"Ver detalles de la actividad"})})]})]})]})})}):f?e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(u,{variant:"outline",onClick:()=>t(!1),className:"mb-4",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Volver"]}),e.jsx("h1",{className:"text-2xl font-bold",children:"Completar Pago"}),e.jsxs("p",{className:"text-gray-600",children:["Inscripción a: ",s.title]})]}),e.jsx(le,{serviceType:"activity",serviceId:s.id,serviceName:s.title,serviceDescription:`Inscripción a actividad en ${s.parkName}`,amount:parseFloat(s.price),currency:"mxn",customerName:a.name,customerEmail:a.email,customerPhone:a.phone,metadata:{activityId:s.id.toString(),parkName:s.parkName,registrationDate:new Date().toISOString()},onPaymentSuccess:x,onPaymentError:P,onCancel:()=>t(!1)})]})}):e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(T,{href:`/actividad/${s.id}`,children:e.jsxs(u,{variant:"outline",className:"mb-4",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Volver a la Actividad"]})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Inscripción con Pago"}),e.jsx("p",{className:"text-gray-600",children:"Completa tu inscripción a la actividad"})]}),e.jsxs(j,{className:"mb-6",children:[e.jsxs(v,{children:[e.jsxs(b,{className:"flex items-center justify-between",children:[s.title,e.jsx(Q,{variant:"secondary",children:s.category})]}),e.jsx(y,{children:s.description})]}),e.jsxs(g,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(X,{className:"w-4 h-4 mr-2 text-gray-500"}),e.jsx("span",{children:s.parkName})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Z,{className:"w-4 h-4 mr-2 text-gray-500"}),e.jsx("span",{children:new Date(s.startDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(G,{className:"w-4 h-4 mr-2 text-gray-500"}),e.jsxs("span",{children:[s.startTime," (",s.duration," min)"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(W,{className:"w-4 h-4 mr-2 text-gray-500"}),e.jsxs("span",{children:["Capacidad: ",s.capacity," personas"]})]}),s.instructorName&&e.jsxs("div",{className:"flex items-center md:col-span-2",children:[e.jsx(Y,{className:"w-4 h-4 mr-2 text-gray-500"}),e.jsxs("span",{children:["Instructor: ",s.instructorName]})]})]}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-lg font-medium",children:"Costo de inscripción:"}),e.jsxs("span",{className:"text-2xl font-bold text-blue-600",children:["$",parseFloat(s.price).toLocaleString()," MXN"]})]})}),s.requirements&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Requisitos:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.requirements})]}),s.materials&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Materiales incluidos:"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.materials})]})]})]}),e.jsxs(j,{className:"mb-6",children:[e.jsxs(v,{children:[e.jsx(b,{children:"Información del Participante"}),e.jsx(y,{children:"Proporciona tus datos para completar la inscripción"})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"name",children:"Nombre Completo *"}),e.jsx($,{id:"name",type:"text",value:a.name,onChange:i=>N({...a,name:i.target.value}),placeholder:"Tu nombre completo",required:!0})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"email",children:"Correo Electrónico *"}),e.jsx($,{id:"email",type:"email",value:a.email,onChange:i=>N({...a,email:i.target.value}),placeholder:"tu@email.com",required:!0})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"phone",children:"Teléfono (Opcional)"}),e.jsx($,{id:"phone",type:"tel",value:a.phone,onChange:i=>N({...a,phone:i.target.value}),placeholder:"(55) 1234-5678"})]}),s.requiresApproval&&e.jsx(S,{children:e.jsx(I,{children:"Esta actividad requiere aprobación previa. Tu inscripción será revisada y recibirás una confirmación por email."})}),s.registrationDeadline&&e.jsx(S,{children:e.jsxs(I,{children:["Fecha límite de inscripción: ",new Date(s.registrationDeadline).toLocaleDateString()]})})]})]}),e.jsx(j,{children:e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total a pagar:"}),e.jsxs("span",{className:"text-2xl font-bold text-green-600",children:["$",parseFloat(s.price).toLocaleString()," MXN"]})]}),e.jsxs(u,{className:"w-full",size:"lg",onClick:()=>t(!0),disabled:!L(),children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Proceder al Pago"]}),e.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"Pagos seguros procesados por Stripe • SSL Encriptado"})]})})]})})}export{de as default};
