import{Y as S,e as Me,a6 as ze,u as B,a7 as me,a8 as se,j as e,aI as Oe,D as ae,p as Ue,B as j,b2 as je,r as ne,t as ie,v as re,w as le,aa as ue,aO as pe,aP as ge,aQ as V,aR as A,ab as r,ac as l,ad as o,z as f,ae as c,H as N,J as b,K as y,N as i,af as t,I as v,aA as L,O as P,x as Xe,be as oe,C as ve,c as fe,Z as Be,a as Re,b as He,a3 as Ke,bh as Qe,bi as Ge,bj as Ne,bk as C,bl as $e,bm as D,F as R,ba as be,bo as _e,bp as Ye,bb as Je,bq as We,br as Ze,bs as es,bt as ss,bu as as,bv as ns,bw as is,W as ye,m as rs,ax as ls,h as Ce,al as os,i as cs,a5 as u,l as ts,X as ds,f as z,ah as De}from"./index-Dzu3mJf5.js";import{H as xs}from"./Helmet-BWphdh6I.js";import{S as H}from"./separator-DuAPTCUu.js";const we=u.object({parkId:u.string().min(1,"Debes seleccionar un parque"),concessionaireId:u.string().min(1,"Debes seleccionar un concesionario"),concessionTypeId:u.string().min(1,"Debes seleccionar un tipo de concesión"),startDate:u.string().min(1,"La fecha de inicio es obligatoria"),endDate:u.string().min(1,"La fecha de vencimiento es obligatoria"),fee:u.string().min(1,"El canon o tarifa es obligatorio"),exclusivityClauses:u.string().optional(),restrictions:u.string().optional(),contractFile:u.instanceof(File).optional(),status:u.enum(["active","pending","expired","terminated"]).default("active"),hasExtension:u.boolean().default(!1),extensionDate:u.string().optional(),notes:u.string().optional()});function us(){const[Se,O]=S.useState(!1),[Fe,U]=S.useState(!1),[Ee,X]=S.useState(!1),[Ie,K]=S.useState(!1),[n,Q]=S.useState(null),[w,ce]=S.useState(""),[M,te]=S.useState("all"),{toast:F}=Me(),G=ze(),{data:de,isLoading:Te}=B({queryKey:["/api/concession-contracts"]}),{data:E,isLoading:$}=B({queryKey:["/api/parks"]}),{data:I,isLoading:_}=B({queryKey:["/api/concessionaires"]}),{data:T,isLoading:Y}=B({queryKey:["/api/concession-types"]}),x=me({resolver:De(we),defaultValues:{parkId:"",concessionaireId:"",concessionTypeId:"",startDate:"",endDate:"",fee:"",exclusivityClauses:"",restrictions:"",status:"active",hasExtension:!1,extensionDate:"",notes:""}}),d=me({resolver:De(we),defaultValues:{parkId:"",concessionaireId:"",concessionTypeId:"",startDate:"",endDate:"",fee:"",exclusivityClauses:"",restrictions:"",status:"active",hasExtension:!1,extensionDate:"",notes:""}}),J=se({mutationFn:async s=>{const a=new FormData;Object.entries(s).forEach(([m,h])=>{m!=="contractFile"&&a.append(m,(h==null?void 0:h.toString())||"")}),s.contractFile&&a.append("contractFile",s.contractFile);const p=await fetch("/api/concession-contracts",{method:"POST",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:a});if(!p.ok){const m=await p.json();throw new Error(m.message||"Error al crear el contrato")}return await p.json()},onSuccess:()=>{G.invalidateQueries({queryKey:["/api/concession-contracts"]}),F({title:"Contrato creado",description:"El contrato ha sido creado exitosamente."}),x.reset(),O(!1)},onError:s=>{F({title:"Error",description:s.message,variant:"destructive"})}}),W=se({mutationFn:async s=>{const{id:a,...p}=s,m=new FormData;Object.entries(p).forEach(([g,ee])=>{g!=="contractFile"&&m.append(g,(ee==null?void 0:ee.toString())||"")}),s.contractFile&&m.append("contractFile",s.contractFile);const h=await fetch(`/api/concession-contracts/${a}`,{method:"PUT",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""},body:m});if(!h.ok){const g=await h.json();throw new Error(g.message||"Error al actualizar el contrato")}return await h.json()},onSuccess:()=>{G.invalidateQueries({queryKey:["/api/concession-contracts"]}),F({title:"Contrato actualizado",description:"El contrato ha sido actualizado exitosamente."}),d.reset(),U(!1)},onError:s=>{F({title:"Error",description:s.message,variant:"destructive"})}}),ke=se({mutationFn:async s=>{const a=await fetch(`/api/concession-contracts/${s}`,{method:"DELETE",headers:{Authorization:localStorage.getItem("token")||"","X-User-Id":localStorage.getItem("userId")||"","X-User-Role":localStorage.getItem("userRole")||""}});if(!a.ok){const p=await a.json();throw new Error(p.message||"Error al eliminar el contrato")}return await a.json()},onSuccess:()=>{G.invalidateQueries({queryKey:["/api/concession-contracts"]}),F({title:"Contrato eliminado",description:"El contrato ha sido eliminado exitosamente."}),K(!1)},onError:s=>{F({title:"Error",description:s.message,variant:"destructive"})}}),qe=s=>{J.mutate(s)},Ve=s=>{n&&W.mutate({...s,id:n.id})},xe=s=>{Q(s),d.reset({parkId:s.parkId.toString(),concessionaireId:s.concessionaireId.toString(),concessionTypeId:s.concessionTypeId.toString(),startDate:s.startDate,endDate:s.endDate,fee:s.fee.toString(),exclusivityClauses:s.exclusivityClauses||"",restrictions:s.restrictions||"",status:s.status,hasExtension:s.hasExtension,extensionDate:s.extensionDate||"",notes:s.notes||""}),U(!0)},Ae=s=>{Q(s),X(!0)},Le=s=>{Q(s),K(!0)},Pe=()=>{n&&ke.mutate(n.id)},Z=de?de.filter(s=>{var m,h,g;const a=w===""||((m=s.parkName)==null?void 0:m.toLowerCase().includes(w.toLowerCase()))||((h=s.concessionaireName)==null?void 0:h.toLowerCase().includes(w.toLowerCase()))||((g=s.concessionTypeName)==null?void 0:g.toLowerCase().includes(w.toLowerCase())),p=M==="all"||s.status===M;return a&&p}):[],k=s=>{if(!s)return"N/A";try{return ts(new Date(s),"dd 'de' MMMM 'de' yyyy",{locale:ds})}catch{return"Fecha inválida"}},he=s=>{switch(s){case"active":return e.jsx(z,{className:"bg-green-100 text-green-800",children:"Activo"});case"pending":return e.jsx(z,{className:"bg-yellow-100 text-yellow-800",children:"Pendiente"});case"expired":return e.jsx(z,{className:"bg-red-100 text-red-800",children:"Vencido"});case"terminated":return e.jsx(z,{className:"bg-gray-100 text-gray-800",children:"Terminado"});default:return e.jsx(z,{children:s})}},q=$||_||Y;return e.jsxs(Oe,{children:[e.jsxs(xs,{children:[e.jsx("title",{children:"Contratos de Concesiones | Bosques Urbanos"}),e.jsx("meta",{name:"description",content:"Gestiona los contratos de concesiones para los parques"})]}),e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Contratos de Concesiones"}),e.jsx("p",{className:"text-muted-foreground",children:"Administra los contratos de concesiones para los espacios de los parques"})]}),e.jsxs(ae,{open:Se,onOpenChange:O,children:[e.jsx(Ue,{asChild:!0,children:e.jsxs(j,{className:"gap-2",children:[e.jsx(je,{size:16}),"Nuevo contrato"]})}),e.jsxs(ne,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(re,{children:"Crear nuevo contrato de concesión"}),e.jsx(le,{children:"Introduce la información del nuevo contrato de concesión"})]}),e.jsx(ue,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(qe),className:"space-y-4",children:[e.jsxs(pe,{defaultValue:"basic",className:"w-full",children:[e.jsxs(ge,{className:"grid w-full grid-cols-3",children:[e.jsx(V,{value:"basic",children:"Información Básica"}),e.jsx(V,{value:"details",children:"Detalles"}),e.jsx(V,{value:"document",children:"Documento"})]}),e.jsxs(A,{value:"basic",className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:x.control,name:"parkId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Parque / Espacio"}),e.jsxs(f,{onValueChange:s.onChange,defaultValue:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un parque"})})}),e.jsx(y,{children:$?e.jsx(i,{value:"loading",children:"Cargando parques..."}):E&&E.length>0?E.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsx(i,{value:"empty",children:"No hay parques disponibles"})})]}),e.jsx(t,{})]})}),e.jsx(r,{control:x.control,name:"concessionaireId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Concesionario"}),e.jsxs(f,{onValueChange:s.onChange,defaultValue:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un concesionario"})})}),e.jsx(y,{children:_?e.jsx(i,{value:"loading",children:"Cargando concesionarios..."}):I&&I.length>0?I.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name||a.fullName},a.id)):e.jsx(i,{value:"loading",children:"No hay concesionarios disponibles"})})]}),e.jsx(t,{})]})})]}),e.jsx(r,{control:x.control,name:"concessionTypeId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Tipo de Concesión"}),e.jsxs(f,{onValueChange:s.onChange,defaultValue:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un tipo de concesión"})})}),e.jsx(y,{children:Y?e.jsx(i,{value:"loading",children:"Cargando tipos de concesiones..."}):T&&T.length>0?T.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsx(i,{value:"loading",children:"No hay tipos de concesiones disponibles"})})]}),e.jsx(t,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:x.control,name:"startDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de inicio"}),e.jsx(c,{children:e.jsx(v,{type:"date",...s})}),e.jsx(t,{})]})}),e.jsx(r,{control:x.control,name:"endDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de vencimiento"}),e.jsx(c,{children:e.jsx(v,{type:"date",...s})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:x.control,name:"status",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Estado del contrato"}),e.jsxs(f,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona el estado del contrato"})})}),e.jsxs(y,{children:[e.jsx(i,{value:"active",children:"Activo"}),e.jsx(i,{value:"pending",children:"Pendiente"}),e.jsx(i,{value:"expired",children:"Vencido"}),e.jsx(i,{value:"terminated",children:"Terminado"})]})]}),e.jsx(t,{})]})})]}),e.jsxs(A,{value:"details",className:"space-y-4 py-4",children:[e.jsx(r,{control:x.control,name:"fee",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Canon o tarifa (MXN)"}),e.jsx(c,{children:e.jsx(v,{placeholder:"Ej: 5000.00",...s})}),e.jsx(L,{children:"Ingresa la cantidad en pesos mexicanos sin símbolos ni separadores"}),e.jsx(t,{})]})}),e.jsx(r,{control:x.control,name:"exclusivityClauses",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Cláusulas de exclusividad"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Describe las cláusulas de exclusividad que aplican a esta concesión",...s,rows:3})}),e.jsx(t,{})]})}),e.jsx(r,{control:x.control,name:"restrictions",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Restricciones"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Describe las restricciones que aplican a esta concesión",...s,rows:3})}),e.jsx(t,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:x.control,name:"hasExtension",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-x-3 space-y-0 p-4 border rounded-md",children:[e.jsx(c,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:a=>s.onChange(a.target.checked),className:"w-4 h-4 mt-1"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(o,{children:"Tiene prórroga"}),e.jsx(L,{children:"Marcar si el contrato tiene una prórroga aprobada"})]})]})}),x.watch("hasExtension")&&e.jsx(r,{control:x.control,name:"extensionDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de prórroga"}),e.jsx(c,{children:e.jsx(v,{type:"date",...s})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:x.control,name:"notes",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Notas adicionales"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Notas adicionales sobre el contrato",...s,rows:3})}),e.jsx(t,{})]})})]}),e.jsxs(A,{value:"document",className:"space-y-4 py-4",children:[e.jsx(r,{control:x.control,name:"contractFile",render:({field:{value:s,onChange:a,...p}})=>e.jsxs(l,{children:[e.jsx(o,{children:"Documento del contrato (PDF)"}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(v,{type:"file",accept:".pdf",onChange:m=>{var g;const h=(g=m.target.files)==null?void 0:g[0];h&&a(h)},...p}),e.jsx(L,{children:"Sube el contrato en formato PDF. Tamaño máximo: 10MB."})]})}),e.jsx(t,{})]})}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(Xe,{className:"h-5 w-5 text-amber-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-amber-800",children:"Información importante"}),e.jsx("p",{className:"text-sm text-amber-700 mt-1",children:"El documento del contrato debe estar firmado por todas las partes involucradas y debe contener todos los términos y condiciones acordados."}),e.jsx("p",{className:"text-sm text-amber-700 mt-2",children:"La subida del documento es obligatoria para formalizar el contrato de concesión."})]})]})})]})]}),e.jsxs(oe,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>O(!1),children:"Cancelar"}),e.jsx(j,{type:"submit",disabled:J.isPending,children:J.isPending?"Guardando...":"Guardar contrato"})]})]})})]})]})]}),e.jsx(ve,{className:"mb-6",children:e.jsx(fe,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative w-full md:w-96",children:[e.jsx(Be,{className:"absolute left-2.5 top-3 h-4 w-4 text-muted-foreground"}),e.jsx(v,{type:"search",placeholder:"Buscar por parque o concesionario...",className:"pl-8 w-full",value:w,onChange:s=>ce(s.target.value)})]}),e.jsxs(f,{value:M,onValueChange:te,children:[e.jsx(N,{className:"w-full md:w-[180px]",children:e.jsx(b,{placeholder:"Filtrar por estado"})}),e.jsxs(y,{children:[e.jsx(i,{value:"all",children:"Todos los estados"}),e.jsx(i,{value:"active",children:"Activos"}),e.jsx(i,{value:"pending",children:"Pendientes"}),e.jsx(i,{value:"expired",children:"Vencidos"}),e.jsx(i,{value:"terminated",children:"Terminados"})]})]})]})})}),e.jsxs(ve,{children:[e.jsxs(Re,{children:[e.jsx(He,{children:"Contratos de concesiones"}),e.jsx(Ke,{children:"Lista de contratos de concesiones para los espacios de los parques"})]}),e.jsx(fe,{children:Te?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("p",{children:"Cargando contratos..."})}):Z&&Z.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Qe,{children:[e.jsx(Ge,{children:e.jsxs(Ne,{children:[e.jsx(C,{children:"Parque / Espacio"}),e.jsx(C,{children:"Concesionario"}),e.jsx(C,{children:"Tipo de concesión"}),e.jsx(C,{children:"Inicio"}),e.jsx(C,{children:"Vencimiento"}),e.jsx(C,{children:"Canon (MXN)"}),e.jsx(C,{children:"Estado"}),e.jsx(C,{className:"text-right",children:"Acciones"})]})}),e.jsx($e,{children:Z.map(s=>e.jsxs(Ne,{children:[e.jsx(D,{className:"font-medium",children:s.parkName}),e.jsx(D,{children:s.concessionaireName}),e.jsx(D,{children:s.concessionTypeName}),e.jsx(D,{children:k(s.startDate)}),e.jsx(D,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:k(s.endDate)}),s.hasExtension&&e.jsxs("span",{className:"text-xs text-muted-foreground mt-1",children:["Prórroga: ",k(s.extensionDate)]})]})}),e.jsxs(D,{children:["$",parseFloat(s.fee).toLocaleString("es-MX")]}),e.jsx(D,{children:he(s.status)}),e.jsx(D,{className:"text-right",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>Ae(s),title:"Ver detalles",children:e.jsx(R,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>xe(s),title:"Editar",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsxs(_e,{open:Ie&&(n==null?void 0:n.id)===s.id,onOpenChange:K,children:[e.jsx(Ye,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>Le(s),title:"Eliminar",children:e.jsx(Je,{className:"h-4 w-4"})})}),e.jsxs(We,{children:[e.jsxs(Ze,{children:[e.jsx(es,{children:"¿Estás seguro?"}),e.jsx(ss,{children:"Esta acción eliminará permanentemente el contrato de concesión y no se puede deshacer."})]}),e.jsxs(as,{children:[e.jsx(ns,{children:"Cancelar"}),e.jsx(is,{onClick:Pe,children:"Eliminar"})]})]})]}),s.contractFileUrl&&e.jsx(j,{variant:"ghost",size:"icon",onClick:()=>window.open(s.contractFileUrl,"_blank"),title:"Descargar contrato",children:e.jsx(ye,{className:"h-4 w-4"})})]})})]},s.id))})]})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(R,{className:"h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium",children:"No hay contratos de concesión"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:w||M!=="all"?"No se encontraron contratos con los criterios de búsqueda aplicados.":"Aún no hay contratos de concesión registrados en el sistema."}),w||M!=="all"?e.jsx(j,{variant:"outline",onClick:()=>{ce(""),te("all")},children:"Limpiar filtros"}):e.jsxs(j,{onClick:()=>O(!0),children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Crear nuevo contrato"]})]})})]})]}),n&&e.jsx(ae,{open:Ee,onOpenChange:X,children:e.jsxs(ne,{className:"sm:max-w-[700px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(re,{children:"Detalles del contrato de concesión"}),e.jsx(le,{children:"Información completa del contrato de concesión"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsx("div",{className:"bg-muted/50 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:n.parkName}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Espacio concesionado"})]}),he(n.status)]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(rs,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Concesionario"]}),e.jsx("p",{children:n.concessionaireName})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(ls,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Tipo de concesión"]}),e.jsx("p",{children:n.concessionTypeName})]})]}),e.jsx(H,{}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Fecha de inicio"]}),e.jsx("p",{children:k(n.startDate)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Fecha de vencimiento"]}),e.jsx("p",{children:k(n.endDate)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(os,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Canon o tarifa"]}),e.jsxs("p",{children:["$",parseFloat(n.fee).toLocaleString("es-MX")," MXN"]})]})]}),n.hasExtension&&e.jsx("div",{className:"bg-blue-50 border border-blue-100 rounded-md p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(cs,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-blue-800",children:"Prórroga de contrato"}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:["Este contrato cuenta con una prórroga hasta:",e.jsxs("span",{className:"font-medium",children:[" ",k(n.extensionDate)]})]})]})]})}),(n.exclusivityClauses||n.restrictions)&&e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsxs("div",{className:"space-y-4",children:[n.exclusivityClauses&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Cláusulas de exclusividad"}),e.jsx("p",{className:"text-sm",children:n.exclusivityClauses})]}),n.restrictions&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Restricciones"}),e.jsx("p",{className:"text-sm",children:n.restrictions})]})]})]}),n.notes&&e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold",children:"Notas adicionales"}),e.jsx("p",{className:"text-sm",children:n.notes})]})]}),n.contractFileUrl&&e.jsxs(e.Fragment,{children:[e.jsx(H,{}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-muted-foreground"}),"Documento del contrato"]}),e.jsx("p",{className:"text-sm",children:"Contrato digital en formato PDF"})]}),e.jsxs(j,{onClick:()=>window.open(n.contractFileUrl,"_blank"),className:"gap-2",children:[e.jsx(ye,{className:"h-4 w-4"}),"Descargar"]})]})]})]}),e.jsxs(oe,{children:[e.jsx(j,{onClick:()=>X(!1),variant:"outline",children:"Cerrar"}),e.jsxs(j,{onClick:()=>{X(!1),xe(n)},className:"gap-2",children:[e.jsx(be,{className:"h-4 w-4"}),"Editar contrato"]})]})]})}),n&&e.jsx(ae,{open:Fe,onOpenChange:U,children:e.jsxs(ne,{className:"sm:max-w-[750px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(re,{children:"Editar contrato de concesión"}),e.jsx(le,{children:"Modifica la información del contrato de concesión"})]}),e.jsx(ue,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(Ve),className:"space-y-4",children:[e.jsxs(pe,{defaultValue:"basic",className:"w-full",children:[e.jsxs(ge,{className:"grid w-full grid-cols-3",children:[e.jsx(V,{value:"basic",children:"Información Básica"}),e.jsx(V,{value:"details",children:"Detalles"}),e.jsx(V,{value:"document",children:"Documento"})]}),e.jsxs(A,{value:"basic",className:"space-y-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:d.control,name:"parkId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Parque / Espacio"}),e.jsxs(f,{onValueChange:s.onChange,value:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un parque"})})}),e.jsx(y,{children:$?e.jsx(i,{value:"loading",children:"Cargando parques..."}):E&&E.length>0?E.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsx(i,{value:"loading",children:"No hay parques disponibles"})})]}),e.jsx(t,{})]})}),e.jsx(r,{control:d.control,name:"concessionaireId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Concesionario"}),e.jsxs(f,{onValueChange:s.onChange,value:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un concesionario"})})}),e.jsx(y,{children:_?e.jsx(i,{value:"loading",children:"Cargando concesionarios..."}):I&&I.length>0?I.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name||a.fullName},a.id)):e.jsx(i,{value:"loading",children:"No hay concesionarios disponibles"})})]}),e.jsx(t,{})]})})]}),e.jsx(r,{control:d.control,name:"concessionTypeId",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Tipo de Concesión"}),e.jsxs(f,{onValueChange:s.onChange,value:s.value,disabled:q,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona un tipo de concesión"})})}),e.jsx(y,{children:Y?e.jsx(i,{value:"loading",children:"Cargando tipos de concesiones..."}):T&&T.length>0?T.map(a=>e.jsx(i,{value:a.id.toString(),children:a.name},a.id)):e.jsx(i,{value:"loading",children:"No hay tipos de concesiones disponibles"})})]}),e.jsx(t,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:d.control,name:"startDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de inicio"}),e.jsx(c,{children:e.jsx(v,{type:"date",...s})}),e.jsx(t,{})]})}),e.jsx(r,{control:d.control,name:"endDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de vencimiento"}),e.jsx(c,{children:e.jsx(v,{type:"date",...s})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:d.control,name:"status",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Estado del contrato"}),e.jsxs(f,{onValueChange:s.onChange,value:s.value,children:[e.jsx(c,{children:e.jsx(N,{children:e.jsx(b,{placeholder:"Selecciona el estado del contrato"})})}),e.jsxs(y,{children:[e.jsx(i,{value:"active",children:"Activo"}),e.jsx(i,{value:"pending",children:"Pendiente"}),e.jsx(i,{value:"expired",children:"Vencido"}),e.jsx(i,{value:"terminated",children:"Terminado"})]})]}),e.jsx(t,{})]})})]}),e.jsxs(A,{value:"details",className:"space-y-4 py-4",children:[e.jsx(r,{control:d.control,name:"fee",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Canon o tarifa (MXN)"}),e.jsx(c,{children:e.jsx(v,{placeholder:"Ej: 5000.00",...s})}),e.jsx(L,{children:"Ingresa la cantidad en pesos mexicanos sin símbolos ni separadores"}),e.jsx(t,{})]})}),e.jsx(r,{control:d.control,name:"exclusivityClauses",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Cláusulas de exclusividad"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Describe las cláusulas de exclusividad que aplican a esta concesión",...s,rows:3})}),e.jsx(t,{})]})}),e.jsx(r,{control:d.control,name:"restrictions",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Restricciones"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Describe las restricciones que aplican a esta concesión",...s,rows:3})}),e.jsx(t,{})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(r,{control:d.control,name:"hasExtension",render:({field:s})=>e.jsxs(l,{className:"flex flex-row items-start space-x-3 space-y-0 p-4 border rounded-md",children:[e.jsx(c,{children:e.jsx("input",{type:"checkbox",checked:s.value,onChange:a=>s.onChange(a.target.checked),className:"w-4 h-4 mt-1"})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(o,{children:"Tiene prórroga"}),e.jsx(L,{children:"Marcar si el contrato tiene una prórroga aprobada"})]})]})}),d.watch("hasExtension")&&e.jsx(r,{control:d.control,name:"extensionDate",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Fecha de prórroga"}),e.jsx(c,{children:e.jsx(v,{type:"date",...s})}),e.jsx(t,{})]})})]}),e.jsx(r,{control:d.control,name:"notes",render:({field:s})=>e.jsxs(l,{children:[e.jsx(o,{children:"Notas adicionales"}),e.jsx(c,{children:e.jsx(P,{placeholder:"Notas adicionales sobre el contrato",...s,rows:3})}),e.jsx(t,{})]})})]}),e.jsxs(A,{value:"document",className:"space-y-4 py-4",children:[n.contractFileUrl&&e.jsxs("div",{className:"flex justify-between items-center p-4 bg-muted rounded-lg mb-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Documento actual"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ya hay un contrato cargado en el sistema"})]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>window.open(n.contractFileUrl,"_blank"),className:"gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"Ver documento"]})]}),e.jsx(r,{control:d.control,name:"contractFile",render:({field:{value:s,onChange:a,...p}})=>e.jsxs(l,{children:[e.jsx(o,{children:"Actualizar documento del contrato (PDF)"}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsx(v,{type:"file",accept:".pdf",onChange:m=>{var g;const h=(g=m.target.files)==null?void 0:g[0];h&&a(h)},...p}),e.jsx(L,{children:n.contractFileUrl?"Sube un nuevo archivo para reemplazar el documento actual":"Sube el contrato en formato PDF. Tamaño máximo: 10MB."})]})}),e.jsx(t,{})]})})]})]}),e.jsxs(oe,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:()=>U(!1),children:"Cancelar"}),e.jsx(j,{type:"submit",disabled:W.isPending,children:W.isPending?"Guardando...":"Actualizar contrato"})]})]})})]})})]})}export{us as default};
