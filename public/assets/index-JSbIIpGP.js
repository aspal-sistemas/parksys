import{Y as u,e as ke,a6 as De,u as se,R as E,a8 as Me,j as e,aI as Ie,B as J,cc as Ee,C as b,a as y,b as C,c as w,a3 as B,f as ae,ak as qe,y as c,z as S,H as T,J as k,K as D,N as l,Z as te,I as F,ao as ce,aB as Ne,aL as fe,bh as Fe,bi as Re,bj as ve,bk as H,bl as Le,bm as V,M as Pe,aE as Be,h as ze,l as Ae,D as Ue,r as He,t as Ve,v as Oe,w as Ke,aO as Qe,aP as $e,aQ as de,aR as oe,a9 as me,aJ as Je,bc as Ge,O as G,ag as We,be as Ze,X as Xe}from"./index-VG22aPDC.js";import{S as O}from"./skeleton-BEdbCltD.js";import{S as he}from"./separator-D_IPDq0v.js";function ls(){const[m,K]=u.useState(""),[W,Ye]=u.useState("all"),[Z,_e]=u.useState("all"),[d,Q]=u.useState("all"),[N,R]=u.useState("all"),[X,Y]=u.useState("all"),[be,_]=u.useState(!1),[x,f]=u.useState(null),[v,z]=u.useState(null),[n,h]=u.useState({maintenanceType:"",notes:"",performedBy:"",urgency:"normal",estimatedCost:"",nextMaintenanceDate:"",maintenanceDate:new Date().toISOString().split("T")[0],materialsUsed:"",workHours:"",weatherConditions:"",beforeCondition:"",afterCondition:"",followUpRequired:!1,recommendations:""}),[L,le]=u.useState(""),{toast:ee}=ke(),ne=De(),{data:t,isLoading:ye}=se({queryKey:["/api/trees"],select:s=>s.data}),{data:M}=se({queryKey:["/api/tree-species"],select:s=>s.data}),[A,xe]=E.useState([]),[ue,je]=E.useState(!0);E.useEffect(()=>{(async()=>{try{je(!0);const a=localStorage.getItem("token"),r=await(await fetch("/api/parks",{headers:{Authorization:`Bearer ${a}`}})).json(),o=Array.isArray(r)?r:(r==null?void 0:r.data)||[];xe(o)}catch(a){console.error("Error loading parks:",a),xe([])}finally{je(!1)}})()},[]),E.useEffect(()=>{R("all"),f(null)},[d]),E.useEffect(()=>{Y("all"),f(null)},[d,N]);const{data:q,isLoading:Ce}=se({queryKey:["/api/trees/maintenances"],select:s=>s.data}),{data:P,isLoading:$}=se({queryKey:["/api/trees/maintenances/stats"],select:s=>s||{total:0,recent:0,byType:[],byMonth:[]}}),U=u.useMemo(()=>{if(!t)return[];let s=[...t];if(d!=="all"&&(s=s.filter(a=>a.parkId===parseInt(d))),N!=="all"&&(s=s.filter(a=>a.speciesId===parseInt(N))),X!=="all"&&(s=s.filter(a=>a.healthStatus===X)),m){const a=m.toLowerCase();s=s.filter(i=>{var r,o,g;return((r=i.code)==null?void 0:r.toLowerCase().includes(a))||((o=i.speciesName)==null?void 0:o.toLowerCase().includes(a))||((g=i.parkName)==null?void 0:g.toLowerCase().includes(a))})}return s.slice(0,50)},[t,d,N,X,m]),ie=u.useMemo(()=>{if(!t||!M)return[];if(d==="all")return M;const s=parseInt(d),a=t.filter(o=>o.parkId===s);if(a.length===0)return M;const i=new Set(a.map(o=>o.speciesId)),r=M.filter(o=>i.has(o.id));return r.length>0?r:M},[t,M,d]),j=u.useMemo(()=>{if(!t)return[];let s=t;if(d!=="all"&&(s=s.filter(a=>a.parkId===parseInt(d))),N!=="all"&&(s=s.filter(a=>a.speciesId===parseInt(N))),m){const a=m.toLowerCase();s=s.filter(i=>{var r,o,g;return((r=i.code)==null?void 0:r.toLowerCase().includes(a))||((o=i.speciesName)==null?void 0:o.toLowerCase().includes(a))||((g=i.parkName)==null?void 0:g.toLowerCase().includes(a))})}return s.slice(0,50)},[t,d,N,m]);E.useEffect(()=>{console.log("🌳 Estado del selector de árboles:",{selectedParkId:d,selectedSpeciesId:N,selectedTreeId:x,totalTrees:(t==null?void 0:t.length)||0,filteredTrees:(j==null?void 0:j.length)||0,searchTerm:m,getTreesForSelection:j==null?void 0:j.slice(0,3).map(s=>({id:s.id,code:s.code,speciesName:s.speciesName,parkName:s.parkName}))})},[d,N,x,t,j,m]);const pe=E.useCallback(s=>{if(!s||!t)return;const a=t.find(i=>{var r;return((r=i.code)==null?void 0:r.toLowerCase())===s.toLowerCase().trim()});a?(Q(a.parkId.toString()),R(a.speciesId.toString()),f(a.id),z({id:a.id,code:a.code||"",speciesName:a.speciesName||"",parkName:a.parkName||"",healthStatus:a.healthStatus||"",plantingDate:a.plantingDate||""}),console.log("🎯 Árbol encontrado por código:",{code:a.code,tree:a,parkId:a.parkId,speciesId:a.speciesId})):(f(null),z(null))},[t]);E.useEffect(()=>{L.trim()&&pe(L)},[L,pe]);const p=E.useMemo(()=>{if(!q)return[];let s=[...q];if(m){const a=m.toLowerCase();s=s.filter(i=>{var r,o,g,ge;return((r=i.treeCode)==null?void 0:r.toLowerCase().includes(a))||((o=i.parkName)==null?void 0:o.toLowerCase().includes(a))||((g=i.speciesName)==null?void 0:g.toLowerCase().includes(a))||((ge=i.performedBy)==null?void 0:ge.toLowerCase().includes(a))})}return W!=="all"&&(s=s.filter(a=>a.maintenanceType===W)),Z!=="all"&&(s=s.filter(a=>a.parkName===Z)),s},[q,m,W,Z]),I=u.useMemo(()=>{if(!q||!t)return{total:0,coverage:0,recent:0};const s=q.length,a=new Set(q.map(g=>g.treeId)).size,i=t.length>0?Math.round(a/t.length*100):0,r=new Date;r.setDate(r.getDate()-30);const o=q.filter(g=>new Date(g.maintenanceDate)>=r).length;return{total:s,coverage:i,recent:o}},[q,t]),re=Me({mutationFn:async s=>{const a=await fetch(`/api/trees/${x}/maintenances`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){const i=await a.json();throw new Error(i.message||"Error al registrar mantenimiento")}return a.json()},onSuccess:()=>{ne.invalidateQueries({queryKey:["/api/trees/maintenances"]}),ne.invalidateQueries({queryKey:["/api/trees/maintenances/stats"]}),ne.invalidateQueries({queryKey:[`/api/trees/${x}/maintenances`]}),ee({title:"Mantenimiento registrado",description:"El registro de mantenimiento se ha guardado correctamente"}),_(!1),h({maintenanceType:"",notes:"",performedBy:"",urgency:"normal",estimatedCost:"",nextMaintenanceDate:"",maintenanceDate:new Date().toISOString().split("T")[0],materialsUsed:"",workHours:"",weatherConditions:"",beforeCondition:"",afterCondition:"",followUpRequired:!1,recommendations:""}),f(null),z(null),le(""),Q("all"),R("all"),Y("all"),K("")},onError:s=>{ee({title:"Error",description:s.message||"Ha ocurrido un error al registrar el mantenimiento",variant:"destructive"})}}),we=()=>{h({maintenanceType:"",notes:"",performedBy:"",urgency:"normal",estimatedCost:"",nextMaintenanceDate:"",maintenanceDate:new Date().toISOString().split("T")[0],materialsUsed:"",workHours:"",weatherConditions:"",beforeCondition:"",afterCondition:"",followUpRequired:!1,recommendations:""}),f(null),z(null),le(""),Q("all"),R("all"),Y("all"),K("")},Se=s=>{s||we(),_(s)},Te=()=>{if(!x){ee({title:"Error",description:"Debes seleccionar un árbol",variant:"destructive"});return}if(!n.maintenanceType){ee({title:"Error",description:"Debes seleccionar un tipo de mantenimiento",variant:"destructive"});return}const s={...n,treeId:x,maintenanceDate:n.maintenanceDate||new Date().toISOString().split("T")[0]};re.mutate(s)};return e.jsxs(Ie,{children:[e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Mantenimiento de Árboles"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestiona y registra las actividades de mantenimiento realizadas en árboles"})]}),e.jsxs(J,{onClick:()=>_(!0),children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Registrar Mantenimiento"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs(b,{children:[e.jsx(y,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium",children:"Total de Mantenimientos"})}),e.jsx(w,{children:$?e.jsx(O,{className:"h-7 w-12"}):e.jsx("div",{className:"text-2xl font-bold",children:(I==null?void 0:I.total)||0})})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Mantenimientos Recientes"}),e.jsx(B,{children:"Últimos 30 días"})]}),e.jsx(w,{children:$?e.jsx(O,{className:"h-7 w-12"}):e.jsx("div",{className:"text-2xl font-bold",children:(I==null?void 0:I.recent)||0})})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Cobertura de Mantenimiento"}),e.jsx(B,{children:"Árboles con mantenimiento"})]}),e.jsx(w,{children:$?e.jsx(O,{className:"h-7 w-12"}):e.jsxs("div",{className:"text-2xl font-bold",children:[(I==null?void 0:I.coverage)||0,"%"]})})]}),e.jsxs(b,{children:[e.jsx(y,{className:"pb-2",children:e.jsx(C,{className:"text-sm font-medium",children:"Tipo Más Común"})}),e.jsx(w,{children:$?e.jsx(O,{className:"h-7 w-32"}):e.jsx("div",{children:P!=null&&P.byType&&P.byType.length>0?e.jsx(ae,{variant:"outline",className:"bg-green-50 text-green-700 hover:bg-green-100",children:P.byType[0].type}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"Sin datos"})})})]}),e.jsxs(b,{children:[e.jsxs(y,{className:"pb-2",children:[e.jsx(C,{className:"text-sm font-medium",children:"Eficiencia"}),e.jsx(B,{children:"Árboles mantenidos"})]}),e.jsx(w,{children:$||ye?e.jsx(O,{className:"h-7 w-16"}):e.jsxs("div",{className:"text-2xl font-bold",children:[t&&P?Math.round(P.total/t.length*100):0,"%"]})})]})]}),e.jsxs(b,{className:"mb-6",children:[e.jsxs(y,{children:[e.jsxs(C,{className:"text-lg flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5"}),"Filtros Avanzados para Selección de Árboles"]}),e.jsx(B,{children:"Máximo 50 resultados - Filtra por parque, especie y estado para encontrar árboles específicos"})]}),e.jsxs(w,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"park-filter",children:"Parque"}),e.jsxs(S,{value:d,onValueChange:Q,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Selecciona un parque"})}),e.jsxs(D,{children:[e.jsx(l,{value:"all",children:"Todos los parques"}),ue?e.jsx(l,{value:"loading",disabled:!0,children:"Cargando..."}):A==null?void 0:A.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"species-filter",children:"Especie"}),e.jsxs(S,{value:N,onValueChange:R,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Selecciona una especie"})}),e.jsxs(D,{children:[e.jsx(l,{value:"all",children:"Todas las especies"}),M==null?void 0:M.map(s=>e.jsx(l,{value:s.id.toString(),children:s.commonName},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"health-filter",children:"Estado de Salud"}),e.jsxs(S,{value:X,onValueChange:Y,children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Selecciona estado"})}),e.jsxs(D,{children:[e.jsx(l,{value:"all",children:"Todos los estados"}),e.jsx(l,{value:"Excelente",children:"Excelente"}),e.jsx(l,{value:"Bueno",children:"Bueno"}),e.jsx(l,{value:"Regular",children:"Regular"}),e.jsx(l,{value:"Malo",children:"Malo"}),e.jsx(l,{value:"Crítico",children:"Crítico"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"search-trees",children:"Búsqueda"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(F,{placeholder:"Código o nombre...",className:"pl-8",value:m,onChange:s=>K(s.target.value)})]})]})]}),e.jsxs("div",{className:"mt-4 flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsxs("span",{children:[U.length," árboles encontrados",U.length===50&&" (límite alcanzado)"]})]})]})]}),e.jsxs(b,{className:"mb-6",children:[e.jsxs(y,{children:[e.jsxs(C,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5"}),"Selección de Árbol para Mantenimiento"]}),e.jsx(B,{children:"Selecciona un árbol de la lista filtrada para programar mantenimiento"})]}),e.jsx(w,{children:v?e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-green-800",children:"Árbol Seleccionado"}),e.jsxs("p",{className:"text-green-700",children:[e.jsx("span",{className:"font-medium",children:v.code})," - ",v.speciesName]}),e.jsxs("p",{className:"text-sm text-green-600",children:[v.parkName," | Estado: ",v.healthStatus]})]}),e.jsx(J,{variant:"outline",size:"sm",onClick:()=>{z(null),f(null)},children:"Cambiar Árbol"})]})}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Selecciona un árbol:"}),e.jsxs(S,{value:(x==null?void 0:x.toString())||"",onValueChange:s=>{const a=parseInt(s);f(a);const i=U.find(r=>r.id===a);i&&z({id:i.id,code:i.code,speciesName:i.speciesName,parkName:i.parkName,healthStatus:i.healthStatus,plantingDate:i.plantingDate})},children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Selecciona un árbol para mantenimiento"})}),e.jsx(D,{children:U==null?void 0:U.map(s=>e.jsx(l,{value:s.id.toString(),children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-medium",children:s.code}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.speciesName," - ",s.parkName]})]})},s.id))})]})]})})]}),e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsx(C,{children:"Registros de Mantenimiento"}),e.jsxs(B,{children:[p==null?void 0:p.length," ",(p==null?void 0:p.length)===1?"registro":"registros"," de mantenimiento"]})]}),e.jsx(w,{children:Ce?e.jsx("div",{className:"space-y-2",children:[...Array(5)].map((s,a)=>e.jsx(O,{className:"h-12 w-full"},a))}):(p==null?void 0:p.length)===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(fe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-medium",children:"No hay registros de mantenimiento"}),e.jsx("p",{className:"text-muted-foreground",children:m||W!=="all"||Z!=="all"?"No se encontraron registros con los filtros aplicados":'Registra el primer mantenimiento haciendo clic en "Registrar Mantenimiento"'})]}):e.jsx("div",{className:"rounded-md border",children:e.jsxs(Fe,{children:[e.jsx(Re,{children:e.jsxs(ve,{children:[e.jsx(H,{children:"Código"}),e.jsx(H,{children:"Parque"}),e.jsx(H,{children:"Especie"}),e.jsx(H,{children:"Tipo"}),e.jsx(H,{children:"Fecha"}),e.jsx(H,{children:"Realizado por"})]})}),e.jsx(Le,{children:p==null?void 0:p.map(s=>e.jsxs(ve,{children:[e.jsx(V,{className:"font-medium",children:s.treeCode}),e.jsx(V,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"h-3 w-3 text-muted-foreground"}),s.parkName]})}),e.jsx(V,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Be,{className:"h-3 w-3 text-green-600"}),s.speciesName]})}),e.jsx(V,{children:e.jsx(ae,{variant:"outline",className:"bg-green-50 text-green-700",children:s.maintenanceType})}),e.jsx(V,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"h-3 w-3 text-muted-foreground"}),Ae(new Date(s.maintenanceDate),"dd MMM yyyy",{locale:Xe})]})}),e.jsx(V,{children:s.performedByName||"Usuario "+s.performedBy})]},s.id))})]})})})]})]}),e.jsx(Ue,{open:be,onOpenChange:Se,children:e.jsxs(He,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ve,{children:[e.jsxs(Oe,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5 text-green-600"}),"Registrar Nuevo Mantenimiento"]}),e.jsx(Ke,{children:"Formulario completo para documentar actividades de mantenimiento de árboles"})]}),e.jsxs(Qe,{defaultValue:"selection",className:"w-full",children:[e.jsxs($e,{className:"grid w-full grid-cols-3",children:[e.jsx(de,{value:"selection",children:"1. Selección de Árbol"}),e.jsx(de,{value:"maintenance",children:"2. Detalles del Mantenimiento"}),e.jsx(de,{value:"additional",children:"3. Información Adicional"})]}),e.jsx(oe,{value:"selection",className:"space-y-4",children:e.jsxs(b,{children:[e.jsxs(y,{children:[e.jsxs(C,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-green-600"}),"Selección de Árbol"]}),e.jsx(B,{children:"Ingresa el código del árbol o busca por filtros jerárquicos"})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"tree-code-input",className:"text-base font-medium",children:"Código del Árbol"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(F,{id:"tree-code-input",placeholder:"Ingresa el código del árbol (ej: FRE-BOS-631, MEZ-PAR-616)...",value:L,onChange:s=>le(s.target.value),className:"pl-10 h-12 text-base"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Al ingresar un código válido, los campos de parque, especie y árbol se completarán automáticamente."}),v&&L&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"h-5 w-5 text-green-600"}),e.jsx("span",{className:"font-medium text-green-800",children:"Árbol encontrado"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Código:"})," ",v.code]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Especie:"})," ",v.speciesName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Parque:"})," ",v.parkName]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Estado:"}),e.jsx(ae,{variant:"outline",className:"ml-1",children:v.healthStatus})]})]})]}),L&&!v&&e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Je,{className:"h-5 w-5 text-yellow-600"}),e.jsxs("span",{className:"font-medium text-yellow-800",children:['No se encontró un árbol con el código "',L,'"']})]}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Verifica que el código sea correcto o usa los filtros para buscar manualmente."})]})]}),e.jsxs("div",{className:"flex items-center gap-4 my-6",children:[e.jsx(he,{className:"flex-1"}),e.jsx("span",{className:"text-sm text-muted-foreground font-medium",children:"O busca por filtros"}),e.jsx(he,{className:"flex-1"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"form-park",children:"Parque"}),e.jsxs(S,{value:d,onValueChange:s=>{Q(s),R("all"),f(null)},children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Selecciona un parque"})}),e.jsxs(D,{children:[e.jsx(l,{value:"all",children:"Todos los parques"}),ue?e.jsx(l,{value:"loading",disabled:!0,children:"Cargando..."}):A==null?void 0:A.map(s=>e.jsx(l,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"form-species",children:"Especie"}),e.jsxs(S,{value:N,onValueChange:s=>{R(s),f(null)},disabled:d==="all",children:[e.jsx(T,{children:e.jsx(k,{placeholder:d==="all"?"Selecciona primero un parque":"Selecciona una especie"})}),e.jsxs(D,{children:[e.jsx(l,{value:"all",children:"Todas las especies"}),ie==null?void 0:ie.map(s=>e.jsx(l,{value:s.id.toString(),children:s.commonName},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"tree-search",children:"Buscar por Código de Árbol"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(te,{className:"absolute left-3 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(F,{id:"tree-search",placeholder:"Buscar por código (ej: BSK-001, PAR-025)...",value:m,onChange:s=>K(s.target.value),className:"pl-10"})]}),m&&e.jsx(J,{variant:"outline",size:"sm",onClick:()=>K(""),className:"shrink-0",children:"Limpiar"})]}),m&&j.length>0&&e.jsx("div",{className:"p-2 bg-blue-50 rounded-md text-sm text-blue-700",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),e.jsxs("span",{children:["Encontrados ",j.length,' árboles que coinciden con "',m,'"']})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"form-tree",children:"Árbol Específico"}),e.jsxs(S,{value:(x==null?void 0:x.toString())||"",onValueChange:s=>f(Number(s)),disabled:d==="all",children:[e.jsx(T,{children:e.jsx(k,{placeholder:d==="all"?"Selecciona primero un parque":"Selecciona un árbol"})}),e.jsx(D,{children:(j==null?void 0:j.length)>0?j.filter(s=>s.id&&s.code).map(s=>e.jsx(l,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{variant:"outline",className:"bg-green-50 text-green-700",children:s.code}),e.jsx("span",{className:"font-medium",children:s.speciesName||"Especie desconocida"}),e.jsxs("span",{className:"text-muted-foreground",children:["(",s.healthStatus||"N/A",")"]}),e.jsx("span",{className:"text-xs text-blue-600",children:s.parkName||"Parque desconocido"})]})},s.id)):e.jsx(l,{value:"no-trees",disabled:!0,children:d==="all"?"Selecciona un parque específico":"No hay árboles disponibles"})})]})]})]}),x&&e.jsxs("div",{className:"p-4 bg-green-50 rounded-md border border-green-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-700 mb-2",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Árbol seleccionado correctamente"})]}),(()=>{const s=t==null?void 0:t.find(a=>a.id===x);return s?e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Código:"})," ",s.code]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Especie:"})," ",s.speciesName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Parque:"})," ",s.parkName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Estado:"})," ",s.healthStatus]})]}):null})()]})]})]})}),e.jsx(oe,{value:"maintenance",className:"space-y-4",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(C,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5 text-blue-600"}),"Detalles del Mantenimiento"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"maintenanceType",children:"Tipo de Mantenimiento *"}),e.jsxs(S,{value:n.maintenanceType,onValueChange:s=>h({...n,maintenanceType:s}),children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Selecciona un tipo"})}),e.jsxs(D,{children:[e.jsx(l,{value:"Poda",children:"🌿 Poda"}),e.jsx(l,{value:"Riego",children:"💧 Riego"}),e.jsx(l,{value:"Fertilización",children:"🌱 Fertilización"}),e.jsx(l,{value:"Control de plagas",children:"🐛 Control de plagas"}),e.jsx(l,{value:"Tratamiento de enfermedades",children:"🏥 Tratamiento de enfermedades"}),e.jsx(l,{value:"Inspección",children:"🔍 Inspección"}),e.jsx(l,{value:"Limpieza",children:"🧹 Limpieza"}),e.jsx(l,{value:"Transplante",children:"🌳 Transplante"}),e.jsx(l,{value:"Otro",children:"⚙️ Otro"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"urgency",children:"Urgencia"}),e.jsxs(S,{value:n.urgency,onValueChange:s=>h({...n,urgency:s}),children:[e.jsx(T,{children:e.jsx(k,{})}),e.jsxs(D,{children:[e.jsx(l,{value:"low",children:"🟢 Baja"}),e.jsx(l,{value:"normal",children:"🟡 Normal"}),e.jsx(l,{value:"high",children:"🟠 Alta"}),e.jsx(l,{value:"critical",children:"🔴 Crítica"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"maintenanceDate",children:"Fecha de Mantenimiento *"}),e.jsx(F,{id:"maintenanceDate",type:"date",value:n.maintenanceDate,onChange:s=>h({...n,maintenanceDate:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"performedBy",children:"Realizado por *"}),e.jsx(F,{id:"performedBy",placeholder:"Nombre del responsable",value:n.performedBy,onChange:s=>h({...n,performedBy:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"workHours",children:"Horas de Trabajo"}),e.jsx(F,{id:"workHours",type:"number",placeholder:"Ej: 2.5",value:n.workHours,onChange:s=>h({...n,workHours:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"estimatedCost",children:"Costo Estimado ($)"}),e.jsx(F,{id:"estimatedCost",type:"number",placeholder:"Ej: 500",value:n.estimatedCost,onChange:s=>h({...n,estimatedCost:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"notes",children:"Descripción del Trabajo Realizado *"}),e.jsx(G,{id:"notes",placeholder:"Describe detalladamente el mantenimiento realizado...",rows:3,value:n.notes,onChange:s=>h({...n,notes:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"materialsUsed",children:"Materiales Utilizados"}),e.jsx(G,{id:"materialsUsed",placeholder:"Lista de materiales, herramientas y productos utilizados...",rows:2,value:n.materialsUsed,onChange:s=>h({...n,materialsUsed:s.target.value})})]})]})]})}),e.jsx(oe,{value:"additional",className:"space-y-4",children:e.jsxs(b,{children:[e.jsx(y,{children:e.jsxs(C,{className:"text-lg flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5 text-purple-600"}),"Información Adicional"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"weatherConditions",children:"Condiciones Climáticas"}),e.jsxs(S,{value:n.weatherConditions,onValueChange:s=>h({...n,weatherConditions:s}),children:[e.jsx(T,{children:e.jsx(k,{placeholder:"Selecciona condiciones"})}),e.jsxs(D,{children:[e.jsx(l,{value:"soleado",children:"☀️ Soleado"}),e.jsx(l,{value:"nublado",children:"☁️ Nublado"}),e.jsx(l,{value:"lluvia",children:"🌧️ Lluvia"}),e.jsx(l,{value:"viento",children:"💨 Viento"}),e.jsx(l,{value:"calor",children:"🌡️ Calor extremo"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"nextMaintenanceDate",children:"Próximo Mantenimiento"}),e.jsx(F,{id:"nextMaintenanceDate",type:"date",value:n.nextMaintenanceDate,onChange:s=>h({...n,nextMaintenanceDate:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"beforeCondition",children:"Condición Antes del Mantenimiento"}),e.jsx(G,{id:"beforeCondition",placeholder:"Describe el estado del árbol antes del mantenimiento...",rows:2,value:n.beforeCondition,onChange:s=>h({...n,beforeCondition:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"afterCondition",children:"Condición Después del Mantenimiento"}),e.jsx(G,{id:"afterCondition",placeholder:"Describe el estado del árbol después del mantenimiento...",rows:2,value:n.afterCondition,onChange:s=>h({...n,afterCondition:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"recommendations",children:"Recomendaciones"}),e.jsx(G,{id:"recommendations",placeholder:"Recomendaciones para futuros mantenimientos...",rows:2,value:n.recommendations,onChange:s=>h({...n,recommendations:s.target.value})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(We,{id:"followUpRequired",checked:n.followUpRequired,onCheckedChange:s=>h({...n,followUpRequired:s})}),e.jsx(c,{htmlFor:"followUpRequired",className:"text-sm",children:"Requiere seguimiento adicional"})]})]})]})})]}),e.jsx(he,{}),e.jsxs(Ze,{className:"gap-2",children:[e.jsx(J,{variant:"outline",onClick:()=>_(!1),children:"Cancelar"}),e.jsx(J,{onClick:Te,disabled:re.isPending||!x||!n.maintenanceType||!n.performedBy,className:"bg-green-600 hover:bg-green-700",children:re.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Registrar Mantenimiento"]})})]})]})})]})}export{ls as default};
