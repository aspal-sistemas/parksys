import{l as me,ae as oe,a2 as j,u as B,ag as U,j as e,aX as O,f as _,b as f,O as xe,Q,V as K,W as G,Y as H,_ as N,B as m,a6 as he,a5 as je,aR as ge,D as pe,bn as D,ao as z,aM as ue,aN as Ne,g as fe,h as ve,i as ye,au as Z,w as be,y as we,z as Ce,I as Se,U as k,e as W,aS as X,aZ as Ee,M as ke,m as _e,o as J,aq as Y,n as De,ah as ze,bo as Le}from"./index-D5qLf1ib.js";const L=({status:s})=>{const i={pending:{icon:De,color:"bg-yellow-100 text-yellow-800",text:"Pendiente"},approved:{icon:ze,color:"bg-green-100 text-green-800",text:"Aprobada"},rejected:{icon:Le,color:"bg-red-100 text-red-800",text:"Rechazada"}}[s],d=i.icon;return e.jsxs(J,{className:i.color,children:[e.jsx(d,{className:"h-3 w-3 mr-1"}),i.text]})},c=({rating:s})=>e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(r=>e.jsx(f,{className:`h-4 w-4 ${r<=s?"text-yellow-500 fill-yellow-500":"text-gray-300"}`},r)),e.jsxs("span",{className:"text-sm text-gray-600 ml-1",children:["(",s,")"]})]}),Pe=({evaluation:s,onDelete:r,onViewDetails:i,isSelected:d,onSelectToggle:g})=>e.jsxs(_,{className:`mb-4 ${d?"border-2 border-blue-500 bg-blue-50":""}`,children:[e.jsx(fe,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{checked:d,onCheckedChange:()=>g(s.id)}),e.jsxs("div",{children:[e.jsx(ve,{className:"text-lg",children:s.park_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Por ",s.evaluator_name," • ",new Date(s.created_at).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{rating:s.overall_rating}),e.jsx(L,{status:s.status})]})]})}),e.jsxs(ye,{children:[e.jsxs("div",{className:"grid grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Limpieza"}),e.jsx(c,{rating:s.cleanliness})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Seguridad"}),e.jsx(c,{rating:s.safety})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Mantenimiento"}),e.jsx(c,{rating:s.maintenance})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Accesibilidad"}),e.jsx(c,{rating:s.accessibility})]})]}),s.comments&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Comentarios:"}),e.jsxs("p",{className:"text-sm text-gray-600 italic",children:['"',s.comments,'"']})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:["📍 ",s.evaluator_city]}),e.jsxs("span",{children:["👤 ",s.evaluator_age," años"]}),s.would_recommend&&e.jsx("span",{className:"text-green-600",children:"✓ Recomendado"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>i(s),className:"text-blue-600 hover:bg-blue-50",children:[e.jsx(Z,{className:"h-4 w-4 mr-1"}),"Ver detalles"]}),e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>r(s.id),className:"text-red-600 hover:bg-red-50",children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Eliminar"]})]})]})]})]}),Te=({evaluation:s,onDelete:r,onViewDetails:i,isSelected:d,onSelectToggle:g})=>e.jsxs("tr",{className:`border-b hover:bg-gray-50 ${d?"bg-blue-50":""}`,children:[e.jsx("td",{className:"p-3",children:e.jsx(z,{checked:d,onCheckedChange:()=>g(s.id)})}),e.jsxs("td",{className:"p-3",children:[e.jsx("div",{className:"font-medium",children:s.park_name}),e.jsx("div",{className:"text-sm text-gray-600",children:s.evaluator_name})]}),e.jsx("td",{className:"p-3",children:e.jsx(c,{rating:s.overall_rating})}),e.jsx("td",{className:"p-3",children:e.jsx(L,{status:s.status})}),e.jsx("td",{className:"p-3 text-sm text-gray-600",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>i(s),className:"text-blue-600 hover:bg-blue-50",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>r(s.id),className:"text-red-600 hover:bg-red-50",children:e.jsx(D,{className:"h-4 w-4"})})]})})]});function qe(){var V,$;const{toast:s}=me(),r=oe(),[i,d]=j.useState([]),[g,ee]=j.useState("grid"),[o,C]=j.useState(1),[v,se]=j.useState(""),[y,ae]=j.useState("all"),[b,te]=j.useState("all"),[P,T]=j.useState(null),E=10,{data:x,isLoading:le}=B({queryKey:["/api/park-evaluations",o,v,y,b],queryFn:async()=>{const a=new URLSearchParams({page:o.toString(),limit:E.toString()});v.trim()&&a.append("search",v.trim()),y!=="all"&&a.append("status",y),b!=="all"&&a.append("parkId",b);const l=await fetch(`/api/park-evaluations?${a.toString()}`);if(!l.ok)throw new Error("Failed to fetch evaluations");return l.json()},suspense:!1,retry:1}),{data:S}=B({queryKey:["/api/parks"],queryFn:async()=>{const a=await fetch("/api/parks");if(!a.ok)throw new Error("Failed to fetch parks");return a.json()},suspense:!1,retry:1}),R=U({mutationFn:a=>Y(`/api/park-evaluations/${a}`,{method:"DELETE"}),onSuccess:()=>{s({title:"Evaluación eliminada correctamente"}),r.invalidateQueries({queryKey:["/api/park-evaluations"]})},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),A=U({mutationFn:a=>Y("/api/park-evaluations/bulk/delete",{method:"DELETE",data:{evaluationIds:a}}),onSuccess:()=>{s({title:"Evaluaciones eliminadas correctamente"}),d([]),r.invalidateQueries({queryKey:["/api/park-evaluations"]})},onError:a=>{s({title:"Error",description:a.message,variant:"destructive"})}}),ie=async()=>{try{const a=await fetch("/api/park-evaluations/export-all");if(!a.ok)throw new Error("Failed to export");const l=await a.json(),n=ne(l.evaluations);ce(n,`evaluaciones_parques_${new Date().toISOString().split("T")[0]}.csv`,"text/csv"),s({title:"CSV exportado correctamente",description:`${l.evaluations.length} evaluaciones exportadas`})}catch(a){s({title:"Error",description:a.message,variant:"destructive"})}},ne=a=>["\uFEFF"+["ID","Parque","Evaluador","Email","Ciudad","Edad","Calificación General","Limpieza","Seguridad","Mantenimiento","Accesibilidad","Amenidades","Actividades","Personal","Belleza Natural","Comentarios","Recomendaría","Estado","Fecha"].join(","),...a.map(t=>{var h;return[t.id,`"${t.park_name}"`,`"${t.evaluator_name}"`,`"${t.evaluator_email}"`,`"${t.evaluator_city}"`,t.evaluator_age,t.overall_rating,t.cleanliness,t.safety,t.maintenance,t.accessibility,t.amenities,t.activities,t.staff,t.natural_beauty,`"${((h=t.comments)==null?void 0:h.replace(/"/g,'""'))||""}"`,t.would_recommend?"Sí":"No",t.status==="pending"?"Pendiente":t.status==="approved"?"Aprobada":"Rechazada",new Date(t.created_at).toLocaleDateString()].join(",")})].join(`
`),ce=(a,l,n)=>{const t=new Blob([a],{type:n}),h=URL.createObjectURL(t),u=document.createElement("a");u.href=h,u.download=l,u.click(),URL.revokeObjectURL(h)},re=async a=>{var n;const l=(n=a.target.files)==null?void 0:n[0];if(l)try{const t=new FormData;t.append("file",l);const h=await fetch("/api/park-evaluations/import-csv",{method:"POST",body:t});if(!h.ok)throw new Error("Error importing CSV file");const u=await h.json();s({title:"CSV importado correctamente",description:`${u.imported} evaluaciones importadas, ${u.skipped||0} omitidas`}),r.invalidateQueries({queryKey:["/api/park-evaluations"]}),a.target.value=""}catch(t){s({title:"Error",description:t.message,variant:"destructive"})}},q=()=>{i.length===p.length?d([]):d(p.map(a=>a.id))},F=a=>{d(l=>l.includes(a)?l.filter(n=>n!==a):[...l,a])},I=a=>{T(a)};j.useEffect(()=>{C(1)},[v,y,b]);const p=(x==null?void 0:x.evaluations)||[],M=((V=x==null?void 0:x.pagination)==null?void 0:V.total)||0,w=(($=x==null?void 0:x.pagination)==null?void 0:$.pages)||1,de=(S==null?void 0:S.data)||S||[];return le?e.jsx(O,{children:e.jsxs("div",{className:"p-6",children:[e.jsx(_,{className:"p-4 bg-gray-50 mb-8",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Evaluaciones"})]})}),e.jsx("div",{className:"text-center py-8",children:"Cargando evaluaciones..."})]})}):e.jsx(O,{children:e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-6 py-8 max-w-7xl",children:[e.jsx(_,{className:"p-4 bg-gray-50 mb-8",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-8 h-8 text-gray-900"}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Evaluaciones"})]})}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-sm mb-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4",children:[e.jsx(xe,{placeholder:"Buscar evaluaciones...",value:v,onChange:a=>se(a.target.value)}),e.jsxs(Q,{value:y,onValueChange:ae,children:[e.jsx(K,{children:e.jsx(G,{placeholder:"Estado"})}),e.jsxs(H,{children:[e.jsx(N,{value:"all",children:"Todos los estados"}),e.jsx(N,{value:"pending",children:"Pendientes"}),e.jsx(N,{value:"approved",children:"Aprobadas"}),e.jsx(N,{value:"rejected",children:"Rechazadas"})]})]}),e.jsxs(Q,{value:b,onValueChange:te,children:[e.jsx(K,{children:e.jsx(G,{placeholder:"Parque"})}),e.jsxs(H,{children:[e.jsx(N,{value:"all",children:"Todos los parques"}),de.map(a=>e.jsx(N,{value:a.id.toString(),children:a.name},a.id))]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>ee(g==="grid"?"list":"grid"),children:g==="grid"?e.jsx(he,{className:"h-4 w-4"}):e.jsx(je,{className:"h-4 w-4"})}),e.jsx("input",{type:"file",accept:".csv",onChange:re,style:{display:"none"},id:"csv-import"}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>{var a;return(a=document.getElementById("csv-import"))==null?void 0:a.click()},children:[e.jsx(ge,{className:"h-4 w-4 mr-1"}),"Importar"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:ie,children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Exportar"]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Mostrando ",(o-1)*E+1," a ",Math.min(o*E,M)," de ",M," registros"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[i.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>A.mutate(i),className:"text-red-600 hover:bg-red-50",disabled:A.isPending,children:[e.jsx(D,{className:"h-4 w-4 mr-1"}),"Eliminar (",i.length,")"]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>d([]),children:"Limpiar"})]}),e.jsx(m,{variant:"outline",size:"sm",onClick:q,children:i.length===p.length?"Deseleccionar todo":"Seleccionar todo"})]})]})]}),g==="grid"?e.jsx("div",{className:"space-y-4",children:p.map(a=>e.jsx(Pe,{evaluation:a,onDelete:l=>R.mutate(l),onViewDetails:I,isSelected:i.includes(a.id),onSelectToggle:F},a.id))}):e.jsx("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left",children:e.jsx(z,{checked:i.length===p.length,onCheckedChange:q})}),e.jsx("th",{className:"p-3 text-left",children:"Parque / Evaluador"}),e.jsx("th",{className:"p-3 text-left",children:"Calificación"}),e.jsx("th",{className:"p-3 text-left",children:"Estado"}),e.jsx("th",{className:"p-3 text-left",children:"Fecha"}),e.jsx("th",{className:"p-3 text-left",children:"Acciones"})]})}),e.jsx("tbody",{children:p.map(a=>e.jsx(Te,{evaluation:a,onDelete:l=>R.mutate(l),onViewDetails:I,isSelected:i.includes(a.id),onSelectToggle:F},a.id))})]})}),w>1&&e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-sm mt-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Página ",o," de ",w]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>C(a=>Math.max(1,a-1)),disabled:o===1,children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Anterior"]}),Array.from({length:Math.min(5,w)},(a,l)=>{const n=l+1;return e.jsx(m,{variant:o===n?"default":"outline",size:"sm",onClick:()=>C(n),className:o===n?"bg-[#00a587] hover:bg-[#067f5f]":"",children:n},n)}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>C(a=>Math.min(w,a+1)),disabled:o===w,children:["Siguiente",e.jsx(Ne,{className:"h-4 w-4 ml-1"})]})]})]})}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(f,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No hay evaluaciones disponibles"})]}),P&&e.jsx(Re,{evaluation:P,onClose:()=>T(null)})]})})})}const Re=({evaluation:s,onClose:r})=>e.jsx(be,{open:!0,onOpenChange:()=>r(),children:e.jsxs(we,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsx(Ce,{children:e.jsxs(Se,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-yellow-500"}),"Detalles de Evaluación - ",s.park_name]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Información del Evaluador"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nombre:"})," ",s.evaluator_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Email:"})," ",s.evaluator_email]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Ciudad:"})," ",s.evaluator_city]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Edad:"})," ",s.evaluator_age," años"]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4"}),"Calificación General"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(c,{rating:s.overall_rating}),e.jsxs("span",{className:"text-lg font-bold text-blue-600",children:[s.overall_rating,"/5"]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Calificaciones Detalladas"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-green-600"}),"Limpieza:"]}),e.jsx(c,{rating:s.cleanliness})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-blue-600"}),"Seguridad:"]}),e.jsx(c,{rating:s.safety})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-orange-600"}),"Mantenimiento:"]}),e.jsx(c,{rating:s.maintenance})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4 text-purple-600"}),"Accesibilidad:"]}),e.jsx(c,{rating:s.accessibility})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-teal-600"}),"Amenidades:"]}),e.jsx(c,{rating:s.amenities})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4 text-indigo-600"}),"Actividades:"]}),e.jsx(c,{rating:s.activities})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(k,{className:"h-4 w-4 text-gray-600"}),"Personal:"]}),e.jsx(c,{rating:s.staff})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4 text-green-700"}),"Belleza Natural:"]}),e.jsx(c,{rating:s.natural_beauty})]})]})]}),s.comments&&e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Comentarios"}),e.jsxs("p",{className:"text-gray-700 italic",children:['"',s.comments,'"']})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Información Adicional"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Recomendaría:"}),e.jsx(J,{variant:s.would_recommend?"default":"secondary",children:s.would_recommend?"Sí":"No"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:"Estado:"}),e.jsx(L,{status:s.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(s.created_at).toLocaleDateString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Hora:"})," ",new Date(s.created_at).toLocaleTimeString()]})]})]})]})]})});export{qe as default};
