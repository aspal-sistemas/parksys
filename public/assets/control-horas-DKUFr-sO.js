import{a2 as C,ae as W,af as Y,u as p,ag as X,j as e,aX as Z,w as ee,x as se,B as E,bh as ae,y as re,z as te,I as ie,J as le,ai as ne,aj as c,ak as d,al as m,Q as R,am as x,V as D,W as F,Y as k,_ as g,an as h,O as H,$ as V,f as y,g as f,h as N,i as v,n as A,ab as I,m as oe,t as K,o,aW as ce,bo as de,ah as me,M as xe,ad as n,ap as he,cb as _}from"./index-D5qLf1ib.js";const je=n.object({employeeId:n.string().min(1,"Selecciona un empleado"),recordType:n.string().min(1,"Selecciona el tipo de registro"),timestamp:n.string().min(1,"Hora y fecha requerida"),location:n.string().optional(),notes:n.string().optional(),isManualEntry:n.boolean().default(!0),manualReason:n.string().optional()}),M=[{value:"check_in",label:"Entrada",color:"bg-green-500",icon:"‚Üó"},{value:"check_out",label:"Salida",color:"bg-red-500",icon:"‚Üô"},{value:"break_start",label:"Inicio de descanso",color:"bg-yellow-500",icon:"‚è∏"},{value:"break_end",label:"Fin de descanso",color:"bg-blue-500",icon:"‚ñ∂"},{value:"overtime_start",label:"Inicio horas extra",color:"bg-purple-500",icon:"‚è∞"},{value:"overtime_end",label:"Fin horas extra",color:"bg-indigo-500",icon:"üèÅ"}];function ge(){var P;const[t,U]=C.useState(new Date().toISOString().split("T")[0]),[r,B]=C.useState("all"),[Q,b]=C.useState(!1),w=W(),i=Y({resolver:he(je),defaultValues:{employeeId:"",recordType:"",timestamp:"",location:"Oficina Central",notes:"",isManualEntry:!0,manualReason:""}}),{data:q=[],isLoading:$}=p({queryKey:["/api/time-off/time-records",t,r],queryFn:async()=>{const s=new URLSearchParams;t&&s.append("dateFrom",t),t&&s.append("dateTo",t),r&&s.append("employeeId",r);const a=await fetch(`/api/time-off/time-records?${s}`);if(!a.ok)throw new Error("Error al cargar registros");return a.json()}}),{data:L=[],isLoading:J}=p({queryKey:["/api/time-off/daily-time-sheets",t,r],queryFn:async()=>{const s=new URLSearchParams;t&&s.append("dateFrom",t),t&&s.append("dateTo",t),r&&r!=="all"&&s.append("employeeId",r);const a=await fetch(`/api/time-off/daily-time-sheets?${s}`);if(!a.ok)throw new Error("Error al cargar hojas de tiempo");return a.json()}}),{data:S=[]}=p({queryKey:["/api/hr/employees"],queryFn:async()=>{const s=await fetch("/api/hr/employees");if(!s.ok)throw new Error("Error al cargar empleados");return s.json()}});p({queryKey:["/api/time-off/work-schedules"],queryFn:async()=>{const s=await fetch("/api/time-off/work-schedules?active=true");if(!s.ok)throw new Error("Error al cargar horarios");return s.json()}});const{data:l}=p({queryKey:["/api/time-off/time-stats",r,t],queryFn:async()=>{const s=new URLSearchParams;r&&s.append("employeeId",r);const a=new Date(t);s.append("month",(a.getMonth()+1).toString()),s.append("year",a.getFullYear().toString());const j=await fetch(`/api/time-off/time-stats?${s}`);if(!j.ok)throw new Error("Error al cargar estad√≠sticas");return j.json()},enabled:!!r}),T=X({mutationFn:async s=>{const a={...s,date:s.timestamp.split("T")[0]},j=await fetch("/api/time-off/time-records",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!j.ok)throw new Error("Error al crear registro");return j.json()},onSuccess:()=>{w.invalidateQueries({queryKey:["/api/time-off/time-records"]}),w.invalidateQueries({queryKey:["/api/time-off/daily-time-sheets"]}),w.invalidateQueries({queryKey:["/api/time-off/time-stats"]}),b(!1),i.reset(),_({title:"Registro creado",description:"El registro de tiempo ha sido guardado correctamente"})},onError:()=>{_({title:"Error",description:"No se pudo crear el registro de tiempo",variant:"destructive"})}}),z=s=>{T.mutate(s)},G=s=>M.find(a=>a.value===s)||M[0],u=s=>new Date(s).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),O=s=>new Date(s).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});return $||J?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})}):e.jsx(Z,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Control de Horas Trabajadas"}),e.jsx("p",{className:"text-gray-600",children:"Gestiona registros de entrada, salida y control de asistencias"})]}),e.jsxs(ee,{open:Q,onOpenChange:b,children:[e.jsx(se,{asChild:!0,children:e.jsxs(E,{children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Nuevo Registro"]})}),e.jsxs(re,{className:"max-w-md",children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Registrar Tiempo"}),e.jsx(le,{children:"Crear un registro manual de tiempo para un empleado"})]}),e.jsx(ne,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(z),className:"space-y-4",children:[e.jsx(c,{control:i.control,name:"employeeId",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Empleado"}),e.jsxs(R,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(x,{children:e.jsx(D,{children:e.jsx(F,{placeholder:"Seleccionar empleado"})})}),e.jsx(k,{children:S.map(a=>e.jsxs(g,{value:a.id.toString(),children:[a.fullName," - ",a.position]},a.id))})]}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"recordType",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Tipo de Registro"}),e.jsxs(R,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(x,{children:e.jsx(D,{children:e.jsx(F,{placeholder:"Seleccionar tipo"})})}),e.jsx(k,{children:M.map(a=>e.jsx(g,{value:a.value,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.icon}),a.label]})},a.value))})]}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"timestamp",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Fecha y Hora"}),e.jsx(x,{children:e.jsx(H,{type:"datetime-local",...s,defaultValue:new Date().toISOString().slice(0,16)})}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"location",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Ubicaci√≥n"}),e.jsx(x,{children:e.jsx(H,{placeholder:"Ubicaci√≥n del registro",...s})}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"manualReason",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Motivo del Registro Manual"}),e.jsx(x,{children:e.jsx(V,{placeholder:"Explica por qu√© se registra manualmente",rows:3,...s})}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"notes",render:({field:s})=>e.jsxs(d,{children:[e.jsx(m,{children:"Notas (Opcional)"}),e.jsx(x,{children:e.jsx(V,{placeholder:"Observaciones adicionales",rows:2,...s})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(E,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(E,{type:"submit",disabled:T.isPending,children:T.isPending?"Guardando...":"Guardar Registro"})]})]})})]})]})]}),e.jsxs(y,{children:[e.jsx(f,{children:e.jsx(N,{children:"Filtros"})}),e.jsx(v,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Fecha"}),e.jsx(H,{type:"date",value:t,onChange:s=>U(s.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Empleado"}),e.jsxs(R,{value:r,onValueChange:B,children:[e.jsx(D,{children:e.jsx(F,{placeholder:"Todos los empleados"})}),e.jsxs(k,{children:[e.jsx(g,{value:"all",children:"Todos los empleados"}),S.map(s=>e.jsx(g,{value:s.id.toString(),children:s.fullName},s.id))]})]})]})]})})]}),r&&l&&e.jsxs(y,{children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Estad√≠sticas del Mes"]}),e.jsxs(I,{children:["Resumen de horas trabajadas para ",(P=S.find(s=>s.id.toString()===r))==null?void 0:P.fullName]})]}),e.jsx(v,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:l.totalHours}),e.jsx("div",{className:"text-sm text-gray-500",children:"Horas Totales"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.totalRegularHours}),e.jsx("div",{className:"text-sm text-gray-500",children:"Horas Regulares"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:l.totalOvertimeHours}),e.jsx("div",{className:"text-sm text-gray-500",children:"Horas Extra"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:l.daysWorked}),e.jsx("div",{className:"text-sm text-gray-500",children:"D√≠as Trabajados"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:l.daysAbsent}),e.jsx("div",{className:"text-sm text-gray-500",children:"D√≠as Ausente"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:l.daysLate}),e.jsx("div",{className:"text-sm text-gray-500",children:"D√≠as Tarde"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-indigo-600",children:l.totalLateMinutes}),e.jsx("div",{className:"text-sm text-gray-500",children:"Min. Tarde"})]})]})})]}),e.jsxs(y,{children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-5 w-5"}),"Resumen Diario de Horas"]}),e.jsx(I,{children:"Resumen calculado de horas trabajadas por empleado y d√≠a"})]}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[L.map(s=>e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:s.employeeName}),e.jsx(o,{variant:"outline",children:s.employeePosition})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[s.isLate&&e.jsxs(o,{className:"bg-yellow-500 text-white",children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Tardanza (",s.lateMinutes," min)"]}),s.isAbsent?e.jsxs(o,{className:"bg-red-500 text-white",children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"Ausente"]}):e.jsxs(o,{className:"bg-green-500 text-white",children:[e.jsx(me,{className:"h-3 w-3 mr-1"}),"Presente"]}),s.isJustified&&e.jsx(o,{className:"bg-blue-500 text-white",children:"Justificado"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Entrada"}),e.jsx("p",{className:"font-medium",children:s.checkInTime?u(s.checkInTime):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Salida"}),e.jsx("p",{className:"font-medium",children:s.checkOutTime?u(s.checkOutTime):"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Horas Regulares"}),e.jsx("p",{className:"font-medium text-green-600",children:s.regularHours})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Horas Extra"}),e.jsx("p",{className:"font-medium text-purple-600",children:s.overtimeHours})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Total Horas"}),e.jsx("p",{className:"font-medium text-blue-600",children:s.totalHours})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Fecha"}),e.jsx("p",{className:"font-medium",children:O(s.date)})]})]}),s.notes&&e.jsx("div",{className:"mt-3 p-2 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})})]},s.id)),L.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay registros de tiempo para los filtros seleccionados"})]})})]}),e.jsxs(y,{children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5"}),"Registros de Tiempo Detallados"]}),e.jsx(I,{children:"Todos los registros de entrada, salida y pausas por empleado"})]}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[q.map(s=>{const a=G(s.recordType);return e.jsxs("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(K,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:s.employeeName}),e.jsxs(o,{className:`${a.color} text-white`,children:[e.jsx("span",{className:"mr-1",children:a.icon}),a.label]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-lg font-mono",children:u(s.timestamp)}),s.isManualEntry&&e.jsx(o,{variant:"outline",children:"Manual"})]})]}),e.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Fecha y Hora"}),e.jsxs("p",{className:"font-medium",children:[O(s.date)," - ",u(s.timestamp)]})]}),s.location&&e.jsxs("div",{children:[e.jsxs("p",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),"Ubicaci√≥n"]}),e.jsx("p",{className:"font-medium",children:s.location})]}),s.registeredByName&&e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500",children:"Registrado por"}),e.jsx("p",{className:"font-medium",children:s.registeredByName})]})]}),s.manualReason&&e.jsx("div",{className:"mt-3 p-2 bg-yellow-50 border border-yellow-200 rounded",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Motivo de registro manual:"})," ",s.manualReason]})}),s.notes&&e.jsx("div",{className:"mt-3 p-2 bg-gray-50 rounded",children:e.jsx("p",{className:"text-sm text-gray-600",children:s.notes})})]},s.id)}),q.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No hay registros de tiempo para los filtros seleccionados"})]})})]})]})})}export{ge as default};
