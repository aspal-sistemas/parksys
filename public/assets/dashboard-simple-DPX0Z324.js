import{u as b,j as e,aX as q,f as i,g as n,h as l,U as K,i as c,b as H,a0 as Q,ar as z,aY as G,b5 as k,bk as J,b8 as L,b9 as T,ba as S,bl as R,bd as Z,be as ee,bf as se,b0 as E,o as A,m as ae,bc as te}from"./index-D5qLf1ib.js";import{B as re}from"./BarChart-BX_xVycl.js";function ce(){const{data:u=[],isLoading:F}=b({queryKey:["/api/visitor-counts"],retry:1}),{data:m=[],isLoading:P}=b({queryKey:["/api/park-evaluations/export-all"],retry:1}),{data:h=[],isLoading:I}=b({queryKey:["/api/feedback"],queryFn:async()=>{const s=await fetch("/api/feedback?limit=1000");if(!s.ok)throw new Error("Failed to fetch feedback");return s.json()},retry:1}),{data:f,isLoading:B}=b({queryKey:["/api/parks"],retry:1}),M=F||P||I||B,p=(f==null?void 0:f.data)||f||[],t=(u==null?void 0:u.data)||u||[],d=(m==null?void 0:m.evaluations)||(m==null?void 0:m.data)||m||[],v=(h==null?void 0:h.feedback)||(h==null?void 0:h.data)||h||[],w=Array.isArray(t)?t.reduce((s,a)=>s+(a.adults||0)+(a.children||0)+(a.seniors||0),0):0,D=Array.isArray(d)?d.length:0,C=Array.isArray(v)?v.length:0,g=Array.isArray(p)?p.length:0,N=Array.isArray(d)&&d.length>0?(d.reduce((s,a)=>s+(a.overall_rating||a.overallRating||0),0)/d.length).toFixed(1):0,O=Array.isArray(t)?t.reduce((s,a)=>{const o=a.countingMethod||"Directo";return s[o]=(s[o]||0)+((a.adults||0)+(a.children||0)+(a.seniors||0)),s},{}):{},U=Object.entries(O).map(([s,a])=>({method:s,count:a})),V=Array.isArray(t)?[{name:"Adultos",value:t.reduce((s,a)=>s+(a.adults||0),0),color:"#00a587"},{name:"Niños",value:t.reduce((s,a)=>s+(a.children||0),0),color:"#00d4aa"},{name:"Adultos Mayores",value:t.reduce((s,a)=>s+(a.seniors||0),0),color:"#067f5f"}]:[],W=Array.isArray(t)&&Array.isArray(p)?p.map(s=>{const o=t.filter(x=>x.parkId===s.id).reduce((x,j)=>x+(j.adults||0)+(j.children||0)+(j.seniors||0),0);return{name:s.name,visitors:o}}).sort((s,a)=>a.visitors-s.visitors).slice(0,5):[],_=Array.isArray(t)?(()=>{const s=new Date,a=[];for(let o=6;o>=0;o--){const x=new Date(s);x.setDate(s.getDate()-o);const j=x.toISOString().split("T")[0],$=t.filter(r=>r.date===j).reduce((r,y)=>r+(y.adults||0)+(y.children||0)+(y.seniors||0),0),X=Array.isArray(d)?d.filter(r=>{try{return new Date(r.created_at||r.createdAt).toISOString().split("T")[0]===j}catch{return!1}}).length:0,Y=Array.isArray(v)?v.filter(r=>{try{return new Date(r.created_at||r.createdAt).toISOString().split("T")[0]===j}catch{return!1}}).length:0;try{a.push({date:x.toLocaleDateString("es-ES",{weekday:"short",day:"numeric"}),visitors:$,evaluations:X,feedback:Y})}catch(r){console.error("Error processing date:",x,r)}}return a})():[];return M?e.jsx(q,{title:"Dashboard Integral de Visitantes",subtitle:"Vista consolidada de visitantes, evaluaciones y retroalimentación",children:e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Cargando datos del dashboard..."})]})})}):e.jsx(q,{title:"Dashboard Integral de Visitantes",subtitle:"Vista consolidada de visitantes, evaluaciones y retroalimentación",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600",children:"Total Visitantes"}),e.jsx(K,{className:"h-4 w-4 text-blue-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:w.toLocaleString()}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Registros históricos"})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600",children:"Evaluaciones"}),e.jsx(H,{className:"h-4 w-4 text-yellow-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:D}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Promedio: ",N," ⭐"]})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600",children:"Retroalimentación"}),e.jsx(Q,{className:"h-4 w-4 text-green-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:C}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Comentarios ciudadanos"})]})]}),e.jsxs(i,{children:[e.jsxs(n,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(l,{className:"text-sm font-medium text-gray-600",children:"Parques Activos"}),e.jsx(z,{className:"h-4 w-4 text-purple-600"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:g}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"En sistema"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5 text-blue-600"}),"Tendencias (Últimos 7 días)"]})}),e.jsx(c,{children:e.jsx(k,{width:"100%",height:300,children:e.jsxs(J,{data:_,children:[e.jsx(L,{dataKey:"date"}),e.jsx(T,{}),e.jsx(S,{}),e.jsx(R,{type:"monotone",dataKey:"visitors",stroke:"#00a587",strokeWidth:2,name:"Visitantes"}),e.jsx(R,{type:"monotone",dataKey:"evaluations",stroke:"#f59e0b",strokeWidth:2,name:"Evaluaciones"}),e.jsx(R,{type:"monotone",dataKey:"feedback",stroke:"#10b981",strokeWidth:2,name:"Feedback"})]})})})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5 text-purple-600"}),"Distribución Demográfica"]})}),e.jsx(c,{children:e.jsx(k,{width:"100%",height:300,children:e.jsxs(Z,{children:[e.jsx(ee,{data:V,cx:"50%",cy:"50%",outerRadius:80,dataKey:"value",label:({name:s,percent:a})=>`${s}: ${(a*100).toFixed(0)}%`,children:V.map((s,a)=>e.jsx(se,{fill:s.color},`cell-${a}`))}),e.jsx(S,{})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-green-600"}),"Top Parques por Visitantes"]})}),e.jsx(c,{children:e.jsx("div",{className:"space-y-3",children:W.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{variant:"secondary",className:"w-6 h-6 p-0 flex items-center justify-center text-xs",children:a+1}),e.jsx("span",{className:"text-sm font-medium",children:s.name})]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.visitors.toLocaleString()," visitantes"]})]},s.name))})})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-orange-600"}),"Métodos de Registro"]})}),e.jsx(c,{children:e.jsx(k,{width:"100%",height:250,children:e.jsxs(re,{data:U,children:[e.jsx(L,{dataKey:"method"}),e.jsx(T,{}),e.jsx(S,{}),e.jsx(te,{dataKey:"count",fill:"#00a587"})]})})})]})]}),e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs(l,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-blue-600"}),"Resumen Ejecutivo"]})}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"Participación Ciudadana"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[D+C," interacciones registradas"]}),e.jsxs(A,{variant:"secondary",className:"mt-2",children:[g>0?((D+C)/g).toFixed(1):0," por parque"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"Satisfacción"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Calificación promedio: ",N,"/5"]}),e.jsx(A,{variant:parseFloat(N)>=4?"default":"secondary",className:"mt-2",children:parseFloat(N)>=4?"Excelente":"Bueno"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-semibold text-gray-900",children:"Cobertura"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:[g," parques en sistema"]}),e.jsxs(A,{variant:"outline",className:"mt-2",children:[w>0?(w/g).toFixed(0):0," visitantes/parque"]})]})]})})]})]})})}export{ce as default};
