MÃ“DULO DE SEGURIDAD - DESCRIPCIÃ“N TÃ‰CNICA COMPLETA
ðŸ“‹ OVERVIEW GENERAL
El mÃ³dulo de Seguridad es un sistema integral de gestiÃ³n de seguridad corporativa que incluye 3 submÃ³dulos principales:

Cambiar ContraseÃ±a - GestiÃ³n de contraseÃ±as de usuarios
Mi Actividad - Historial personal de actividades
Admin Seguridad - Panel administrativo de seguridad
ðŸ—ï¸ ARQUITECTURA DE BASE DE DATOS
Tablas Principales:
-- Tabla de logs de auditorÃ­a
audit_logs {
  id: serial PRIMARY KEY,
  user_id: integer,
  username: text,
  action: text,
  ip_address: text,
  user_agent: text,
  success: boolean,
  details: jsonb,
  timestamp: timestamp
}
-- Intentos de login
login_attempts {
  id: serial PRIMARY KEY,
  username: text NOT NULL,
  ip_address: text NOT NULL,
  user_agent: text,
  success: boolean NOT NULL,
  failure_reason: text,
  attempted_at: timestamp DEFAULT NOW()
}
-- Bloqueos de cuenta
account_lockouts {
  id: serial PRIMARY KEY,
  username: text NOT NULL,
  ip_address: text NOT NULL,
  locked_at: timestamp DEFAULT NOW(),
  locked_until: timestamp NOT NULL,
  attempt_count: integer NOT NULL,
  is_active: boolean DEFAULT true
}
-- Tokens de recuperaciÃ³n de contraseÃ±a
password_reset_tokens {
  id: serial PRIMARY KEY,
  user_id: integer REFERENCES users(id),
  token: text NOT NULL UNIQUE,
  email: text NOT NULL,
  expires_at: timestamp NOT NULL,
  is_used: boolean DEFAULT false,
  created_at: timestamp DEFAULT NOW()
}
-- Logs de actividad de usuario
user_activity_logs {
  id: serial PRIMARY KEY,
  user_id: integer,
  username: text,
  action: text,
  ip_address: text,
  user_agent: text,
  details: jsonb,
  success: boolean,
  timestamp: timestamp DEFAULT NOW()
}
ðŸ”§ BACKEND - SERVICIOS Y APIS
SecurityService (Clase Principal)
ConfiguraciÃ³n de seguridad:

const SECURITY_CONFIG = {
  MAX_LOGIN_ATTEMPTS: 5,
  LOCKOUT_DURATION_MINUTES: 15,
  PASSWORD_RESET_TOKEN_EXPIRY_MINUTES: 30,
  MIN_PASSWORD_LENGTH: 8,
  PASSWORD_HISTORY_COUNT: 5,
  SESSION_TIMEOUT_MINUTES: 120
};
Funcionalidades Principales:
1. LÃ­mite de Intentos de Login

Registra intentos exitosos/fallidos
Bloqueo automÃ¡tico despuÃ©s de 5 intentos fallidos
Bloqueo temporal de 15 minutos
DetecciÃ³n de IP sospechosas
2. PolÃ­tica de ContraseÃ±as Robustas

MÃ­nimo 8 caracteres
MayÃºsculas, minÃºsculas, nÃºmeros, caracteres especiales
ValidaciÃ³n contra contraseÃ±as comunes
Hash con bcrypt (12 salt rounds)
3. AuditorÃ­a de Accesos

Registro completo de todas las actividades
Tracking de IP, User Agent, timestamp
Detalles JSON para contexto adicional
4. RecuperaciÃ³n de ContraseÃ±as

Tokens criptogrÃ¡ficos Ãºnicos
ExpiraciÃ³n en 30 minutos
ValidaciÃ³n y marcado como usado
Endpoints API:
// Actividad personal
GET /api/security/activity
- PaginaciÃ³n: page, limit
- Filtrado por usuario autenticado
- Ordenado por timestamp DESC
// Cambio de contraseÃ±a
POST /api/auth/change-password
Body: { currentPassword, newPassword }
- ValidaciÃ³n de contraseÃ±a actual
- ValidaciÃ³n de polÃ­tica de contraseÃ±as
- Hash y actualizaciÃ³n segura
// EstadÃ­sticas admin (solo admin)
GET /api/admin/security/stats?days=30
- Total de logins
- Logins fallidos
- Tasa de Ã©xito
- Usuarios activos
- Cuentas bloqueadas
// Actividad sospechosa (solo admin)
GET /api/admin/security/suspicious-activity?hours=24
- Intentos fallidos recientes
- Patrones sospechosos de IP
- Actividades no exitosas
// Desbloquear cuenta (solo admin)
POST /api/admin/unlock-account
Body: { username }
- Desactivar bloqueos activos
- NotificaciÃ³n de desbloqueo
ðŸŽ¨ FRONTEND - COMPONENTES Y PÃGINAS
1. CAMBIAR CONTRASEÃ‘A (/security/change-password)
CaracterÃ­sticas:

Formulario con 3 campos: contraseÃ±a actual, nueva, confirmar
Botones de mostrar/ocultar contraseÃ±a en todos los campos
Indicador de fortaleza de contraseÃ±a (dÃ©bil/medio/fuerte)
ValidaciÃ³n en tiempo real
Mensajes de error especÃ­ficos
Funcionalidades:

// ValidaciÃ³n de fortaleza
const calculatePasswordStrength = (password: string) => {
  let score = 0;
  if (password.length >= 8) score++;
  if (/[A-Z]/.test(password)) score++;
  if (/[a-z]/.test(password)) score++;
  if (/\d/.test(password)) score++;
  if (/[^A-Za-z0-9]/.test(password)) score++;
  
  return score < 3 ? 'weak' : score < 5 ? 'medium' : 'strong';
};
2. MI ACTIVIDAD (/security/activity)
CaracterÃ­sticas:

Lista paginada del historial personal
10 registros por pÃ¡gina
Iconos especÃ­ficos por tipo de actividad:
ðŸŸ¢ Login exitoso
ðŸ”µ Logout
ðŸŸ£ Cambio de contraseÃ±a
ðŸ”´ Login fallido
âš« Otras actividades
InformaciÃ³n mostrada:

AcciÃ³n realizada
Fecha y hora
Estado (Ã©xito/fallo)
IP Address
User Agent (navegador)
Detalles adicionales
3. ADMIN SEGURIDAD (/admin/security)
Panel Administrativo con 3 pestaÃ±as:

PestaÃ±a 1: EstadÃ­sticas

Tarjetas con mÃ©tricas principales:
Total de logins (Ãºltimos 30 dÃ­as)
Logins fallidos
Tasa de Ã©xito
Usuarios activos
Cuentas bloqueadas
PestaÃ±a 2: Actividad Sospechosa

Lista de actividades no exitosas (Ãºltimas 24h)
Filtros por tiempo
InformaciÃ³n detallada:
Usuario
AcciÃ³n
IP Address
Timestamp
RazÃ³n del fallo
PestaÃ±a 3: GestiÃ³n de Cuentas

Herramienta para desbloquear cuentas manualmente
Input de username
BotÃ³n de desbloqueo
ConfirmaciÃ³n de acciÃ³n
ðŸ”’ CARACTERÃSTICAS DE SEGURIDAD AVANZADAS
1. DetecciÃ³n de Patrones Sospechosos
Multiple intentos fallidos desde misma IP
Intentos de login fuera de horario habitual
Cambios de contraseÃ±a frecuentes
Accesos desde ubicaciones inusuales
2. Sistema de Bloqueos Inteligente
Bloqueo progresivo (5, 15, 30 minutos)
Limpieza automÃ¡tica de bloqueos expirados
Desbloqueo manual por administradores
3. AuditorÃ­a Completa
Registro de TODAS las acciones del sistema
Metadatos completos (IP, navegador, timestamp)
Detalles contextuales en formato JSON
RetenciÃ³n configurable de logs
4. Notificaciones de Seguridad
Email de cambio de contraseÃ±a
Alertas de bloqueo de cuenta
Notificaciones de actividad sospechosa
ðŸš¦ PERMISOS Y ROLES
// NavegaciÃ³n del mÃ³dulo
menuItems = [
  { 
    id: "change-password", 
    label: "Cambiar ContraseÃ±a", 
    path: "/security/change-password", 
    permissions: [] // Todos los usuarios
  },
  { 
    id: "security-activity", 
    label: "Mi Actividad", 
    path: "/security/activity", 
    permissions: [] // Todos los usuarios
  },
  { 
    id: "admin-security", 
    label: "Admin Seguridad", 
    path: "/admin/security", 
    permissions: ["admin.security", "admin.all", "all"] // Solo admin
  }
]
ðŸ“Š FLUJO DE DATOS TÃPICO
Cambio de ContraseÃ±a:
Usuario ingresa contraseÃ±a actual + nueva contraseÃ±a
Backend valida contraseÃ±a actual con bcrypt
Nueva contraseÃ±a se valida contra polÃ­ticas
Hash de nueva contraseÃ±a con bcrypt
ActualizaciÃ³n en base de datos
Log de actividad registrado
Email de notificaciÃ³n (opcional)
Consulta de Actividad:
Frontend solicita actividades con paginaciÃ³n
Backend consulta audit_logs filtrando por user_id
Retorna datos paginados con metadatos
Frontend renderiza con iconos apropiados
Dashboard Admin:
Consulta estadÃ­sticas agregadas
Consulta actividades sospechosas
Renderiza mÃ©tricas en tiempo real
Herramientas de gestiÃ³n disponibles
ðŸ› ï¸ TECNOLOGÃAS UTILIZADAS
Backend: Node.js + Express + TypeScript
Base de Datos: PostgreSQL con Drizzle ORM
AutenticaciÃ³n: JWT + bcrypt
Frontend: React + TypeScript + shadcn/ui
ValidaciÃ³n: Zod schemas
Estado: TanStack Query
Routing: Wouter
Estilo: Tailwind CSS